(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7688,5952,1685,9298],{7079:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/database/tables",function(){return n(47242)}])},14670:function(e,t,n){"use strict";n.d(t,{NK:function(){return m},Tf:function(){return h},Yb:function(){return d},cc:function(){return o},rg:function(){return c},uk:function(){return u}});var a=n(79147),s=n(27086),l=n(32999),i=n(54563);function r(e){console.error("Supabase grid error: ",e)}function o(e){let{editable:t}=e;return t?e:{...e,onAddColumn:void 0,onAddRow:void 0,onEditColumn:void 0,onDeleteColumn:void 0,onEditRow:void 0}}function c(e){return Array.isArray(e)?e.map(e=>{let[t,n]=e.split(":");if(t&&n)return{column:t,ascending:"asc"===n}}).filter(e=>void 0!==e):[]}function d(e){return Array.isArray(e)?e.map(e=>{let[t,n,...a]=e.split(":"),s=a.join(":"),l=i.o.find(e=>e.abbrev===n);if(t&&n&&l)return{column:t,operator:l.value,value:s||""}}).filter(e=>void 0!==e):[]}async function u(e,t,n,a,i){var o,c;let d=e.projectRef?function(e,t,n){let a=x(s.E_,e),l=localStorage.getItem(a);if(l)return JSON.parse(l)[n&&"public"!=n?"".concat(n,".").concat(t):t]}(e.projectRef,e.table.name,e.table.schema):void 0;if(!t.isInitialComplete&&void 0===a&&void 0===i&&((null==d?void 0:d.sorts)||(null==d?void 0:d.filters)))return{savedState:{sorts:d.sorts,filters:d.filters}};let u=(0,l.cv)(e.table,{projectRef:e.projectRef,tableId:e.tableId,editable:e.editable,defaultWidth:null===(o=e.gridProps)||void 0===o?void 0:o.defaultColumnWidth,onAddColumn:e.editable?e.onAddColumn:void 0,onExpandJSONEditor:e.onExpandJSONEditor,onExpandTextEditor:e.onExpandTextEditor});return n({type:"INIT_TABLE",payload:{table:e.table,gridProps:e.gridProps,gridColumns:u,savedState:d,editable:e.editable,onError:null!==(c=e.onError)&&void 0!==c?c:r}}),{savedState:{}}}function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],{table:n,columns:a,primaryKeys:s,relationships:l}=e,i=a.map(e=>{let n={position:e.ordinal_position,name:e.name,defaultValue:e.default_value,dataType:e.data_type,format:e.format,isPrimaryKey:!1,isIdentity:e.is_identity,isGeneratable:"BY DEFAULT"==e.identity_generation,isNullable:e.is_nullable,isUpdatable:e.is_updatable,isEncrypted:t.includes(e.name),enum:e.enums,comment:e.comment,foreignKey:{targetTableSchema:null,targetTableName:null,targetColumnName:null,deletionAction:void 0}},a=s.find(t=>t.name==e.name);n.isPrimaryKey=!!a;let i=l.find(t=>t.source_schema===e.schema&&t.source_table_name===e.table&&t.source_column_name===e.name);return i&&(n.foreignKey.targetTableSchema=i.target_table_schema,n.foreignKey.targetTableName=i.target_table_name,n.foreignKey.targetColumnName=i.target_column_name,n.foreignKey.deletionAction=i.deletion_action),n});return{name:n.name,comment:n.comment,schema:n.schema,columns:i}}let h=(0,a.Z)(function(e,t,n,a){let l;if(!e.table)return;let i={gridColumns:e.gridColumns,...void 0!==n&&{sorts:n},...void 0!==a&&{filters:a}},r=x(s.E_,t),o=localStorage.getItem(r),{name:c,schema:d}=e.table,u=d&&"public"!=d?"".concat(d,".").concat(c):c;l=o?{...l=JSON.parse(o),[u]:i}:{[u]:i},localStorage.setItem(r,JSON.stringify(l))},500);function x(e,t){return"".concat(e,"_").concat(t)}},64167:function(e,t,n){"use strict";n.d(t,{O:function(){return s}});var a=n(52322);let s=()=>(0,a.jsx)("span",{className:"sb-grid-empty-value opacity-50",children:"EMPTY"})},82875:function(e,t,n){"use strict";n.d(t,{rc:function(){return i},Fy:function(){return o},OX:function(){return f.O},rE:function(){return d},q2:function(){return u},fQ:function(){return p}});var a=n(52322),s=n(13096),l=n(2784);let i=e=>{let{value:t,children:n,onEscape:i,onEnter:r}=e,o=(0,l.useRef)(null),c=(0,s.nN)(o),d=(0,l.useCallback)(e=>{switch(e.key){case"Escape":e.stopPropagation(),i&&i(t);break;case"Enter":e.stopPropagation(),!e.shiftKey&&r&&(e.preventDefault(),r(t))}},[t]);return(0,l.useEffect)(()=>{c&&void 0!==r&&r(t)},[c]),(0,a.jsx)("div",{ref:o,onKeyDown:d,children:n})};var r=n(40386);let o=e=>{let{children:t,side:n,align:s,options:l,onSelect:i}=e;return(0,a.jsxs)(r.h_,{children:[(0,a.jsx)(r.$F,{children:t}),(0,a.jsx)(r.AW,{side:n,align:s,children:(0,a.jsxs)("div",{className:"dropdown-control",style:{maxHeight:"30vh"},children:[0===l.length&&(0,a.jsx)("p",{className:"dropdown-control__empty-text",children:"No more items"}),l.map(e=>(0,a.jsx)(r.Xi,{onClick:()=>i(e.value),children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[e.preLabel&&(0,a.jsx)("span",{className:"grow text-foreground-lighter",children:e.preLabel}),(0,a.jsx)("span",{children:e.label}),e.postLabel&&(0,a.jsx)("span",{className:"text-foreground-lighter",children:e.postLabel})]})},e.value))]})})]})};var c=n(79534);let d=e=>{let{width:t,height:n,value:s,language:l,readOnly:i=!1,onChange:r,onMount:o}=e;return(0,a.jsx)(c.default,{width:t,height:n||"200px",theme:"supabase",wrapperProps:{className:"grid-monaco-editor-container"},className:"grid-monaco-editor",defaultLanguage:l||"plaintext",defaultValue:s,onChange:r,onMount:function(e){e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})});let t=e.getModel().getPositionAt(null==s?void 0:s.length);e.setPosition(t),setTimeout(()=>{null==e||e.focus()},0),o&&o(e)},options:{readOnly:i,tabSize:2,fontSize:13,minimap:{enabled:!1},glyphMargin:!1,folding:!1,lineNumbers:"off",lineNumbersMinChars:0,scrollBeyondLastLine:!1,wordWrap:"on"}})},u=()=>(0,a.jsx)("span",{className:"null-value opacity-50",children:"NULL"});function m(e,t){return e.indexOf(t)>=0}var h=n(78478),x=n(59218);function p(e){let{gridRef:t}=e,{rows:n,gridColumns:a,selectedCellPosition:s}=(0,h.Qq)(),[i,r]=l.useState("Command");return l.useEffect(()=>{var e,t;r("windows"==((null===(e=navigator)||void 0===e?void 0:e.appVersion.indexOf("Win"))!==-1?"windows":(null===(t=navigator)||void 0===t?void 0:t.appVersion.indexOf("Mac"))!==-1?"macos":"unknown")?"Control":"Command")},[]),!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],[a,s]=l.useState(),i=a=>{if(!e||m(t,a.target.nodeName)||m(n,a.target.className))return;let l=a.metaKey&&a.shiftKey?"Command+Shift+".concat(a.key):a.metaKey?"Command+".concat(a.key):a.shiftKey&&"Enter"===a.key?"Shift+".concat(a.key):a.ctrlKey&&a.key?"Control+".concat(a.key):a.key;e[l]&&(l.includes("+")?(a.preventDefault(),e[l](a),s(null)):(s(a.key),a.preventDefault()))},r=t=>{e&&e[t.key]&&a===t.key&&(t.preventDefault(),e[t.key](t),s(null))};l.useEffect(()=>(window.addEventListener("keydown",i),window.addEventListener("keyup",r),()=>{window.removeEventListener("keydown",i),window.removeEventListener("keyup",r)}))}({["".concat(i,"+ArrowUp")]:e=>{if(e.stopPropagation(),s){var n;let e={idx:null!==(n=null==s?void 0:s.idx)&&void 0!==n?n:0,rowIdx:0};t.current.selectCell(e)}else t.current.scrollToCell({rowIdx:Number(0)})},["".concat(i,"+ArrowDown")]:e=>{if(e.stopPropagation(),s){var a;let e={idx:null!==(a=null==s?void 0:s.idx)&&void 0!==a?a:0,rowIdx:n.length>1?n.length-1:0};t.current.selectCell(e)}else t.current.scrollToCell({rowIdx:Number(n.length)})},["".concat(i,"+ArrowLeft")]:e=>{var n;e.stopPropagation();let l={idx:a.filter(e=>e.frozen).length,rowIdx:null!==(n=null==s?void 0:s.rowIdx)&&void 0!==n?n:0};t.current.selectCell(l)},["".concat(i,"+ArrowRight")]:e=>{var n,l;e.stopPropagation(),null===(n=t.current)||void 0===n||n.selectCell({idx:a.length-1,rowIdx:null!==(l=null==s?void 0:s.rowIdx)&&void 0!==l?l:0})},["".concat(i,"+c")]:e=>{if(e.stopPropagation(),s){let{idx:e,rowIdx:i}=s;if(e>0){var t,l;let s=a[e].key,r=null!==(l=null===(t=n[i])||void 0===t?void 0:t[s])&&void 0!==l?l:"",o=(0,x.Lw)(r);(0,x.vQ)(o)}}}},["INPUT","TEXTAREA","SELECT"]),null}var f=n(64167)},41303:function(e,t,n){"use strict";n.d(t,{Z:function(){return _}});var a=n(52322),s=n(2784),l=n(14670),i=n(83314),r=n(83033),o=n(94077),c=n(13096),d=n(50412),u=n(27792),m=n(17318),h=n(97110),x=n(64112),p=n(78478),f=n(82875),g=n(73579);let j=[{value:100,label:"100 rows"},{value:500,label:"500 rows"},{value:1e3,label:"1000 rows"}];var v=e=>{var t,n,v;let{isLoading:b=!1}=e,y=(0,p.Qq)(),N=(0,p.I0)(),w=(0,g._2)(),_=w.page,[{filter:C}]=(0,c.x3)({arrayKeys:["filter"]}),S=(0,l.Yb)(C),k=null!==(t=y.table)&&void 0!==t?t:void 0,E=(0,d.fN)(),{project:Z}=(0,i.d2)(),{data:T,isLoading:R,isSuccess:z,isError:A}=(0,o.H)({queryKey:[null==k?void 0:k.schema,null==k?void 0:k.name,"count"],projectRef:null==Z?void 0:Z.ref,connectionString:null==Z?void 0:Z.connectionString,table:k,filters:S,impersonatedRole:E.role},{keepPreviousData:!0,onSuccess(e){N({type:"SET_ROWS_COUNT",payload:e.count})}}),P=Math.ceil((null!==(n=null==T?void 0:T.count)&&void 0!==n?n:0)/w.rowsPerPage),L=(null!==(v=null==T?void 0:T.count)&&void 0!==v?v:0)>0?P:1;(0,s.useEffect)(()=>{_&&_>L&&w.setPage(L)},[_,L]),(0,s.useEffect)(()=>{},[y.selectedRows]);let[I,D]=(0,s.useState)(!1),F=()=>{U(),N({type:"SELECTED_ROWS_CHANGE",payload:{selectedRows:new Set}})},[O,q]=(0,s.useState)(!1),W=()=>{V(),N({type:"SELECTED_ROWS_CHANGE",payload:{selectedRows:new Set}})},U=()=>{let e=_-1;w.setPage(e)},V=()=>{let e=_+1;w.setPage(e)};return(0,a.jsxs)("div",{className:"sb-grid-pagination",children:[R&&(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Loading records count..."}),z&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.z,{icon:(0,a.jsx)(m.Z,{}),type:"outline",disabled:_<=1||R,onClick:()=>{_>1&&(y.selectedRows.size>=1?D(!0):U())},style:{padding:"3px 10px"}}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Page"}),(0,a.jsx)("div",{className:"sb-grid-pagination-input-container",children:(0,a.jsx)(h.Z,{value:_,onChange:function(e){let t=e.target.value,n=Number(t)>P?P:Number(t);w.setPage(n||1)},size:"tiny",style:{width:"3rem"},max:P,min:1})}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"of ".concat(L)}),(0,a.jsx)(u.z,{icon:(0,a.jsx)(x.Z,{}),type:"outline",disabled:_>=P||R,onClick:()=>{_<P&&(y.selectedRows.size>=1?q(!0):V())},style:{padding:"3px 10px"}}),(0,a.jsx)(f.Fy,{options:j,onSelect:function(e){let t=Number(e);w.setRowsPerPage(isNaN(t)?100:t)},side:"top",align:"start",children:(0,a.jsx)(u.z,{asChild:!0,type:"outline",style:{padding:"3px 10px"},children:(0,a.jsx)("span",{children:"".concat(w.rowsPerPage," rows")})})}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"".concat(T.count.toLocaleString()," ").concat(0===T.count||T.count>1?"records":"record")}),(0,a.jsx)(r.Z,{visible:I,title:"Confirm moving to previous page",confirmLabel:"Confirm",onCancel:()=>D(!1),onConfirm:()=>{F()},children:(0,a.jsx)("p",{className:"py-4 text-sm text-foreground-light",children:"The currently selected lines will be deselected, do you want to proceed?"})}),(0,a.jsx)(r.Z,{visible:O,title:"Confirm moving to next page",confirmLabel:"Confirm",onCancel:()=>q(!1),onConfirm:()=>{W()},children:(0,a.jsx)("p",{className:"py-4 text-sm text-foreground-light",children:"The currently selected lines will be deselected, do you want to proceed?"})})]}),A&&(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Error fetching records count. Please refresh the page."})]})},b=n(52111),y=n(24459),N=n(56009),w=n(32483),_=e=>{let{isLoading:t,isRefetching:n}=e,{id:s}=(0,y.UO)(),l=s?Number(s):void 0,{data:i}=(0,b.Z)(l),[{view:r="data"},o]=(0,c.x3)();return(0,a.jsxs)("div",{className:"flex min-h-9 overflow-hidden items-center px-5 w-full border-t",children:["data"===r&&(0,a.jsx)(v,{isLoading:t}),(0,a.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[i&&"data"===r&&(0,a.jsx)(w.Z,{table:i,isRefetching:n}),(0,a.jsx)(N.Z,{width:75,options:["definition","data"],activeOption:r,borderOverride:"border",onClickOption:e=>{"data"===e?o({view:void 0}):o({view:e})}})]})]})}},9596:function(e,t,n){"use strict";n.d(t,{SJ:function(){return l},k3:function(){return r},_O:function(){return g},$3:function(){return j}});var a=n(52322),s=n(82875);let l=e=>{let t=e.row[e.column.key];return null===t?(0,a.jsx)(s.q2,{}):(0,a.jsx)(a.Fragment,{children:t?"TRUE":"FALSE"})};n(2784);var i=n(64167);let r=e=>{let t=e.row[e.column.key];return null===t?(0,a.jsx)(s.q2,{}):""===t?(0,a.jsx)(i.O,{}):(("object"==typeof t||Array.isArray(t))&&(t=JSON.stringify(t)),(0,a.jsx)(a.Fragment,{children:t}))};var o=n(24990),c=n(39097),d=n.n(c),u=n(27792),m=n(64112),h=n(83314),x=n(44294),p=n(36554),f=n(73579);let g=e=>{var t;let{project:n}=(0,h.d2)(),l=(0,f._2)(),{projectRef:i,tableId:r,row:c,column:g}=e,j=r?Number(r):void 0,{data:v}=(0,x.yp)({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString,id:j}),b=(null!==(t=null==v?void 0:v.relationships)&&void 0!==t?t:[]).find(e=>e.source_schema===(null==v?void 0:v.schema)&&e.source_table_name===(null==v?void 0:v.name)&&e.source_column_name===g.name),{data:y}=(0,p.Bj)({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString,schema:null==b?void 0:b.target_table_schema}),N=null==y?void 0:y.find(e=>e.schema===(null==b?void 0:b.target_table_schema)&&e.name===b.target_table_name),w=c[g.key];return(0,a.jsxs)("div",{className:"sb-grid-foreign-key-formatter flex justify-between",children:[(0,a.jsx)("span",{className:"sb-grid-foreign-key-formatter__text",children:null===w?(0,a.jsx)(s.q2,{}):w}),void 0!==b&&void 0!==N&&null!==w&&(0,a.jsxs)(o.fC,{delayDuration:0,children:[(0,a.jsx)(o.xz,{asChild:!0,children:(0,a.jsx)(u.z,{type:"default",size:"tiny",className:"translate-y-[2px]",onClick:()=>{},style:{padding:"3px"},asChild:!0,children:(0,a.jsx)(d(),{href:"/project/".concat(i,"/editor/").concat(null==N?void 0:N.id,"?filter=").concat(null==b?void 0:b.target_column_name,"%3Aeq%3A").concat(w),onClick:()=>l.setSelectedSchemaName(b.target_table_schema),children:(0,a.jsx)(m.Z,{size:"tiny"})})})}),(0,a.jsx)(o.h_,{children:(0,a.jsx)(o.h_,{children:(0,a.jsxs)(o.VY,{side:"bottom",children:[(0,a.jsx)(o.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:"View referencing record"})})]})})})]})]})},j=e=>{let t=e.row[e.column.key];if(null===t)return(0,a.jsx)(s.q2,{});if(""===t)return(0,a.jsx)(s.OX,{});try{t=JSON.stringify(t)}catch(e){}return(0,a.jsx)(a.Fragment,{children:t})}},43386:function(e,t,n){"use strict";n.d(t,{Lx:function(){return W},x8:function(){return f},rj:function(){return z},F_:function(){return L}});var a=n(52322),s=n(24990),l=n(29966),i=n(11214),r=n(2784),o=n(92843),c=n(20103),d=n(42004),u=n(12203),m=n(45236),h=n(64112),x=n(78478),p=n(5933);function f(e){let{column:t,columnType:n,isPrimaryKey:f,isEncrypted:g,format:j,foreignKey:v}=e,b=r.useRef(null),y=(0,x.I0)(),N=t.idx,w=t.key,_="array"==n?"".concat(j.replace("_",""),"[]"):j,C=(0,x.Qq)(),S=t.name;(0,r.useEffect)(()=>{C.gridColumns[N].key!=w&&y({type:"UPDATE_COLUMN_IDX",payload:{columnKey:w,columnIdx:N}})},[w,N,C.gridColumns]);let[{isDragging:k},E]=(0,o.c)({type:"column-header",item:()=>({key:w,index:N}),canDrag:()=>!t.frozen,collect:e=>({isDragging:e.isDragging()})}),[{handlerId:Z},T]=(0,c.L)({accept:"column-header",collect:e=>({handlerId:e.getHandlerId()}),hover(e,n){var a;if(!b.current||t.frozen)return;let s=e.index,l=e.key;if(s===N)return;let i=null===(a=b.current)||void 0===a?void 0:a.getBoundingClientRect(),r=(i.right-i.left)/2,o=n.getClientOffset().x-i.left;s<N&&o<r||s>N&&o>r||(R(l,w),e.index=N)}}),R=(e,t)=>{e!=t&&y({type:"MOVE_COLUMN",payload:{fromKey:e,toKey:t}})},z=t.frozen?"sb-grid-column-header--cursor":"";return E(T(b)),(0,a.jsx)("div",{ref:b,"data-handler-id":Z,style:{opacity:k?0:1},className:"w-full",children:(0,a.jsxs)("div",{className:"sb-grid-column-header ".concat(z),children:[(0,a.jsxs)("div",{className:"sb-grid-column-header__inner",children:[function(e,t){let{name:n,foreignKey:r}=t;return"foreign_key"===e?(0,a.jsxs)(s.fC,{delayDuration:0,children:[(0,a.jsx)(s.xz,{children:(0,a.jsx)(m.Z,{size:"tiny",strokeWidth:2})}),(0,a.jsx)(s.h_,{children:(0,a.jsxs)(s.VY,{side:"bottom",children:[(0,a.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-foreground-light",children:"Foreign key relation:"}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("p",{className:"text-xs text-foreground",children:n}),(0,a.jsx)(h.Z,{size:"tiny",strokeWidth:1.5}),(0,a.jsxs)("p",{className:"text-xs text-foreground",children:[null==r?void 0:r.targetTableSchema,".",null==r?void 0:r.targetTableName,".",null==r?void 0:r.targetColumnName]})]}),(null==r?void 0:r.deletionAction)!==i.N.NO_ACTION&&(0,a.jsxs)("p",{className:"text-xs text-foreground mt-1",children:["On delete: ",(0,l.s8)(null==r?void 0:r.deletionAction)]})]})})]})})]}):null}(n,{name:t.name,foreignKey:v}),f&&(0,a.jsxs)(s.fC,{delayDuration:0,children:[(0,a.jsx)(s.xz,{children:(0,a.jsx)("div",{className:"sb-grid-column-header__inner__primary-key",children:(0,a.jsx)(d.Z,{size:"tiny",strokeWidth:2})})}),(0,a.jsx)(s.h_,{children:(0,a.jsxs)(s.VY,{side:"bottom",children:[(0,a.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:"Primary key"})})]})})]}),(0,a.jsx)("span",{className:"sb-grid-column-header__inner__name",title:S,children:t.name}),(0,a.jsx)("span",{className:"sb-grid-column-header__inner__format",children:_}),g&&(0,a.jsxs)(s.fC,{delayDuration:0,children:[(0,a.jsx)(s.xz,{children:(0,a.jsx)(u.Z,{size:"tiny",strokeWidth:2})}),(0,a.jsx)(s.h_,{children:(0,a.jsxs)(s.VY,{side:"bottom",children:[(0,a.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:"Encrypted column"})})]})})]})]}),(0,a.jsx)(p.ov,{column:t,isEncrypted:g})]})})}var g=n(79147),j=n(47370);n(17917);var v=n(64018),b=n(27792),y=n(59218),N=n(83314),w=n(33105),_=n(54175),C=n(33063),S=n(13096),k=n(5388),E=n(71623);function Z(e,t){let{show:n}=(0,E.av)();return(0,a.jsx)(j.X2,{...t,onContextMenu:function(e){n(e,{id:p.ep,props:{rowIdx:t.rowIdx}})}},e)}let T=e=>{var t;return null!==(t=null==e?void 0:e.idx)&&void 0!==t?t:-1},R=(0,g.Z)((e,t,n)=>{n({type:"UPDATE_COLUMN_SIZE",payload:{index:e,width:Math.round(t)}})},500),z=(0,v.X$)((0,r.forwardRef)((e,t)=>{var n;let{width:s,height:l,containerClass:i,gridClass:o,rowClass:c,rows:d,error:u,isLoading:m,isSuccess:h,isError:p,filters:f,setParams:g,updateRow:v,onAddRow:E,onImportData:z,onEditForeignKeyColumnValue:A}=e,P=(0,x.I0)(),L=(0,x.Qq)();async function I(e,t){let n=e[t.indexes[0]],a=d.find(e=>e.idx==n.idx),s=Object.keys(n).find(e=>n[e]!==a[e]);s&&v(a,{[s]:n[s]})}let D=(0,r.useRef)(null);function F(){var e,t,n;let a=null===(n=D.current)||void 0===n?void 0:n.row[null===(t=D.current)||void 0===t?void 0:null===(e=t.column)||void 0===e?void 0:e.key],s=(0,y.Lw)(a);s&&(0,k.vQ)(s)}(0,S.aL)({"Command+c":e=>{e.stopPropagation(),F()},"Control+c":e=>{e.stopPropagation(),F()}},["INPUT","TEXTAREA"]);let O=L.table,{project:q}=(0,N.d2)(),{data:W}=(0,C.X)({projectRef:null==q?void 0:q.ref,connectionString:null==q?void 0:q.connectionString,schema:null!==(n=null==O?void 0:O.schema)&&void 0!==n?n:void 0}),U=()=>{g(e=>({...e,filter:[]}))};return(0,a.jsx)("div",{className:"".concat(i," flex flex-col"),style:{width:s||"100%",height:l||"50vh"},children:(0,a.jsx)(j.ZP,{ref:t,className:"".concat(o," flex-grow"),rowClass:c,columns:L.gridColumns,rows:null!=d?d:[],renderers:{renderRow:Z,noRowsFallback:(0,a.jsxs)("div",{style:{width:"calc(100vw - 255px - 55px)"},children:[m&&(0,a.jsx)("div",{className:"p-2 col-span-full",children:(0,a.jsx)(_.A,{})}),p&&(0,a.jsx)("div",{className:"p-2 col-span-full",children:(0,a.jsx)(w.Z,{error:u,subject:"Failed to retrieve rows from table"})}),h&&(0,a.jsx)(a.Fragment,{children:0===(null!=f?f:[]).length?(0,a.jsxs)("div",{style:{height:"calc(100% - 35px)"},className:"flex flex-col items-center justify-center col-span-full",children:[(0,a.jsx)("p",{className:"text-sm text-light",children:"This table is empty"}),void 0!==E&&void 0!==z&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"text-sm text-light mt-1",children:"Add rows to your table to get started."}),(0,a.jsx)("div",{className:"flex items-center space-x-2 mt-4",children:void 0!==E&&void 0!==z&&(0,a.jsx)(b.z,{type:"default",onClick:z,children:"Import data via CSV"})})]})]}):(0,a.jsxs)("div",{style:{height:"calc(100% - 35px)"},className:"flex flex-col items-center justify-center col-span-full",children:[(0,a.jsx)("p",{className:"text-sm text-light",children:"The filters applied has returned no results from this table"}),(0,a.jsx)("div",{className:"flex items-center space-x-2 mt-4",children:(0,a.jsx)(b.z,{type:"default",onClick:()=>U(),children:"Remove all filters"})})]})})]})},rowKeyGetter:T,selectedRows:L.selectedRows,onColumnResize:function(e,t){R(e,t,P)},onRowsChange:I,onSelectedCellChange:function(e){D.current=e,P({type:"SELECTED_CELL_CHANGE",payload:{position:{idx:e.column.idx,rowIdx:e.rowIdx}}})},onSelectedRowsChange:function(e){P({type:"SELECTED_ROWS_CHANGE",payload:{selectedRows:e}})},onCellDoubleClick:e=>(function(e,t){let n=function(e){var t,n;let{targetTableSchema:a,targetTableName:s,targetColumnName:l}=null!==(n=null==O?void 0:null===(t=O.columns.find(t=>t.name==e))||void 0===t?void 0:t.foreignKey)&&void 0!==n?n:{};return null==W?void 0:W.find(e=>e.target_schema==a&&e.target_table==s&&e.target_columns==l)}(t.name);n&&A({foreignKey:n,row:e,column:t})})(e.row,e.column)})})}));var A=n(77181),P=n(27086);let L={key:P.W,name:"",idx:0,width:65,maxWidth:65,resizable:!1,sortable:!1,frozen:!0,isLastFrozenColumn:!1,renderHeaderCell:e=>{let[t,n]=(0,j.Gt)();return(0,a.jsx)(F,{"aria-label":"Select All",tabIndex:e.tabIndex,value:t,onChange:e=>n({type:"HEADER",checked:e})})},renderCell:e=>{let[t,n]=(0,j.Gt)();return(0,a.jsx)(D,{"aria-label":"Select",tabIndex:e.tabIndex,value:t,row:e.row,onChange:(t,a)=>{n({type:"ROW",row:e.row,checked:t,isShiftClick:a})},onClick:I})},renderGroupCell:e=>{let[t,n]=(0,j.Gt)();return(0,a.jsx)(D,{"aria-label":"Select Group",tabIndex:e.tabIndex,value:t,onChange:t=>{n({type:"ROW",row:e.row,checked:t,isShiftClick:!1})},onClick:I})},parent:void 0,level:0,minWidth:0,draggable:!1};function I(e){e.stopPropagation()}function D(e){let{row:t,value:n,tabIndex:l,disabled:i,onClick:r,onChange:o,"aria-label":c,"aria-labelledby":d}=e,{onEditRow:u}=(0,x.Qq)();return(0,a.jsxs)("div",{className:"sb-grid-select-cell__formatter",children:[(0,a.jsx)("input",{"aria-label":c,"aria-labelledby":d,tabIndex:l,type:"checkbox",className:"rdg-row__select-column__select-action",disabled:i,checked:n,onChange:function(e){o(e.target.checked,e.nativeEvent.shiftKey)},onClick:r}),u&&t&&(0,a.jsxs)(s.fC,{delayDuration:0,children:[(0,a.jsx)(s.xz,{asChild:!0,children:(0,a.jsx)(b.z,{type:"text",size:"tiny",className:"rdg-row__select-column__edit-action",icon:(0,a.jsx)(A.Z,{size:"tiny",strokeWidth:1.5,className:"text-foreground"}),onClick:function(e){e.stopPropagation(),u&&t&&u(t)},style:{padding:"3px"}})}),(0,a.jsx)(s.h_,{children:(0,a.jsxs)(s.VY,{side:"bottom",children:[(0,a.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:"Expand row"})})]})})]})]})}function F(e){let{disabled:t,tabIndex:n,value:s,onChange:l,onClick:i,"aria-label":r,"aria-labelledby":o}=e;return(0,a.jsx)("div",{className:"sb-grid-select-cell__header",children:(0,a.jsx)("input",{"aria-label":r,"aria-labelledby":o,tabIndex:n,type:"checkbox",className:"sb-grid-select-cell__header__input",disabled:t,checked:s,onChange:function(e){l(e.target.checked,e.nativeEvent.shiftKey)},onClick:i})})}var O=n(14279),q=n(9596);let W={key:P.uZ,name:"",idx:999,width:100,maxWidth:100,resizable:!1,sortable:!1,frozen:!1,isLastFrozenColumn:!1,renderHeaderCell:()=>(0,a.jsx)(U,{"aria-label":"Add New Row"}),renderCell:q.k3,parent:void 0,level:0,minWidth:0,draggable:!1},U=e=>{let{}=e,{onAddColumn:t}=(0,x.Qq)();return(0,a.jsx)("div",{className:"sb-grid-add-column",children:(0,a.jsx)(b.z,{block:!0,type:"text",onClick:t,icon:(0,a.jsx)(O.Z,{})})})}},32483:function(e,t,n){"use strict";n.d(t,{Z:function(){return m}});var a=n(52322),s=n(85945),l=n(82671),i=n(69786),r=n(2784),o=n(27792);let c=new(n(10978)).Z({concurrency:1});var d=n(60595),u=n(83030),m=e=>{let{table:t,isRefetching:n}=e,{ref:m}=(0,l.UO)(),h=(0,s.NL)(),x=i.M.query(m,[t.schema,t.name]),[p,f]=(0,r.useState)();async function g(){await h.invalidateQueries(x)}return(0,r.useEffect)(()=>{let e,t=!0;return c.on("active",()=>{e&&clearTimeout(e),t&&f("saving")}),c.on("idle",()=>{e&&clearTimeout(e),e=window.setTimeout(()=>f(void 0),2e3),t&&f("saved")}),()=>{t=!1,e&&clearTimeout(e)}},[]),(0,a.jsx)(o.z,{type:"text",icon:p?"saved"===p?(0,a.jsx)(u.Z,{className:"text-brand",strokeWidth:3}):(0,a.jsx)(a.Fragment,{}):(0,a.jsx)(d.Z,{className:"text-foreground-muted",strokeWidth:1.5}),onClick:()=>{p||g()},loading:n||"saving"===p,children:p?"saved"===p?"Changes saved":"Saving changes":"Refresh"})}},54563:function(e,t,n){"use strict";n.d(t,{o:function(){return f},E:function(){return N}});var a=n(52322),s=n(14819),l=n.n(s),i=n(18149),r=n.n(i),o=n(2784),c=n(73485),d=n(27792),u=n(7738),m=n(83036),h=function(e){return(0,a.jsx)(m.Z,{icon:u.Z,...e})},x=n(14279),p=n(14670);let f=[{value:"=",label:"equals",preLabel:"[ = ]",abbrev:"eq"},{value:"<>",label:"not equal",preLabel:"[ <> ]",abbrev:"neq"},{value:">",label:"greater than",preLabel:"[ > ]",abbrev:"gt"},{value:"<",label:"less than",preLabel:"[ < ]",abbrev:"lt"},{value:">=",label:"greater than or equal",preLabel:"[ >= ]",abbrev:"gte"},{value:"<=",label:"less than or equal",preLabel:"[ <= ]",abbrev:"lte"},{value:"~~",label:"like operator",preLabel:"[ ~~ ]",abbrev:"like"},{value:"~~*",label:"ilike operator",preLabel:"[ ~~* ]",abbrev:"ilike"},{value:"in",label:"one of a list of values",preLabel:"[ in ]",abbrev:"in"},{value:"is",label:"checking for (null,not null,true,false)",preLabel:"[ is ]",abbrev:"is"}];var g=n(56599),j=n(31840),v=n(9019),b=n(82875),y=(0,o.memo)(e=>{var t,n;let{table:s,filter:l,filterIdx:i,onChange:r,onDelete:o,onKeyDown:c}=e,u=s.columns.find(e=>e.name===l.column),m=(null===(t=s.columns)||void 0===t?void 0:t.map(e=>({value:e.name,label:e.name,postLabel:e.dataType})))||[],h=(null==u?void 0:u.format)==="timestamptz"?"yyyy-mm-dd hh:mm:ss+zz":(null==u?void 0:u.format)==="timestamp"?"yyyy-mm-dd hh:mm:ss":"Enter a value";return(0,a.jsxs)("div",{className:"sb-grid-filter-row px-3",children:[(0,a.jsx)(b.Fy,{align:"start",options:m,onSelect:e=>r(i,{...l,column:e}),children:(0,a.jsx)(d.z,{asChild:!0,type:"outline",icon:(0,a.jsx)("div",{className:"text-foreground-lighter",children:(0,a.jsx)(g.Z,{strokeWidth:1.5,size:14})}),className:"w-32 justify-start",children:(0,a.jsx)("span",{children:null!==(n=null==u?void 0:u.name)&&void 0!==n?n:""})})}),(0,a.jsx)(b.Fy,{align:"start",options:f,onSelect:e=>r(i,{...l,operator:e}),children:(0,a.jsx)(d.z,{asChild:!0,type:"outline",icon:(0,a.jsx)("div",{className:"text-foreground-lighter",children:(0,a.jsx)(g.Z,{strokeWidth:1.5,size:14})}),children:(0,a.jsx)("span",{children:l.operator})})}),(0,a.jsx)(j.Z,{size:"tiny",className:"w-full",placeholder:h,value:l.value,onChange:e=>r(i,{...l,value:e.target.value}),onKeyDown:c}),(0,a.jsx)(d.z,{icon:(0,a.jsx)(v.Z,{strokeWidth:1.5,size:14}),size:"tiny",type:"text",onClick:()=>o(i)})]})}),N=e=>{let{table:t,filters:n,setParams:s}=e,l=(n||[]).length>0?"Filtered by ".concat(n.length," rule").concat(n.length>1?"s":""):"Filter";return(0,a.jsx)(c.Z,{size:"large",align:"start",className:"sb-grid-filter-popover",overlay:(0,a.jsx)(w,{table:t,filters:n,setParams:s}),children:(0,a.jsx)(d.z,{asChild:!0,type:(n||[]).length>0?"link":"text",icon:(0,a.jsx)("div",{className:"text-foreground-light",children:(0,a.jsx)(h,{strokeWidth:1.5})}),children:(0,a.jsx)("span",{children:l})})})};let w=e=>{let{table:t,filters:n,setParams:s}=e,i=(0,o.useMemo)(()=>(0,p.Yb)(null!=n?n:[]),[n]),[u,m]=(0,o.useState)(i),h=(0,o.useCallback)((e,t)=>{m(n=>l()(n,{[e]:{$set:t}}))},[]),g=(0,o.useCallback)(e=>{m(t=>l()(t,{$splice:[[e,1]]}))},[]);function j(){s(e=>({...e,filter:u.map(e=>{let t=f.find(t=>t.value===e.operator);return"".concat(e.column,":").concat(null==t?void 0:t.abbrev,":").concat(e.value)})}))}function v(e){"Enter"===e.key&&j()}return(0,a.jsxs)("div",{className:"space-y-2 py-2",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[u.map((e,n)=>(0,a.jsx)(y,{table:t,filter:e,filterIdx:n,onChange:h,onDelete:g,onKeyDown:v},"filter-".concat(e.column,"-").concat([n]))),0==u.length&&(0,a.jsxs)("div",{className:"space-y-1 px-3",children:[(0,a.jsx)("h5",{className:"text-sm text-foreground-light",children:"No filters applied to this view"}),(0,a.jsx)("p",{className:"text-xs text-foreground-lighter",children:"Add a column below to filter the view"})]})]}),(0,a.jsx)(c.Z.Separator,{}),(0,a.jsxs)("div",{className:"px-3 flex flex-row justify-between",children:[(0,a.jsx)(d.z,{icon:(0,a.jsx)(x.Z,{}),type:"text",onClick:function(){var e;let n=null===(e=t.columns[0])||void 0===e?void 0:e.name;n&&m([...u,{column:n,operator:"=",value:""}])},children:"Add filter"}),(0,a.jsx)(d.z,{disabled:r()(u,i),type:"default",onClick:j,children:"Apply filter"})]})]})}},8243:function(e,t,n){"use strict";n.d(t,{f:function(){return y}});var a=n(52322),s=n(14819),l=n.n(s),i=n(18149),r=n.n(i),o=n(2784),c=n(73485),d=n(27792),u=n(69168),m=n(56599),h=n(82875),x=n(14670),p=n(92843),f=n(20103),g=n(63952),j=n(76419),v=n(9019),b=(0,o.memo)(e=>{let{table:t,index:n,columnName:s,sort:l,onDelete:i,onToggle:r,onDrag:c}=e,u=t.columns.find(e=>e.name===s),m=(0,o.useRef)(null),[{isDragging:h},x]=(0,p.c)({type:"sort-row",item:()=>({key:s,index:n}),collect:e=>({isDragging:e.isDragging()})}),[{handlerId:b},y]=(0,f.L)({accept:"sort-row",collect:e=>({handlerId:e.getHandlerId()}),hover(e,t){var a;if(!m.current)return;let s=e.index;if(s===n)return;let l=null===(a=m.current)||void 0===a?void 0:a.getBoundingClientRect(),i=(l.bottom-l.top)/2,r=t.getClientOffset().y-l.top;s<n&&r<i||s>n&&r>i||(N(s,n),e.index=n)}}),N=(e,t)=>{e!=t&&c(e,t)};return(x(y(m)),u)?(0,a.jsxs)("div",{className:"flex items-center gap-3 px-3",ref:m,style:{opacity:h?0:1},"data-handler-id":b,children:[(0,a.jsx)("span",{className:"transition-color text-foreground-lighter hover:text-foreground-light",children:(0,a.jsx)(g.Z,{strokeWidth:2,size:16})}),(0,a.jsx)("div",{className:"grow",children:(0,a.jsxs)("span",{className:"flex grow items-center gap-1 truncate text-sm text-foreground",children:[(0,a.jsx)("span",{className:"text-xs text-foreground-lighter",children:n>0?"then by":"sort by"}),u.name]})}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("label",{className:"text-xs text-foreground-lighter",children:"ascending:"}),(0,a.jsx)(j.Z,{size:"tiny",layout:"flex",defaultChecked:l.ascending,onChange:e=>r(s,e)})]}),(0,a.jsx)(d.z,{icon:(0,a.jsx)(v.Z,{strokeWidth:1.5,size:14}),size:"tiny",type:"text",onClick:()=>i(s)})]}):null}),y=e=>{let{table:t,sorts:n,setParams:s}=e,l=(n||[]).length>0?"Sorted by ".concat(n.length," rule").concat(n.length>1?"s":""):"Sort";return(0,a.jsx)(c.Z,{size:"large",align:"start",className:"sb-grid-sort-popover",overlay:(0,a.jsx)(N,{table:t,sorts:n,setParams:s}),children:(0,a.jsx)(d.z,{asChild:!0,type:(n||[]).length>0?"link":"text",icon:(0,a.jsx)("div",{className:"text-foreground-light",children:(0,a.jsx)(u.Z,{strokeWidth:1.5})}),children:(0,a.jsx)("span",{children:l})})})};let N=e=>{let{table:t,sorts:n,setParams:s}=e,i=(0,o.useMemo)(()=>(0,x.rg)(null!=n?n:[]),[n]),[u,p]=(0,o.useState)(i),f=t.columns.filter(e=>!u.find(t=>t.column==e.name)),g=(null==f?void 0:f.map(e=>({value:e.name,label:e.name})))||[],j=(0,o.useCallback)(e=>{p(t=>t.filter(t=>t.column!==e))},[]),v=(0,o.useCallback)((e,t)=>{p(n=>{let a=n.findIndex(t=>t.column===e);return l()(n,{[a]:{$merge:{ascending:t}}})})},[]),y=(0,o.useCallback)((e,t)=>{p(n=>l()(n,{$splice:[[e,1],[t,0,n[e]]]}))},[]);return(0,a.jsxs)("div",{className:"space-y-2 py-2",children:[u.map((e,n)=>(0,a.jsx)(b,{table:t,index:n,columnName:e.column,sort:e,onDelete:j,onToggle:v,onDrag:y},e.column)),0===u.length&&(0,a.jsxs)("div",{className:"space-y-1 px-3",children:[(0,a.jsx)("h5",{className:"text-sm text-foreground-light",children:"No sorts applied to this view"}),(0,a.jsx)("p",{className:"text-xs text-foreground-lighter",children:"Add a column below to sort the view"})]}),(0,a.jsx)(c.Z.Separator,{}),(0,a.jsxs)("div",{className:"px-3 flex flex-row justify-between",children:[f&&f.length>0?(0,a.jsx)(h.Fy,{options:g,onSelect:function(e){p([...u,{column:e,ascending:!0}])},side:"bottom",align:"start",children:(0,a.jsx)(d.z,{asChild:!0,type:"text",iconRight:(0,a.jsx)(m.Z,{}),className:"sb-grid-dropdown__item-trigger",children:(0,a.jsx)("span",{children:"Pick ".concat(u.length>1?"another":"a"," column to sort by")})})}):(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"All columns have been added"}),(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)(d.z,{disabled:r()(u,i),type:"default",onClick:function(){s(e=>({...e,sort:u.map(e=>"".concat(e.column,":").concat(e.ascending?"asc":"desc"))}))},children:"Apply sorting"})})]})]})}},5933:function(e,t,n){"use strict";n.d(t,{ov:function(){return g},ep:function(){return w},q4:function(){return N}});var a=n(52322),s=n(24990),l=n(40386),i=n(8448),r=n(2784),o=n(92795),c=n(83036),d=function(e){return(0,a.jsx)(c.Z,{icon:o.Z,...e})},u=n(12203),m=n(25463),h=n(21784),x=n(27792),p=n(56599),f=n(78478),g=e=>{let{column:t,isEncrypted:n}=e,r=(0,f.Qq)(),o=(0,f.I0)(),{onEditColumn:c,onDeleteColumn:g}=r,j=t.key;function v(){c&&c(j)}function b(){g&&g(j)}return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(l.h_,{children:[(0,a.jsx)(l.$F,{asChild:!0,children:(0,a.jsx)(x.z,{className:"opacity-50 flex",type:"text",style:{padding:"3px"},children:(0,a.jsx)(p.Z,{})})}),(0,a.jsx)(l.AW,{align:"end",side:"bottom",children:(0,a.jsxs)(a.Fragment,{children:[r.editable&&void 0!==v&&(0,a.jsxs)(s.fC,{delayDuration:0,children:[(0,a.jsx)(s.xz,{asChild:!0,className:"".concat(n?"opacity-50":""),children:(0,a.jsxs)(l.Xi,{className:"space-x-2",onClick:v,disabled:n,children:[(0,a.jsx)(i.Z,{size:"tiny"}),(0,a.jsx)("p",{children:"Edit column"})]})}),n&&(0,a.jsx)(s.h_,{children:(0,a.jsxs)(s.VY,{side:"bottom",children:[(0,a.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:"Encrypted columns cannot be edited"})})]})})]}),(0,a.jsx)(l.Xi,{className:"space-x-2",onClick:t.frozen?function(){o({type:"UNFREEZE_COLUMN",payload:{columnKey:j}})}:function(){o({type:"FREEZE_COLUMN",payload:{columnKey:j}})},children:t.frozen?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d,{size:"tiny"}),(0,a.jsx)("p",{children:"Unfreeze column"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.Z,{size:"tiny"}),(0,a.jsx)("p",{children:"Freeze column"})]})}),r.editable&&void 0!==b&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.Z,{}),(0,a.jsxs)(l.Xi,{className:"space-x-2",onClick:b,children:[(0,a.jsx)(h.Z,{size:"tiny",stroke:"red"}),(0,a.jsx)("p",{children:"Delete column"})]})]})]})})]})})},j=n(71623),v=n(29123),b=n(73579),y=n(59218),N=e=>{let{rows:t}=e,n=(0,f.Qq)(),s=(0,b._2)();function l(e){let{data:t}=e;return"edit"===t?void 0==n.onEditRow:"delete"===t&&!n.editable}let o=(0,r.useCallback)(e=>{var a;let{props:s}=e;if(!n.selectedCellPosition||!s)return;let{rowIdx:l}=s,i=t[l][n.gridColumns[null===(a=n.selectedCellPosition)||void 0===a?void 0:a.idx].key],r=(0,y.Lw)(i);(0,y.vQ)(r)},[t,n.gridColumns,n.selectedCellPosition]);return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(j.v2,{id:w,animation:!1,children:[(0,a.jsxs)(j.ck,{onClick:o,children:[(0,a.jsx)(v.Z,{size:"tiny"}),(0,a.jsx)("span",{className:"ml-2 text-xs",children:"Copy cell content"})]}),(0,a.jsxs)(j.ck,{onClick:function(e){let{props:a}=e,{rowIdx:s}=a,l=t[s];n.onEditRow&&n.onEditRow(l)},hidden:l,data:"edit",children:[(0,a.jsx)(i.Z,{size:"tiny"}),(0,a.jsx)("span",{className:"ml-2 text-xs",children:"Edit row"})]}),n.editable&&(0,a.jsx)(j.Z0,{}),(0,a.jsxs)(j.ck,{onClick:function(e){let{props:n}=e,{rowIdx:a}=n,l=t[a];l&&s.onDeleteRows([l])},hidden:l,data:"delete",children:[(0,a.jsx)(h.Z,{size:"tiny",stroke:"red"}),(0,a.jsx)("span",{className:"ml-2 text-xs",children:"Delete row"})]})]})})};let w="row-context-menu-id"},27086:function(e,t,n){"use strict";n.d(t,{E_:function(){return s},Vz:function(){return l},W:function(){return r},ZR:function(){return i},jg:function(){return c},mr:function(){return a},uZ:function(){return o}});let a=100,s="supabase_grid",l=-1,i=-2,r="supabase-grid-select-row",o="supabase-grid-add-column",c="Please add a primary key column to your table to update or delete rows"},25424:function(e,t,n){"use strict";n.d(t,{AE:function(){return B.A},zB:function(){return V},NK:function(){return x.NK}});var a=n(52322),s=n(24459),l=n(2784),i=n(28846),r=n(52797),o=n(28316),c=n(83314),d=n(43712),u=n(13096),m=n(50412),h=n(73579),x=n(14670),p=n(82875),f=n(41303),g=n(43386),j=n(24990),v=n(59491),b=n(6277),y=n(46782),N=n.n(y),w=n(90286),_=n.n(w),C=n(62202),S=n(78478),k=n(94077),E=n(40386),Z=n(27792),T=n(56599),R=n(12467),z=n(46398),A=n(78174),P=n(9019),L=n(42760),I=n(21784),D=n(54563),F=n(8243),O=e=>{let{table:t,sorts:n,filters:s,onAddColumn:l,onAddRow:i,onImportData:r,headerActions:o,customHeader:c,isRefetching:d}=e,{selectedRows:u}=(0,S.Qq)();return(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"flex h-10 items-center justify-between bg-surface-100 px-5 py-1.5",children:[c?(0,a.jsx)(a.Fragment,{children:c}):(0,a.jsx)(a.Fragment,{children:u.size>0?(0,a.jsx)(W,{table:t,sorts:n,filters:s}):(0,a.jsx)(q,{table:t,isRefetching:d,onAddColumn:l,onAddRow:i,onImportData:r})}),(0,a.jsx)("div",{className:"sb-grid-header__inner",children:o})]})})};let q=e=>{let{table:t,isRefetching:n,onAddColumn:s,onAddRow:l,onImportData:i}=e,r=(0,u.Xo)(v.KA.TENANT_SQL_ADMIN_WRITE,"columns"),[{filter:o,sort:c},d]=(0,u.x3)({arrayKeys:["sort","filter"]});return(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(D.E,{table:t,filters:o,setParams:d}),(0,a.jsx)(F.f,{table:t,sorts:c,setParams:d})]}),(void 0!==l||void 0!==s)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"h-[20px] w-px border-r border-control"}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:r&&(0,a.jsxs)(E.h_,{children:[(0,a.jsx)(E.$F,{asChild:!0,children:(0,a.jsx)(Z.z,{"data-testid":"table-editor-insert-new-row",type:"primary",size:"tiny",icon:(0,a.jsx)(T.Z,{size:14,strokeWidth:1.5}),children:"Insert"})}),(0,a.jsx)(E.AW,{side:"bottom",align:"start",children:[...void 0!==l?[(0,a.jsxs)(E.Xi,{className:"group space-x-2",onClick:l,children:[(0,a.jsxs)("div",{className:"-mt-2 pr-1.5",children:[(0,a.jsx)("div",{className:"border border-foreground-lighter w-[15px] h-[4px]"}),(0,a.jsx)("div",{className:"border border-foreground-lighter w-[15px] h-[4px] my-[2px]"}),(0,a.jsx)("div",{className:(0,R.cn)(["border border-foreground-light w-[15px] h-[4px] translate-x-0.5","transition duration-200 group-data-[highlighted]:border-brand group-data-[highlighted]:translate-x-0"])})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{children:"Insert row"}),(0,a.jsxs)("p",{className:"text-foreground-light",children:["Insert a new row into ",t.name]})]})]},"add-row")]:[],...void 0!==s?[(0,a.jsxs)(E.Xi,{className:"group space-x-2",onClick:s,children:[(0,a.jsxs)("div",{className:"flex -mt-2 pr-1.5",children:[(0,a.jsx)("div",{className:"border border-foreground-lighter w-[4px] h-[15px]"}),(0,a.jsx)("div",{className:"border border-foreground-lighter w-[4px] h-[15px] mx-[2px]"}),(0,a.jsx)("div",{className:(0,R.cn)(["border border-foreground-light w-[4px] h-[15px] -translate-y-0.5","transition duration-200 group-data-[highlighted]:border-brand group-data-[highlighted]:translate-y-0"])})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{children:"Insert column"}),(0,a.jsxs)("p",{className:"text-foreground-light",children:["Insert a new column into ",t.name]})]})]},"add-column")]:[],...void 0!==i?[(0,a.jsxs)(E.Xi,{className:"group space-x-2",onClick:i,children:[(0,a.jsxs)("div",{className:"relative -mt-2",children:[(0,a.jsx)(z.Z,{className:"-translate-x-[2px]"}),(0,a.jsx)(A.Z,{className:(0,b.default)("transition duration-200 absolute bottom-0 right-0 translate-y-1 opacity-0 bg-brand-400 rounded-full","group-data-[highlighted]:translate-y-0 group-data-[highlighted]:text-brand group-data-[highlighted]:opacity-100"),strokeWidth:3,size:12})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{children:"Import data from CSV"}),(0,a.jsx)("p",{className:"text-foreground-light",children:"Insert new rows from a CSV"})]})]},"import-data")]:[]]})]})})]})]})},W=e=>{var t,n;let{table:s,sorts:i,filters:r}=e,o=(0,S.Qq)(),u=(0,S.I0)(),{project:x}=(0,c.d2)(),p=(0,h._2)(),f=(0,m.fN)(),g=void 0!==f.role,[v,b]=(0,l.useState)(!1),{data:y}=(0,d.KK)({queryKey:[s.schema,s.name],projectRef:null==x?void 0:x.ref,connectionString:null==x?void 0:x.connectionString,table:s,sorts:i,filters:r,page:p.page,limit:p.rowsPerPage,impersonatedRole:f.role}),{data:w}=(0,k.H)({queryKey:[null==s?void 0:s.schema,null==s?void 0:s.name,"count"],projectRef:null==x?void 0:x.ref,connectionString:null==x?void 0:x.connectionString,table:s,filters:r,impersonatedRole:f.role},{keepPreviousData:!0}),E=()=>{u({type:"SELECT_ALL_ROWS",payload:{selectedRows:new Set(z.map(e=>e.idx))}})};async function T(){if(b(!0),O&&A>5e5)return C.ZP.error("Sorry! We're unable to support exporting of CSV for row counts larger than ".concat(5e5.toLocaleString()," at the moment.")),b(!1);if(!x)return C.ZP.error("Project is required"),b(!1);let e=(O?await (0,d.wF)({projectRef:x.ref,connectionString:x.connectionString,table:s,filters:r,sorts:i,impersonatedRole:f.role}):z.filter(e=>D.has(e.idx))).map(e=>(Object.keys(e).map(t=>{"object"==typeof e[t]&&null!==e[t]&&(e[t]=JSON.stringify(e[t]))}),e)),t=_().unparse(e,{columns:o.table.columns.map(e=>e.name)}),n=new Blob([t],{type:"text/csv;charset=utf-8;"});N()(n,"".concat(o.table.name,"_rows.csv")),b(!1)}function R(){u({type:"SELECTED_ROWS_CHANGE",payload:{selectedRows:new Set}})}let z=null!==(t=null==y?void 0:y.rows)&&void 0!==t?t:[],A=null!==(n=null==w?void 0:w.count)&&void 0!==n?n:0,{selectedRows:D,editable:F,allRowsSelected:O}=o;return(0,m.gv)(()=>{(O||D.size>0)&&R()}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(Z.z,{type:"default",style:{padding:"3px"},icon:(0,a.jsx)(P.Z,{size:"tiny",strokeWidth:2}),onClick:R}),(0,a.jsx)("span",{className:"text-xs text-foreground",children:O?"".concat(A," rows selected"):D.size>1?"".concat(D.size," rows selected"):"".concat(D.size," row selected")}),!O&&A>z.length&&(0,a.jsxs)(Z.z,{type:"link",onClick:()=>E(),children:["Select all ",A," rows"]})]}),(0,a.jsx)("div",{className:"h-[20px] border-r border-strong"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(Z.z,{type:"primary",size:"tiny",icon:(0,a.jsx)(L.Z,{}),loading:v,disabled:v,onClick:T,children:"Export to CSV"}),F&&(0,a.jsxs)(j.fC,{delayDuration:0,children:[(0,a.jsx)(j.xz,{asChild:!0,children:(0,a.jsx)(Z.z,{type:"default",size:"tiny",icon:(0,a.jsx)(I.Z,{size:"tiny"}),onClick:()=>{let e=O?A:D.size,t=Array.from(D),n=z.filter(e=>t.includes(e.idx));p.onDeleteRows(n,{allRowsSelected:O,numRows:e,callback:()=>{u({type:"REMOVE_ROWS",payload:{rowIdxs:t}}),u({type:"SELECTED_ROWS_CHANGE",payload:{selectedRows:new Set}})}})},disabled:O&&g,children:O?"Delete ".concat(A," rows"):D.size>1?"Delete ".concat(D.size," rows"):"Delete ".concat(D.size," row")})}),O&&g&&(0,a.jsx)(j.h_,{children:(0,a.jsxs)(j.VY,{side:"bottom",children:[(0,a.jsx)(j.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:"Table truncation is not supported when impersonating a role"})})]})})]})]})]})};var U=n(5933);let V=e=>{let t=(0,x.cc)(e);return(0,a.jsx)(S.g3,{children:(0,a.jsx)(i.W,{backend:r.PD,context:window,children:(0,a.jsx)(M,{...t})})})},M=e=>{var t,n;let{editable:i,projectRef:r,gridProps:j,headerActions:v,showCustomChildren:b,customHeader:y,children:N,onAddRow:w,onAddColumn:_,updateTableRow:C,onEditForeignKeyColumnValue:k,onImportData:E}=e,{id:Z}=(0,s.UO)(),T=(0,S.I0)(),R=(0,S.Qq)(),z=(0,h._2)(),A=(0,l.useRef)(null),[P,L]=(0,l.useState)(!1),[{sort:I,filter:D},F]=(0,u.x3)({arrayKeys:["sort","filter"]}),q=(0,x.rg)(I),W=(0,x.Yb)(D),V=(0,m.fN)(),{project:M}=(0,c.d2)(),{data:B,error:K,isSuccess:Y,isError:Q,isLoading:H,isRefetching:G}=(0,d.KK)({queryKey:[e.table.schema,e.table.name],projectRef:null==M?void 0:M.ref,connectionString:null==M?void 0:M.connectionString,table:e.table,sorts:q,filters:W,page:z.page,limit:z.rowsPerPage,impersonatedRole:V.role},{keepPreviousData:!0,retryDelay:(e,t)=>{var n;return(t&&(null===(n=t.message)||void 0===n?void 0:n.includes("does not exist"))&&F(e=>({...e,sort:void 0})),e>3)?1/0:5e3},onSuccess(e){T({type:"SET_ROWS_COUNT",payload:e.rows.length})}});return(0,l.useEffect)(()=>{P||L(!0)},[]),(0,l.useEffect)(()=>{P&&T({type:"UPDATE_FILTERS",payload:{}})},[JSON.stringify(W)]),(0,l.useEffect)(()=>{P&&T({type:"UPDATE_SORTS",payload:{}})},[JSON.stringify(q)]),(0,l.useEffect)(()=>{R.isInitialComplete&&r&&R.table&&(0,x.Tf)(R,r,I,D)},[R.table,R.isInitialComplete,R.gridColumns,JSON.stringify(q),JSON.stringify(W),r]),(0,l.useEffect)(()=>{T({type:"INIT_CALLBACK",payload:{...e}})},[]),(0,l.useEffect)(()=>{let t=async()=>{let{savedState:t}=await (0,x.uk)({...e,tableId:Z},R,T,I,D);(t.sorts||t.filters)&&F(e=>({...e,...t.sorts&&{sort:t.sorts},...t.filters&&{filter:t.filters}}))},n=JSON.stringify(e.table)!==JSON.stringify(R.table);(!R.table||n)&&t()},[R.table,e.table,e.schema]),(0,a.jsxs)("div",{className:"sb-grid",children:[(0,a.jsx)(O,{table:e.table,sorts:q,filters:W,isRefetching:G,onAddRow:i?w:void 0,onAddColumn:i?_:void 0,onImportData:i?E:void 0,headerActions:v,customHeader:y}),b&&void 0!==N?(0,a.jsx)(a.Fragment,{children:N}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g.rj,{ref:A,...j,rows:null!==(t=null==B?void 0:B.rows)&&void 0!==t?t:[],error:K,isLoading:H,isSuccess:Y,isError:Q,filters:W,setParams:F,updateRow:C,onAddRow:w,onImportData:E,onEditForeignKeyColumnValue:k}),(0,a.jsx)(f.Z,{isLoading:H,isRefetching:G}),(0,a.jsx)(p.fQ,{gridRef:A})]}),P&&(0,o.createPortal)((0,a.jsx)(U.q4,{rows:null!==(n=null==B?void 0:B.rows)&&void 0!==n?n:[]}),document.body)]})};var B=n(99314)},99314:function(e,t,n){"use strict";n.d(t,{A:function(){return u}});var a=n(87612),s=n(83561);function l(e,t){return 0===t.length?e:e+=" where ".concat(t.map(e=>{switch(e.operator){case"in":let t;return t=Array.isArray(e.value)?e.value.map(e=>i(e)):String(e.value).split(",").map(e=>i(e)),"".concat((0,s.ident)(e.column)," ").concat(e.operator," (").concat(t.join(","),")");case"is":return function(e){let t=String(e.value);switch(t){case"null":case"false":case"true":case"not null":return"".concat((0,s.ident)(e.column)," ").concat(e.operator," ").concat(t);default:return"".concat((0,s.ident)(e.column)," ").concat(e.operator," ").concat(i(e.value))}}(e);default:return"".concat((0,s.ident)(e.column)," ").concat(e.operator," ").concat(i(e.value))}}).join(" and "))}function i(e){return"string"!=typeof e||(null==e?void 0:e.startsWith("ARRAY["))&&(null==e?void 0:e.endsWith("]"))?e:(0,s.literal)(e)}function r(e){return"".concat((0,s.ident)(e.schema),".").concat((0,s.ident)(e.name))}class o{range(e,t){return this.pagination={offset:e,limit:t-e+1},this}toSql(){try{var e;let{actionValue:t,actionOptions:n,filters:a,sorts:i}=null!==(e=this.options)&&void 0!==e?e:{};switch(this.action){case"count":return function(e,t){let n="select count(*) from ".concat(r(e)),{filters:a}=null!=t?t:{};return a&&(n=l(n,a)),n+";"}(this.table,{filters:a});case"delete":return function(e,t,n){if(!t||0===t.length)throw{message:"no filters for this delete query"};let a="delete from ".concat(r(e)),{returning:s,enumArrayColumns:i}=null!=n?n:{};return t&&(a=l(a,t)),s&&(a+=void 0===i||0===i.length?" returning *":" returning *, ".concat(i.map(e=>'"'.concat(e,'"::text[]')).join(","))),a+";"}(this.table,a,{returning:null==n?void 0:n.returning,enumArrayColumns:null==n?void 0:n.enumArrayColumns});case"insert":return function(e,t,n){if(!t||0===t.length)throw{message:"no value to insert"};let{returning:a,enumArrayColumns:l}=null!=n?n:{},i=Object.keys(t[0]).map(e=>(0,s.ident)(e)).join(","),o="";return o=0==i.length?(0,s.format)("insert into %1$s select from jsonb_populate_recordset(null::%1$s, %2$s)",r(e),(0,s.literal)(JSON.stringify(t))):(0,s.format)("insert into %1$s (%2$s) select %2$s from jsonb_populate_recordset(null::%1$s, %3$s)",r(e),i,(0,s.literal)(JSON.stringify(t))),a&&(o+=void 0===l||0===l.length?" returning *":" returning *, ".concat(l.map(e=>'"'.concat(e,'"::text[]')).join(","))),o+";"}(this.table,t,{returning:null==n?void 0:n.returning,enumArrayColumns:null==n?void 0:n.enumArrayColumns});case"select":return function(e,t,n){var a;let i="";i+="select ".concat(null!=t?t:"*"," from ").concat(r(e));let{filters:o,pagination:c,sorts:d}=null!=n?n:{};if(o&&(i=l(i,o)),d&&(a=i,i=0===d.length?a:a+=" order by ".concat(d.map(e=>{let t=e.ascending?"asc":"desc",n=e.nullsFirst?"nulls first":"nulls last";return"".concat((0,s.ident)(e.column)," ").concat(t," ").concat(n)}).join(", "))),c){let{limit:e,offset:t}=null!=c?c:{};i+=" limit ".concat((0,s.literal)(e)," offset ").concat((0,s.literal)(t))}return i+";"}(this.table,t,{filters:a,pagination:this.pagination,sorts:i});case"update":return function(e,t,n){let{filters:a,returning:i,enumArrayColumns:o}=null!=n?n:{};if(!a||0===a.length)throw{message:"no filters for this update query"};let c=Object.keys(t).map(e=>(0,s.ident)(e)).join(","),d=(0,s.format)("update %1$s set (%2$s) = (select %2$s from json_populate_record(null::%1$s, %3$s))",r(e),c,(0,s.literal)(JSON.stringify(t)));return a&&(d=l(d,a)),i&&(d+=void 0===o||0===o.length?" returning *":" returning *, ".concat(o.map(e=>'"'.concat(e,'"::text[]')).join(","))),d+";"}(this.table,t,{filters:a,returning:null==n?void 0:n.returning,enumArrayColumns:null==n?void 0:n.enumArrayColumns});case"truncate":return function(e,t){let n="truncate ".concat(r(e)),{cascade:a}=null!=t?t:{};return a&&(n+=" cascade"),n+";"}(this.table,{cascade:null==n?void 0:n.cascade});default:return""}}catch(e){throw e}}constructor(e,t,n){(0,a._)(this,"table",void 0),(0,a._)(this,"action",void 0),(0,a._)(this,"options",void 0),(0,a._)(this,"pagination",void 0),this.table=e,this.action=t,this.options=n}}class c{filter(e,t,n){return this.filters.push({column:e,operator:t,value:n}),this}match(e){return Object.entries(e).map(e=>{let[t,n]=e;this.filters.push({column:t,operator:"=",value:n})}),this}order(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.sorts.push({column:e,ascending:t,nullsFirst:n}),this}range(e,t){return this._getQueryModifier().range(e,t)}toSql(){return this._getQueryModifier().toSql()}_getQueryModifier(){return new o(this.table,this.action,{actionValue:this.actionValue,actionOptions:this.actionOptions,filters:this.filters,sorts:this.sorts})}constructor(e,t,n,s){(0,a._)(this,"table",void 0),(0,a._)(this,"action",void 0),(0,a._)(this,"actionValue",void 0),(0,a._)(this,"actionOptions",void 0),(0,a._)(this,"filters",void 0),(0,a._)(this,"sorts",void 0),this.table=e,this.action=t,this.actionValue=n,this.actionOptions=s,this.filters=[],this.sorts=[]}}class d{count(){return new c(this.table,"count")}delete(e){return new c(this.table,"delete",void 0,e)}insert(e,t){return new c(this.table,"insert",e,t)}select(e){return new c(this.table,"select",e)}update(e,t){return new c(this.table,"update",e,t)}truncate(e){return new c(this.table,"truncate",void 0,e)}constructor(e){(0,a._)(this,"table",void 0),this.table=e}}class u{from(e,t){return new d({name:e,schema:null!=t?t:"public"})}}},78478:function(e,t,n){"use strict";n.d(t,{g3:function(){return m},I0:function(){return x},Qq:function(){return h}});var a=n(2784),s=n(64018),l=n(27086),i=n(14819),r=n.n(i),o=n(59218);function c(e){let t=(0,o.I8)(e);return t.renderEditCell=e.renderEditCell,t.renderHeaderCell=e.renderHeaderCell,t.renderCell=e.renderCell,t.renderGroupCell=e.renderGroupCell,t}let d={table:null,isInitialComplete:!1,editable:!1,allRowsSelected:!1,onAddColumn:null,onAddRow:null,onError:null,onEditRow:null,onEditColumn:null,onDeleteColumn:null,gridColumns:[],rows:[],selectedRows:new Set,selectedCellPosition:null,totalRows:l.Vz},u=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,n=arguments.length>1?arguments[1]:void 0;for(let a=0;a<t.length;a++)e=t[a](e,n);return e}}((e,t)=>{switch(t.type){case"INIT_TABLE":return{...e,table:t.payload.table,isInitialComplete:!0,editable:t.payload.editable||!1};case"UPDATE_FILTERS":{let t={...e};return t.page=1,t.totalRows=l.ZR,t}case"UPDATE_SORTS":return{...e};default:return e}},(e,t)=>"INIT_CALLBACK"===t.type?{...e,onAddColumn:t.payload.onAddColumn,onAddRow:t.payload.onAddRow,onError:t.payload.onError,onEditRow:t.payload.onEditRow,onEditColumn:t.payload.onEditColumn,onDeleteColumn:t.payload.onDeleteColumn}:e,(e,t)=>{switch(t.type){case"INIT_TABLE":return{...e,gridColumns:function(e,t){let n=e;if(null==t?void 0:t.gridColumns){n=[];let a=t.gridColumns.filter(e=>(null==e?void 0:e.name)!=="");for(let t=0;t<a.length;t++){let s=a[t],l=e.find(e=>e.key===s.key);l&&n.push({...l,width:s.width,frozen:s.frozen})}let s=e.filter(e=>!a.find(t=>t.key===e.key)&&""!==e.name);n=n.concat(s);let i=e.find(e=>e.key===l.W);i&&(n=[i,...n]);let r=e.find(e=>e.key===l.uZ);r&&n.push(r)}return n}(t.payload.gridColumns,t.payload.savedState)};case"MOVE_COLUMN":{let n=e.gridColumns.findIndex(e=>e.key===t.payload.fromKey),a=e.gridColumns.findIndex(e=>e.key===t.payload.toKey),s=e.gridColumns[n];return{...e,gridColumns:r()(e.gridColumns,{$splice:[[n,1],[a,0,s]]})}}case"UPDATE_COLUMN_SIZE":{let n=c(e.gridColumns[t.payload.index]);return n.width=t.payload.width,{...e,gridColumns:r()(e.gridColumns,{[t.payload.index]:{$set:n}})}}case"FREEZE_COLUMN":{let n=e.gridColumns.findIndex(e=>e.key===t.payload.columnKey),a=c(e.gridColumns[n]);return a.frozen=!0,{...e,gridColumns:r()(e.gridColumns,{[n]:{$set:a}})}}case"UNFREEZE_COLUMN":{let n=e.gridColumns.findIndex(e=>e.key===t.payload.columnKey),a=c(e.gridColumns[n]);return a.frozen=!1,{...e,gridColumns:r()(e.gridColumns,{[n]:{$set:a}})}}case"UPDATE_COLUMN_IDX":{let n=e.gridColumns.findIndex(e=>e.key===t.payload.columnKey),a=c(e.gridColumns[n]);return a.idx=t.payload.columnIdx,{...e,gridColumns:r()(e.gridColumns,{[n]:{$set:a}}).sort((e,t)=>e.idx-t.idx)}}default:return e}},(e,t)=>{switch(t.type){case"INIT_TABLE":return{...e,selectedCellPosition:null,selectedRows:new Set,totalRows:l.ZR};case"SELECTED_CELL_CHANGE":return{...e,selectedCellPosition:t.payload.position};case"SELECTED_ROWS_CHANGE":return{...e,allRowsSelected:!1,selectedRows:t.payload.selectedRows};case"SELECT_ALL_ROWS":return{...e,allRowsSelected:!0,selectedRows:t.payload.selectedRows};case"SET_ROWS":return{...e,rows:t.payload.rows};case"SET_ROWS_COUNT":return{...e,totalRows:t.payload};default:return e}}),{Provider:m,useTrackedState:h,useUpdate:x}=(0,s.fH)(()=>(0,a.useReducer)(u,d))},59218:function(e,t,n){"use strict";function a(e){try{return JSON.parse(JSON.stringify(e))}catch(e){throw e}}function s(e){return null===e?"":"object"==typeof e||Array.isArray(e)?JSON.stringify(e):e}n.d(t,{I8:function(){return a},Lw:function(){return s},vQ:function(){return l}});let l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{};if(window.document.hasFocus()){var n,a;null===(a=window.navigator)||void 0===a||null===(n=a.clipboard)||void 0===n||n.writeText(e).then(t)}else console.warn("Unable to copy to clipboard")}},32999:function(e,t,n){"use strict";n.d(t,{i1:function(){return V},ve:function(){return B},cv:function(){return M}});var a=n(52322),s=n(601),l=n(14774),i=n(78478);let r=e=>{let{row:t,column:n,isNullable:s,onRowChange:r,onClose:o}=e,c=(0,i.Qq)().gridColumns.find(e=>e.name==n.key),d=t[n.key];return(0,a.jsxs)(l.ZP,{autoFocus:!0,id:"boolean-editor",name:"boolean-editor",size:"small",onBlur:()=>o(!1),onChange:e=>{let a=e.target.value;"null"===a?r({...t,[n.key]:null},!0):r({...t,[n.key]:"true"===a},!0)},defaultValue:null===d?"null":d.toString(),style:{width:"".concat((null==c?void 0:c.width)||n.width,"px")},children:[(0,a.jsx)(l.ZP.Option,{value:"true",children:"TRUE"}),(0,a.jsx)(l.ZP.Option,{value:"false",children:"FALSE"}),s&&(0,a.jsx)(l.ZP.Option,{value:"null",children:"NULL"})]})};var o=n(2784);function c(e){null==e||e.focus(),null==e||e.select()}function d(e){let{row:t,column:n,onRowChange:s,onClose:l}=e,i=t[n.key];return(0,a.jsx)("input",{className:"sb-grid-date-editor",ref:c,value:null!=i?i:"",onChange:function(e){let a=e.target.value;""==a?s({...t,[n.key]:null}):s({...t,[n.key]:a})},onBlur:()=>l(!0),type:"date"})}var u=n(28879),m=n.n(u),h=n(89945),x=n.n(h);function p(e){null==e||e.focus(),null==e||e.select()}function f(e){let{row:t,column:n,format:s,onRowChange:l,onClose:i}=e,r=t[n.key],o=r?m()(r,s).format("YYYY-MM-DDTHH:mm:ss"):r;return(0,a.jsx)("input",{className:"sb-grid-datetime-editor",ref:p,value:null!=o?o:"",onChange:function(e){let a=e.target.value;if(0===a.length)l({...t,[n.key]:null});else{let e=m()(a).format(s);l({...t,[n.key]:e})}},onBlur:()=>i(!0),type:"datetime-local",step:"1"})}function g(e){return(0,a.jsx)(f,{...e,format:"YYYY-MM-DDTHH:mm:ss"})}function j(e){return(0,a.jsx)(f,{...e,format:"YYYY-MM-DDTHH:mm:ssZ"})}m().extend(x());var v=n(24990),b=n(73485),y=n(73124),N=n(83036),w=function(e){return(0,a.jsx)(N.Z,{icon:y.Z,...e})},_=n(82875),C=n(5388),S=n(1842),k=n.n(S);let E=e=>{let{row:t,column:n,isEditable:s=!0,onRowChange:l,onExpandEditor:r}=e,c=(0,i.Qq)(),d=c.gridColumns.find(e=>e.name==n.key),u=t[n.key],m=(0,C.ZO)(k()(u)?"":JSON.stringify(u)),[h,x]=(0,o.useState)(!0),[p,f]=(0,o.useState)(m),g=(0,o.useCallback)(()=>{s&&l(t,!0),x(!1)},[]),j=(0,o.useCallback)(e=>{(null!==e?(0,C.tT)(e):e)!==p&&N(e)},[]),y=()=>{g(),r(n.key,{...t,[n.key]:(0,C.dW)(p)||t[n.key]})},N=e=>{if(s){if(e){if(Z(e)){let a=JSON.parse(e);l({...t,[n.key]:a},!0),x(!1)}else{let{onError:e}=c;e&&e(Error("Please enter a valid JSON"))}}else l({...t,[n.key]:null},!0),x(!1)}};return(0,a.jsx)(b.Z,{open:h,side:"bottom",align:"start",sideOffset:-35,className:"rounded-none",overlay:(0,a.jsxs)(_.rc,{value:p,onEscape:g,onEnter:j,children:[(0,a.jsx)(_.rE,{width:"".concat((null==d?void 0:d.width)||n.width,"px"),value:null!=p?p:"",language:"json",readOnly:!s,onChange:e=>{s&&(e&&""!=e?f(e):f(null))}}),(0,a.jsxs)("div",{className:"flex items-start justify-between p-2 bg-surface-200 space-x-2",children:[s?(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"px-1.5 py-[2.5px] rounded bg-selection border border-strong flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-[10px]",children:""})}),(0,a.jsx)("p",{className:"text-xs text-foreground-light",children:"Save changes"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"px-1 py-[2.5px] rounded bg-selection border border-strong flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-[10px]",children:"Esc"})}),(0,a.jsx)("p",{className:"text-xs text-foreground-light",children:"Cancel changes"})]})]}):(0,a.jsx)("div",{}),(0,a.jsxs)(v.fC,{delayDuration:0,children:[(0,a.jsx)(v.xz,{children:(0,a.jsx)("div",{className:"border border-strong rounded p-1 flex items-center justify-center transition cursor-pointer bg-selection hover:bg-border-strong",onClick:()=>y(),children:(0,a.jsx)(w,{size:12,strokeWidth:2})})}),(0,a.jsx)(v.h_,{children:(0,a.jsxs)(v.VY,{side:"bottom",children:[(0,a.jsx)(v.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:"Expand editor"})})]})})]})]})]}),children:(0,a.jsx)("div",{className:"".concat(p&&0==m.trim().length?"sb-grid-fill-container":""," sb-grid-json-editor__trigger"),onClick:()=>x(!h),children:null===p||""===p?(0,a.jsx)(_.q2,{}):m})})},Z=e=>{try{return JSON.parse(e),!0}catch(e){return!1}};function T(e){null==e||e.focus(),null==e||e.select()}function R(e){let{row:t,column:n,onRowChange:s,onClose:l}=e,i=t[n.key];return(0,a.jsx)("input",{className:"sb-grid-number-editor",ref:T,value:null!=i?i:"",onChange:function(e){let a=e.target.value;""==a?s({...t,[n.key]:null}):s({...t,[n.key]:a})},onBlur:function(){l(!0)},type:"number"})}function z(e){let{row:t,column:n,onRowChange:s,onClose:r,options:o,isNullable:c}=e,d=(0,i.Qq)().gridColumns.find(e=>e.name==n.key),u=t[n.key];return(0,a.jsxs)(l.ZP,{autoFocus:!0,id:"select-editor",name:"select-editor",size:"small",defaultValue:null!=u?u:"",className:"sb-grid-select-editor !gap-2",style:{width:"".concat((null==d?void 0:d.width)||n.width,"px")},onChange:function(e){e.target.value&&""!=e.target.value?s({...t,[n.key]:e.target.value},!0):s({...t,[n.key]:null},!0)},onBlur:function(){r(!1)},children:[c&&(0,a.jsx)(l.ZP.Option,{value:"",children:"NULL"}),o.map(e=>{let{label:t,_value:n}=e;return(0,a.jsx)(l.ZP.Option,{value:n,selected:n===u,children:t},n)})]})}var A=n(27792);let P=e=>{let{row:t,column:n,isNullable:s,isEditable:l,onRowChange:r,onExpandEditor:c}=e,d=(0,i.Qq)(),[u,m]=(0,o.useState)(!0),h=d.gridColumns.find(e=>e.name==n.key),x=t[n.key],[p,f]=(0,o.useState)(x),g=(0,o.useCallback)(()=>{l&&r(t,!0),m(!1)},[]),j=(0,o.useCallback)(e=>{l&&r({...t,[n.key]:e},!0),m(!1)},[]),y=()=>{g(),c(n.key,{...t,[n.key]:p||t[n.key]})};return(0,a.jsx)(b.Z,{open:u,side:"bottom",align:"start",sideOffset:-35,className:"rounded-none",overlay:(0,a.jsxs)(_.rc,{value:p,onEscape:g,onEnter:j,children:[(0,a.jsx)(_.rE,{width:"".concat((null==h?void 0:h.width)||n.width,"px"),value:null!=p?p:"",readOnly:!l,onChange:function(e){l&&(e?f(e):f(""))}}),l&&(0,a.jsxs)("div",{className:"flex items-start justify-between p-2 bg-surface-200 space-x-2",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"px-1.5 py-[2.5px] rounded bg-surface-300 border border-strong flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-[10px]",children:""})}),(0,a.jsx)("p",{className:"text-xs text-foreground-light",children:"Save changes"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"px-1 py-[2.5px] rounded bg-surface-300 border border-strong flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-[10px]",children:"Esc"})}),(0,a.jsx)("p",{className:"text-xs text-foreground-light",children:"Cancel changes"})]})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end gap-y-1",children:[(0,a.jsx)("div",{children:(0,a.jsxs)(v.fC,{delayDuration:0,children:[(0,a.jsx)(v.xz,{asChild:!0,children:(0,a.jsx)(A.z,{type:"default",className:"px-1",onClick:()=>y(),icon:(0,a.jsx)(w,{size:12,strokeWidth:2})})}),(0,a.jsx)(v.h_,{children:(0,a.jsxs)(v.VY,{side:"bottom",children:[(0,a.jsx)(v.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:"Expand editor"})})]})})]})}),s&&(0,a.jsx)(A.z,{asChild:!0,htmlType:"button",type:"default",size:"tiny",onClick:()=>j(null),children:(0,a.jsx)("div",{children:"Set to NULL"})})]})]})]}),children:(0,a.jsx)("div",{className:"".concat(p&&0==p.trim().length?"sb-grid-fill-container":""," sb-grid-text-editor__trigger"),onClick:()=>m(!u),children:null===p?(0,a.jsx)(_.q2,{}):""===p?(0,a.jsx)(_.OX,{}):p})})};function L(e){null==e||e.focus(),null==e||e.select()}m().extend(x());let I="HH:mm:ss";function D(e){let{row:t,column:n,format:s,onRowChange:l,onClose:i}=e,r=t[n.key],o=r?m()(r,s).format(I):r;return(0,a.jsx)("input",{className:"sb-grid-time-editor",ref:L,value:null!=o?o:"",onChange:function(e){let a=e.target.value;if(""==a)l({...t,[n.key]:null});else{let e=m()(a,I).format(s);l({...t,[n.key]:e})}},onBlur:()=>i(!0),type:"time",step:"1"})}function F(e){return(0,a.jsx)(D,{...e,format:"HH:mm:ss"})}function O(e){return(0,a.jsx)(D,{...e,format:"HH:mm:ssZZ"})}var q=n(43386),W=n(27086),U=n(9596);let V=9;function M(e,t){let n=e.columns.map((e,n)=>{var l;let i=function(e){if((0,s.Pm)(e))return"foreign_key";if((0,s.v3)(e.dataType))return"number";if((0,s.nr)(e.dataType))return"array";if((0,s.om)(e.dataType))return"json";if((0,s.II)(e.dataType))return"text";if((0,s.kO)(e.format))return"citext";if((0,s.VO)(e.format))return"date";else if((0,s.LT)(e.format))return"time";else if((0,s.Kp)(e.format))return"datetime";else if((0,s.nL)(e.dataType))return"boolean";else if((0,s.N8)(e.dataType))return"enum";else return"unknown"}(e),o=B(e),c=(e.name.length+e.format.length)*V,u=(null==t?void 0:t.defaultWidth)?t.defaultWidth:o<c?c:o;return{key:e.name,name:e.name,idx:n+1,resizable:!0,sortable:!0,width:u,minWidth:W.mr,frozen:e.isPrimaryKey||!1,isLastFrozenColumn:!1,renderHeaderCell:t=>(0,a.jsx)(q.x8,{...t,columnType:i,isPrimaryKey:e.isPrimaryKey,isEncrypted:e.isEncrypted,format:e.format,foreignKey:e.foreignKey}),renderEditCell:t?function(e,t,n,s,l){if(!n)return["array","json"].includes(t)?e=>(0,a.jsx)(E,{...e,isEditable:n,onExpandEditor:s}):["number","boolean"].includes(t)?void 0:e=>(0,a.jsx)(P,{...e,isEditable:n,onExpandEditor:l});if(!e.isPrimaryKey&&e.isUpdatable)switch(t){case"boolean":return t=>(0,a.jsx)(r,{...t,isNullable:e.isNullable});case"date":return d;case"datetime":return e.format.endsWith("z")?j:g;case"time":return e.format.endsWith("z")?O:F;case"enum":{let t=e.enum.map(e=>({label:e,value:e}));return n=>(0,a.jsx)(z,{...n,options:t,isNullable:e.isNullable})}case"array":case"json":return e=>(0,a.jsx)(E,{...e,onExpandEditor:s});case"number":return R;case"citext":case"text":return t=>(0,a.jsx)(P,{...t,isEditable:n,isNullable:e.isNullable,onExpandEditor:l});default:return}}(e,i,null!==(l=null==t?void 0:t.editable)&&void 0!==l&&l,t.onExpandJSONEditor,t.onExpandTextEditor):void 0,renderCell:function(e,t,n){switch(t){case"boolean":return U.SJ;case"foreign_key":if(e.isPrimaryKey||!e.isUpdatable)return U.k3;return e=>(0,a.jsx)(U._O,{...e,projectRef:n.projectRef,tableId:n.tableId});case"json":return U.$3;default:return U.k3}}(e,i,{projectRef:null==t?void 0:t.projectRef,tableId:null==t?void 0:t.tableId}),parent:void 0,level:0,maxWidth:void 0,draggable:!1}}),l=[q.F_,...n];return(null==t?void 0:t.onAddColumn)&&l.push(q.Lx),l}function B(e){return(0,s.v3)(e.dataType)?120:(0,s.Kp)(e.format)||(0,s.VO)(e.format)||(0,s.LT)(e.format)?150:(0,s.nL)(e.dataType)?120:(0,s.N8)(e.dataType)?150:250}},601:function(e,t,n){"use strict";n.d(t,{II:function(){return d},Kp:function(){return x},LT:function(){return j},N8:function(){return N},Pm:function(){return w},VO:function(){return f},kO:function(){return m},nL:function(){return b},nr:function(){return o},om:function(){return i},v3:function(){return s}});let a=["smallint","integer","bigint","decimal","numeric","real","double precision","serial","bigserial","int2","int4","int8","float4","float8","smallserial","serial2","serial4","serial8"];function s(e){return a.indexOf(e.toLowerCase())>-1}let l=["json","jsonb","array"];function i(e){return l.indexOf(e.toLowerCase())>-1}let r=["array"];function o(e){return r.indexOf(e.toLowerCase())>-1}let c=["uuid","text","character varying"];function d(e){return c.indexOf(e.toLowerCase())>-1}let u=["citext"];function m(e){return u.indexOf(e.toLowerCase())>-1}let h=["timestamp","timestamptz"];function x(e){return h.indexOf(e.toLowerCase())>-1}let p=["date"];function f(e){return p.indexOf(e.toLowerCase())>-1}let g=["time","timetz"];function j(e){return g.indexOf(e.toLowerCase())>-1}let v=["boolean","bool"];function b(e){return v.indexOf(e.toLowerCase())>-1}let y=["user-defined"];function N(e){return y.indexOf(e.toLowerCase())>-1}function w(e){var t;let{targetTableSchema:n,targetTableName:a,targetColumnName:s}=null!==(t=null==e?void 0:e.foreignKey)&&void 0!==t?t:{};return!!n&&!!a&&!!s}},65189:function(e,t,n){"use strict";n.d(t,{CM:function(){return j},$L:function(){return k},ZP:function(){return E}});var a=n(52322),s=n(89796),l=n(34291),i=n.n(l),r=n(11158),o=e=>{let{operation:t="",onSelectOperation:n=i()}=e;return(0,a.jsxs)("div",{className:"flex justify-between space-x-12",children:[(0,a.jsxs)("div",{className:"flex w-1/3 flex-col space-y-2",children:[(0,a.jsx)("label",{className:"text-base text-foreground-light",htmlFor:"allowed-operation",children:"Allowed operation"}),(0,a.jsx)("p",{className:"text-sm text-foreground-lighter",children:"Select an operation for this policy"})]}),(0,a.jsx)("div",{className:"w-2/3",children:(0,a.jsx)("div",{className:"flex items-center space-x-8",children:(0,a.jsx)(r.Z.Group,{type:"small-cards",size:"tiny",id:"allowed-operation",children:["SELECT","INSERT","UPDATE","DELETE","ALL"].map(e=>(0,a.jsx)(r.Z,{name:"allowed-operation",label:e,value:e,checked:t===e,onChange:e=>n(e.target.value)},e))})})})]})},c=n(24990),d=n(2784),u=n(40855),m=n(25321),h=n(13096),x=e=>{let{operation:t="",definition:n="",check:s="",onUpdatePolicyUsing:l=i(),onUpdatePolicyCheck:r=i()}=e,o=e=>["SELECT","UPDATE","DELETE","ALL"].includes(e)||!e,x=e=>["INSERT","UPDATE","ALL"].includes(e),p=(0,h.D9)(t)||"";return(0,d.useEffect)(()=>{o(p)&&!o(t)&&l(void 0),x(p)&&!x(t)&&r(void 0)},[t]),(0,a.jsxs)("div",{className:"space-y-4",children:[o(t)&&(0,a.jsxs)("div",{className:"flex space-x-12",children:[(0,a.jsxs)("div",{className:"flex w-1/3 flex-col space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("label",{className:"text-base text-foreground-light",htmlFor:"policy-name",children:"USING expression"}),(0,a.jsxs)(c.fC,{delayDuration:0,children:[(0,a.jsx)(c.xz,{children:(0,a.jsx)(u.Z,{className:"text-foreground-light",size:16,strokeWidth:1.5})}),(0,a.jsx)(c.h_,{children:(0,a.jsxs)(c.VY,{side:"bottom",children:[(0,a.jsx)(c.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsxs)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow w-[300px] space-y-2 border border-background",children:[(0,a.jsx)("p",{className:"text-xs text-foreground",children:"This expression will be added to queries that refer to the table if row-level security is enabled."}),(0,a.jsx)("p",{className:"text-xs text-foreground",children:"Rows for which the expression returns true will be visible. Any rows for which the expression returns false or null will not be visible to the user (in a SELECT), and will not be available for modification (in an UPDATE or DELETE)."}),(0,a.jsx)("p",{className:"text-xs text-foreground",children:"Such rows are silently suppressed - no error is reported."})]})]})})]})]}),(0,a.jsx)("p",{className:"text-sm text-foreground-lighter",children:"Provide a SQL conditional expression that returns a boolean."})]}),(0,a.jsx)("div",{className:"w-2/3 ".concat(x(t)?"h-32":"h-56"),children:(0,a.jsx)(m.Z,{defaultValue:n,onInputChange:l})})]}),x(t)&&(0,a.jsxs)("div",{className:"flex space-x-12",children:[(0,a.jsxs)("div",{className:"flex w-1/3 flex-col space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("label",{className:"text-base text-foreground-light",htmlFor:"policy-name",children:"WITH CHECK expression"}),(0,a.jsxs)(c.fC,{delayDuration:0,children:[(0,a.jsx)(c.xz,{children:(0,a.jsx)(u.Z,{className:"text-foreground-light",size:16,strokeWidth:1.5})}),(0,a.jsx)(c.h_,{children:(0,a.jsxs)(c.VY,{side:"bottom",children:[(0,a.jsx)(c.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsxs)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow w-[300px] space-y-2 border border-background",children:[(0,a.jsx)("p",{className:"text-xs text-foreground",children:"This expression will be used in INSERT and UPDATE queries against the table if row-level security is enabled."}),(0,a.jsx)("p",{className:"text-xs text-foreground",children:"Only rows for which the expression evaluates to true will be allowed. An error will be thrown if the expression evaluates to false or null for any of the records inserted or any of the records that result from the update."}),(0,a.jsx)("p",{className:"text-xs text-foreground",children:"Note that this expression is evaluated against the proposed new contents of the row, not the original contents."})]})]})})]})]}),(0,a.jsx)("p",{className:"text-sm text-foreground-lighter",children:"Provide a SQL conditional expression that returns a boolean."})]}),(0,a.jsx)("div",{className:"w-2/3 ".concat(o(t)?"h-32":"h-56"),children:(0,a.jsx)(m.Z,{defaultValue:s,onInputChange:r})})]})]})},p=n(27792),f=e=>{let{showTemplates:t,onViewTemplates:n=i(),onReviewPolicy:s=i()}=e;return(0,a.jsx)("div",{className:"flex justify-between items-center border-t px-6 py-4 border-default",children:(0,a.jsxs)("div",{className:"flex w-full items-center justify-end gap-2",children:[t&&(0,a.jsx)(p.z,{type:"default",onClick:n,children:"View templates"}),(0,a.jsx)(p.z,{type:"primary",onClick:s,children:"Review"})]})})},g=n(31840),j=e=>{let{name:t="",limit:n=100,onUpdatePolicyName:s}=e;return(0,a.jsxs)("div",{className:"flex space-x-12",children:[(0,a.jsxs)("div",{className:"flex w-1/3 flex-col space-y-2",children:[(0,a.jsx)("label",{className:"text-base text-foreground-light",htmlFor:"policy-name",children:"Policy name"}),(0,a.jsx)("p",{className:"text-sm text-foreground-lighter",children:"A descriptive name for your policy"})]}),(0,a.jsx)("div",{className:"relative w-2/3",children:(0,a.jsx)(g.Z,{id:"policy-name",value:t,onChange:e=>s(e.target.value),actions:(0,a.jsxs)("span",{className:"mr-3 text-sm text-foreground-lighter",children:[t.length,"/",n]})})})]})},v=n(16208),b=n(83314),y=n(33105),N=n(15698),w=n(54175),_=n(55895),C=n(829),S=n.n(C),k=e=>{let{selectedRoles:t,onUpdateSelectedRoles:n}=e,{project:s}=(0,b.d2)(),{data:l,error:i,isLoading:r,isError:o,isSuccess:c}=(0,_.x)({projectRef:null==s?void 0:s.ref,connectionString:null==s?void 0:s.connectionString}),d=S()((null!=l?l:[]).filter(e=>!v.Bv.includes(e.name)),e=>e.name.toLocaleLowerCase()).map(e=>({id:e.id,name:e.name,value:e.name,disabled:!1}));return(0,a.jsxs)("div",{className:"flex space-x-12",children:[(0,a.jsxs)("div",{className:"flex w-1/3 flex-col space-y-2",children:[(0,a.jsx)("label",{className:"text-foreground-light text-base",htmlFor:"policy-name",children:"Target roles"}),(0,a.jsx)("p",{className:"text-foreground-lighter text-sm",children:"Apply policy to the selected roles"})]}),(0,a.jsxs)("div",{className:"relative w-2/3",children:[r&&(0,a.jsx)(w.Z,{className:"py-4"}),o&&(0,a.jsx)(y.Z,{error:i,subject:"Failed to retrieve database roles"}),c&&(0,a.jsx)(N.Z,{options:d,value:t,placeholder:"Defaults to all (public) roles if none selected",searchPlaceholder:"Search for a role",onChange:n})]})]})},E=e=>{var t,n,l,i;let{isNewPolicy:r=!0,policyFormFields:c={},onUpdatePolicyFormFields:d=()=>{},onViewTemplates:u=()=>{},onReviewPolicy:m=()=>{}}=e,h=null!==(t=null==c?void 0:c.command)&&void 0!==t?t:"",p=null!==(n=null==c?void 0:c.definition)&&void 0!==n?n:"",g=null!==(l=null==c?void 0:c.check)&&void 0!==l?l:"",v=(null!==(i=null==c?void 0:c.roles)&&void 0!==i?i:[]).filter(e=>"public"!==e);return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"space-y-8 py-8",children:[(0,a.jsx)(s.C.Content,{children:(0,a.jsx)(j,{name:c.name,limit:63,onUpdatePolicyName:e=>d({name:e})})}),(0,a.jsx)(s.C.Separator,{}),r&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.C.Content,{children:(0,a.jsx)(o,{operation:h,onSelectOperation:e=>d({command:e})})}),(0,a.jsx)(s.C.Separator,{})]}),(0,a.jsx)(s.C.Content,{children:(0,a.jsx)(k,{selectedRoles:v,onUpdateSelectedRoles:e=>d({roles:e})})}),(0,a.jsx)(s.C.Separator,{}),(0,a.jsx)(s.C.Content,{children:(0,a.jsx)(x,{operation:h,definition:p,check:g,onUpdatePolicyUsing:e=>d({definition:e}),onUpdatePolicyCheck:e=>d({check:e})})})]}),(0,a.jsx)(f,{showTemplates:r,onViewTemplates:u,onReviewPolicy:m})]})}},93124:function(e,t,n){"use strict";n.d(t,{g:function(){return a}});let a=(e,t)=>[{id:"policy-1",preview:!1,templateName:"Enable read access to everyone",description:"This policy gives read access to your table for all users via the SELECT operation.",statement:'\ncreate policy "Enable read access for all users"\non "'.concat(e,'"."').concat(t,'"\nfor select using (true);').trim(),name:"Enable read access for all users",definition:"true",check:"",command:"SELECT",roles:[]},{id:"policy-2",preview:!1,templateName:"Enable insert access for authenticated users only",description:"This policy gives insert access to your table for all authenticated users only.",statement:'\ncreate policy "Enable insert for authenticated users only"\non "'.concat(e,'"."').concat(t,'"\nfor insert to authenticated \nwith check (true);').trim(),name:"Enable insert for authenticated users only",definition:"",check:"true",command:"INSERT",roles:["authenticated"]},{id:"policy-3",preview:!1,templateName:"Enable update access for users based on their email *",description:'This policy assumes that your table has a column "email", and allows users to update rows which the "email" column matches their email.',statement:'\ncreate policy "Enable update for users based on email"\non "'.concat(e,'"."').concat(t,"\"\nfor update using (\n  auth.jwt() ->> 'email' = email\n) with check (\n  auth.jwt() ->> 'email' = email\n);").trim(),name:"Enable update for users based on email",definition:"auth.jwt() ->> 'email' = email",check:"auth.jwt() ->> 'email' = email",command:"UPDATE",roles:[]},{id:"policy-4",preview:!1,templateName:"Enable delete access for users based on their user ID *",description:'This policy assumes that your table has a column "user_id", and allows users to delete rows which the "user_id" column matches their ID',statement:'\ncreate policy "Enable delete for users based on user_id"\non "'.concat(e,'"."').concat(t,'"\nfor delete using (\n  auth.uid() = user_id\n);').trim(),name:"Enable delete for users based on user_id",definition:"auth.uid() = user_id",check:"",command:"DELETE",roles:[]},{id:"policy-5",preview:!1,templateName:"Enable insert access for users based on their user ID *",description:'This policy assumes that your table has a column "user_id", and allows users to insert rows which the "user_id" column matches their ID',statement:'\ncreate policy "Enable insert for users based on user_id"\non "'.concat(e,'"."').concat(t,'"\nfor insert with check (\n  auth.uid() = user_id\n);').trim(),name:"Enable insert for users based on user_id",definition:"",check:"auth.uid() = user_id",command:"INSERT",roles:[]},{id:"policy-6",preview:!0,name:"Policy with table joins",templateName:"Policy with table joins",description:"\nQuery across tables to build more advanced RLS rules\n    \nAssuming 2 tables called `teams` and `members`, you can query both tables in the policy to control access to the members table.",statement:'\ncreate policy "Members can update team details if they belong to the team"\non teams for update using (\n  auth.uid() in (\n    select user_id from members where team_id = id\n  )\n);\n'.trim(),definition:"auth.uid() in (select user_id from members where team_id = id)",check:"",command:"UPDATE",roles:[]},{id:"policy-7",preview:!0,templateName:"Policy with security definer functions",description:"\nUseful in a many-to-many relationship where you want to restrict access to the linking table. \n    \nAssuming 2 tables called `teams` and `members`, you can use a security definer function in combination with a policy to control access to the members table.".trim(),statement:'\ncreate or replace function get_teams_for_user(user_id uuid)\nreturns setof bigint as $$\n  select team_id from members where user_id = $1\n$$ stable language sql security definer;\n\ncreate policy "Team members can update team members if they belong to the team"\non members\nfor all using (\n  team_id in (select get_teams_for_user(auth.uid()))\n);\n'.trim(),name:"Policy with security definer functions",definition:"team_id in (select get_teams_for_user(auth.uid()))",check:"",command:"ALL",roles:[]},{id:"policy-8",preview:!0,name:"Policy to implement Time To Live (TTL)",templateName:"Policy to implement Time To Live (TTL)",description:"\nImplement a TTL-like feature that you see in Instagram stories or Snapchat where messages expire after a day.\n    \nRows under the table are available only if they have been created within the last 24 hours.",statement:'\ncreate policy "Stories are live for a day"\non "'.concat(e,'"."').concat(t,"\"\nfor select using (\n  created_at > (current_timestamp - interval '1 day')\n);\n").trim(),definition:"created_at > (current_timestamp - interval '1 day')",check:"",command:"SELECT",roles:[]}]},94203:function(e,t,n){"use strict";n.d(t,{$A:function(){return k},rE:function(){return b},yV:function(){return ea},pT:function(){return H},tV:function(){return eb},jm:function(){return J}});var a=n(52322),s=n(45455),l=n.n(s),i=n(94069),r=n(5632),o=n(2784),c=n(62202),d=n(24459),u=n(14049),m=n(83314),h=n(31043),x=n(37107),p=n(98263),f=n(43518),g=n(1877),j=n(73579),v=n(70245),b=e=>{let{tables:t,hasTables:n,isLocked:s,onSelectEditPolicy:b}=e,y=(0,r.useRouter)(),{ref:N}=(0,d.UO)(),{project:w}=(0,m.d2)(),_=(0,j._2)(),[C,S]=(0,o.useState)({}),[k,E]=(0,o.useState)({}),{mutate:Z}=(0,g.V)({onError:e=>{c.ZP.error("Failed to toggle RLS: ".concat(e.message))},onSettled:()=>{R()}}),{mutate:T}=(0,f.l)({onSuccess:()=>{c.ZP.success("Successfully deleted policy!")},onSettled:()=>{R()}}),R=()=>{E({}),S({})},z=e=>{S(e)},A=e=>{b(e)},P=e=>{E(e)},L=async()=>{let e={id:C.id,rls_enabled:!C.rls_enabled};Z({projectRef:null==w?void 0:w.ref,connectionString:null==w?void 0:w.connectionString,id:e.id,schema:C.schema,payload:e})},I=async()=>{if(!w)return console.error("Project is required");T({projectRef:w.ref,connectionString:w.connectionString,id:k.id})};return 0===t.length?(0,a.jsx)("div",{className:"flex-grow flex items-center justify-center",children:(0,a.jsx)(x.Z,{size:"large",title:"Row-Level Security (RLS) Policies",ctaButtonLabel:"Create a table",infoButtonLabel:"What is RLS?",infoButtonUrl:"https://supabase.com/docs/guides/auth/row-level-security",onClickCta:()=>y.push("/project/".concat(N,"/editor")),children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(p.Z,{title:"What are policies?",icon:(0,a.jsx)(i.Z,{size:14,strokeWidth:2}),description:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("p",{className:"text-sm",children:"Policies restrict, on a per-user basis, which rows can be returned by normal queries, or inserted, updated, or deleted by data modification commands."}),(0,a.jsx)("p",{className:"text-sm",children:"This is also known as Row-Level Security (RLS). Each policy is attached to a table, and the policy is executed each time its accessed."})]})}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Create a table in this schema first before creating a policy."})]})})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col gap-y-4 pb-4",children:[s&&(0,a.jsx)(u.Z,{schema:_.selectedSchemaName,entity:"policies"}),t.length>0?t.map(e=>(0,a.jsx)("section",{children:(0,a.jsx)(eb,{table:e,isLocked:s,onSelectToggleRLS:z,onSelectEditPolicy:A,onSelectDeletePolicy:P})},e.id)):n?(0,a.jsx)(h.Z,{}):null]}),(0,a.jsx)(v.Z,{danger:!0,visible:!l()(k),title:"Confirm to delete policy",description:'This is permanent! Are you sure you want to delete the policy "'.concat(k.name,'"'),buttonLabel:"Delete",buttonLoadingLabel:"Deleting",onSelectCancel:R,onSelectConfirm:I}),(0,a.jsx)(v.Z,{danger:C.rls_enabled,visible:!l()(C),title:"Confirm to ".concat(C.rls_enabled?"disable":"enable"," Row Level Security"),description:"Are you sure you want to ".concat(C.rls_enabled?"disable":"enable",' Row Level Security for the table "').concat(C.name,'"?'),buttonLabel:"Confirm",buttonLoadingLabel:"Saving",onSelectCancel:R,onSelectConfirm:L})]})},y=n(34291),N=n.n(y),w=n(76626),_=n(65981),C=n(89796),S=n(83033);let k={SELECTION:"SELECTION",TEMPLATES:"TEMPLATES",EDITOR:"EDITOR",REVIEW:"REVIEW"};var E=n(93352),Z=n.n(E),T=n(18149),R=n.n(T);let z=(e,t)=>{let{definition:n,check:a}=e,s={...e,definition:n?n.replace(/\s+/g," ").trim():void 0===n?null:n,check:a?a.replace(/\s+/g," ").trim():void 0===a?null:a};if(l()(t))return A(s);if(R()(e,t))return{};let i={};return(R()(s.name,t.name)||(i.name=s.name),R()(s.definition,t.definition)||(i.definition=s.definition),R()(s.check,t.check)||(i.check=s.check),R()(s.roles,t.roles)||(i.roles=s.roles),l()(i))?{}:P(s,i)},A=e=>{let{name:t,definition:n,check:a,command:s,schema:l,table:i}=e,r=0===e.roles.length?["public"]:e.roles;return{description:"Add policy for the ".concat(s,' operation under the policy "').concat(t,'"'),statement:['CREATE POLICY "'.concat(t,'" ON "').concat(l,'"."').concat(i,'"'),"AS PERMISSIVE FOR ".concat(s),"TO ".concat(r.join(", ")),"".concat(n?"USING (".concat(n,")"):""),"".concat(a?"WITH CHECK (".concat(a,")"):"")].join("\n")}},P=(e,t)=>{var n;let{name:a,schema:s,table:l}=e,i=Z()(t,["definition"]),r=Z()(t,["check"]),o=Z()(t,["name"]),c=Z()(t,["roles"]),d=Object.keys(t),u="Update policy's ".concat(1===d.length?d[0]:"".concat(d.slice(0,d.length-1).join(", ")," and ").concat(d[d.length-1])," "),m=0===(null!==(n=null==t?void 0:t.roles)&&void 0!==n?n:[]).length?["public"]:t.roles,h='ALTER POLICY "'.concat(a,'" ON "').concat(s,'"."').concat(l,'"');return{description:u,statement:["BEGIN;",...i?["  ".concat(h," USING (").concat(t.definition,");")]:[],...r?["  ".concat(h," WITH CHECK (").concat(t.check,");")]:[],...c?["  ".concat(h," TO ").concat(m.join(", "),";")]:[],...o?["  ".concat(h,' RENAME TO "').concat(t.name,'";')]:[],"COMMIT;"].join("\n")}},L=e=>{let{command:t,definition:n,check:a,roles:s}=e;return{...e,action:"PERMISSIVE",command:t||void 0,definition:n||void 0,check:a||void 0,roles:s.length>0?s:void 0}},I=(e,t)=>{let{definition:n,check:a}=e,s={...e,definition:n?n.replace(/\s+/g," ").trim():n,check:a?a.replace(/\s+/g," ").trim():a},l={id:t.id};return R()(s.name,t.name)||(l.name=s.name),R()(s.definition,t.definition)||(l.definition=s.definition||void 0),R()(s.check,t.check)||(l.check=s.check||void 0),R()(s.roles,t.roles)||(0===s.roles.length?l.roles=["public"]:l.roles=s.roles||void 0),l};var D=n(65189),F=n(25321),O=n(27792),q=e=>{let{policy:t={},onSelectBack:n=N(),onSelectSave:s=N()}=e,[i,r]=(0,o.useState)(!1),c=t.statement||"";return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(C.C.Content,{children:(0,a.jsxs)("div",{className:"space-y-6 py-8",children:[(0,a.jsx)("div",{className:"flex items-center justify-between space-y-8",children:(0,a.jsx)("div",{className:"flex flex-col",children:(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"This is the SQL statement that will be used to create your policy."})})}),(0,a.jsx)("div",{className:"space-y-4 overflow-y-auto",style:{maxHeight:"25rem"},children:l()(t)?(0,a.jsx)("div",{className:"my-10 flex items-center justify-center space-x-2 opacity-50",children:(0,a.jsx)("p",{className:"text-base text-foreground-light",children:"There are no changes made to this policy"})}):(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("span",{children:t.description}),(0,a.jsx)("div",{className:"h-40",children:(0,a.jsx)(F.Z,{readOnly:!0,defaultValue:c})})]})})]})}),(0,a.jsxs)("div",{className:"flex w-full items-center justify-end gap-2 border-t px-6 py-4 border-default",children:[(0,a.jsx)(O.z,{type:"default",onClick:n,children:"Back to edit"}),(0,a.jsx)(O.z,{type:"primary",disabled:l()(t),onClick:()=>{r(!0),s()},loading:i,children:"Save policy"})]})]})},W=n(86699),U=n(83036),V=function(e){return(0,a.jsx)(U.Z,{icon:W.Z,...e})},M=n(8448),B=n(72860),K=n(39127),Y=n(40449),Q=n(33025),H=e=>{let{description:t="",showAssistantPreview:n,onViewTemplates:s=N(),onViewEditor:l=N(),onToggleFeaturePreviewModal:i}=e;return(0,_.WZ)(),(0,a.jsxs)(C.C.Content,{className:"space-y-4 py-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:t}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-2 lg:grid-cols-1",children:[(0,a.jsx)(Y.Z,{title:"Get started quickly",description:"Create a policy from a template",icon:(0,a.jsx)("div",{className:"flex",children:(0,a.jsx)("div",{className:" flex h-8 w-8 items-center justify-center rounded bg-foreground text-background ",children:(0,a.jsx)(V,{size:14,strokeWidth:2})})}),onClick:s}),(0,a.jsx)(Y.Z,{title:"For full customization",description:"Create a policy from scratch",icon:(0,a.jsx)("div",{className:"flex",children:(0,a.jsx)("div",{className:" flex h-8 w-8 items-center justify-center rounded bg-foreground text-background ",children:(0,a.jsx)(M.Z,{size:14,strokeWidth:2})})}),onClick:l})]})]}),n&&void 0!==i&&(0,a.jsxs)(B.bZ,{children:[(0,a.jsx)(Q.Z,{}),(0,a.jsx)(B.Cd,{children:"Try the new Supabase Assistant for RLS policies"}),(0,a.jsx)(B.X,{children:"Create RLS policies for your tables with the help of AI"}),(0,a.jsxs)("div",{className:"flex items-center gap-x-2 mt-3",children:[(0,a.jsx)(O.z,{type:"default",onClick:i,children:"Toggle feature preview"}),(0,a.jsx)(O.z,{asChild:!0,type:"default",icon:(0,a.jsx)(K.Z,{size:14,strokeWidth:1.5}),children:(0,a.jsx)("a",{href:"https://supabase.com/blog/studio-introducing-assistant#introducing-the-supabase-assistant",target:"_blank",rel:"noreferrer",children:"Learn more"})})]})]})]})},G=e=>{let{selectedTemplate:t}=e,{id:n,templateName:s,description:i,statement:r}=t;return(0,a.jsx)("div",{className:"space-y-8",style:{width:"70%"},children:!l()(t)&&(0,a.jsx)("div",{className:"flex h-full flex-col justify-between",children:(0,a.jsxs)("div",{className:"my-5 h-full space-y-6 px-6",children:[(0,a.jsx)("div",{className:"space-y-2",children:(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsx)("h3",{className:"text-foreground text-base",children:s}),(0,a.jsx)("p",{className:"text-foreground-light text-sm",children:i})]})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-foreground-light text-sm",children:"Policy SQL template:"}),(0,a.jsx)("div",{className:"h-64",children:(0,a.jsx)(F.Z,{readOnly:!0,queryId:n,defaultValue:r})})]})]})})})},X=n(72762),$=e=>{let{templates:t=[],templatesNote:n="",selectedTemplate:s,setSelectedTemplate:l=N()}=e;return(0,a.jsxs)("div",{className:"flex flex-col justify-between border-r border-default",style:{width:"30%"},children:[(0,a.jsx)("div",{className:"hide-scrollbar  divide-border-primary space-y-0 divide-y divide-solid overflow-y-auto",style:{maxHeight:"24rem"},children:(0,a.jsx)(X.ZP,{type:"border",children:t.map((e,t)=>{let n=(null==s?void 0:s.id)===(null==e?void 0:e.id);return(0,a.jsx)("div",{className:"border-b border-overlay hover:bg-surface-200 "+(n?"bg-surface-300":""),children:(0,a.jsx)(X.ZP.Item,{active:n,onClick:()=>l(e),children:(0,a.jsx)("div",{className:"truncate py-2",children:e.templateName})},e.id)},t)})})}),n&&(0,a.jsx)("div",{className:"px-4 py-2",children:(0,a.jsx)("p",{className:"text-xs text-foreground-lighter",children:n})})]})},J=e=>{let{templates:t=[],templatesNote:n="",onUseTemplate:s=N()}=e,[i,r]=(0,o.useState)(t[0]);return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between border-t border-default",children:[(0,a.jsx)($,{templatesNote:n,templates:t,selectedTemplate:i,setSelectedTemplate:r}),(0,a.jsx)(G,{selectedTemplate:i})]}),(0,a.jsxs)("div",{className:"flex w-full items-center justify-end gap-3 border-t px-6 py-4 border-default",children:[(0,a.jsx)("span",{className:"text-sm text-foreground-lighter",children:"This will override any existing code you've written"}),(0,a.jsx)(O.z,{type:"primary",disabled:l()(i),onClick:()=>s(i),children:"Use this template"})]})]})},ee=n(93124),et=n(13128),en=e=>{let{view:t,schema:n,table:s,isNewPolicy:l,showAssistantPreview:i,onSelectBackFromTemplates:r=N(),onToggleFeaturePreviewModal:o}=e,c=()=>t===k.EDITOR||t===k.SELECTION?"".concat(l?"Adding new policy to":"Editing policy from"," ").concat(n,".").concat(s):t===k.REVIEW?"Reviewing policy to be ".concat(l?"created":"updated"," on ").concat(n,".").concat(s):void 0;return t===k.TEMPLATES?(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("span",{onClick:r,className:"cursor-pointer text-foreground-lighter transition-colors hover:text-foreground",children:(0,a.jsx)(et.Z,{strokeWidth:2,size:14})}),(0,a.jsx)("h4",{children:"Select a template to use for your new policy"})]})}):(0,a.jsxs)("div",{className:"w-full flex items-center justify-between gap-x-4",children:[(0,a.jsx)("h4",{className:"truncate",title:c(),children:c()}),(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[i&&t===k.EDITOR&&(0,a.jsx)(O.z,{type:"default",icon:(0,a.jsx)(Q.Z,{size:14}),onClick:o,children:"Try Supabase Assistant"}),(0,a.jsx)(O.z,{asChild:!0,type:"default",icon:(0,a.jsx)(K.Z,{size:14}),children:(0,a.jsxs)("a",{href:"https://supabase.com/docs/learn/auth-deep-dive/auth-policies",target:"_blank",rel:"noreferrer",children:[" ","Documentation"]})})]})]})},ea=e=>{let{visible:t=!1,schema:n="",table:s="",selectedPolicyToEdit:i={},showAssistantPreview:r=!1,onSelectCancel:d=N(),onCreatePolicy:u,onUpdatePolicy:m,onSaveSuccess:h=N()}=e,x=(0,_.WZ)(),p=l()(i),f=p?{schema:n,table:s,name:"",definition:"",check:"",command:null,roles:[]}:i,[g,j]=(0,o.useState)(""),[v,b]=(0,o.useState)(k.EDITOR),[y,E]=(0,o.useState)(f),[Z,T]=(0,o.useState)(""),[R,A]=(0,o.useState)(!1),[P,F]=(0,o.useState)(!1);(0,o.useEffect)(()=>{t&&(p?O():W(),E(f))},[t]);let O=()=>b(k.SELECTION),W=()=>b(k.EDITOR),U=()=>{j(v),b(k.TEMPLATES)},V=()=>b(k.REVIEW),M=()=>{x.setSelectedFeaturePreview(w.dA.UI_PREVIEW_RLS_AI_ASSISTANT),x.setShowFeaturePreviewModal(!x.showFeaturePreviewModal),d()},B=async e=>{(p?await u(e):await m(e))?W():h()};return(0,a.jsx)(C.C,{hideFooter:!0,size:v===k.SELECTION?"medium":"xxlarge",visible:t,contentStyle:{padding:0},header:[(0,a.jsx)(en,{view:v,isNewPolicy:p,schema:n,table:s,showAssistantPreview:r,onSelectBackFromTemplates:()=>b(g),onToggleFeaturePreviewModal:M},"0")],onCancel:()=>{R?F(!0):d()},children:(0,a.jsxs)("div",{children:[(0,a.jsx)(S.Z,{visible:P,title:"Discard changes",confirmLabel:"Discard",onCancel:()=>F(!1),onConfirm:()=>{d(),F(!1),A(!1)},children:(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"There are unsaved changes. Are you sure you want to close the editor? Your changes will be lost."})}),v===k.SELECTION?(0,a.jsx)(H,{description:"Write rules with PostgreSQL's policies to fit your unique business needs.",onViewTemplates:U,onViewEditor:W,showAssistantPreview:r,onToggleFeaturePreviewModal:M}):v===k.EDITOR?(0,a.jsx)(D.ZP,{isNewPolicy:p,policyFormFields:y,onUpdatePolicyFormFields:e=>{A(!0),e.name&&e.name.length>63||E({...y,...e})},onViewTemplates:U,onReviewPolicy:()=>{let{name:e,definition:t,check:n,command:a}=y;return 0===e.length?c.ZP.error("Please provide a name for your policy"):a?["SELECT","DELETE"].includes(a)&&!t?c.ZP.error("Please provide a USING expression for your policy"):"INSERT"!==a||n?"UPDATE"!==a||t||n?void(T(z(y,i)),V()):c.ZP.error("Please provide either a USING, or WITH CHECK expression, or both for your policy"):c.ZP.error("Please provide a WITH CHECK expression for your policy"):c.ZP.error("Please select an operation for your policy")}}):v===k.TEMPLATES?(0,a.jsx)(J,{templates:(0,ee.g)(n,s).filter(e=>!e.preview),templatesNote:"* References a specific column in the table",onUseTemplate:e=>{E({...y,name:e.name,definition:e.definition,check:e.check,command:e.command,roles:e.roles}),W()}}):v===k.REVIEW?(0,a.jsx)(q,{policy:Z,onSelectBack:W,onSelectSave:()=>{B(p?L(y):I(y,i)),A(!1)}}):null]})})},es=n(57372),el=n(40068),ei=n(43449),er=n(24990),eo=n(59491),ec=n(81733),ed=n(40386),eu=n(38055),em=n(21784),eh=n(13096),ex=n(36322),ep=e=>{let{policy:t,onSelectEditPolicy:n=N(),onSelectDeletePolicy:s=N()}=e,l=(0,eh.Xo)(eo.KA.TENANT_SQL_ADMIN_WRITE,"policies"),{project:i}=(0,m.d2)(),{data:r}=(0,ex.$E)({projectRef:null==i?void 0:i.ref}),o=(null==r?void 0:r.EXTERNAL_ANONYMOUS_USERS_ENABLED)&&(t.roles.includes("authenticated")||t.roles.includes("public"));return(0,a.jsxs)(el.Z.Content,{className:"flex border-overlay w-full space-x-4 border-b py-4 lg:items-center",children:[(0,a.jsxs)("div",{className:"flex grow flex-col space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("p",{className:"font-mono text-xs text-foreground-light",children:t.command}),(0,a.jsx)("p",{className:"text-sm text-foreground",children:t.name}),o?(0,a.jsx)(ec.C,{color:"yellow",children:"Applies to anonymous users"}):null]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("p",{className:"text-foreground-light text-sm",children:"Applied to:"}),t.roles.slice(0,3).map((e,t)=>(0,a.jsx)("code",{className:"text-foreground-light text-xs",children:e},"policy-".concat(e,"-").concat(t))),(0,a.jsxs)(er.fC,{delayDuration:0,children:[(0,a.jsx)(er.xz,{children:t.roles.length>3&&(0,a.jsxs)("code",{className:"text-foreground-light text-xs",children:["+ ",t.roles.length-3," more roles"]},"policy-etc")}),(0,a.jsx)(er.h_,{children:(0,a.jsxs)(er.VY,{side:"bottom",children:[(0,a.jsx)(er.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background max-w-[220px] text-center",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:t.roles.slice(3).join(", ")})})]})})]})]})]}),(0,a.jsx)("div",{children:l?(0,a.jsxs)(ed.h_,{children:[(0,a.jsx)(ed.$F,{asChild:!0,children:(0,a.jsx)(O.z,{type:"default",style:{paddingLeft:4,paddingRight:4},icon:(0,a.jsx)(eu.Z,{})})}),(0,a.jsxs)(ed.AW,{side:"bottom",align:"end",className:"w-40",children:[(0,a.jsxs)(ed.Xi,{className:"space-x-2",onClick:()=>n(t),children:[(0,a.jsx)(M.Z,{size:14}),(0,a.jsx)("p",{children:"Edit policy"})]}),(0,a.jsx)(ed.VD,{}),(0,a.jsxs)(ed.Xi,{className:"space-x-2",onClick:()=>s(t),children:[(0,a.jsx)(em.Z,{size:14}),(0,a.jsx)("p",{children:"Delete policy"})]})]})]}):(0,a.jsxs)(er.fC,{delayDuration:0,children:[(0,a.jsx)(er.xz,{asChild:!0,children:(0,a.jsx)(O.z,{disabled:!0,type:"default",style:{paddingLeft:4,paddingRight:4},icon:(0,a.jsx)(eu.Z,{})})}),!l&&(0,a.jsx)(er.h_,{children:(0,a.jsxs)(er.VY,{side:"left",children:[(0,a.jsx)(er.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to edit RLS policies"})})]})})]})})]})},ef=n(39097),eg=n.n(ef),ej=n(12203),ev=e=>{let{table:t,isLocked:n,onSelectToggleRLS:s=N()}=e,{ref:l}=(0,r.useRouter)().query,i=(0,eh.Xo)(eo.KA.TENANT_SQL_ADMIN_WRITE,"tables");return(0,a.jsxs)("div",{id:t.id.toString(),className:"flex w-full items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex gap-x-4 text-left",children:[(0,a.jsx)(eg(),{href:"/project/".concat(l,"/editor/").concat(t.id),children:(0,a.jsx)("h4",{className:"m-0",children:t.name})}),(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[n&&(0,a.jsx)(ec.C,{children:(0,a.jsxs)("span",{className:"flex gap-2 items-center text-xs uppercase text-foreground-lighter",children:[(0,a.jsx)(ej.Z,{width:12})," Locked"]})}),(0,a.jsx)(ec.C,{variant:t.rls_enabled?"brand":"warning",children:t.rls_enabled?"Row Level Security enabled":"Row Level Security disabled"})]})]}),!n&&(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("div",{className:"flex flex-row justify-end gap-x-2",children:(0,a.jsxs)(er.fC,{delayDuration:0,children:[(0,a.jsx)(er.xz,{asChild:!0,children:(0,a.jsx)(O.z,{type:"default",disabled:!i,onClick:()=>s(t),children:t.rls_enabled?"Disable RLS":"Enable RLS"})}),!i&&(0,a.jsx)(er.h_,{children:(0,a.jsxs)(er.VY,{side:"bottom",children:[(0,a.jsx)(er.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to toggle RLS"})})]})})]})})})]})},eb=e=>{let{table:t,isLocked:n,onSelectToggleRLS:s=N(),onSelectEditPolicy:l=N(),onSelectDeletePolicy:i=N()}=e,{project:r}=(0,m.d2)(),{data:o}=(0,ei.r)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString}),c=(null!=o?o:[]).filter(e=>e.schema===t.schema&&e.table===t.name).sort((e,t)=>e.name.localeCompare(t.name));return(0,a.jsxs)(el.Z,{className:"!m-0",title:(0,a.jsx)(ev,{table:t,isLocked:n,onSelectToggleRLS:s}),children:[(!t.rls_enabled||0===c.length)&&(0,a.jsxs)("div",{className:"px-6 py-4 flex flex-col gap-y-3",children:[t.rls_enabled&&0===c.length&&(0,a.jsxs)(B.bZ,{children:[(0,a.jsx)(es.aN,{}),(0,a.jsx)(B.Cd,{children:"Row Level Security is enabled for this table, but no policies are set"}),(0,a.jsxs)(B.X,{children:["Select queries will return an"," ",(0,a.jsx)("span",{className:"text-foreground underline",children:"empty array"})," of results."]})]}),!t.rls_enabled&&(0,a.jsxs)(B.bZ,{variant:"warning",children:[(0,a.jsx)(es.aN,{}),(0,a.jsx)(B.Cd,{children:"Warning: Row Level Security is disabled. Your table is publicly readable and writable."}),(0,a.jsx)(B.X,{children:"Anyone with the project's anonymous key can modify or delete your data. Enable RLS and create access policies to keep your data secure."})]}),0===c.length&&(0,a.jsx)("p",{className:"text-foreground-light text-sm",children:"No policies created yet"})]}),null==c?void 0:c.map(e=>(0,a.jsx)(ep,{policy:e,onSelectEditPolicy:l,onSelectDeletePolicy:i},e.id))]})}},43801:function(e,t,n){"use strict";function a(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-",{displayName:a,display_name:s,fullName:l,full_name:i,familyName:r,family_name:o,givenName:c,given_name:d,surname:u,lastName:m,last_name:h,firstName:x,first_name:p}=null!==(t=e.raw_user_meta_data)&&void 0!==t?t:{},f=r||o||u||m||h,g=c||d||x||p;return a||s||l||i||g&&f&&"".concat(g," ").concat(f)||n}function s(e){var t;let{avatarUrl:n,avatarURL:a,avatar_url:s,profileUrl:l,profileURL:i,profile_url:r,profileImage:o,profile_image:c,profileImageUrl:d,profileImageURL:u,profile_image_url:m}=null!==(t=e.raw_user_meta_data)&&void 0!==t?t:{};return n||a||s||o||c||l||i||r||d||u||m}n.d(t,{E:function(){return s},G:function(){return a}})},81199:function(e,t,n){"use strict";n.d(t,{$:function(){return l},O:function(){return s}});var a=n(76626);let s=e=>{let t=e.find(e=>"compute_instance"===e.type);return{computeInstance:t,pitr:e.find(e=>"pitr"===e.type),customDomain:e.find(e=>"custom_domain"===e.type),ipv4:e.find(e=>"ipv4"===e.type)}},l=e=>{var t;return!!a.Qy&&(null!==(t=null==e?void 0:e.addons)&&void 0!==t?t:[]).some(e=>"addon_security_hipaa"===e.supabase_prod_id)}},41547:function(e,t,n){"use strict";var a=n(52322),s=n(60100);t.Z=()=>(0,a.jsx)("div",{className:"block w-full rounded border border-muted border-opacity-50 bg-gray-300 p-3",children:(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)(s.Z,{size:20,strokeWidth:1.5}),(0,a.jsx)("p",{className:"text-sm",children:"No backups created yet - check again tomorrow."})]})})},88690:function(e,t,n){"use strict";n.d(t,{Z:function(){return F}});var a=n(52322),s=n(59491),l=n(39097),i=n.n(l),r=n(2784),o=n(62202),c=n(39383),d=n(39127),u=n(79378),m=n(76419),h=n(81733),x=n(83033),p=n(83314),f=n(85945),g=n(48228),j=n(49422),v=n(99172);async function b(e){let{projectRef:t,connectionString:n,id:a}=e,s=new Headers;n&&s.set("x-connection-encrypted",n);let{data:l,error:i}=await (0,j.IV)("/platform/pg-meta/{ref}/extensions",{params:{header:{"x-connection-encrypted":n},path:{ref:t},query:{id:a}},headers:s});if(i)throw i;return l}let y=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,f.NL)();return(0,g.D)(e=>b(e),{async onSuccess(t,n,s){let{projectRef:l}=n;await a.invalidateQueries(v.o.list(l)),await (null==e?void 0:e(t,n,s))},async onError(e,n,a){void 0===t?o.Am.error("Failed to disable database extension: ".concat(e.message)):t(e,n,a)},...n})};var N=n(13096),w=n(30877),_=n(54175),C=n(22092),S=n(5341),k=n(58686),E=n(89796),Z=n(53187),T=n(31840),R=n(55380),z=n(14279),A=n(65283),P=n(72860),L=n(66105),I=n(27792),D=e=>{let{visible:t,extension:n,onCancel:s}=e,{project:l}=(0,p.d2)(),[i,c]=(0,r.useState)(),[d,u]=(0,r.useState)(!1),{data:m,isLoading:h}=(0,S.Q)({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString}),{mutate:x,isLoading:f}=(0,C.k)({onSuccess:()=>{o.ZP.success("".concat(n.name," is on.")),s()},onError:e=>{o.ZP.error("Failed to enable ".concat(n.name,": ").concat(e.message))}});(0,r.useEffect)(()=>{let e=!1;return t&&(async()=>{e||(u(!0),c(void 0));try{let t=await (0,k.Rj)({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString,sql:"select * from pg_available_extension_versions where name = '".concat(n.name,"'")});e||c(t.result[0].schema)}catch(e){}u(!1)})(),()=>{e=!0}},[t,n.name]);let g=async e=>{if(void 0===l)return console.error("Project is required");let t=null!=i?i:"custom"===e.schema?e.name:e.schema;x({projectRef:l.ref,connectionString:null==l?void 0:l.connectionString,schema:t,name:n.name,version:n.default_version,cascade:!0,createSchema:!t.startsWith("pg_")})};return(0,a.jsx)(E.C,{hideFooter:!0,visible:t,onCancel:s,size:"small",header:(0,a.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,a.jsx)("h5",{className:"text-sm text-foreground",children:"Confirm to enable"}),(0,a.jsx)("code",{className:"text-xs",children:n.name})]}),children:(0,a.jsx)(Z.Z,{initialValues:{name:n.name,schema:"extensions"},validate:e=>{let t={};return"custom"!==e.schema||e.name||(t.name="Required field"),t},onSubmit:g,children:e=>{let{values:t}=e;return(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsx)(E.C.Content,{children:d||h?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(_.Z,{}),(0,a.jsx)("div",{className:"w-3/4",children:(0,a.jsx)(_.Z,{})})]}):i?(0,a.jsx)(T.Z,{disabled:!0,id:"schema",name:"schema",value:i,label:"Select a schema to enable the extension for",descriptionText:"Extension must be installed in ".concat(i,".")}):(0,a.jsxs)(R.Z,{size:"small",name:"schema",label:"Select a schema to enable the extension for",children:[(0,a.jsxs)(R.Z.Option,{id:"custom",label:'Create a new schema "'.concat(n.name,'"'),value:"custom",addOnBefore:()=>(0,a.jsx)(z.Z,{size:16,strokeWidth:1.5}),children:['Create a new schema "',n.name,'"']},"custom"),(0,a.jsx)(E.C.Separator,{}),null==m?void 0:m.map(e=>(0,a.jsx)(R.Z.Option,{id:e.name,label:e.name,value:e.name,addOnBefore:()=>(0,a.jsx)(A.Z,{size:16,strokeWidth:1.5}),children:e.name},e.id))]})}),"custom"===t.schema&&(0,a.jsx)(E.C.Content,{children:(0,a.jsx)(T.Z,{id:"name",name:"name",label:"Schema name"})}),"pg_cron"===n.name&&(null==l?void 0:l.cloud_provider)==="FLY"&&(0,a.jsx)(E.C.Content,{children:(0,a.jsxs)(P.bZ,{variant:"warning",children:[(0,a.jsx)(L.Z,{strokeWidth:2}),(0,a.jsx)(P.Cd,{children:"The pg_cron extension is not fully supported for Fly projects"}),(0,a.jsx)(P.X,{children:"You can still enable the extension, but pg_cron jobs may not run due to the behavior of Fly projects."}),(0,a.jsx)(P.X,{className:"mt-3",children:(0,a.jsx)(I.z,{asChild:!0,type:"default",iconRight:(0,a.jsx)(w.Z,{width:12,height:12}),children:(0,a.jsx)("a",{href:"/docs/guides/platform/fly-postgres#limitations",target:"_blank",rel:"noopener noreferrer",children:(0,a.jsx)("span",{children:"Learn more"})})})})]})}),(0,a.jsx)(E.C.Separator,{}),(0,a.jsx)(E.C.Content,{children:(0,a.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,a.jsx)(I.z,{type:"default",disabled:f,onClick:()=>s(),children:"Cancel"}),(0,a.jsx)(I.z,{htmlType:"submit",disabled:f,loading:f,children:"Enable extension"})]})})]})}})})},F=e=>{var t,n,l,f,g;let{extension:j}=e,{project:v}=(0,p.d2)(),b=null!==j.installed_version,[w,_]=(0,r.useState)(!1),{mutate:C,isLoading:S}=y({onSuccess:()=>{o.ZP.success("".concat(j.name," is off.")),T(!1)}}),k=(0,N.Xo)(s.KA.TENANT_SQL_ADMIN_WRITE,"extensions");async function E(){return _(!0)}let[Z,T]=(0,r.useState)(!1),R=()=>{if(void 0===v)return console.error("Project is required");C({projectRef:v.ref,connectionString:v.connectionString,id:j.name})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex border-overlay flex-col overflow-hidden rounded border shadow-sm",children:[(0,a.jsxs)("div",{className:"border-overlay bg-surface-100 flex justify-between w-full border-b py-3 px-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 max-w-[85%]",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 truncate",children:[(0,a.jsx)("h3",{title:j.name,className:"h-5 m-0 text-sm truncate cursor-pointer text-foreground",children:j.name}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:null!==(f=null==j?void 0:j.installed_version)&&void 0!==f?f:j.default_version})]}),c.Rw.find(e=>e.name===j.name)?(0,a.jsx)(i(),{href:(null===(t=c.Rw.find(e=>e.name===j.name))||void 0===t?void 0:t.link.startsWith("/guides"))?"https://supabase.com/docs".concat(null===(n=c.Rw.find(e=>e.name===j.name))||void 0===n?void 0:n.link):null!==(g=null===(l=c.Rw.find(e=>e.name===j.name))||void 0===l?void 0:l.link)&&void 0!==g?g:"",className:"max-w-[85%] cursor-default zans",target:"_blank",rel:"noreferrer",children:(0,a.jsx)(d.Z,{className:"ml-2.5 cursor-pointer",size:14})}):null]}),S?(0,a.jsx)(u.Z,{className:"animate-spin",size:16}):(0,a.jsx)(m.Z,{size:"tiny",checked:b,disabled:!k,onChange:()=>b?void T(!0):E()})]}),(0,a.jsxs)("div",{className:"bg-panel-header-light bg-panel-secondary-light flex h-full flex-col justify-between",children:[(0,a.jsx)("div",{className:"py-3 px-4",children:(0,a.jsx)("p",{className:"text-sm text-foreground-light capitalize-sentence",children:j.comment})}),b&&j.schema&&(0,a.jsx)("div",{className:"py-3 px-4",children:(0,a.jsxs)("div",{className:"flex items-center flex-grow space-x-2 text-sm text-foreground-light",children:[(0,a.jsx)("span",{children:"Schema:"}),(0,a.jsx)(h.C,{children:"".concat(j.schema)})]})})]})]}),(0,a.jsx)(D,{visible:w,extension:j,onCancel:()=>_(!1)}),(0,a.jsx)(x.Z,{visible:Z,title:"Confirm to disable extension",confirmLabel:"Disable",confirmLabelLoading:"Disabling",onCancel:()=>T(!1),onConfirm:()=>R(),children:(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:['Are you sure you want to turn OFF the "',j.name,'" extension?']})})]})}},96475:function(e,t,n){"use strict";n.d(t,{QI:function(){return i},cK:function(){return l}});var a=n(45455),s=n.n(a);function l(e){let t=null==e?void 0:e.split(",");return s()(e)||!t||(null==t?void 0:t.length)==0?{value:[]}:{value:t.map(e=>{let t=e.trim(),n=t.indexOf(" ");return{name:t.slice(0,1!==n?n:0),type:t.slice(n+1)}})}}function i(e){let t=[];if(e)for(var n in e)t.push({name:n,value:e[n]});return{value:t}}},14049:function(e,t,n){"use strict";n.d(t,{b:function(){return d}});var a=n(52322),s=n(2784),l=n(89796),i=n(27792),r=n(72860),o=n(98938),c=n(99962);let d=e=>{let{visible:t,onClose:n}=e;return(0,a.jsx)(l.C,{size:"medium",visible:t,header:"Schemas managed by Supabase",customFooter:(0,a.jsx)("div",{className:"flex items-center justify-end space-x-2",children:(0,a.jsx)(i.z,{type:"default",onClick:()=>n(),children:"Understood"})}),onCancel:()=>n(),children:(0,a.jsxs)(l.C.Content,{className:"py-4 space-y-2",children:[(0,a.jsx)("p",{className:"text-sm",children:"The following schemas are managed by Supabase and are currently protected from write access through the dashboard."}),(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:c.F.map(e=>(0,a.jsx)("code",{className:"text-xs",children:e},e))}),(0,a.jsx)("p",{className:"text-sm !mt-4",children:"These schemas are critical to the functionality of your Supabase project and hence we highly recommend not altering them."}),(0,a.jsx)("p",{className:"text-sm",children:"You can, however, still interact with those schemas through the SQL Editor although we advise you only do so if you know what you are doing."})]})})};t.Z=e=>{let{schema:t,entity:n}=e,[l,c]=(0,s.useState)(!1);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(r.bZ,{children:[(0,a.jsx)(o.Z,{strokeWidth:2}),(0,a.jsxs)(r.Cd,{children:["Currently viewing ",n," from a protected schema"]}),(0,a.jsxs)(r.X,{children:[(0,a.jsxs)("p",{className:"mb-2",children:["The ",(0,a.jsx)("code",{className:"text-xs",children:t})," schema is managed by Supabase and is read-only through the dashboard."]}),(0,a.jsx)(i.z,{type:"default",size:"tiny",onClick:()=>c(!0),children:"Learn more"})]})]}),(0,a.jsx)(d,{visible:l,onClose:()=>c(!1)})]})}},16208:function(e,t,n){"use strict";n.d(t,{Bv:function(){return s},IC:function(){return l},NM:function(){return a}});let a=["anon","service_role","authenticated","authenticator","dashboard_user","supabase_admin","supabase_auth_admin","supabase_read_only_user","supabase_replication_admin","supabase_storage_admin","supabase_functions_admin","pgbouncer","pgsodium_keyholder","pgsodium_keyiduser","pgsodium_keymaker","pgtle_admin"],s=["postgres","pgbouncer","supabase_admin","supabase_auth_admin","supabase_storage_admin","dashboard_user","authenticator","pg_database_owner","pg_read_all_data","pg_write_all_data"],l={can_login:{disabled:!1,description:"User can login",grant_by_dashboard:!0},can_create_role:{disabled:!1,description:"User can create roles",grant_by_dashboard:!0},can_create_db:{disabled:!1,description:"User can create databases",grant_by_dashboard:!0},can_bypass_rls:{disabled:!0,description:"User bypasses every row level security policy",grant_by_dashboard:!1},is_superuser:{disabled:!0,description:"User is a Superuser",grant_by_dashboard:!1},is_replication_role:{disabled:!0,description:"User can initiate streaming replication and put the system in and out of backup mode",grant_by_dashboard:!1}}},18478:function(e,t,n){"use strict";n.d(t,{I:function(){return s},_:function(){return l}});var a=n(76626);let s={STRIPE:"stripe_fdw_handler",FIREBASE:"firebase_fdw_handler",S3:"s3_fdw_handler",CLICK_HOUSE:"click_house_fdw_handler",BIG_QUERY:"big_query_fdw_handler",AIRTABLE:"airtable_fdw_handler",LOGFLARE:"logflare_fdw_handler"},l=[{name:"stripe_wrapper",handlerName:s.STRIPE,validatorName:"stripe_fdw_validator",icon:"".concat(a.GW,"/img/icons/stripe-icon.svg"),extensionName:"StripeFdw",label:"Stripe",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/stripe",server:{options:[{name:"api_key_id",label:"Stripe Secret Key",required:!0,encrypted:!0,hidden:!0,urlHelper:"https://stripe.com/docs/keys"},{name:"api_url",label:"Stripe API URL",defaultValue:"https://api.stripe.com/v1",required:!1,encrypted:!1,hidden:!1}]},tables:[{label:"Balance",description:"The balance currently on your Stripe account",availableColumns:[{name:"balance_type",type:"text"},{name:"amount",type:"bigint"},{name:"currency",type:"text"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"balance",editable:!1,required:!0,type:"text"}]},{label:"Balance Transactions",description:"Transactions that have contributed to the balance on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"amount",type:"bigint"},{name:"currency",type:"text"},{name:"description",type:"text"},{name:"fee",type:"bigint"},{name:"net",type:"bigint"},{name:"status",type:"text"},{name:"type",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"balance_transactions",editable:!1,required:!0,type:"text"}]},{label:"Charges",description:"Charges made on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"amount",type:"bigint"},{name:"currency",type:"text"},{name:"customer",type:"text"},{name:"description",type:"text"},{name:"invoice",type:"text"},{name:"payment_intent",type:"text"},{name:"status",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"charges",editable:!1,required:!0,type:"text"}]},{label:"Customers",description:"Customers on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"email",type:"text"},{name:"name",type:"text"},{name:"description",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"customers",editable:!1,required:!0,type:"text"},{name:"rowid_column",label:"Row ID Column",defaultValue:"id",editable:!0,required:!0,type:"text"}]},{label:"Invoices",description:"Invoices on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"customer",type:"text"},{name:"subscription",type:"text"},{name:"status",type:"text"},{name:"total",type:"bigint"},{name:"currency",type:"text"},{name:"period_start",type:"timestamp"},{name:"period_end",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"invoices",editable:!1,required:!0,type:"text"}]},{label:"Payment Intents",description:"Payment Intents on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"customer",type:"text"},{name:"amount",type:"bigint"},{name:"currency",type:"text"},{name:"payment_method",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"payment_intents",editable:!1,required:!0,type:"text"}]},{label:"Products",description:"Products on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"name",type:"text"},{name:"active",type:"bool"},{name:"default_price",type:"text"},{name:"description",type:"text"},{name:"created",type:"timestamp"},{name:"updated",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"products",editable:!1,required:!0,type:"text"},{name:"rowid_column",label:"Row ID Column",defaultValue:"id",editable:!0,required:!0,type:"text"}]},{label:"Subscriptions",description:"Subscriptions on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"customer",type:"text"},{name:"currency",type:"text"},{name:"current_period_start",type:"timestamp"},{name:"current_period_end",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"subscriptions",editable:!1,required:!0,type:"text"},{name:"rowid_column",label:"Row ID Column",defaultValue:"id",editable:!0,required:!0,type:"text"}]}]},{name:"firebase_wrapper",handlerName:s.FIREBASE,validatorName:"firebase_fdw_validator",icon:"".concat(a.GW,"/img/icons/firebase-icon.svg"),extensionName:"FirebaseFdw",label:"Firebase",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/firebase",server:{options:[{name:"project_id",label:"Project ID",required:!0,encrypted:!1,hidden:!1},{name:"sa_key_id",label:"Service Account Key",required:!0,encrypted:!0,hidden:!0,isTextArea:!0,urlHelper:"https://firebase.google.com/docs/admin/setup#initialize-sdk"}]},tables:[{label:"Users",description:"Shows your Firebase users",availableColumns:[{name:"uid",type:"text"},{name:"email",type:"text"},{name:"created_at",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"auth/users",editable:!1,required:!0,type:"text"},{name:"base_url",label:"Base URL",defaultValue:"https://identitytoolkit.googleapis.com/v1/projects",editable:!0,required:!0,type:"text"},{name:"limit",label:"Limit",defaultValue:"10000",editable:!0,required:!0,type:"text"}]},{label:"Firestore Collection",description:"Map to a Firestore collection",availableColumns:[{name:"name",type:"text"},{name:"created_at",type:"timestamp"},{name:"updated_at",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",label:"Object",placeholder:"firestore/[collection_id]",editable:!0,required:!0,type:"text"},{name:"base_url",label:"Base URL",defaultValue:"https://firestore.googleapis.com/v1beta1/projects",editable:!0,required:!0,type:"text"},{name:"limit",label:"Limit",defaultValue:"10000",editable:!0,required:!0,type:"text"}]}]},{name:"s3_wrapper",handlerName:s.S3,validatorName:"s3_fdw_validator",icon:"".concat(a.GW,"/img/icons/s3-icon.svg"),extensionName:"S3Fdw",label:"S3",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/s3",server:{options:[{name:"vault_access_key_id",label:"Access Key ID",required:!0,encrypted:!0,hidden:!0},{name:"vault_secret_access_key",label:"Access Key Secret",required:!0,encrypted:!0,hidden:!0},{name:"aws_region",label:"AWS Region",required:!0,encrypted:!1,hidden:!1,defaultValue:"us-east-1"}]},tables:[{label:"S3 File",description:"Map to a file in S3 (CSV or JSON only)",options:[{name:"uri",label:"URI",editable:!0,required:!0,placeholder:"s3://bucket/s3_table.csv",type:"text"},{name:"format",label:"Format",editable:!0,required:!0,type:"select",defaultValue:"csv",options:[{label:"CSV",value:"csv"},{label:"JSONL (JSON Lines)",value:"jsonl"}]},{name:"has_header",label:"Has Header",editable:!0,required:!0,type:"select",defaultValue:"true",options:[{label:"True",value:"true"},{label:"False",value:"false"}]},{name:"compress",label:"Compression",editable:!0,required:!1,type:"select",options:[{label:"GZIP",value:"gzip"}]}]}]},{name:"clickhouse_wrapper",handlerName:s.CLICK_HOUSE,validatorName:"click_house_fdw_validator",icon:"".concat(a.GW,"/img/icons/clickhouse-icon.svg"),extensionName:"ClickHouseFdw",label:"ClickHouse",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/clickhouse",server:{options:[{name:"conn_string_id",label:"ClickHouse Connection String",required:!0,encrypted:!0,hidden:!0}]},tables:[{label:"ClickHouse Table",description:"Map to a ClickHouse Table",options:[{name:"table",label:"ClickHouse Table Name",editable:!0,required:!0,placeholder:"my_clickhouse_table",type:"text"},{name:"rowid_column",label:"Row ID Column",defaultValue:"id",editable:!0,required:!0,type:"text"}]}]},{name:"bigquery_wrapper",handlerName:s.BIG_QUERY,validatorName:"big_query_fdw_validator",icon:"".concat(a.GW,"/img/icons/bigquery-icon.svg"),extensionName:"BigQueryFdw",label:"BigQuery",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/bigquery",server:{options:[{name:"sa_key_id",label:"Service Account Key",required:!0,encrypted:!0,hidden:!0},{name:"project_id",label:"Project ID",required:!0,encrypted:!1,hidden:!1},{name:"dataset_id",label:"Dataset ID",required:!0,encrypted:!1,hidden:!1}]},tables:[{label:"BigQuery Table",description:"Map to a BigQuery Table",options:[{name:"table",label:"BigQuery Table Name",editable:!0,required:!0,placeholder:"my_bigquery_table",type:"text"},{name:"location",label:"Location",defaultValue:"US",editable:!0,required:!1,type:"text"},{name:"timeout",label:"Timeout (ms)",defaultValue:"30000",editable:!0,required:!1,type:"text"},{name:"rowid_column",label:"Row ID Column",defaultValue:"id",editable:!0,required:!1,type:"text"}]}]},{name:"airtable_wrapper",handlerName:s.AIRTABLE,validatorName:"airtable_fdw_validator",icon:"".concat(a.GW,"/img/icons/airtable-icon.svg"),extensionName:"airtableFdw",label:"Airtable",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/airtable",server:{options:[{name:"api_key_id",label:"API Key ID",required:!0,encrypted:!0,hidden:!0}]},tables:[{label:"Airtable Table",description:"Map to an Airtable Table",options:[{name:"base_id",label:"Base ID",editable:!0,required:!0,type:"text"},{name:"table_id",label:"Table ID",editable:!0,required:!0,type:"text"}]}]},{name:"logflare_wrapper",handlerName:s.LOGFLARE,validatorName:"logflare_fdw_validator",icon:"".concat(a.GW,"/img/icons/logflare-icon.svg"),extensionName:"logflareFdw",label:"Logflare",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/logflare",server:{options:[{name:"api_key_id",label:"API Key ID",required:!0,encrypted:!0,hidden:!0}]},tables:[{label:"Logflare Table",description:"Map to a Logflare Table",options:[{name:"endpoint",label:"Endpoint",editable:!0,required:!0,type:"text"}]}]}]},50402:function(e,t,n){"use strict";var a=n(52322),s=n(24990),l=n(59491),i=n(38421),r=n.n(i),o=n(39097),c=n.n(o),d=n(2784),u=n(24459),m=n(13096),h=n(27792),x=n(14279),p=n(40386),f=n(18478);t.Z=e=>{let{buttonText:t="Add wrapper",align:n="end"}=e,{ref:i}=(0,u.UO)();return(0,m.Xo)(l.KA.TENANT_SQL_ADMIN_WRITE,"wrappers")?(0,a.jsxs)(p.h_,{children:[(0,a.jsx)(p.$F,{asChild:!0,children:(0,a.jsx)(h.z,{type:"primary",icon:(0,a.jsx)(x.Z,{strokeWidth:1.5}),children:t})}),(0,a.jsx)(p.AW,{side:"bottom",align:n,children:f._.map((e,t)=>(0,a.jsxs)(d.Fragment,{children:[(0,a.jsx)(p.Xi,{className:"space-x-2",asChild:!0,children:(0,a.jsxs)(c(),{href:"/project/".concat(i,"/database/wrappers/new?type=").concat(e.name.toLowerCase()),children:[(0,a.jsx)(r(),{src:e.icon,width:20,height:20,alt:"".concat(e.name," wrapper icon")}),(0,a.jsx)("p",{children:e.label})]})},e.name),t!==f._.length-1&&(0,a.jsx)(p.VD,{})]},t))})]}):(0,a.jsxs)(s.fC,{delayDuration:0,children:[(0,a.jsx)(s.xz,{asChild:!0,children:(0,a.jsx)(h.z,{disabled:!0,type:"primary",icon:(0,a.jsx)(x.Z,{strokeWidth:1.5}),children:t})}),(0,a.jsx)(s.h_,{children:(0,a.jsxs)(s.VY,{side:"bottom",children:[(0,a.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to add wrappers"})})]})})]})}},53174:function(e,t,n){"use strict";n.d(t,{M4:function(){return t2},TH:function(){return Z},B8:function(){return ar},RA:function(){return nL},ZY:function(){return td},ZR:function(){return ah},eX:function(){return nY},_h:function(){return ty},Ms:function(){return aT},IP:function(){return eV},Vj:function(){return tF},_y:function(){return tW},yT:function(){return eA},bw:function(){return V},Hm:function(){return tP}});var a=n(52322),s=n(24990),l=n(59491),i=n(34291),r=n.n(i),o=n(39097),c=n.n(o),d=n(2784),u=n(27792),m=n(31840),h=n(34124),x=n(14279),p=n(40386),f=n(38055),g=n(8448),j=n(21784),v=n(24459),b=n(31043),y=n(28615),N=n(33105),w=n(54175),_=n(13096),C=n(52111),S=n(99962),k=n(16097),E=n(14049),Z=e=>{var t,n,i,o,Z;let{onAddColumn:T=r(),onEditColumn:R=r(),onDeleteColumn:z=r()}=e,{id:A,ref:P}=(0,v.UO)(),[L,I]=(0,d.useState)(""),{data:D,error:F,isError:O,isLoading:q,isSuccess:W}=(0,C.Z)(Number(A)),U=null!==(i=0===L.length?null!==(n=null==D?void 0:D.columns)&&void 0!==n?n:[]:null==D?void 0:null===(t=D.columns)||void 0===t?void 0:t.filter(e=>e.name.includes(L)))&&void 0!==i?i:[],V=S.F.includes(null!==(o=null==D?void 0:D.schema)&&void 0!==o?o:""),M=(0,_.Xo)(l.KA.TENANT_SQL_ADMIN_WRITE,"columns");return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(u.z,{asChild:!0,type:"outline",icon:(0,a.jsx)(k.Z,{size:14}),style:{padding:"5px"},children:(0,a.jsx)(c(),{href:"/project/".concat(P,"/database/tables")})}),(0,a.jsx)(m.Z,{size:"small",placeholder:"Filter columns",value:L,onChange:e=>I(e.target.value),icon:(0,a.jsx)(h.Z,{size:"tiny"})})]}),!V&&(0,a.jsx)("div",{children:(0,a.jsxs)(s.fC,{delayDuration:0,children:[(0,a.jsx)(s.xz,{asChild:!0,children:(0,a.jsx)(u.z,{disabled:!M,icon:(0,a.jsx)(x.Z,{}),onClick:()=>T(),children:"New column"})}),!M&&(0,a.jsx)(s.h_,{children:(0,a.jsxs)(s.VY,{side:"bottom",children:[(0,a.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to create columns"})})]})})]})})]}),V&&(0,a.jsx)(E.Z,{schema:null!==(Z=null==D?void 0:D.schema)&&void 0!==Z?Z:"",entity:"columns"}),q&&(0,a.jsx)(w.A,{}),O&&(0,a.jsx)(N.Z,{error:F,subject:'Failed to retrieve columns for table "'.concat(null==D?void 0:D.schema,".").concat(null==D?void 0:D.name,'"')}),W&&(0,a.jsx)(a.Fragment,{children:0===U.length?(0,a.jsx)(b.Z,{}):(0,a.jsx)("div",{children:(0,a.jsx)(y.Z,{head:[(0,a.jsx)(y.Z.th,{children:"Name"},"name"),(0,a.jsx)(y.Z.th,{className:"hidden lg:table-cell",children:"Description"},"description"),(0,a.jsx)(y.Z.th,{className:"hidden xl:table-cell",children:"Data Type"},"type"),(0,a.jsx)(y.Z.th,{className:"hidden xl:table-cell",children:"Format"},"format"),(0,a.jsx)(y.Z.th,{},"buttons")],body:U.map((e,t)=>(0,a.jsxs)(y.Z.tr,{className:"border-t",children:[(0,a.jsx)(y.Z.td,{children:(0,a.jsx)("p",{children:e.name})}),(0,a.jsx)(y.Z.td,{className:"break-all whitespace-normal",children:null!==e.comment?(0,a.jsx)("p",{title:e.comment,children:e.comment}):(0,a.jsx)("p",{className:"text-border-stronger",children:"No description"})}),(0,a.jsx)(y.Z.td,{children:(0,a.jsx)("code",{className:"text-xs",children:e.data_type})}),(0,a.jsx)(y.Z.td,{className:"font-mono text-xs",children:(0,a.jsx)("code",{className:"text-xs",children:e.format})}),(0,a.jsx)(y.Z.td,{className:"text-right",children:!V&&(0,a.jsxs)(p.h_,{children:[(0,a.jsx)(p.$F,{asChild:!0,children:(0,a.jsx)(u.z,{type:"default",className:"px-1",children:(0,a.jsx)(f.Z,{})})}),(0,a.jsxs)(p.AW,{side:"bottom",align:"end",className:"w-32",children:[(0,a.jsx)(p.Xi,{disabled:!M,onClick:()=>R(e),children:(0,a.jsxs)(s.fC,{delayDuration:0,children:[(0,a.jsxs)(s.xz,{className:"flex items-center space-x-2",children:[(0,a.jsx)(g.Z,{size:"tiny"}),(0,a.jsx)("p",{children:"Edit column"})]}),!M&&(0,a.jsx)(s.h_,{children:(0,a.jsxs)(s.VY,{side:"bottom",children:[(0,a.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:"Additional permissions required to edit column"})})]})})]})}),(0,a.jsx)(p.Xi,{disabled:!M||V,onClick:()=>z(e),children:(0,a.jsxs)(s.fC,{delayDuration:0,children:[(0,a.jsxs)(s.xz,{className:"flex items-center space-x-2",children:[(0,a.jsx)(j.Z,{stroke:"red",size:"tiny"}),(0,a.jsx)("p",{children:"Delete column"})]}),!M&&(0,a.jsx)(s.h_,{children:(0,a.jsxs)(s.VY,{side:"bottom",children:[(0,a.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:"Additional permissions required to edit column"})})]})})]})})]})]})})]},e.name))})})})]})},T=n(96795),R=n.n(T),z=n(72219),A=n(5632),P=n(83314),L=n(1003),I=n(985),D=n(5341),F=n(36554),O=n(73579),q=n(16166),W=n(9019),U=n(36238),V=e=>{let{onAddTable:t=r(),onEditTable:n=r(),onDeleteTable:i=r()}=e,o=(0,A.useRouter)(),{ref:b}=(0,v.UO)(),{project:C}=(0,P.d2)(),k=(0,O._2)(),[Z,T]=(0,d.useState)(""),V=(0,_.Xo)(l.KA.TENANT_SQL_ADMIN_WRITE,"tables"),{data:M}=(0,D.Q)({projectRef:null==C?void 0:C.ref,connectionString:null==C?void 0:C.connectionString}),[B]=R()(null!=M?M:[],e=>{var t;return S.F.includes(null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"")}),{data:K,isLoading:Y,isSuccess:Q,isError:H,error:G}=(0,F.Bj)({projectRef:null==C?void 0:C.ref,connectionString:null==C?void 0:C.connectionString,schema:k.selectedSchemaName,sortByProperty:"name",includeColumns:!0},{select:e=>0===Z.length?e:e.filter(e=>e.name.includes(Z))}),{data:X}=(0,I.z)({projectRef:null==C?void 0:C.ref,connectionString:null==C?void 0:C.connectionString}),$=(null!=X?X:[]).find(e=>"supabase_realtime"===e.name),J=null==M?void 0:M.find(e=>e.name===k.selectedSchemaName),ee=B.some(e=>e.id===(null==J?void 0:J.id));return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(L.Z,{className:"w-[260px]",size:"small",showError:!1,selectedSchemaName:k.selectedSchemaName,onSelectSchema:k.setSelectedSchemaName}),(0,a.jsx)(m.Z,{size:"small",className:"w-64",placeholder:"Search for a table",value:Z,onChange:e=>T(e.target.value),icon:(0,a.jsx)(h.Z,{size:"tiny"})})]}),!ee&&(0,a.jsx)("div",{children:(0,a.jsxs)(s.fC,{delayDuration:0,children:[(0,a.jsx)(s.xz,{asChild:!0,children:(0,a.jsx)(u.z,{disabled:!V,icon:(0,a.jsx)(x.Z,{}),onClick:()=>t(),children:"New table"})}),!V&&(0,a.jsx)(s.h_,{children:(0,a.jsxs)(s.VY,{side:"bottom",children:[(0,a.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to create tables"})})]})})]})})]}),ee&&(0,a.jsx)(E.Z,{schema:k.selectedSchemaName,entity:"tables"}),Y&&(0,a.jsx)(w.A,{}),H&&(0,a.jsx)(N.Z,{error:G,subject:"Failed to retrieve tables"}),Q&&(0,a.jsx)("div",{className:"my-4 w-full",children:(0,a.jsx)(y.Z,{head:[(0,a.jsx)(y.Z.th,{children:"Name"},"name"),(0,a.jsx)(y.Z.th,{className:"hidden lg:table-cell",children:"Description"},"description"),(0,a.jsx)(y.Z.th,{className:"hidden text-right xl:table-cell",children:"Rows (Estimated)"},"rows"),(0,a.jsx)(y.Z.th,{className:"hidden text-right xl:table-cell",children:"Size (Estimated)"},"size"),(0,a.jsx)(y.Z.th,{className:"hidden xl:table-cell text-center",children:"Realtime Enabled"},"realtime"),(0,a.jsx)(y.Z.th,{},"buttons")],body:(0,a.jsxs)(a.Fragment,{children:[0===K.length&&0===Z.length&&(0,a.jsx)(y.Z.tr,{children:(0,a.jsxs)(y.Z.td,{colSpan:6,children:[(0,a.jsx)("p",{className:"text-sm text-foreground",children:"No tables created yet"}),(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:['There are no tables found in the schema "',k.selectedSchemaName,'"']})]})},k.selectedSchemaName),0===K.length&&Z.length>0&&(0,a.jsx)(y.Z.tr,{children:(0,a.jsxs)(y.Z.td,{colSpan:6,children:[(0,a.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',Z,'" did not return any results']})]})},k.selectedSchemaName),K.length>0&&K.map((e,t)=>{var l,r,d;return(0,a.jsxs)(y.Z.tr,{children:[(0,a.jsx)(y.Z.td,{children:e.name.length>20?(0,a.jsxs)(s.fC,{delayDuration:0,disableHoverableContent:!0,children:[(0,a.jsx)(s.xz,{asChild:!0,className:"max-w-[95%] overflow-hidden text-ellipsis whitespace-nowrap",children:(0,a.jsx)("p",{children:e.name})}),(0,a.jsx)(s.h_,{children:(0,a.jsxs)(s.VY,{side:"bottom",children:[(0,a.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-scale-100 py-1 px-2 leading-none shadow border border-scale-200",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:e.name})})]})})]}):(0,a.jsx)("p",{children:e.name})}),(0,a.jsx)(y.Z.td,{className:"hidden max-w-sm truncate lg:table-cell break-all whitespace-normal",children:null!==e.comment?(0,a.jsx)("p",{title:e.comment,children:e.comment}):(0,a.jsx)("p",{className:"text-border-stronger",children:"No description"})}),(0,a.jsx)(y.Z.td,{className:"hidden text-right xl:table-cell",children:(null!==(r=e.live_rows_estimate)&&void 0!==r?r:e.live_row_count).toLocaleString()}),(0,a.jsx)(y.Z.td,{className:"hidden text-right xl:table-cell",children:(0,a.jsx)("code",{className:"text-xs",children:e.size})}),(0,a.jsx)(y.Z.td,{className:"hidden xl:table-cell text-center",children:(null!==(d=null==$?void 0:$.tables)&&void 0!==d?d:[]).find(t=>t.id===e.id)?(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)(q.Z,{strokeWidth:2,className:"text-brand"})}):(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)(W.Z,{strokeWidth:2,className:"text-foreground-lighter"})})}),(0,a.jsx)(y.Z.td,{children:(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)(u.z,{asChild:!0,type:"default",iconRight:(0,a.jsx)(z.Z,{size:14,className:"text-foreground-light"}),className:"whitespace-nowrap hover:border-muted",style:{paddingTop:3,paddingBottom:3},children:(0,a.jsxs)(c(),{href:"/project/".concat(b,"/database/tables/").concat(e.id),children:[null===(l=e.columns)||void 0===l?void 0:l.length," columns"]})}),!ee&&(0,a.jsxs)(p.h_,{children:[(0,a.jsx)(p.$F,{asChild:!0,children:(0,a.jsx)(u.z,{type:"default",className:"px-1",children:(0,a.jsx)(f.Z,{})})}),(0,a.jsxs)(p.AW,{side:"bottom",align:"end",className:"w-32",children:[(0,a.jsx)(p.Xi,{disabled:!V,onClick:()=>n(e),children:(0,a.jsxs)(s.fC,{delayDuration:0,children:[(0,a.jsxs)(s.xz,{className:"flex items-center space-x-2",children:[(0,a.jsx)(g.Z,{size:"tiny"}),(0,a.jsx)("p",{children:"Edit table"})]}),!V&&(0,a.jsx)(s.h_,{children:(0,a.jsxs)(s.VY,{side:"bottom",children:[(0,a.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:"Additional permissions required to edit table"})})]})})]})}),(0,a.jsxs)(p.Xi,{className:"flex items-center space-x-2",onClick:()=>o.push("/project/".concat(null==C?void 0:C.ref,"/editor/").concat(e.id)),children:[(0,a.jsx)(U.Z,{size:"tiny"}),(0,a.jsx)("p",{children:"View table"})]}),(0,a.jsx)(p.Xi,{disabled:!V||ee,onClick:()=>i(e),children:(0,a.jsxs)(s.fC,{delayDuration:0,children:[(0,a.jsxs)(s.xz,{className:"flex items-center space-x-2",children:[(0,a.jsx)(j.Z,{stroke:"red",size:"tiny"}),(0,a.jsx)("p",{children:"Delete table"})]}),!V&&(0,a.jsx)(s.h_,{children:(0,a.jsxs)(s.VY,{side:"bottom",children:[(0,a.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:"Additional permissions required to delete table"})})]})})]})})]})]})]})})]},e.id)})]})})})]})},M=n(829),B=n.n(M),K=n(38880),Y=n(88724),Q=n(34389),H=n(81733),G=n(88230),X=n(87831),$=n(55895),J=n(38799),ee=n(88883),et=n(63955),en=n(62202),ea=n(17414),es=n(56860),el=n(97351),ei=n(79268),er=n(30195),eo=n(27398),ec=n(85945),ed=n(48228),eu=n(49422),em=n(7686);async function eh(e){let{projectRef:t,connectionString:n,payload:a}=e,s=new Headers;n&&s.set("x-connection-encrypted",n);let{data:l,error:i}=await (0,eu.v_)("/platform/pg-meta/{ref}/roles",{params:{header:{"x-connection-encrypted":n},path:{ref:t}},body:a,headers:s});if(i)throw i;return l}let ex=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,ec.NL)();return(0,ed.D)(e=>eh(e),{async onSuccess(t,n,s){let{projectRef:l}=n;await a.invalidateQueries(em.i.list(l)),await (null==e?void 0:e(t,n,s))},async onError(e,n,a){void 0===t?en.Am.error("Failed to create database role: ".concat(e.message)):t(e,n,a)},...n})};var ep=n(16208);let ef=er.ZP.object({name:er.ZP.string().trim().min(1,"You must provide a name").default(""),is_superuser:er.ZP.boolean().default(!1),can_login:er.ZP.boolean().default(!1),can_create_role:er.ZP.boolean().default(!1),can_create_db:er.ZP.boolean().default(!1),is_replication_role:er.ZP.boolean().default(!1),can_bypass_rls:er.ZP.boolean().default(!1)}),eg={name:"",is_superuser:!1,can_login:!1,can_create_role:!1,can_create_db:!1,is_replication_role:!1,can_bypass_rls:!1};var ej=e=>{let{visible:t,onClose:n}=e,s="create-new-role",{project:l}=(0,P.d2)(),i=(0,et.cI)({resolver:(0,ee.F)(ef)}),{mutate:r,isLoading:o}=ex({onSuccess:e=>{en.ZP.success("Successfully created new role: ".concat(e.name)),d()}}),c=async e=>{if(!l)return console.error("Project is required");r({projectRef:l.ref,connectionString:l.connectionString,payload:e})},d=()=>{n(),i.reset(eg)};return(0,a.jsx)(ea.ZP,{size:"large",visible:t,header:"Create a new role",className:"mr-0 transform transition-all duration-300 ease-in-out",loading:!1,onCancel:d,customFooter:(0,a.jsx)("div",{className:"flex w-full justify-end space-x-3 border-t border-default px-3 py-4",children:(0,a.jsx)(eo.iN,{form:s,isSubmitting:o,hasChanges:i.formState.isDirty,handleReset:d})}),children:(0,a.jsx)(es.l0,{...i,children:(0,a.jsxs)("form",{id:s,className:"grid gap-6 w-full px-8 py-8",onSubmit:i.handleSubmit(c),children:[(0,a.jsx)(es.Wi,{control:i.control,name:"name",render:e=>{let{field:t}=e;return(0,a.jsxs)(es.xJ,{className:"grid gap-2 md:grid md:grid-cols-12 space-y-0",children:[(0,a.jsx)(es.lX,{className:"flex flex-col space-y-2 col-span-4 text-sm justify-center text-foreground-light",children:"Name"}),(0,a.jsx)(es.NI,{className:"col-span-8",children:(0,a.jsx)(el.I,{...t,className:"w-full"})}),(0,a.jsx)(es.zG,{className:"col-start-5 col-span-8"})]})}}),(0,a.jsxs)("div",{className:"grid gap-2 mt-4 md:grid md:grid-cols-12",children:[(0,a.jsx)("div",{className:"col-span-4",children:(0,a.jsx)(es.lX,{className:"flex flex-col space-y-2 col-span-4 text-sm justify-center text-foreground-light",children:"Role privileges"})}),(0,a.jsxs)("div",{className:"col-span-8 grid gap-4",children:[Object.keys(ep.IC).filter(e=>ep.IC[e].grant_by_dashboard).map(e=>{let t=ep.IC[e];return(0,a.jsx)(es.Wi,{control:i.control,name:e,render:e=>{let{field:n}=e;return(0,a.jsxs)(es.xJ,{className:"grid gap-2 md:grid md:grid-cols-12 space-y-0",children:[(0,a.jsx)(es.NI,{className:"col-span-8 flex items-center gap-4",children:(0,a.jsxs)("div",{className:"w-full text-sm",children:[(0,a.jsx)(ei.r,{checked:n.value,onCheckedChange:n.onChange}),(0,a.jsx)(es.lX,{children:t.description})]})}),(0,a.jsx)(es.zG,{className:"col-start-5 col-span-8"})]})}},e)}),(0,a.jsx)(ea.ZP.Separator,{}),(0,a.jsxs)("div",{className:"grid gap-4",children:[(0,a.jsx)("p",{className:"text-sm",children:"These privileges cannot be granted via the Dashboard:"}),Object.keys(ep.IC).filter(e=>!ep.IC[e].grant_by_dashboard).map(e=>{let t=ep.IC[e];return(0,a.jsx)(es.Wi,{control:i.control,name:e,render:e=>{let{field:n}=e;return(0,a.jsxs)(es.xJ,{className:"space-y-0 opacity-70",children:[(0,a.jsx)(es.NI,{className:"flex items-center gap-4",children:(0,a.jsxs)("div",{className:"w-full text-sm",children:[(0,a.jsx)(ei.r,{checked:n.value,onCheckedChange:n.onChange,disabled:!0,"aria-readonly":!0}),(0,a.jsx)(es.lX,{children:t.description})]})}),(0,a.jsx)(es.zG,{className:"col-start-5 col-span-8"})]})}},e)})]})]})]})]})})})},ev=n(89796);async function eb(e){let{projectRef:t,connectionString:n,id:a}=e,s=new Headers;n&&s.set("x-connection-encrypted",n);let{data:l,error:i}=await (0,eu.IV)("/platform/pg-meta/{ref}/roles",{params:{header:{"x-connection-encrypted":n},path:{ref:t},query:{id:a}},headers:s});if(i)throw i;return l}let ey=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,ec.NL)();return(0,ed.D)(e=>eb(e),{async onSuccess(t,n,s){let{projectRef:l}=n;await a.invalidateQueries(em.i.list(l)),await (null==e?void 0:e(t,n,s))},async onError(e,n,a){void 0===t?en.Am.error("Failed to delete database role: ".concat(e.message)):t(e,n,a)},...n})};var eN=e=>{let{role:t,visible:n,onClose:s}=e,{project:l}=(0,P.d2)(),{mutate:i,isLoading:r}=ey({onSuccess:()=>{en.ZP.success("Successfully deleted role: ".concat(t.name)),s()}}),o=async()=>l?t?void i({projectRef:l.ref,connectionString:l.connectionString,id:t.id.toString()}):console.error("Failed to delete role: role is missing"):console.error("Project is required");return(0,a.jsx)(ev.C,{size:"small",alignFooter:"right",visible:n,onCancel:s,onConfirm:o,header:(0,a.jsxs)("h3",{children:['Confirm to delete role "',null==t?void 0:t.name,'"']}),loading:r,children:(0,a.jsx)("div",{className:"py-4",children:(0,a.jsx)(ev.C.Content,{children:(0,a.jsx)("p",{className:"text-sm",children:"This will automatically revoke any membership of this role in other roles, and this action cannot be undone."})})})})},ew=n(53187),e_=n(15998),eC=n(65028),eS=n(76419),ek=n(40855);async function eE(e){let{projectRef:t,connectionString:n,id:a,payload:s}=e,l=new Headers;n&&l.set("x-connection-encrypted",n);let{data:i,error:r}=await (0,eu.r$)("/platform/pg-meta/{ref}/roles",{params:{header:{"x-connection-encrypted":n},path:{ref:t},query:{id:a}},body:s,headers:l});if(r)throw r;return i}let eZ=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,ec.NL)();return(0,ed.D)(e=>eE(e),{async onSuccess(t,n,s){let{projectRef:l}=n;await a.invalidateQueries(em.i.list(l)),await (null==e?void 0:e(t,n,s))},async onError(e,n,a){void 0===t?en.Am.error("Failed to update database role: ".concat(e.message)):t(e,n,a)},...n})};var eT=e=>{let{role:t,disabled:n=!1,onSelectDelete:l}=e,{project:i}=(0,P.d2)(),[r,o]=(0,d.useState)(!1),{mutate:c,isLoading:m}=eZ(),{is_superuser:h,can_login:x,can_create_role:g,can_create_db:v,is_replication_role:b,can_bypass_rls:y}=t,N=async(e,n)=>{let{resetForm:a}=n;if(!i)return console.error("Project is required");let{is_superuser:s,is_replication_role:l,...r}=e;c({projectRef:i.ref,connectionString:i.connectionString,id:t.id,payload:r},{onSuccess:()=>{en.ZP.success('Successfully updated role "'.concat(t.name,'"')),a({values:{...e},initialValues:{...e}})}})};return(0,a.jsx)(ew.Z,{name:"role-update-form",initialValues:{is_superuser:h,can_login:x,can_create_role:g,can_create_db:v,is_replication_role:b,can_bypass_rls:y},onSubmit:N,className:"bg-surface-100 hover:bg-overlay-hover data-open:bg-selection border-default hover:border-strong data-open:border-strong data-open:pb-px col-span-12 mx-auto -space-y-px overflow-hidden border border-t-0 first:border-t first:!mt-0 hover:border-t hover:-mt-[1px] shadow transition hover:z-50 first:rounded-tl first:rounded-tr last:rounded-bl last:rounded-br",children:e=>{let{values:i,initialValues:c,handleReset:d}=e,h=JSON.stringify(i)!==JSON.stringify(c);return(0,a.jsxs)(e_.ZP,{open:r,children:[(0,a.jsx)(e_.ZP.Trigger,{asChild:!0,children:(0,a.jsxs)("button",{id:"collapsible-trigger",type:"button",className:"group flex w-full items-center justify-between rounded py-3 px-6 text-foreground",onClick:e=>{"collapsible-trigger"===e.target.id&&o(!r)},children:[(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)(eC.Z,{id:"collapsible-trigger",className:"text-border-stronger transition data-open-parent:rotate-0 data-closed-parent:rotate-180",strokeWidth:2,width:14}),(0,a.jsxs)("div",{className:"space-x-2 flex items-center",children:[(0,a.jsx)("p",{className:"text-left text-sm",id:"collapsible-trigger",children:t.name}),(0,a.jsxs)("p",{className:"text-left text-sm text-foreground-light",id:"collapsible-trigger",children:["(ID: ",t.id,")"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[t.active_connections>0&&(0,a.jsx)("div",{className:"relative h-2 w-2",children:(0,a.jsxs)("span",{className:"flex h-2 w-2",children:[(0,a.jsx)("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-brand opacity-75"}),(0,a.jsx)("span",{className:"relative inline-flex h-2 w-2 rounded-full bg-brand opacity-75"})]})}),(0,a.jsxs)("p",{id:"collapsible-trigger",className:"text-sm ".concat(t.active_connections>0?"text-foreground":"text-foreground-light"),children:[t.active_connections," connections"]}),!n&&(0,a.jsxs)(p.h_,{children:[(0,a.jsx)(p.$F,{asChild:!0,children:(0,a.jsx)(u.z,{type:"default",className:"px-1",children:(0,a.jsx)(f.Z,{})})}),(0,a.jsx)(p.AW,{side:"bottom",className:"w-[120px]",children:(0,a.jsxs)(p.Xi,{className:"space-x-2",onClick:e=>{e.stopPropagation(),l(t)},children:[(0,a.jsx)(j.Z,{className:"text-red-800",size:"tiny",strokeWidth:2}),(0,a.jsx)("p",{children:"Delete"})]})})]})]})]})}),(0,a.jsx)(e_.ZP.Content,{children:(0,a.jsxs)("div",{className:"group border-t border-default bg-surface-100 py-6 px-20 text-foreground",children:[(0,a.jsx)("div",{className:"py-4 space-y-[9px]",children:Object.keys(ep.IC).map(e=>(0,a.jsx)(eS.Z,{size:"small",id:e,name:e,label:ep.IC[e].description,disabled:n||ep.IC[e].disabled,className:["roles-toggle",n||ep.IC[e].disabled?"opacity-50":""].join(" "),afterLabel:!n&&ep.IC[e].disabled?(0,a.jsxs)(s.fC,{delayDuration:0,children:[(0,a.jsx)(s.xz,{type:"button",children:(0,a.jsx)(ek.Z,{size:"tiny",strokeWidth:2,className:"ml-2 relative top-[3px]"})}),(0,a.jsx)(s.h_,{children:(0,a.jsxs)(s.VY,{align:"center",side:"bottom",children:[(0,a.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background space-y-1",children:(0,a.jsx)("span",{className:"text-xs",children:"This privilege cannot be updated via the dashboard"})})]})})]}):(0,a.jsx)(a.Fragment,{})},e))}),!n&&(0,a.jsxs)("div",{className:"py-4 flex items-center space-x-2 justify-end",children:[(0,a.jsx)(u.z,{type:"default",disabled:!h||m,onClick:()=>d(),children:"Cancel"}),(0,a.jsx)(u.z,{type:"primary",htmlType:"submit",disabled:!h||m,loading:m,children:"Save"})]})]})})]})}})},eR=n(12467),ez=e=>{let{index:t}=e;return(0,a.jsx)("div",{className:(0,eR.cn)(["bg-surface-100","data-open:bg-selection","border-default","data-open:border-strong","data-open:pb-px col-span-12 mx-auto","-space-y-px overflow-hidden","border border-t-0 first:border-t first:!mt-0 shadow transition","first:rounded-tl first:rounded-tr","last:rounded-bl last:rounded-br"]),children:(0,a.jsxs)("div",{className:"flex w-full items-center justify-between rounded py-3 px-6 text-foreground",children:[(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)(eC.Z,{id:"collapsible-trigger",className:"text-border-stronger rotate-180",strokeWidth:2,width:14}),(0,a.jsxs)("div",{className:"space-x-2 flex items-center",children:[(0,a.jsx)(w.Z,{className:"h-4 w-20 py-0 my-0.5",delayIndex:t}),(0,a.jsx)(w.Z,{className:"h-4 w-16 py-0 my-0.5",delayIndex:t})]})]}),(0,a.jsx)(w.Z,{className:"h-4 w-[90px] py-0 my-0.5",delayIndex:t})]})})},eA=()=>{let{project:e}=(0,P.d2)(),[t,n]=(0,d.useState)(""),[i,r]=(0,d.useState)("all"),[o,c]=(0,d.useState)(!1),[h,x]=(0,d.useState)(),p=(0,_.Xo)(l.KA.TENANT_SQL_ADMIN_WRITE,"roles"),{data:f}=(0,J.E)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),g=null==f?void 0:f.maxConnections,{data:j,isLoading:v}=(0,$.x)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),b=B()(null!=j?j:[],e=>e.name.toLocaleLowerCase()),y=("active"===i?b.filter(e=>e.active_connections>0):b).filter(e=>e.name.includes(t)),[N,w]=R()(y,e=>ep.NM.includes(e.name)),C=b.map(e=>e.active_connections).reduce((e,t)=>e+t,0),S=B()(b.filter(e=>e.active_connections>0),e=>-e.active_connections);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(m.Z,{size:"small",placeholder:"Search for a role",icon:(0,a.jsx)(K.Z,{size:12}),value:t,onChange:e=>n(e.target.value),actions:t&&(0,a.jsx)(u.z,{size:"tiny",type:"text",onClick:()=>n(""),className:"px-1 mr-1",children:(0,a.jsx)(Y.Z,{size:12,strokeWidth:2})})}),(0,a.jsxs)("div",{className:"flex items-center border border-strong rounded-full w-min h-[34px]",children:[(0,a.jsx)("button",{className:["text-xs w-[90px] h-full text-center rounded-l-full flex items-center justify-center transition","all"===i?"bg-overlay-hover text-foreground":"hover:bg-surface-200 text-foreground-light"].join(" "),onClick:()=>r("all"),children:"All roles"}),(0,a.jsx)("div",{className:"h-full w-[1px] border-r border-strong"}),(0,a.jsx)("button",{className:["text-xs w-[90px] h-full text-center rounded-r-full flex items-center justify-center transition","active"===i?"bg-overlay-hover text-foreground":"hover:bg-surface-200 text-foreground-light"].join(" "),onClick:()=>r("active"),children:"Active roles"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,a.jsxs)(s.fC,{delayDuration:0,children:[(0,a.jsx)(s.xz,{children:(0,a.jsx)("div",{className:"w-42",children:(0,a.jsx)(X.Z,{type:"horizontal",max:g||C,value:C,barClass:0===g||void 0===g?"bg-foreground":C>.9*g?"bg-destructive":C>.75*g?"bg-warning":void 0,labelTop:Number.isInteger(g)?"".concat(C,"/").concat(g):"".concat(C),labelBottom:"Active connections"})})}),(0,a.jsxs)(s.VY,{align:"start",side:"bottom",children:[(0,a.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsxs)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background space-y-1",children:[(0,a.jsx)("p",{className:"text-xs text-foreground-light pr-2",children:"Connections by roles:"}),S.map(e=>(0,a.jsxs)("div",{className:"text-xs text-foreground",children:[e.name,": ",e.active_connections]},e.id))]})]})]}),(0,a.jsxs)(s.fC,{delayDuration:0,children:[(0,a.jsx)(s.xz,{asChild:!0,children:(0,a.jsx)(u.z,{type:"primary",disabled:!p,icon:(0,a.jsx)(Q.Z,{size:12}),onClick:()=>c(!0),children:"Add role"})}),!p&&(0,a.jsxs)(s.VY,{align:"start",side:"bottom",children:[(0,a.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background text-xs",children:"You need additional permissions to add a new role"})]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[N.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"bg-surface-100 border border-default px-6 py-3 rounded-t flex items-center space-x-4",children:[(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Roles managed by Supabase"}),(0,a.jsx)(H.C,{variant:"brand",children:"Protected"})]}),v?Array.from({length:5}).map((e,t)=>(0,a.jsx)(ez,{index:t},t)):N.map(e=>(0,a.jsx)(eT,{disabled:!0,role:e,onSelectDelete:x},e.id))]}),w.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"bg-surface-100 border border-default px-6 py-3 rounded-t",children:(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Other database roles"})}),v?Array.from({length:3}).map((e,t)=>(0,a.jsx)(ez,{index:t},t)):w.map(e=>(0,a.jsx)(eT,{disabled:!p,role:e,onSelectDelete:x},e.id))]})]}),t.length>0&&0===y.length&&(0,a.jsx)(G.Z,{searchString:t,onResetFilter:()=>n("")}),(0,a.jsx)(ej,{visible:o,onClose:()=>c(!1)}),(0,a.jsx)(eN,{role:h,visible:void 0!==h,onClose:()=>x(void 0)})]})},eP=n(25877),eL=n.n(eP),eI=n(98938),eD=n(39127),eF=n(98263),eO=n(73883),eq=n(88690),eW=e=>{let{index:t=0}=e;return(0,a.jsxs)("div",{className:"flex border-overlay flex-col overflow-hidden rounded border shadow-sm",children:[(0,a.jsxs)("div",{className:"border-overlay bg-surface-100 flex justify-between w-full border-b py-3 px-4",children:[(0,a.jsx)("div",{className:"flex items-center gap-1 max-w-[85%]",children:(0,a.jsx)("div",{className:"flex items-center space-x-2 truncate",children:(0,a.jsx)(w.Z,{className:"h-5 w-32 m-0 text-foreground",delayIndex:t})})}),(0,a.jsx)(eS.Z,{size:"tiny",checked:!1,disabled:!0})]}),(0,a.jsx)("div",{className:"bg-panel-header-light bg-panel-secondary-light flex h-full flex-col justify-between",children:(0,a.jsx)("div",{className:"py-3 px-4",children:(0,a.jsx)(w.Z,{className:"h-4 w-48",delayIndex:t})})})]})};let eU=["adminpack","amcheck","file_fdw","lo","old_snapshot","pageinspect","pg_buffercache","pg_freespacemap","pg_prewarm","pg_surgery","pg_visibility","pgstattuple","supabase_vault","supautils","intagg","xml2","pg_tle"];var eV=()=>{let{filter:e}=(0,v.UO)(),{project:t}=(0,P.d2)(),[n,s]=(0,d.useState)(""),{data:i,isLoading:r}=(0,eO.H)({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString}),o=0===n.length?null!=i?i:[]:(null!=i?i:[]).filter(e=>e.name.includes(n)),x=o.filter(e=>!eU.includes(e.name)),[p,f]=R()(x,e=>!eL()(e.installed_version)),g=(0,_.Xo)(l.KA.TENANT_SQL_ADMIN_WRITE,"extensions"),j=(0,_.N4)();return(0,d.useEffect)(()=>{void 0!==e&&s(e)},[e]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(m.Z,{size:"small",placeholder:"Search for an extension",value:n,onChange:e=>s(e.target.value),className:"w-64",icon:(0,a.jsx)(h.Z,{size:"tiny"})}),j&&!g?(0,a.jsx)("div",{className:"w-[500px]",children:(0,a.jsx)(eF.Z,{icon:(0,a.jsx)(eI.Z,{className:"text-foreground-light",strokeWidth:2}),title:"You need additional permissions to update database extensions"})}):(0,a.jsx)(u.z,{asChild:!0,type:"default",icon:(0,a.jsx)(eD.Z,{}),children:(0,a.jsx)(c(),{href:"https://supabase.com/docs/guides/database/extensions",target:"_blank",rel:"noreferrer",children:"Documentation"})})]})}),r?(0,a.jsx)("div",{className:"my-8 w-full space-y-12",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(w.Z,{className:"h-[28px] w-40"}),(0,a.jsx)("div",{className:"mb-4 grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-3",children:Array.from({length:6}).map((e,t)=>(0,a.jsx)(eW,{index:t},t))})]})}):(0,a.jsxs)(a.Fragment,{children:[0===o.length&&(0,a.jsx)(G.Z,{searchString:n,onResetFilter:()=>s("")}),(0,a.jsxs)("div",{className:"my-8 w-full space-y-12",children:[p.length>0&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"text-lg",children:"Enabled extensions"}),(0,a.jsx)("div",{className:"mb-4 grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-3",children:p.map(e=>(0,a.jsx)(eq.Z,{extension:e},e.name))})]}),f.length>0&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"text-lg",children:"Available extensions"}),(0,a.jsx)("div",{className:"mb-4 grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-3",children:f.map(e=>(0,a.jsx)(eq.Z,{extension:e},e.name))})]})]})]})]})},eM=n(45455),eB=n.n(eM),eK=n(20676),eY=n(58686),eQ=n(69786);function eH(e){return"\n    begin;\n\n    ".concat(e,"\n    \n    commit;\n  ")}var eG=n(86218),eX=n(66694);function e$(e){let{wrapperMeta:t,formState:n,tables:a}=e,s=a.filter(e=>e.is_new_schema).map(e=>"create schema if not exists ".concat(e.schema_name,";")).join("\n"),l="\n    create foreign data wrapper ".concat(n.wrapper_name,"\n    handler ").concat(t.handlerName,"\n    validator ").concat(t.validatorName,";\n  "),i=t.server.options.filter(e=>e.encrypted),r=t.server.options.filter(e=>!e.encrypted),o=i.map(e=>{let t="".concat(n.wrapper_name,"_").concat(e.name),a=(n[e.name]||"").replace(/'/g,"''");return"\n      select pgsodium.create_key(\n        name := '".concat(t,"'\n      );\n\n      select vault.create_secret (\n        new_secret := '").concat(a,"',\n        new_name   := '").concat(t,"',\n        new_key_id := (select id from pgsodium.valid_key where name = '").concat(t,"')\n      );\n    ")}).join("\n"),c=[...i.map(e=>"".concat(e.name," ''%s''")),...r.map(e=>"".concat(e.name," ''").concat(n[e.name],"''"))].join(","),d="\n    do $$\n    declare\n      ".concat(i.map(e=>"v_".concat(e.name," text;")).join("\n"),"\n    begin\n      ").concat(i.map(e=>"select id into v_".concat(e.name," from pgsodium.valid_key where name = '").concat(n.wrapper_name,"_").concat(e.name,"' limit 1;")).join("\n"),"\n    \n      execute format(\n        E'create server ").concat(n.server_name,"\\n'\n        '   foreign data wrapper ").concat(n.wrapper_name,"\\n'\n        '   options (\\n'\n        '     ").concat(c,"\\n'\n        '   );',\n        ").concat(i.map(e=>"v_".concat(e.name)).join(",\n"),"\n      );\n    end $$;\n  "),u=a.map(e=>{let t=e.columns;return'\n        create foreign table "'.concat(e.schema_name,'"."').concat(e.table_name,'" (\n          ').concat(t.map(e=>'"'.concat(e.name,'" ').concat(e.type)).join(",\n          "),"\n        )\n        server ").concat(n.server_name,"\n        options (\n          ").concat(Object.entries(e).filter(e=>{let[t,n]=e;return"table_name"!==t&&"schema_name"!==t&&"columns"!==t&&"index"!==t&&"is_new_schema"!==t&&!!n}).map(e=>{let[t,n]=e;return"".concat(t," '").concat(n,"'")}).join(",\n          "),"\n        );\n      ")}).join("\n\n");return"\n    ".concat(s,"\n\n    ").concat(l,"\n\n    ").concat(o,"\n\n    ").concat(d,"\n\n    ").concat(u,"\n  ")}async function eJ(e){let{projectRef:t,connectionString:n,wrapperMeta:a,formState:s,tables:l}=e,i=eH(e$({wrapperMeta:a,formState:s,tables:l})),{result:r}=await (0,eY.Rj)({projectRef:t,connectionString:n,sql:i});return r}let e0=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,ec.NL)();return(0,ed.D)(e=>eJ(e),{async onSuccess(t,n,s){let{projectRef:l}=n;await Promise.all([a.invalidateQueries(eX.C.list(l)),a.invalidateQueries(eQ.M.query(l,["fdws"]),{refetchType:"all"}),a.invalidateQueries(eK.H.list(l)),a.invalidateQueries(eQ.M.query(l,eG.W.list(l)))]),await (null==e?void 0:e(t,n,s))},async onError(e,n,a){void 0===t?en.Am.error("Failed to create ".concat(n.wrapperMeta.label," foreign data wrapper: ").concat(e.message)):t(e,n,a)},...n})};var e1=n(17318),e2=n(79378),e4=n(8993),e3=e=>{var t,n,s;let{option:l,loading:i,error:r}=e,[o,h]=(0,d.useState)(!l.hidden);return l.isTextArea?(0,a.jsx)("div",{className:"text-area-text-sm text-area-resize-none",children:(0,a.jsx)(m.Z.TextArea,{rows:6,error:r,className:"input-mono",disabled:i,id:l.name,name:l.name,label:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("p",{children:l.label}),void 0!==l.urlHelper&&(0,a.jsx)(c(),{href:l.urlHelper,target:"_blank",rel:"noreferrer",children:(0,a.jsx)(ek.Z,{strokeWidth:2,size:14,className:"text-foreground-light hover:text-foreground cursor-pointer transition"})})]}),value:i?"Fetching value from Vault...":void 0,defaultValue:null!==(t=l.defaultValue)&&void 0!==t?t:"",required:null!==(n=l.required)&&void 0!==n&&n},l.name)}):(0,a.jsx)(m.Z,{id:l.name,name:l.name,label:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("p",{children:l.label}),void 0!==l.urlHelper&&(0,a.jsx)(c(),{href:l.urlHelper,target:"_blank",rel:"noreferrer",children:(0,a.jsx)(ek.Z,{strokeWidth:2,size:14,className:"text-foreground-light hover:text-foreground cursor-pointer transition"})})]}),defaultValue:null!==(s=l.defaultValue)&&void 0!==s?s:"",error:r,value:i?"Fetching value from Vault...":void 0,type:!l.hidden||i?"text":o?"text":"password",disabled:i,actions:i?(0,a.jsx)("div",{className:"flex items-center justify-center mr-1",children:(0,a.jsx)(u.z,{disabled:!0,type:"default",icon:(0,a.jsx)(e2.Z,{className:"animate-spin"})})}):l.hidden?(0,a.jsx)("div",{className:"flex items-center justify-center mr-1",children:(0,a.jsx)(u.z,{type:"default",icon:o?(0,a.jsx)(U.Z,{}):(0,a.jsx)(e4.Z,{}),onClick:()=>h(!o)})}):null},l.name)},e5=n(59329),e8=n(55380),e6=n(65283),e9=n(47835),e7=n(65593);let te=[{name:"",type:"text"}];var tt=e=>{let{initialColumns:t=te,onChange:n,errors:s={}}=e,[l,i]=(0,d.useReducer)((e,t)=>{switch(t.type){case"ADD_COLUMN":return{...e,columns:{...e.columns,[e.nextId]:{id:e.nextId,name:"",type:"text"}},nextId:e.nextId+1};case"REMOVE_COLUMN":return{...e,columns:Object.fromEntries(Object.entries(e.columns).filter(e=>{let[n]=e;return Number(n)!==t.payload.id}))};case"UPDATE_COLUMN":return{...e,columns:{...e.columns,[t.payload.id]:{...e.columns[t.payload.id],[t.payload.key]:t.payload.value}}};default:return e}},{columns:Object.fromEntries(t.map((e,t)=>[t,{...e,id:t}])),nextId:t.length}),r=(0,e7.Z)(n);(0,d.useEffect)(()=>{var e;null===(e=r.current)||void 0===e||e.call(r,tn(l.columns))},[l.columns]);let o=()=>{i({type:"ADD_COLUMN"})},c=e=>{i({type:"REMOVE_COLUMN",payload:{id:e}})},h=(e,t,n)=>{i({type:"UPDATE_COLUMN",payload:{id:e,key:t,value:n}})},x=tn(l.columns);return(0,a.jsxs)("div",{className:"w-full flex flex-col gap-4",children:[(0,a.jsx)("div",{className:"flex flex-col gap-4",children:x.map((e,t)=>(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(m.Z,{className:"flex-1 [&_label]:!p-0",layout:"vertical",label:"Name",value:e.name,onChange:t=>h(e.id,"name",t.target.value)}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(e9.Z,{value:e.type,enumTypes:[],onOptionSelect:t=>h(e.id,"type",t),layout:"vertical",className:"[&_label]:!p-0"})}),(0,a.jsx)(u.z,{onClick:()=>c(e.id),icon:(0,a.jsx)(W.Z,{size:14,strokeWidth:1.5}),type:"outline",className:"self-end -translate-y-1 !px-2 !py-2"})]}),s["columns.".concat(t)]&&(0,a.jsx)("span",{className:"text-red-900 text-sm mt-2",children:s["columns.".concat(t)]})]},e.id))}),(0,a.jsx)(u.z,{type:"default",onClick:()=>o(),className:"self-start",children:"Add column"})]})};function tn(e){return Object.values(e).sort((e,t)=>e.id-t.id)}var ta=n(18478);let ts=e=>{let t=new Set(e.filter(e=>e.required).map(e=>e.name)),n=new Set(Array.from(t).filter(e=>e.includes("."))),a=Array.from(n);return e=>Object.fromEntries(Object.entries(e).flatMap(e=>{let[t,n]=e;return Array.isArray(n)?[[t,n],...n.map((e,n)=>["".concat(t,".").concat(n),e])]:[[t,n]]}).filter(e=>{let[s,l]=e,[i,r]=s.split(".");if(void 0!==r&&t.has(i)&&Object.keys(l).some(e=>n.has("".concat(i,".").concat(e)))){let e=a.find(e=>e.startsWith("".concat(i,".")));return!!e&&!l[e.split(".")[1]]}return t.has(i)&&(Array.isArray(l)?l.length<1:!l)}).map(e=>{let[t]=e;return"table_name"===t?[t,"Please provide a name for your table"]:"columns"===t?[t,"Please select at least one column"]:[t,"This field is required"]}))},tl=(e,t)=>{var n;return(null!==(n=null==e?void 0:e.tables)&&void 0!==n?n:[]).map(n=>{var a,s,l;let i=0,r=Object.fromEntries(n.options.map(e=>e.split("=")));switch(e.handler){case ta.I.STRIPE:i=null!==(a=null==t?void 0:t.tables.findIndex(e=>{var t;return(null===(t=e.options.find(e=>"object"===e.name))||void 0===t?void 0:t.defaultValue)===r.object}))&&void 0!==a?a:0;break;case ta.I.FIREBASE:i="auth/users"===r.object?null!==(s=null==t?void 0:t.tables.findIndex(e=>e.options.find(e=>"auth/users"===e.defaultValue)))&&void 0!==s?s:0:null!==(l=null==t?void 0:t.tables.findIndex(e=>"Firestore Collection"===e.label))&&void 0!==l?l:0;case ta.I.S3:case ta.I.AIRTABLE:case ta.I.LOGFLARE:case ta.I.BIG_QUERY:case ta.I.CLICK_HOUSE:}return{...r,index:i,columns:n.columns,is_new_schema:!1,schema:n.schema,schema_name:n.schema,table_name:n.name}})},ti=e=>Object.fromEntries(e.map(e=>e.split("=")));var tr=e=>{let{visible:t,onCancel:n,onSave:s,tables:l,initialData:i}=e,[r,o]=(0,d.useState)("");(0,d.useEffect)(()=>{i&&o(String(i.index))},[i]);let c=""===r?void 0:l[parseInt(r)],u=()=>{o(""),n()};return(0,a.jsx)(ea.ZP,{size:"medium",visible:t,onCancel:u,header:(0,a.jsx)("span",{children:"Edit foreign table"}),customFooter:(0,a.jsx)(e5.Z,{backButtonLabel:"Cancel",applyButtonLabel:"Save",formId:"wrapper-table-editor-form",closePanel:u}),children:(0,a.jsx)(ea.ZP.Content,{children:(0,a.jsxs)("div",{className:"my-4 space-y-6",children:[(0,a.jsxs)(e8.Z,{size:"small",label:"Select a target the table will point to",value:r,onChange:e=>o(e),children:[(0,a.jsx)(e8.Z.Option,{value:"",label:"---",children:"---"},"empty"),l.map((e,t)=>(0,a.jsx)(e8.Z.Option,{className:"group",value:String(t),label:e.label,children:(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{children:e.label}),(0,a.jsx)("p",{className:"opacity-50",children:e.description})]})},String(t)))]}),c&&(0,a.jsx)(tc,{table:c,onSubmit:(e,t)=>{let{resetForm:n}=t;s({...e,index:parseInt(r),schema_name:"custom"===e.schema?e.schema_name:e.schema,is_new_schema:"custom"===e.schema}),n(),o("")},initialData:i})]})})},"WrapperTableEditor")};let to=e=>{var t,n,s;let{option:l}=e;return"select"===l.type?(0,a.jsx)(e8.Z,{id:l.name,name:l.name,label:l.label,defaultValue:null!==(t=l.defaultValue)&&void 0!==t?t:"",children:[...l.required?[]:[(0,a.jsx)(e8.Z.Option,{value:"",label:"---",children:"---"},"empty")],...l.options.map(e=>(0,a.jsx)(e8.Z.Option,{id:l.name+e.value,value:e.value,label:e.label,children:e.label},e.value))]},l.name):(0,a.jsx)(m.Z,{id:l.name,name:l.name,label:l.label,placeholder:null!==(n=l.placeholder)&&void 0!==n?n:"",defaultValue:null!==(s=l.defaultValue)&&void 0!==s?s:""},l.name)},tc=e=>{var t,n,s;let{table:l,onSubmit:i,initialData:r}=e,{project:o}=(0,P.d2)(),{data:c,isLoading:d,isSuccess:u}=(0,D.Q)({projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString}),h=null!==(t=l.options.filter(e=>e.editable&&e.required&&!e.defaultValue))&&void 0!==t?t:[],p=null!==(n=l.options.filter(e=>e.editable&&(!e.required||e.defaultValue)))&&void 0!==n?n:[],f=null!=r?r:{table_name:"",columns:null!==(s=l.availableColumns)&&void 0!==s?s:[],...Object.fromEntries(l.options.map(e=>{var t;return[e.name,null!==(t=e.defaultValue)&&void 0!==t?t:""]})),schema:"public",schema_name:""},g=ts([...l.options,{name:"table_name",required:!0},{name:"columns",required:!0},...l.availableColumns?[]:[{name:"columns.name",required:!0}]]);return(0,a.jsx)(ew.Z,{id:"wrapper-table-editor-form",initialValues:f,validate:g,onSubmit:i,enableReinitialize:!0,children:e=>{var t;let{errors:n,values:s,setFieldValue:i}=e;return(0,a.jsxs)("div",{className:"space-y-4",children:[d&&(0,a.jsx)(w.Z,{className:"py-4"}),u&&(0,a.jsxs)(e8.Z,{size:"small",name:"schema",label:"Select a schema for the foreign table",children:[(0,a.jsx)(e8.Z.Option,{id:"custom",label:"Create a new schema",value:"custom",addOnBefore:()=>(0,a.jsx)(x.Z,{size:16,strokeWidth:1.5}),children:"Create a new schema"},"custom"),(0,a.jsx)(ev.C.Separator,{}),null===(t=null!=c?c:[])||void 0===t?void 0:t.map(e=>(0,a.jsx)(e8.Z.Option,{id:e.name,label:e.name,value:e.name,addOnBefore:()=>(0,a.jsx)(e6.Z,{size:16,strokeWidth:1.5}),children:e.name},e.id))]}),"custom"===s.schema&&(0,a.jsx)(m.Z,{id:"schema_name",name:"schema_name",label:"Schema name"}),(0,a.jsx)(m.Z,{id:"table_name",name:"table_name",label:"Table name",descriptionText:"You can query from this table after the wrapper is enabled."}),h.map(e=>(0,a.jsx)(to,{option:e},e.name)),(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{className:"!w-full",children:l.availableColumns?"Select the columns to be added to your table":"Add columns to your table"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2 w-full",children:l.availableColumns?l.availableColumns.map(e=>{let t=!!s.columns.find(t=>t.name===e.name);return(0,a.jsx)("div",{className:["px-2 py-1 rounded cursor-pointer transition","".concat(t?"bg-brand-300":"bg-surface-300 hover:bg-selection")].join(" "),onClick:()=>{t?i("columns",s.columns.filter(t=>t.name!==e.name)):i("columns",s.columns.concat([e]))},children:(0,a.jsx)("p",{className:"text-sm",children:e.name})},e.name)}):(0,a.jsx)(tt,{initialColumns:s.columns,onChange:e=>{i("columns",e)},errors:n})}),n.columns&&(0,a.jsx)("span",{className:"text-red-900 text-sm mt-2",children:n.columns})]}),p.map(e=>(0,a.jsx)(to,{option:e},e.name))]})}})};var td=()=>{let e="create-wrapper-form",t=(0,A.useRouter)(),n=(0,ec.NL)(),{ref:s,type:i}=(0,v.UO)(),{project:r}=(0,P.d2)(),o=(0,_.Xo)(l.KA.TENANT_SQL_ADMIN_WRITE,"wrappers"),[h,x]=(0,d.useState)([]),[p,f]=(0,d.useState)(!1),[b,y]=(0,d.useState)(),[N,w]=(0,d.useState)({}),{mutate:C,isLoading:S}=e0({onSuccess:()=>{en.ZP.success("Successfully created ".concat(null==k?void 0:k.label," foreign data wrapper")),x([]),h.some(e=>e.is_new_schema)&&(0,D.X)(n,s),t.push("/project/".concat(s,"/database/wrappers"))}}),k=ta._.find(e=>e.name===i),E=void 0!==k?{wrapper_name:"",server_name:"",...Object.fromEntries(k.server.options.map(e=>{var t;return[e.name,null!==(t=e.defaultValue)&&void 0!==t?t:""]}))}:{};if(void 0===k)return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-full space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2 flex flex-col items-center w-[400px]",children:[(0,a.jsx)("p",{children:"Unsupported wrapper type"}),(0,a.jsxs)("p",{className:"text-sm text-center text-foreground-light",children:["The wrapper type ",i," not supported by the dashboard. Head back to create a different wrapper."]})]}),(0,a.jsx)(u.z,{asChild:!0,type:"default",children:(0,a.jsx)(c(),{href:"/project/".concat(s,"/database/wrappers"),children:"Head back"})})]});let Z=async e=>{let t=ts(k.server.options)(e),{wrapper_name:n}=e;if(0===n.length&&(t.name="Please provide a name for your wrapper"),0===h.length&&(t.tables="Please add at least one table"),!eB()(t))return w(t);C({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,wrapperMeta:k,formState:{...e,server_name:"".concat(n,"_server")},tables:h})};return(0,a.jsxs)(eo.ld,{children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"relative flex items-center justify-between mb-6",children:[(0,a.jsx)("div",{className:"transition cursor-pointer absolute -left-20 top-1 opacity-75 hover:opacity-100",children:(0,a.jsx)(c(),{href:"/project/".concat(s,"/database/wrappers"),children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(e1.Z,{strokeWidth:1.5,size:14}),(0,a.jsx)("p",{className:"text-sm",children:"Back"})]})})}),(0,a.jsxs)("h3",{className:"mb-2 text-xl text-foreground",children:["Create a ",k.label," Wrapper"]}),(0,a.jsx)("div",{className:"flex items-center space-x-2",children:(0,a.jsx)(u.z,{asChild:!0,type:"default",icon:(0,a.jsx)(eD.Z,{strokeWidth:1.5}),children:(0,a.jsx)(c(),{href:k.docsUrl,target:"_blank",rel:"noreferrer",children:"Documentation"})})})]}),(0,a.jsx)(ew.Z,{id:e,initialValues:E,onSubmit:Z,children:t=>{var n;let{handleReset:s,values:l,initialValues:i}=t,r=JSON.stringify(l)!==JSON.stringify(i);return(0,a.jsxs)(eo.by,{disabled:!o,footer:(0,a.jsx)("div",{className:"flex px-8 py-4",children:(0,a.jsx)(eo.iN,{form:e,isSubmitting:S,hasChanges:r,handleReset:s,disabled:!o,helper:o?void 0:"You need additional permissions to create a foreign data wrapper"})}),children:[(0,a.jsx)(eo.hj,{header:(0,a.jsx)(eo.S0,{children:"Wrapper Configuration"}),children:(0,a.jsx)(eo.B4,{loading:!1,children:(0,a.jsx)(m.Z,{id:"wrapper_name",label:"Wrapper Name",error:N.wrapper_name,descriptionText:(null!==(n=null==l?void 0:l.wrapper_name)&&void 0!==n?n:"").length>0?(0,a.jsxs)(a.Fragment,{children:["Your wrapper's server name will be"," ",(0,a.jsxs)("code",{className:"text-xs",children:[l.wrapper_name,"_server"]})]}):""})})}),(0,a.jsx)(eo.hj,{header:(0,a.jsxs)(eo.S0,{children:[k.label," Configuration"]}),children:(0,a.jsx)(eo.B4,{loading:!1,children:k.server.options.map(e=>(0,a.jsx)(e3,{option:e,loading:!1,error:N[e.name]},e.name))})}),(0,a.jsx)(eo.hj,{header:(0,a.jsxs)(eo.S0,{children:[(0,a.jsx)("p",{children:"Foreign Tables"}),(0,a.jsx)("p",{className:"text-foreground-light mt-2 w-[90%]",children:"You can query your data from these foreign tables after the wrapper is created"})]}),children:(0,a.jsxs)(eo.B4,{loading:!1,children:[0===h.length?(0,a.jsx)("div",{className:"flex justify-end translate-y-4",children:(0,a.jsx)(u.z,{type:"default",onClick:()=>f(!0),children:"Add foreign table"})}):(0,a.jsx)("div",{className:"space-y-2",children:h.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 border rounded-md border-control",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm",children:[e.schema_name,".",e.table_name]}),(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:[k.tables[e.index].label,":"," ",e.columns.map(e=>e.name).join(", ")]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(u.z,{type:"default",className:"px-1",icon:(0,a.jsx)(g.Z,{}),onClick:()=>{f(!0),y({...e,tableIndex:t})}}),(0,a.jsx)(u.z,{type:"default",className:"px-1",icon:(0,a.jsx)(j.Z,{}),onClick:()=>{x(e=>e.filter((e,n)=>n!==t))}})]})]},"".concat(e.schema_name,".").concat(e.table_name)))}),h.length>0&&(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(u.z,{type:"default",onClick:()=>f(!0),children:"Add foreign table"})}),0===h.length&&N.tables&&(0,a.jsx)("p",{className:"text-sm text-right text-red-900",children:N.tables})]})})]})}})]}),(0,a.jsx)(tr,{visible:p,tables:k.tables,onCancel:()=>{y(void 0),f(!1)},onSave:e=>{x(t=>{if(void 0!==e.tableIndex){let n=e.tableIndex,a=[...t];return delete e.tableIndex,a[n]=e,a}return[...t,e]}),f(!1),y(void 0)},initialData:b})]})},tu=n(9575);let tm=e=>{let{wrapper:t,wrapperMeta:n}=e,a=n.server.options.filter(e=>e.encrypted).map(e=>{let n="".concat(t.name,"_").concat(e.name);return"\n      delete from vault.secrets where key_id = (select id from pgsodium.valid_key where name = '".concat(n,"');\n\n      delete from pgsodium.key where name = '").concat(n,"';\n    ")}).join("\n");return"\n    drop foreign data wrapper if exists ".concat(t.name," cascade;\n\n    ").concat(a,"\n  ")};async function th(e){let{projectRef:t,connectionString:n,wrapper:a,wrapperMeta:s}=e,l=eH(tm({wrapper:a,wrapperMeta:s})),{result:i}=await (0,eY.Rj)({projectRef:t,connectionString:n,sql:l});return i}let tx=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,ec.NL)();return(0,ed.D)(e=>th(e),{async onSuccess(t,n,s){let{projectRef:l}=n;await Promise.all([a.invalidateQueries(eX.C.list(l)),a.invalidateQueries(eQ.M.query(l,["fdws"])),a.invalidateQueries(eK.H.list(l)),a.invalidateQueries(eQ.M.query(l,eG.W.list(l)))]),await (null==e?void 0:e(t,n,s))},async onError(e,n,a){void 0===t?en.Am.error("Failed to disable ".concat(n.wrapper.name," foreign data wrapper: ").concat(e.message)):t(e,n,a)},...n})},tp=e=>{let{wrapper:t,wrapperMeta:n,formState:a,tables:s}=e,l=tm({wrapper:t,wrapperMeta:n}),i=e$({wrapperMeta:n,formState:a,tables:s});return"\n    ".concat(l,"\n\n    ").concat(i,"\n  ")};async function tf(e){let{projectRef:t,connectionString:n,wrapper:a,wrapperMeta:s,formState:l,tables:i}=e,r=eH(tp({wrapper:a,wrapperMeta:s,formState:l,tables:i})),{result:o}=await (0,eY.Rj)({projectRef:t,connectionString:n,sql:r});return o}let tg=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,ec.NL)();return(0,ed.D)(e=>tf(e),{async onSuccess(t,n,s){let{projectRef:l}=n;await Promise.all([a.invalidateQueries(eX.C.list(l)),a.invalidateQueries(eQ.M.query(l,["fdws"])),a.invalidateQueries(eK.H.list(l)),a.invalidateQueries(eQ.M.query(l,eG.W.list(l)))]),await (null==e?void 0:e(t,n,s))},async onError(e,n,a){void 0===t?en.Am.error("Failed to update ".concat(n.wrapper.name," foreign data wrapper: ").concat(e.message)):t(e,n,a)},...n})};var tj=n(47220),tv=n(42341),tb=n(19627),ty=()=>{var e,t;let n="edit-wrapper-form",s=(0,A.useRouter)(),i=(0,ec.NL)(),{ref:r,id:o}=(0,v.UO)(),{project:h}=(0,P.d2)(),{data:x,isLoading:p}=(0,tj.y)({projectRef:null==h?void 0:h.ref,connectionString:null==h?void 0:h.connectionString}),{data:f,isLoading:b}=(0,tb.f)({projectRef:null==h?void 0:h.ref,connectionString:null==h?void 0:h.connectionString}),y=(null!==(e=null==x?void 0:x.result)&&void 0!==e?e:[]).find(e=>Number(e.id)===Number(o)),N=(0,_.Je)(y),w=ta._.find(e=>e.handlerName===(null==N?void 0:N.handler)),{mutate:C,isLoading:S}=tg({onSuccess:()=>{en.ZP.success("Successfully updated ".concat(null==w?void 0:w.label," foreign data wrapper")),E([]),k.some(e=>e.is_new_schema)&&(0,D.X)(i,r),s.push("/project/".concat(r,"/database/wrappers"))}}),[k,E]=(0,d.useState)([]),[Z,T]=(0,d.useState)(!1),[R,z]=(0,d.useState)(),[L,I]=(0,d.useState)({}),F=(0,_.Xo)(l.KA.TENANT_SQL_ADMIN_WRITE,"wrappers"),O=void 0!==w?{wrapper_name:null==N?void 0:N.name,server_name:null==N?void 0:N.server_name,...ti(null!==(t=null==N?void 0:N.server_options)&&void 0!==t?t:[])}:{};if((0,d.useEffect)(()=>{(null==N?void 0:N.id)&&E(tl(N,w))},[null==N?void 0:N.id]),p)return(0,a.jsx)("div",{className:"flex items-center justify-center w-full h-full",children:(0,a.jsx)(tu.Z,{})});if(void 0===N||void 0===w)return S?(0,a.jsx)("div",{className:"flex flex-col items-center justify-center w-full h-full space-y-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(e2.Z,{className:"animate-spin",size:16}),(0,a.jsx)("p",{className:"text-sm",children:"Updating wrapper"})]})}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-full space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2 flex flex-col items-center w-[400px]",children:[(0,a.jsx)("p",{children:"Unknown wrapper"}),(0,a.jsxs)("p",{className:"text-sm text-center text-foreground-light",children:["The wrapper ID ",o," cannot be found in your project. Head back to select another wrapper."]})]}),(0,a.jsx)(u.z,{asChild:!0,type:"default",children:(0,a.jsx)(c(),{href:"/project/".concat(r,"/database/wrappers"),children:"Head back"})})]});let q=async e=>{let t=ts(w.server.options)(e),{wrapper_name:n}=e;if(0===n.length&&(t.name="Please provide a name for your wrapper"),0===k.length&&(t.tables="Please add at least one table"),!eB()(t))return I(t);C({projectRef:null==h?void 0:h.ref,connectionString:null==h?void 0:h.connectionString,wrapper:N,wrapperMeta:w,formState:{...e,server_name:"".concat(n,"_server")},tables:k})};return(0,a.jsxs)(eo.ld,{children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"relative flex items-center justify-between mb-6",children:[(0,a.jsx)("div",{className:"transition cursor-pointer absolute -left-20 top-1 opacity-75 hover:opacity-100",children:(0,a.jsx)(c(),{href:"/project/".concat(r,"/database/wrappers"),children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(e1.Z,{strokeWidth:1.5,size:14}),(0,a.jsx)("p",{className:"text-sm",children:"Back"})]})})}),(0,a.jsxs)("h3",{className:"mb-2 text-xl text-foreground",children:["Edit wrapper: ",N.name]}),(0,a.jsx)("div",{className:"flex items-center space-x-2",children:(0,a.jsx)(u.z,{asChild:!0,type:"default",icon:(0,a.jsx)(eD.Z,{strokeWidth:1.5}),children:(0,a.jsx)(c(),{href:"https://supabase.github.io/wrappers/stripe/",target:"_blank",rel:"noreferrer",children:"Documentation"})})})]}),(0,a.jsx)(ew.Z,{id:n,initialValues:O,onSubmit:q,children:e=>{var t;let{handleReset:s,values:l,initialValues:i,resetForm:r}=e,[o,c]=(0,d.useState)(!1),x=tl(null!==(t=null==N?void 0:N.tables)&&void 0!==t?t:[]),p=JSON.stringify(l)!==JSON.stringify(i),v=JSON.stringify(x)!==JSON.stringify(k),y=w.server.options.filter(e=>e.encrypted);return(0,d.useEffect)(()=>{let e=async()=>{if(c(!0),b)return;let e=(await Promise.all(y.map(async e=>{let t=null==f?void 0:f.find(t=>t.name==="".concat(N.name,"_").concat(e.name));if(void 0===t)return{[e.name]:""};{let n=await (0,tv.mp)({projectRef:null==h?void 0:h.ref,connectionString:null==h?void 0:h.connectionString,id:t.id});return{[e.name]:n[0].decrypted_secret}}}))).reduce((e,t)=>{let[n]=Object.keys(t);return{...e,[n]:t[n]}},{});r({values:{...l,...e},initialValues:{...i,...e}}),c(!1)};y.length>0&&e()},[b]),(0,a.jsxs)(eo.by,{disabled:!F,footer:(0,a.jsx)("div",{className:"flex px-8 py-4",children:(0,a.jsx)(eo.iN,{form:n,isSubmitting:S,hasChanges:p||v,handleReset:()=>{s(),E(x)},disabled:!F,helper:F?void 0:"You need additional permissions to edit a foreign data wrapper"})}),children:[(0,a.jsx)(eo.hj,{header:(0,a.jsx)(eo.S0,{children:"Wrapper Configuration"}),children:(0,a.jsx)(eo.B4,{loading:!1,children:(0,a.jsx)(m.Z,{id:"wrapper_name",label:"Wrapper Name",error:L.wrapper_name,descriptionText:l.wrapper_name!==i.wrapper_name?(0,a.jsxs)(a.Fragment,{children:["Your wrapper's server name will be updated to"," ",(0,a.jsxs)("code",{className:"text-xs",children:[l.wrapper_name,"_server"]})]}):(0,a.jsxs)(a.Fragment,{children:["Your wrapper's server name is"," ",(0,a.jsxs)("code",{className:"text-xs",children:[l.wrapper_name,"_server"]})]})})})}),(0,a.jsx)(eo.hj,{header:(0,a.jsxs)(eo.S0,{children:[w.label," Configuration"]}),children:(0,a.jsx)(eo.B4,{loading:!1,children:w.server.options.map(e=>(0,a.jsx)(e3,{option:e,loading:!!e.encrypted&&o,error:L[e.name]},e.name))})}),(0,a.jsx)(eo.hj,{header:(0,a.jsxs)(eo.S0,{children:[(0,a.jsx)("p",{children:"Foreign Tables"}),(0,a.jsx)("p",{className:"text-foreground-light mt-2 w-[90%]",children:"You can query your data from these foreign tables after the wrapper is created"})]}),children:(0,a.jsxs)(eo.B4,{loading:!1,children:[0===k.length?(0,a.jsx)("div",{className:"flex justify-end translate-y-4",children:(0,a.jsx)(u.z,{type:"default",onClick:()=>T(!0),children:"Add foreign table"})}):(0,a.jsx)("div",{className:"space-y-2",children:k.map((e,t)=>{let n=w.tables[e.index].label;return(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 border rounded-md border-control",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm",children:[e.schema_name,".",e.table_name]}),(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:[n,":"," ",e.columns.map(e=>e.name).join(", ")]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(u.z,{type:"default",className:"px-1",icon:(0,a.jsx)(g.Z,{}),onClick:()=>{T(!0),z({...e,tableIndex:t})}}),(0,a.jsx)(u.z,{type:"default",className:"px-1",icon:(0,a.jsx)(j.Z,{}),onClick:()=>{E(e=>e.filter((e,n)=>n!==t))}})]})]},"".concat(e.schema_name,".").concat(e.table_name))})}),k.length>0&&(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(u.z,{type:"default",onClick:()=>T(!0),children:"Add foreign table"})}),0===k.length&&L.tables&&(0,a.jsx)("p",{className:"text-sm text-right text-red-900",children:L.tables})]})})]})}})]}),(0,a.jsx)(tr,{visible:Z,tables:w.tables,onCancel:()=>{z(void 0),T(!1)},onSave:e=>{E(t=>{if(void 0!==e.tableIndex){let n=e.tableIndex,a=[...t];return delete e.tableIndex,a[n]=e,a}return[...t,e]}),T(!1),z(void 0)},initialData:R})]})},tN=n(3440),tw=n.n(tN),t_=e=>{let{selectedWrapper:t,onClose:n}=e,{project:s}=(0,P.d2)(),{mutate:l,isLoading:i}=tx({onSuccess:()=>{en.ZP.success("Successfully disabled ".concat(null==t?void 0:t.name," foreign data wrapper")),n()}}),r=ta._.find(e=>e.handlerName===(null==t?void 0:t.handler)),o=async()=>(null==s?void 0:s.ref)?t?r?void l({projectRef:null==s?void 0:s.ref,connectionString:null==s?void 0:s.connectionString,wrapper:t,wrapperMeta:r}):console.error("Wrapper meta is required"):console.error("Wrapper is required"):console.error("Project ref is required");return(0,a.jsx)(ev.C,{size:"medium",alignFooter:"right",loading:i,visible:void 0!==t,onCancel:()=>n(),onConfirm:()=>o(),header:"Confirm to disable ".concat(null==t?void 0:t.name),children:(0,a.jsx)("div",{className:"py-4",children:(0,a.jsx)(ev.C.Content,{children:(0,a.jsxs)("p",{className:"text-sm",children:["Are you sure you want to disable ",null==t?void 0:t.name,"? This will also remove all tables created with this wrapper."]})})})})},tC=n(38421),tS=n.n(tC),tk=n(82671),tE=e=>{let{wrappers:t=[],wrapperMeta:n,isOpen:i,onOpen:r,onSelectDelete:o}=e,{ref:d}=(0,tk.UO)(),m=(0,_.Xo)(l.KA.TENANT_SQL_ADMIN_WRITE,"wrappers");return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(e_.ZP,{open:i,onOpenChange:()=>r(n.name),className:"bg-surface-100 hover:bg-overlay-hover data-open:bg-selection border-default hover:border-strong data-open:border-strong col-span-12 mx-auto -space-y-px overflow-hidden transition border shadow hover:z-50 first:rounded-tl first:rounded-tr first:!border-t last:rounded-bl last:rounded-br last:border-t-0",children:[(0,a.jsx)(e_.ZP.Trigger,{asChild:!0,children:(0,a.jsxs)("button",{type:"button",className:"flex items-center justify-between w-full px-6 py-3 rounded group text-foreground",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(eC.Z,{className:"transition text-border-stronger data-open-parent:rotate-0 data-closed-parent:rotate-180",strokeWidth:2,width:14}),(0,a.jsx)(tS(),{src:n.icon,width:20,height:20,alt:"".concat(n.name," wrapper icon")}),(0,a.jsx)("span",{className:"text-sm capitalize",children:n.label})]}),(0,a.jsx)("div",{className:"flex items-center gap-3",children:(0,a.jsxs)("div",{className:"px-3 py-1 text-xs border rounded-md border-strong bg-surface-100 text-foreground",children:[t.length," wrapper",t.length>1?"s":""]})})]})}),(0,a.jsx)(e_.ZP.Content,{children:(0,a.jsx)("div",{className:"border-t group border-strong bg-surface-100 text-foreground divide-y",children:t.map(e=>{let t=Object.fromEntries(e.server_options.map(e=>e.split("="))),[l,i]=R()(n.server.options,"hidden");return(0,a.jsxs)("div",{className:"px-6 py-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"space-y-1 w-3/4",children:[(0,a.jsx)("div",{className:"flex items-center space-x-2",children:(0,a.jsx)("p",{className:"text-base",children:e.name})}),i.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-foreground-light",children:[(0,a.jsxs)("p",{children:[e.label,":"]}),(0,a.jsx)("p",{children:t[e.name]})]},e.name)),l.map(t=>(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,a.jsxs)("p",{className:"text-foreground-light",children:[t.label,":"]}),(0,a.jsxs)(c(),{href:"/project/".concat(d,"/settings/vault/secrets?search=").concat(e.name,"_").concat(t.name),className:"transition text-foreground-light hover:text-foreground flex items-center space-x-2",children:[(0,a.jsx)("span",{children:"Encrypted in Vault"}),(0,a.jsx)(eD.Z,{size:14,strokeWidth:1.5})]})]},t.name)),(0,a.jsxs)("div",{className:"!mt-3 space-y-1",children:[(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:["Foreign tables",e.tables&&": (".concat(e.tables.length,")")]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:e.tables?e.tables.map(e=>(0,a.jsx)(c(),{href:"/project/".concat(d,"/editor/").concat(e.id),children:(0,a.jsx)("div",{className:"text-sm border rounded px-2 py-1 transition bg-surface-200 hover:bg-overlay-hover",children:e.name})},e.id)):(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"No tables available"})})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[m?(0,a.jsx)(c(),{href:"/project/".concat(d,"/database/wrappers/").concat(e.id),children:(0,a.jsx)(u.z,{type:"default",icon:(0,a.jsx)(g.Z,{strokeWidth:1.5}),className:"py-2"})}):(0,a.jsxs)(s.fC,{delayDuration:0,children:[(0,a.jsx)(s.xz,{asChild:!0,children:(0,a.jsx)(u.z,{type:"default",disabled:!0,icon:(0,a.jsx)(g.Z,{strokeWidth:1.5}),className:"py-2"})}),!m&&(0,a.jsx)(s.h_,{children:(0,a.jsxs)(s.VY,{side:"bottom",children:[(0,a.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to edit wrappers"})})]})})]}),(0,a.jsxs)(s.fC,{delayDuration:0,children:[(0,a.jsx)(s.xz,{asChild:!0,children:(0,a.jsx)(u.z,{type:"default",disabled:!m,icon:(0,a.jsx)(j.Z,{strokeWidth:1.5}),className:"py-2",onClick:()=>o(e)})}),!m&&(0,a.jsx)(s.h_,{children:(0,a.jsxs)(s.VY,{side:"bottom",children:[(0,a.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to add wrappers"})})]})})]})]})]},e.id)})})})]})})},tZ=n(6659),tT=n(22092),tR=n(76626),tz=()=>{let{ref:e}=(0,v.UO)(),{resolvedTheme:t}=(0,tZ.F)(),{project:n}=(0,P.d2)(),{data:i}=(0,eO.H)({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString}),r=(null!=i?i:[]).find(e=>"wrappers"===e.name),o=(null!=i?i:[]).find(e=>"supabase_vault"===e.name),m=void 0===r||void 0===o,[h,x]=(0,d.useState)(!1),p=(0,_.Xo)(l.KA.TENANT_SQL_ADMIN_WRITE,"extensions"),{mutateAsync:f}=(0,tT.k)({onError:()=>{}}),g=async()=>{if(void 0===r||void 0===o)return;if(void 0===n)return console.error("Project is required");let e=!1;try{var t,a;x(!0),await Promise.all([f({projectRef:n.ref,connectionString:n.connectionString,schema:null!==(t=r.schema)&&void 0!==t?t:"extensions",name:r.name,version:r.default_version,cascade:!0}),f({projectRef:n.ref,connectionString:n.connectionString,schema:null!==(a=o.schema)&&void 0!==a?a:"vault",name:o.name,version:o.default_version,cascade:!0})])}catch(t){t.message.includes("already exists")||(e=!0,en.ZP.error("Failed to enable Wrappers: ".concat(t.message)))}finally{x(!1),e||en.ZP.success("Wrappers is now enabled!")}};return(0,a.jsx)("div",{children:(0,a.jsx)("div",{className:"w-full px-12 py-12 bg-no-repeat border rounded-md bg-studio border-default",style:{backgroundSize:"45%",backgroundPosition:"105% 40%",backgroundImage:(null==t?void 0:t.includes("dark"))?'url("'.concat(tR.GW,'/img/wrappers-dark.png")'):'url("'.concat(tR.GW,'/img/wrappers-light.png")')},children:(0,a.jsxs)("div",{className:"w-3/5 space-y-8",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"text-lg",children:"Supabase Wrappers"}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Supabase Wrappers is a framework for building Postgres Foreign Data Wrappers (FDW) which connect Postgres to external systems. Query your data warehouse or third-party APIs directly from your database."})]}),m?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"rounded border border-default px-4 py-2 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-foreground-light text-sm",children:"Wrappers is not available for this project yet."}),(0,a.jsx)("p",{className:"text-foreground-light text-sm",children:"Do reach out to us if you're interested!"})]}),(0,a.jsx)("div",{children:(0,a.jsx)(u.z,{asChild:!0,type:"primary",children:(0,a.jsx)(c(),{href:"/support/new?ref=".concat(e,"&category=sales&subject=Request%20for%20access%20to%20wrappers"),target:"_blank",rel:"noreferrer",children:"Contact us"})})})]}),(0,a.jsx)("div",{className:"flex items-center space-x-2 my-1 ml-[1px]",children:(0,a.jsx)(u.z,{asChild:!0,type:"default",icon:(0,a.jsx)(eD.Z,{}),children:(0,a.jsx)(c(),{href:"https://supabase.com/docs/guides/database/extensions/wrappers/overview",target:"_blank",rel:"noreferrer",children:"About Wrappers"})})})]}):(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(u.z,{asChild:!0,type:"default",icon:(0,a.jsx)(eD.Z,{}),children:(0,a.jsx)(c(),{href:"https://supabase.com/docs/guides/database/extensions/wrappers/overview",target:"_blank",rel:"noreferrer",children:"About Wrappers"})}),(0,a.jsxs)(s.fC,{delayDuration:0,children:[(0,a.jsx)(s.xz,{asChild:!0,children:(0,a.jsx)(u.z,{type:"primary",loading:h,disabled:m||h||!p,onClick:()=>g(),children:"Enable Wrappers"})}),!p&&(0,a.jsx)(s.h_,{children:(0,a.jsxs)(s.VY,{side:"bottom",children:[(0,a.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to enable Wrappers for this project"})})]})})]})]})]})})})},tA=n(50402),tP=e=>{var t;let{isEnabled:n}=e,{project:s}=(0,P.d2)(),{data:l}=(0,tj.y)({projectRef:null==s?void 0:s.ref,connectionString:null==s?void 0:s.connectionString}),[i,r]=(0,d.useState)(""),[o,c]=(0,d.useState)(),u=null!==(t=null==l?void 0:l.result)&&void 0!==t?t:[],m=tw()(u,"handler");return(0,a.jsxs)(a.Fragment,{children:[n?(0,a.jsx)("div",{children:0===u.length?(0,a.jsxs)("div",{className:"border rounded border-default px-20 py-16 flex flex-col items-center justify-center space-y-4",children:[(0,a.jsx)("p",{className:"text-sm",children:"No wrappers created yet"}),(0,a.jsx)(tA.Z,{align:"center",buttonText:"Create a new wrapper"})]}):(0,a.jsx)(a.Fragment,{children:ta._.map((e,t)=>{var n;let s=null!==(n=m[e.handlerName])&&void 0!==n?n:[];return s.length>0?(0,a.jsx)(tE,{wrapperMeta:e,wrappers:s,isOpen:i===e.name,onOpen:e=>{i!==e?r(e):r("")},onSelectDelete:c},t):null})})}):(0,a.jsx)(tz,{}),(0,a.jsx)(t_,{selectedWrapper:o,onClose:()=>c(void 0)})]})},tL=n(83033),tI=n(25808),tD=e=>{let{index:t}=e;return(0,a.jsxs)(y.Z.tr,{className:"border-t",children:[(0,a.jsx)(y.Z.td,{className:"px-4 py-3",style:{width:"25%"},children:(0,a.jsx)(w.Z,{className:"h-4 w-24 my-0.5 p-0",delayIndex:t})}),(0,a.jsx)(y.Z.td,{className:"hidden lg:table-cell",style:{width:"25%"},children:(0,a.jsx)(w.Z,{className:"h-4 w-14 my-0.5 p-0",delayIndex:t})}),Array.from({length:4}).map((e,t)=>(0,a.jsx)(y.Z.td,{children:(0,a.jsx)(eS.Z,{size:"tiny",checked:!1,disabled:!0})},t)),(0,a.jsx)(y.Z.td,{className:"px-4 py-3 pr-2",children:(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(w.Z,{className:"h-6 w-12 p-0",delayIndex:t})})})]})},tF=e=>{let{onSelectPublication:t=r()}=e,{project:n}=(0,P.d2)(),[s,i]=(0,d.useState)(""),{data:o,isLoading:c}=(0,I.z)({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString}),{mutate:x}=(0,tI.u)({onSuccess:()=>{en.ZP.success("Successfully updated event"),b(null)}}),p=(0,_.Xo)(l.KA.TENANT_SQL_ADMIN_WRITE,"publications"),f=(0,_.N4)(),g=[{event:"Insert",key:"publish_insert"},{event:"Update",key:"publish_update"},{event:"Delete",key:"publish_delete"},{event:"Truncate",key:"publish_truncate"}],j=0===s.length?null!=o?o:[]:(null!=o?o:[]).filter(e=>e.name.includes(s)),[v,b]=(0,d.useState)(null),N=async()=>{if(!v||!n)return;let{publication:e,event:t,currentStatus:a}=v,s={projectRef:n.ref,connectionString:n.connectionString,id:e.id};s["publish_".concat(t.event.toLowerCase())]=!a,x(s)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)(m.Z,{size:"small",icon:(0,a.jsx)(h.Z,{size:"tiny"}),placeholder:"Filter",value:s,onChange:e=>i(e.target.value)})}),f&&!p&&(0,a.jsx)("div",{className:"w-[500px]",children:(0,a.jsx)(eF.Z,{icon:(0,a.jsx)(eI.Z,{className:"text-foreground-light",strokeWidth:2}),title:"You need additional permissions to update database replications"})})]})}),(0,a.jsxs)("div",{className:"overflow-hidden rounded",children:[(0,a.jsx)(y.Z,{head:[(0,a.jsx)(y.Z.th,{style:{width:"25%"},children:"Name"},"header.name"),(0,a.jsx)(y.Z.th,{className:"hidden lg:table-cell",style:{width:"25%"},children:"System ID"},"header.id"),(0,a.jsx)(y.Z.th,{children:"Insert"},"header.insert"),(0,a.jsx)(y.Z.th,{children:"Update"},"header.update"),(0,a.jsx)(y.Z.th,{children:"Delete"},"header.delete"),(0,a.jsx)(y.Z.th,{children:"Truncate"},"header.truncate"),(0,a.jsx)(y.Z.th,{className:"text-right",children:"Source"},"header.source")],body:c?Array.from({length:5}).map((e,t)=>(0,a.jsx)(tD,{index:t},t)):j.map(e=>(0,a.jsxs)(y.Z.tr,{className:"border-t",children:[(0,a.jsx)(y.Z.td,{className:"px-4 py-3",style:{width:"25%"},children:e.name}),(0,a.jsx)(y.Z.td,{className:"hidden lg:table-cell",style:{width:"25%"},children:e.id}),g.map(t=>(0,a.jsx)(y.Z.td,{children:(0,a.jsx)(eS.Z,{size:"tiny",checked:e[t.key],disabled:!p,onChange:()=>{b({publication:e,event:t,currentStatus:e[t.key]})}})},t.key)),(0,a.jsx)(y.Z.td,{className:"px-4 py-3 pr-2",children:(0,a.jsx)("div",{className:"flex justify-end gap-2",children:(0,a.jsx)(u.z,{type:"default",style:{paddingTop:3,paddingBottom:3},onClick:()=>t(e.id),children:null==e.tables?"All tables":"".concat(e.tables.length," ").concat(e.tables.length>1||0==e.tables.length?"tables":"table")})})})]},e.name))}),!c&&0===j.length&&(0,a.jsx)(G.Z,{searchString:s,onResetFilter:()=>i(""),className:"rounded-t-none border-t-0"})]}),(0,a.jsx)(tL.Z,{visible:null!==v,title:"Confirm to toggle sending ".concat(null==v?void 0:v.event.event.toLowerCase()," events"),confirmLabel:"Confirm",confirmLabelLoading:"Updating",onCancel:()=>b(null),onConfirm:()=>{N()},children:(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:["Are you sure you want to ",(null==v?void 0:v.currentStatus)?"stop":"start"," ","sending ",null==v?void 0:v.event.event.toLowerCase()," events for"," ",null==v?void 0:v.publication.name,"?"]})})]})},tO=n(13128),tq=e=>{var t;let{table:n,selectedPublication:s}=e,{project:i}=(0,P.d2)(),r=null==s.tables,[o,c]=(0,d.useState)((null===(t=s.tables)||void 0===t?void 0:t.find(e=>e.id==n.id))!=void 0),u=(0,_.Xo)(l.KA.TENANT_SQL_ADMIN_WRITE,"publications"),{mutate:m,isLoading:h}=(0,tI.u)(),x=async(e,t)=>{var n;if(void 0===i)return console.error("Project is required");c(!o);let a=null!==(n=null==t?void 0:t.tables)&&void 0!==n?n:[],s=a.some(t=>t.id==e.id)?a.filter(t=>t.id!=e.id).map(e=>"".concat(e.schema,".").concat(e.name)):["".concat(e.schema,".").concat(e.name)].concat(a.map(e=>"".concat(e.schema,".").concat(e.name)));m({projectRef:null==i?void 0:i.ref,connectionString:null==i?void 0:i.connectionString,id:t.id,tables:s},{onSuccess:()=>{en.ZP.success("Successfully ".concat(o?"disabled":"enabled"," replication for ").concat(e.name))},onError:t=>{en.ZP.error("Failed to toggle replication for ".concat(e.name,": ").concat(t.message)),c(o)}})};return(0,a.jsxs)(y.Z.tr,{children:[(0,a.jsx)(y.Z.td,{className:"whitespace-nowrap",children:n.name}),(0,a.jsx)(y.Z.td,{className:"whitespace-nowrap",children:n.schema}),(0,a.jsx)(y.Z.td,{className:"hidden max-w-sm truncate whitespace-nowrap lg:table-cell",children:n.comment}),(0,a.jsx)(y.Z.td,{className:"px-4 py-3 pr-2",children:(0,a.jsx)("div",{className:"flex justify-end gap-2",children:r?(0,a.jsxs)(H.C,{children:[(0,a.jsx)("span",{children:"Enabled"}),(0,a.jsx)("span",{className:"hidden lg:inline-block",children:"\xa0for all tables"})]}):(0,a.jsx)(eS.Z,{size:"tiny",align:"right",disabled:!u||h,className:"m-0 ml-2 mt-1 -mb-1 p-0",checked:o,onChange:()=>x(n,s)})})})]},n.id)},tW=e=>{let{selectedPublication:t,onSelectBack:n}=e,{project:s}=(0,P.d2)(),[i,r]=(0,d.useState)(""),o=(0,_.Xo)(l.KA.TENANT_SQL_ADMIN_WRITE,"publications"),{data:c,isLoading:x,isSuccess:p,isError:f,error:g}=(0,F.Bj)({projectRef:null==s?void 0:s.ref,connectionString:null==s?void 0:s.connectionString},{select:e=>e.filter(e=>0===i.length?!S.F.includes(e.schema):!S.F.includes(e.schema)&&e.name.includes(i))});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(u.z,{type:"outline",onClick:()=>n(),icon:(0,a.jsx)(tO.Z,{}),style:{padding:"5px"}}),(0,a.jsx)("div",{children:(0,a.jsx)(m.Z,{size:"small",placeholder:"Filter",value:i,onChange:e=>r(e.target.value),icon:(0,a.jsx)(h.Z,{size:"tiny"})})})]}),!o&&(0,a.jsx)("div",{className:"w-[500px]",children:(0,a.jsx)(eF.Z,{icon:(0,a.jsx)(eI.Z,{className:"text-foreground-light",strokeWidth:2}),title:"You need additional permissions to update database replications"})})]})}),x&&(0,a.jsx)("div",{className:"mt-8",children:(0,a.jsx)(tu.Z,{})}),f&&(0,a.jsx)(N.Z,{error:g,subject:"Failed to retrieve tables"}),p&&(0===c.length?(0,a.jsx)(b.Z,{}):(0,a.jsx)("div",{children:(0,a.jsx)(y.Z,{head:[(0,a.jsx)(y.Z.th,{children:"Name"},"header-name"),(0,a.jsx)(y.Z.th,{children:"Schema"},"header-schema"),(0,a.jsx)(y.Z.th,{className:"hidden text-left lg:table-cell",children:"Description"},"header-desc"),(0,a.jsx)(y.Z.th,{},"header-all")],body:c.map((e,n)=>(0,a.jsx)(tq,{table:e,selectedPublication:t},e.id))})}))]})},tU=n(28879),tV=n.n(tU),tM=n(15941),tB=n(40068),tK=n(48577);async function tY(e){let{ref:t,backup:n}=e;if(n.isPhysicalBackup){let{data:e,error:a}=await (0,eu.v_)("/platform/database/{ref}/backups/restore-physical",{params:{path:{ref:t}},body:{id:n.id,recovery_time_target:n.inserted_at}});if(a)throw a;return e}let{data:a,error:s}=await (0,eu.v_)("/platform/database/{ref}/backups/restore",{params:{path:{ref:t}},body:{id:n.id}});if(s)throw s;return a}let tQ=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,ed.D)(e=>tY(e),{async onSuccess(t,n,a){await (null==e?void 0:e(t,n,a))},async onError(e,n,a){void 0===t?en.Am.error("Failed to restore from backup: ".concat(e.message)):t(e,n,a)},...n})};var tH=n(45105),tG=n(92378),tX=n(42760);async function t$(e){let{ref:t,backup:n}=e,{data:a,error:s}=await (0,eu.v_)("/platform/database/{ref}/backups/download",{params:{path:{ref:t}},body:{id:n.id,inserted_at:n.inserted_at,project_id:n.project_id,data:{},s3_bucket:"deprecated",s3_path:"deprecated",status:"deprecated"}});if(s)throw s;return a}let tJ=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,ed.D)(e=>t$(e),{async onSuccess(t,n,a){await (null==e?void 0:e(t,n,a))},async onError(e,n,a){void 0===t?en.Am.error("Failed to download backup: ".concat(e.message)):t(e,n,a)},...n})};var t0=e=>{let{index:t,isHealthy:n,backup:s,projectRef:i,onSelectBackup:r}=e,o=(0,_.Xo)(l.KA.INFRA_EXECUTE,"queue_job.restore.prepare"),{mutate:c,isLoading:d}=tJ({onSuccess:e=>{let{fileUrl:t}=e,n=document.createElement("a");n.href=t,document.body.appendChild(n),n.click(),document.body.removeChild(n)}});return(0,a.jsxs)("div",{className:"flex h-12 items-center justify-between px-6 ".concat(t?"border-t border-default":""),children:[(0,a.jsx)("p",{className:"text-sm text-foreground ",children:"COMPLETED"==s.status?"".concat(tV()(s.inserted_at).format("DD MMM YYYY HH:mm:ss")," UTC"):tV()(s.inserted_at).format("DD MMM YYYY")}),(0,a.jsx)("div",{children:"COMPLETED"===s.status?(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsx)(u.z,{type:"default",disabled:!n||!o,onClick:r,children:"Restore"}),!s.isPhysicalBackup&&(0,a.jsx)(u.z,{type:"default",disabled:!o||d,onClick:()=>c({ref:i,backup:s}),loading:d,icon:(0,a.jsx)(tX.Z,{}),children:"Download"})]}):(0,a.jsx)(H.C,{variant:"warning",children:"Backup In Progress..."})})]})},t1=n(41547),t2=()=>{var e,t;let n=(0,A.useRouter)(),s=(0,ec.NL)(),i=(0,_.lL)(),{project:r}=(0,P.d2)(),o=(null==r?void 0:r.ref)||"default",c=(null==r?void 0:r.status)===tR.S.ACTIVE_HEALTHY,[u,m]=(0,d.useState)(),h=(0,_.Xo)(l.KA.INFRA_EXECUTE,"queue_job.restore.prepare"),{data:x}=(0,tH.T)({projectRef:o}),{mutate:p,isLoading:f,isSuccess:g}=tQ({onSuccess:()=>{setTimeout(()=>{(0,tG.k7)(s,o,tR.S.RESTORING),en.ZP.success("Restoring database back to ".concat(tV()(null==u?void 0:u.inserted_at).format("DD MMM YYYY HH:mm:ss"))),n.push("/project/".concat(o))},3e3)}}),j=null!==(e=null==x?void 0:x.tierKey)&&void 0!==e?e:"",v=(null!==(t=null==x?void 0:x.backups)&&void 0!==t?t:[]).sort((e,t)=>new Date(t.inserted_at).valueOf()-new Date(e.inserted_at).valueOf()),b=null==x?void 0:x.pitr_enabled;return"FREE"===j?(0,a.jsx)(tK.Z,{icon:(0,a.jsx)(tM.Z,{size:"large"}),primaryText:"Free Plan does not include project backups.",projectRef:o,organizationSlug:i.slug,secondaryText:"Upgrade to the Pro plan for up to 7 days of scheduled backups.",addon:"pitr"}):b?null:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"space-y-6",children:0===v.length&&"FREE"!==j?(0,a.jsx)(t1.Z,{}):(0,a.jsxs)(a.Fragment,{children:[!h&&(0,a.jsx)(eF.Z,{icon:(0,a.jsx)(eI.Z,{className:"text-foreground-light",strokeWidth:2}),title:"You need additional permissions to trigger a scheduled backup"}),(0,a.jsx)(tB.Z,{children:null==v?void 0:v.map((e,t)=>(0,a.jsx)(t0,{backup:e,projectRef:o,index:t,isHealthy:c,onSelectBackup:()=>m(e)},e.id))})]})}),(0,a.jsx)(tL.Z,{size:"medium",confirmLabel:"Confirm restore",confirmLabelLoading:"Restoring",visible:void 0!==u,title:"Confirm to restore from backup",loading:f||g,onCancel:()=>m(void 0),onConfirm:()=>{if(void 0===u)return console.error("Backup required");p({ref:o,backup:u})},children:(0,a.jsxs)("p",{children:["Are you sure you want to restore from",tV()(null==u?void 0:u.inserted_at).format("DD MMM YYYY"),"? This will destroy any new data written since this backup was made."]})})]})},t4=n(87612),t3=n(93352),t5=n.n(t3),t8=n(34519),t6=n.n(t8),t9=n(26139),t7=n.n(t9),ne=n(67304),nt=n.n(ne),nn=n(80075),na=n(46776),ns=n(38183),nl=n(72978),ni=n(64039),nr=n(46916),no=n(83036),nc=function(e){return(0,a.jsx)(no.Z,{icon:nr.Z,...e})},nd=n(49017),nu=e=>{let{icon:t,text:n}=e;return(0,a.jsxs)("div",{className:"flex items-center justify-center flex-row py-4 space-x-2",children:[(0,a.jsx)("div",{className:"relative bg-surface-100 text-foreground-lighter w-6 h-6 rounded-full flex items-center justify-center",children:t}),(0,a.jsx)("p",{className:"text-foreground-light",children:n})]})},nm=n(4084),nh=n(87555),nx=n(63936),np=n(71436),nf=n(71970);async function ng(e){let{id:t,projectRef:n,connectionString:a,payload:s}=e,l=new Headers;a&&l.set("x-connection-encrypted",a);let i=await (0,np.r$)("".concat(tR.T5,"/pg-meta/").concat(n,"/triggers?id=").concat(t),s,{headers:Object.fromEntries(l)});if(i.error)throw i.error;return i}let nj=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,ec.NL)();return(0,ed.D)(e=>ng(e),{async onSuccess(t,n,s){let{projectRef:l}=n;await a.invalidateQueries(nf.D.list(l)),await (null==e?void 0:e(t,n,s))},async onError(e,n,a){void 0===t?en.Am.error("Failed to update database trigger: ".concat(e.message)):t(e,n,a)},...n})};var nv=n(86263),nb=n(16760),ny=n.n(nb),nN=n(84636),nw=n.n(nN),n_=n(56599),nC=n(37107),nS=n(25321),nk=e=>{let{triggerFunctions:t,visible:n,onChange:s,setVisible:l}=e,i=t.length>=1,r=ny()(nw()(t,"schema"),"schema");function o(e){s(e),l(!n)}return(0,a.jsx)(ea.ZP,{size:"large",header:"Pick a function",visible:n,onCancel:()=>l(!n),className:"hooks-sidepanel",children:(0,a.jsx)("div",{className:"py-6",children:i?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(nE,{}),r.map(e=>(0,a.jsx)(nT,{schema:e,functions:t.filter(t=>t.schema==e),selectFunction:o},e))]}):(0,a.jsx)(nZ,{})})})};let nE=()=>{let{ref:e}=(0,v.UO)();return(0,a.jsx)("div",{className:"px-6",children:(0,a.jsx)(eF.Z,{icon:(0,a.jsx)(ek.Z,{size:"large",strokeWidth:1.5}),title:"Only functions that return a trigger will be displayed below",description:"You can make functions by using the Database Functions",button:(0,a.jsx)(u.z,{asChild:!0,type:"default",children:(0,a.jsx)(c(),{href:"/project/".concat(e,"/database/functions"),children:"Go to Functions"})})})})},nZ=()=>{let e=(0,A.useRouter)(),{ref:t}=e.query;return(0,a.jsx)(nC.Z,{title:"No Trigger Functions found in database",ctaButtonLabel:"Create a trigger function",onClickCta:()=>{e.push("/project/".concat(t,"/database/functions"))},children:(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"You will need to create a trigger based function before you can add it to your trigger."})})},nT=e=>{let{schema:t,functions:n,selectFunction:s}=e;return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"sticky top-0 flex items-center space-x-1 px-6 backdrop-blur backdrop-filter",children:[(0,a.jsx)("h5",{className:"text-foreground-light",children:"schema"}),(0,a.jsx)("h5",{children:t})]}),(0,a.jsx)("div",{className:"space-y-0 divide-y border-t border-b border-default",children:n.map(e=>(0,a.jsx)(nR,{id:e.id,completeStatement:e.complete_statement,name:e.name,onClick:s},e.id))})]})},nR=e=>{let{id:t,completeStatement:n,name:s,onClick:l}=e,[i,r]=(0,d.useState)(!1);return(0,a.jsxs)("div",{className:"cursor-pointer rounded p-3 px-6 hover:bg-studio",onClick:()=>l(t),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between space-x-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"flex items-center justify-center rounded bg-foreground p-1 text-background",children:(0,a.jsx)(nd.Z,{strokeWidth:2,size:14})}),(0,a.jsx)("p",{className:"mb-0 text-sm",children:s})]}),(0,a.jsx)(u.z,{type:"text",onClick:e=>{e.stopPropagation(),r(!i)},icon:(0,a.jsx)(n_.Z,{className:i?"rotate-180 transform":"rotate-0 transform"}),children:i?"Hide definition":"View definition"})]}),(0,a.jsx)(nv.u,{show:i,enter:"transition ease-out duration-300",enterFrom:"transform opacity-0",enterTo:"transform opacity-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100",leaveTo:"transform opacity-0",children:(0,a.jsx)("div",{className:"mt-4 h-64 border border-default",children:(0,a.jsx)(nS.Z,{defaultValue:n,readOnly:!0,contextmenu:!1})})})]})};class nz{get requestBody(){return{id:this.id,activation:this.activation.value,enabled_mode:this.enabledMode.value,events:this.events.value,function_name:this.functionName.value,function_schema:this.functionSchema.value,orientation:this.orientation.value,name:this.name.value,schema:this.schema.value,table:this.table.value}}reset(e){var t,n,a,s,l,i,r,o,c,d;this.id=null==e?void 0:e.id,this.originalName=null==e?void 0:e.name,this.activation={value:null!==(t=null==e?void 0:e.activation)&&void 0!==t?t:"BEFORE"},this.enabledMode={value:null!==(n=null==e?void 0:e.enabled_mode)&&void 0!==n?n:"ORIGIN"},this.events={value:null!==(a=null==e?void 0:e.events)&&void 0!==a?a:[]},this.functionName={value:null!==(s=null==e?void 0:e.function_name)&&void 0!==s?s:""},this.functionSchema={value:null!==(l=null==e?void 0:e.function_schema)&&void 0!==l?l:""},this.orientation={value:null!==(i=null==e?void 0:e.orientation)&&void 0!==i?i:"STATEMENT"},this.name={value:null!==(r=null==e?void 0:e.name)&&void 0!==r?r:""},this.schema={value:null!==(o=null==e?void 0:e.schema)&&void 0!==o?o:""},this.table={value:null!==(c=null==e?void 0:e.table)&&void 0!==c?c:""},this.tableId={value:null!==(d=null==e?void 0:e.table_id)&&void 0!==d?d:""}}update(e){this.activation=e.activation,this.enabledMode=e.enabledMode,this.events=e.events,this.functionName=e.functionName,this.functionSchema=e.functionSchema,this.orientation=e.orientation,this.name=e.name,this.schema=e.schema,this.table=e.table,this.tableId=e.tableId}constructor(){(0,t4._)(this,"id",void 0),(0,t4._)(this,"originalName",void 0),(0,t4._)(this,"activation",void 0),(0,t4._)(this,"enabledMode",void 0),(0,t4._)(this,"events",void 0),(0,t4._)(this,"functionName",void 0),(0,t4._)(this,"functionSchema",void 0),(0,t4._)(this,"orientation",void 0),(0,t4._)(this,"name",void 0),(0,t4._)(this,"schema",void 0),(0,t4._)(this,"table",void 0),(0,t4._)(this,"tableId",void 0),(0,nn.ky)(this),this.reset()}}class nA{get isEditing(){return void 0!=this.formState.id}constructor(){(0,t4._)(this,"chooseFunctionFormVisible",!1),(0,t4._)(this,"formState",new nz),(0,t4._)(this,"meta",null),(0,t4._)(this,"tables",[]),(0,t4._)(this,"isDirty",!1),(0,t4._)(this,"setChooseFunctionFormVisible",e=>{this.chooseFunctionFormVisible=e}),(0,t4._)(this,"setDefaultSelectedTable",()=>{var e;(null===(e=this.tables)||void 0===e?void 0:e.length)!=0&&(this.formState.table.value=this.tables[0].name,this.formState.schema.value=this.tables[0].schema,this.formState.tableId.value=this.tables[0].id)}),(0,t4._)(this,"setisDirty",e=>{this.isDirty=e}),(0,t4._)(this,"setTables",e=>{this.tables=e.sort((e,t)=>e.schema.localeCompare(t.schema)).filter(e=>!S.F.includes(e.schema)),this.setDefaultSelectedTable()}),(0,t4._)(this,"onFormChange",e=>{let{key:t,value:n}=e;if(this.isDirty=!0,t5()(this.formState,t)){let e=this.formState[t];this.formState[t]={...e,value:n,error:void 0}}else this.formState[t]={value:n}}),(0,t4._)(this,"onSelectFunction",e=>{this.formState.functionName.value=e.name,this.formState.functionSchema.value=e.schema}),(0,t4._)(this,"validateForm",()=>{let e=!0,t=t6()(this.formState,(t,n)=>{switch(n){case"name":var a;if(eB()(t.value)||(a=t.value,/\s/.test(a)))return e=!1,{...t,error:"Invalid trigger name"};return t;case"activation":if(eB()(t.value))return e=!1,{...t,error:"you have an error"};return t;case"events":if(eB()(t.value))return e=!1,{...t,error:"Select at least 1 event"};return t;case"tableId":if(eB()("".concat(t.value)))return e=!1,{...t,error:"You must choose a table"};return t;default:return t}});return e||this.formState.update(t),e}),(0,nn.ky)(this)}}let nP=(0,d.createContext)(null);var nL=(0,na.Pi)(e=>{let{trigger:t,visible:n,setVisible:s}=e,{project:l}=(0,P.d2)(),[i,r]=(0,d.useState)(!1),o=(0,na.fv)(()=>new nA);(0,F.Bj)({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString},{onSuccess(e){o.tables.length<=0&&o.setTables(e)}});let{data:c}=(0,nh.R)({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString}),u=(null!=c?c:[]).filter(e=>"trigger"===e.return_type),{mutate:m,isLoading:h}=(0,nx.x)(),{mutate:x,isLoading:p}=nj();async function f(){if(!l)return console.error("Project is required");if(o.validateForm()){let e=o.formState.requestBody;o.isEditing&&e.id?x({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString,id:e.id,payload:e},{onSuccess:()=>{en.ZP.success("Successfully updated trigger ".concat(e.name)),s(!n)},onError:e=>{en.ZP.error("Failed to update trigger: ".concat(e.message))}}):m({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString,payload:e},{onSuccess:()=>{en.ZP.success("Successfully created trigger ".concat(e.name)),s(!n)},onError:e=>{en.ZP.error("Failed to create trigger: ".concat(e.message))}})}}(0,d.useEffect)(()=>{o.setisDirty(!1),t?o.formState.reset(t):(o.formState.reset(),o.setDefaultSelectedTable())},[n,t]);let g=o.tables.length>=1;return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(ea.ZP,{size:"large",visible:n,onCancel:()=>{o.isDirty?r(!0):s(!n)},header:o.formState.id?"Edit '".concat(o.formState.originalName,"' trigger"):"Add a new Trigger",hideFooter:!g,className:o.chooseFunctionFormVisible?"hooks-sidepanel mr-16 transform transition-all duration-300 ease-in-out":"hooks-sidepanel mr-0 transform transition-all duration-300 ease-in-out",loading:h||p,onConfirm:f,children:g?(0,a.jsxs)("div",{children:[(0,a.jsxs)(nP.Provider,{value:o,children:[(0,a.jsx)("div",{className:"my-6 space-y-10",children:o.isEditing?(0,a.jsxs)("div",{className:"space-y-6 px-6",children:[(0,a.jsx)(nI,{}),(0,a.jsx)(nD,{})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"px-6",children:(0,a.jsx)(nI,{})}),(0,a.jsx)(ea.ZP.Separator,{}),(0,a.jsxs)("div",{className:"space-y-12 px-6",children:[(0,a.jsx)("h5",{children:"Conditions to fire trigger"}),(0,a.jsx)(nO,{}),(0,a.jsx)(nq,{}),(0,a.jsx)(nW,{}),(0,a.jsx)(nF,{})]}),(0,a.jsx)(ea.ZP.Separator,{}),(0,a.jsx)(nU,{})]})}),(0,a.jsx)(nk,{triggerFunctions:u,visible:o.chooseFunctionFormVisible,setVisible:o.setChooseFunctionFormVisible,onChange:e=>{let t=(null!=c?c:[]).find(t=>t.id===e);t&&o.onSelectFunction(t)}})]}),(0,a.jsx)(tL.Z,{visible:i,title:"Discard changes",confirmLabel:"Discard",onCancel:()=>r(!1),onConfirm:()=>{r(!1),s(!n)},children:(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"There are unsaved changes. Are you sure you want to close the panel? Your changes will be lost."})})]}):(0,a.jsx)(nm.Z,{message:"You will need to create a table first before you can make a trigger"})})})});let nI=(0,na.Pi)(e=>{let{}=e,t=(0,d.useContext)(nP);return(0,a.jsx)(m.Z,{id:"name",label:"Name of trigger",layout:"horizontal",placeholder:"Name of trigger",value:t.formState.name.value,onChange:e=>t.onFormChange({key:"name",value:e.target.value}),size:"small",error:t.formState.name.error,descriptionText:"The name is also stored as the actual postgres name of the trigger. Do not use spaces/whitespace."})}),nD=(0,na.Pi)(e=>{let{}=e,t=(0,d.useContext)(nP);return(0,a.jsxs)(e8.Z,{id:"enabled-mode",label:"Enabled mode",layout:"horizontal",value:t.formState.enabledMode.value,onChange:e=>t.onFormChange({key:"enabledMode",value:e}),size:"small",descriptionText:"Determines if a trigger should or should not fire. Can also be used to disable a trigger, but not delete it.",children:[(0,a.jsxs)(e8.Z.Option,{addOnBefore:e=>{let{active:t,selected:n}=e;return(0,a.jsx)("div",{className:"h-3 w-3 rounded-full border border-green-700 bg-green-900 shadow-sm"})},value:"ORIGIN",label:"Origin",children:["Origin",(0,a.jsx)("span",{className:"block text-foreground-lighter",children:"This is a default behavior"})]}),(0,a.jsxs)(e8.Z.Option,{addOnBefore:e=>{let{active:t,selected:n}=e;return(0,a.jsx)("div",{className:"h-3 w-3 rounded-full border border-green-700 bg-green-900 shadow-sm"})},value:"REPLICA",label:"Replica",children:["Replica",(0,a.jsx)("span",{className:"block text-foreground-lighter",children:"Will only fire if the session is in replica mode"})]}),(0,a.jsxs)(e8.Z.Option,{addOnBefore:e=>{let{active:t,selected:n}=e;return(0,a.jsx)("div",{className:"h-3 w-3 rounded-full border border-green-700 bg-green-900 shadow-sm"})},value:"ALWAYS",label:"Always",children:["Always",(0,a.jsx)("span",{className:"block text-foreground-lighter",children:"Will fire regardless of the current replication role"})]}),(0,a.jsxs)(e8.Z.Option,{addOnBefore:e=>{let{active:t,selected:n}=e;return(0,a.jsx)("div",{className:"h-3 w-3 rounded-full border border-red-700 bg-red-900 shadow-sm"})},value:"DISABLED",label:"Disabled",children:["Disabled",(0,a.jsx)("span",{className:"block text-foreground-lighter",children:"Will not fire"})]})]})}),nF=(0,na.Pi)(e=>{let{}=e,t=(0,d.useContext)(nP);return(0,a.jsxs)(e8.Z,{id:"orientation",label:"Orientation",layout:"horizontal",value:t.formState.orientation.value,onChange:e=>t.onFormChange({key:"orientation",value:e}),size:"small",descriptionText:"Identifies whether the trigger fires once for each processed row or once for each statement",children:[(0,a.jsxs)(e8.Z.Option,{value:"ROW",label:"Row",children:["Row",(0,a.jsx)("span",{className:"block text-foreground-lighter",children:"fires once for each processed row"})]}),(0,a.jsxs)(e8.Z.Option,{value:"STATEMENT",label:"Statement",children:["Statement",(0,a.jsx)("span",{className:"block text-foreground-lighter",children:"fires once for each statement"})]})]})}),nO=(0,na.Pi)(e=>{let{}=e,t=(0,d.useContext)(nP);return(0,a.jsx)(e8.Z,{id:"table",label:"Table",layout:"horizontal",value:t.formState.tableId.value,onChange:e=>{let n=t.tables.find(t=>t.id===e);n&&(t.onFormChange({key:"table",value:n.name}),t.onFormChange({key:"schema",value:n.schema}),t.onFormChange({key:"tableId",value:e}))},size:"small",error:t.formState.tableId.error,descriptionText:"This is the table the trigger will watch for changes. You can only select 1 table for a trigger.",children:t.tables.map(e=>(0,a.jsx)(e8.Z.Option,{id:e.id,value:e.id,label:e.name,addOnBefore:()=>(0,a.jsx)("div",{className:"flex items-center justify-center rounded bg-foreground p-1 text-background",children:(0,a.jsx)(ns.Z,{src:"".concat(tR.GW,"/img/table-editor.svg"),style:{width:"16px",height:"16px",strokeWidth:"1px"},preProcessor:e=>e.replace(/svg/,'svg class="m-auto text-color-inherit"')})}),children:(0,a.jsxs)("div",{className:"flex flex-row items-center space-x-1",children:[(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:e.schema}),(0,a.jsx)("p",{className:"text-foreground",children:e.name})]})},e.id))})}),nq=(0,na.Pi)(e=>{let{}=e,t=(0,d.useContext)(nP);return(0,a.jsxs)(nl.Z.Group,{name:"events",label:"Events",id:"events",labelOptional:"The type of events that will trigger your trigger",layout:"horizontal",descriptionText:"These are the events that are watched by the trigger, only the events selected above will fire the trigger on the table you've selected.",size:"small",onChange:e=>{let n=t.formState.events.value,a=e.target.checked?t7()(n,[e.target.value]):nt()(n,e.target.value);t.onFormChange({key:"events",value:a})},error:t.formState.events.error,children:[(0,a.jsx)(nl.Z,{value:"INSERT",label:"Insert",description:"Any insert operation on the table",checked:t.formState.events.value.includes("INSERT")}),(0,a.jsx)(nl.Z,{value:"UPDATE",label:"Update",description:"Any update operation, of any column in the table",checked:t.formState.events.value.includes("UPDATE")}),(0,a.jsx)(nl.Z,{value:"DELETE",label:"Delete",description:"Any deletion of a record",checked:t.formState.events.value.includes("DELETE")})]})}),nW=(0,na.Pi)(e=>{let{}=e,t=(0,d.useContext)(nP);return(0,a.jsxs)(e8.Z,{id:"activation",label:"Trigger type",descriptionText:"This determines when your Hook fires",onChange:e=>{t.onFormChange({key:"activation",value:e})},value:t.formState.activation.value,layout:"horizontal",size:"small",error:t.formState.activation.error,children:[(0,a.jsx)(e8.Z.Option,{id:"before",value:"BEFORE",label:"Before the event",addOnBefore:()=>(0,a.jsx)("div",{className:"flex items-center justify-center rounded bg-foreground p-1 text-background",children:(0,a.jsx)(ni.Z,{strokeWidth:2,size:"small"})}),children:(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{children:"before"}),(0,a.jsx)("span",{className:"block text-foreground-lighter",children:"Trigger fires before the operation is attempted"})]})}),(0,a.jsx)(e8.Z.Option,{id:"after",value:"AFTER",label:"After the event",addOnBefore:()=>(0,a.jsx)("div",{className:"flex items-center justify-center rounded bg-green-1200 p-1 text-background",children:(0,a.jsx)(nc,{strokeWidth:2,size:"small"})}),children:(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{children:"after"}),(0,a.jsx)("span",{className:"block text-foreground-lighter",children:"Trigger fires after the operation has completed"})]})})]})}),nU=(0,na.Pi)(e=>{let{}=e,t=(0,d.useContext)(nP);return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"space-y-6 px-6",children:(0,a.jsx)("h5",{children:"Function to trigger"})}),(0,a.jsx)("div",{className:"px-6",children:eB()(t.formState.functionName.value)?(0,a.jsx)(nV,{}):(0,a.jsx)(nM,{})})]})}),nV=(0,na.Pi)(e=>{let{}=e,t=(0,d.useContext)(nP);return(0,a.jsx)("button",{type:"button",onClick:()=>t.setChooseFunctionFormVisible(!0),className:"relative w-full rounded border border-default bg-surface-200 px-5 py-1 shadow-sm transition-all hover:border-strong hover:bg-overlay-hover",children:(0,a.jsx)(nu,{icon:(0,a.jsx)(nd.Z,{size:14,strokeWidth:2}),text:"Choose a function to trigger"})})}),nM=(0,na.Pi)(e=>{let{}=e,t=(0,d.useContext)(nP);return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"relative w-full flex items-center justify-between space-x-3 px-5 py-4 border border-default rounded shadow-sm transition-shadow",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"flex h-6 w-6 items-center justify-center rounded bg-foreground text-background focus-within:bg-opacity-10",children:(0,a.jsx)(nd.Z,{size:"small",strokeWidth:2,width:14})}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("p",{className:"text-foreground-light",children:t.formState.functionName.value}),(0,a.jsx)("div",{children:(0,a.jsx)(H.C,{children:t.formState.functionSchema.value})})]})]}),(0,a.jsx)(u.z,{type:"default",onClick:()=>t.setChooseFunctionFormVisible(!0),children:"Change function"})]})})});var nB=n(58905),nK=n(77889),nY=e=>{let{trigger:t,visible:n,setVisible:s}=e,{project:l}=(0,P.d2)(),{id:i,name:r,schema:o}=null!=t?t:{},{mutate:c,isLoading:d}=(0,nK.m)();async function u(){return l?i?void c({projectRef:l.ref,connectionString:l.connectionString,id:i},{onSuccess:()=>{en.ZP.success("Successfully removed ".concat(r)),s(!1)}}):console.error("Trigger ID is required"):console.error("Project is required")}return(0,a.jsx)(nB.Z,{variant:"warning",visible:n,onCancel:()=>s(!n),onConfirm:u,title:"Delete this trigger",loading:d,confirmLabel:"Delete trigger ".concat(r),confirmPlaceholder:"Type in name of trigger",confirmString:r,text:(0,a.jsxs)(a.Fragment,{children:["This will delete your trigger called"," ",(0,a.jsx)("span",{className:"text-bold text-foreground",children:r})," of schema"," ",(0,a.jsx)("span",{className:"text-bold text-foreground",children:o})]}),alert:{title:"You cannot recover this trigger once deleted."}})},nQ=n(87622),nH=n.n(nQ),nG=n(54373),nX=n(84904),n$=n(93221);async function nJ(e){let{projectRef:t,connectionString:n,payload:a}=e,s=new Headers;n&&s.set("x-connection-encrypted",n);let{data:l,error:i}=await (0,eu.v_)("/platform/pg-meta/{ref}/functions",{params:{path:{ref:t}},body:a,headers:s});if(i)throw i;return l}let n0=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,ec.NL)();return(0,ed.D)(e=>nJ(e),{async onSuccess(t,n,s){let{projectRef:l}=n;await a.invalidateQueries(n$.l.list(l)),await (null==e?void 0:e(t,n,s))},async onError(e,n,a){void 0===t?en.Am.error("Failed to create database function: ".concat(e.message)):t(e,n,a)},...n})};async function n1(e){let{projectRef:t,connectionString:n,id:a,payload:s}=e,l=new Headers;n&&l.set("x-connection-encrypted",n);let{data:i,error:r}=await (0,eu.r$)("/platform/pg-meta/{ref}/functions",{params:{header:{"x-connection-encrypted":n},path:{ref:t},query:{id:a}},body:s,headers:l});if(r)throw r;return i}let n2=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,ec.NL)();return(0,ed.D)(e=>n1(e),{async onSuccess(t,n,s){let{projectRef:l}=n;await a.invalidateQueries(n$.l.list(l)),await (null==e?void 0:e(t,n,s))},async onError(e,n,a){void 0===t?en.Am.error("Failed to update database function: ".concat(e.message)):t(e,n,a)},...n})};var n4=n(66243),n3=n(25463),n5=n(4260),n8=n(80203),n6=n(11158),n9=n(48378),n7=n(96475);let ae=e=>{let{selectedFunction:t,assistantVisible:n,setAssistantVisible:s}=e;return(0,a.jsx)(n4.Tu,{className:(0,eR.cn)(void 0!==t?"pt-3 pb-0":"py-3","flex flex-row justify-between items-center border-b-0"),children:(0,a.jsxs)("div",{className:"flex flex-row gap-3 items-center max-w-[75%]",children:[(0,a.jsxs)(n4.sw,{className:(0,eR.cn)("text-muted hover:text ring-offset-background transition-opacity hover:opacity-100","focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2","disabled:pointer-events-none data-[state=open]:bg-secondary","transition"),children:[(0,a.jsx)(Y.Z,{className:"h-3 w-3"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]}),(0,a.jsx)(n4.bC,{className:"truncate",children:void 0!==t?"Edit '".concat(t,"' function"):"Add a new function"})]})})};var at=n(12494),an=n(46934),aa=n(40414);let as=e=>{let{field:t,focused:n,setFocused:s}=e;return(0,a.jsxs)("div",{className:(0,eR.cn)("rounded-md relative group flex-grow"),children:[(0,a.jsx)(es.NI,{children:(0,a.jsx)(nS.Z,{defaultValue:t.value,onInputChange:e=>{t.onChange(e)},contextmenu:!1})}),(0,a.jsx)("div",{className:(0,eR.cn)("absolute top-0 right-2 bg-surface-300 border border-strong rounded h-[28px]","opacity-0 group-hover:opacity-100 group-hover:top-2 transition-all"),children:(0,a.jsxs)(aa.u,{children:[(0,a.jsx)(aa.aJ,{asChild:!0,children:(0,a.jsx)(u.z,{type:"text",size:"tiny",className:(0,eR.cn)("px-2 text-foreground-lighter hover:text-foreground","transition z-50"),onClick:()=>s(!n),icon:n?(0,a.jsx)(at.Z,{}):(0,a.jsx)(an.Z,{})})}),(0,a.jsx)(aa._v,{side:"bottom",children:n?"Minimize editor":"Maximize editor"})]})})]})},al="create-function-sidepanel",ai=er.ZP.object({name:er.ZP.string().trim().min(1),schema:er.ZP.string().trim().min(1),args:er.ZP.array(er.ZP.object({name:er.ZP.string().trim().min(1),type:er.ZP.string().trim()})),behavior:er.ZP.enum(["IMMUTABLE","STABLE","VOLATILE"]),definition:er.ZP.string().trim(),language:er.ZP.string().trim(),return_type:er.ZP.string().trim(),security_definer:er.ZP.boolean(),config_params:er.ZP.array(er.ZP.object({name:er.ZP.string().trim().min(1),value:er.ZP.string().trim().min(1)})).optional()});var ar=e=>{let{func:t,visible:n,setVisible:s}=e,{project:l}=(0,P.d2)(),[i,r]=(0,d.useState)(!1),[o,c]=(0,d.useState)(!1),[m,h]=(0,d.useState)(!1),[x,p]=(0,d.useState)(!1),f=!!(null==t?void 0:t.id),g=(0,et.cI)({resolver:(0,ee.F)(ai)}),{mutate:j,isLoading:v}=n0(),{mutate:b,isLoading:y}=n2();function N(){g.formState.isDirty?r(!0):s(!n)}let w=async e=>{if(!l)return console.error("Project is required");let a={...e,args:e.args.map(e=>"".concat(e.name," ").concat(e.type)),config_params:t6()(nH()(e.config_params,"name"),"value")};f?b({id:t.id,projectRef:l.ref,connectionString:l.connectionString,payload:a},{onSuccess:()=>{en.ZP.success("Successfully updated function ".concat(e.name)),s(!n)}}):j({projectRef:l.ref,connectionString:l.connectionString,payload:a},{onSuccess:()=>{en.ZP.success("Successfully created function ".concat(e.name)),s(!n)}})};return(0,d.useEffect)(()=>{if(n){var e,a,s,l,i,r,o;g.reset({name:null!==(e=null==t?void 0:t.name)&&void 0!==e?e:"",schema:null!==(a=null==t?void 0:t.schema)&&void 0!==a?a:"public",args:(0,n7.cK)((null==t?void 0:t.argument_types)||"").value,behavior:null!==(s=null==t?void 0:t.behavior)&&void 0!==s?s:"VOLATILE",definition:null!==(l=null==t?void 0:t.definition)&&void 0!==l?l:"",language:null!==(i=null==t?void 0:t.language)&&void 0!==i?i:"plpgsql",return_type:null!==(r=null==t?void 0:t.return_type)&&void 0!==r?r:"void",security_definer:null!==(o=null==t?void 0:t.security_definer)&&void 0!==o&&o,config_params:(0,n7.QI)(null==t?void 0:t.config_params).value})}},[n,t]),(0,a.jsx)(n4.yo,{open:n,onOpenChange:()=>N(),children:(0,a.jsxs)(n4.ue,{showClose:!1,size:m?"lg":"default",className:(0,eR.cn)("p-0 flex flex-row gap-0",m?"!min-w-[1200px]":"!min-w-[600px]"),children:[(0,a.jsxs)("div",{className:(0,eR.cn)("flex flex-col grow w-full",m&&"w-[60%]"),children:[(0,a.jsx)(ae,{selectedFunction:null==t?void 0:t.name,assistantVisible:m,setAssistantVisible:h}),(0,a.jsx)(n3.Z,{}),(0,a.jsx)(es.l0,{...g,children:(0,a.jsxs)("form",{id:al,className:"flex-grow overflow-auto",onSubmit:g.handleSubmit(w),children:[(0,a.jsx)(n4.DN,{className:x?"hidden":"",children:(0,a.jsx)(es.Wi,{control:g.control,name:"name",render:e=>{let{field:t}=e;return(0,a.jsx)(n9.E,{label:"Name of function",description:"Name will also be used for the function name in postgres",layout:"horizontal",children:(0,a.jsx)(es.NI,{children:(0,a.jsx)(el.I,{...t})})})}})}),(0,a.jsx)(n3.Z,{className:x?"hidden":""}),(0,a.jsxs)(n4.DN,{className:x?"hidden":"space-y-4",children:[(0,a.jsx)(es.Wi,{control:g.control,name:"schema",render:e=>{let{field:t}=e;return(0,a.jsx)(n9.E,{label:"Schema",description:"Tables made in the table editor will be in 'public'",layout:"horizontal",children:(0,a.jsx)(es.NI,{children:(0,a.jsx)(L.Z,{selectedSchemaName:t.value,excludedSchemas:S.F,size:"small",onSelectSchema:e=>t.onChange(e)})})})}}),!f&&(0,a.jsx)(es.Wi,{control:g.control,name:"return_type",render:e=>{let{field:t}=e;return(0,a.jsx)(n9.E,{label:"Return type",layout:"horizontal",children:(0,a.jsxs)(n5.Ph,{onValueChange:t.onChange,defaultValue:t.value,children:[(0,a.jsx)(n5.i4,{className:"col-span-8",children:(0,a.jsx)(n5.ki,{})}),(0,a.jsx)(n5.Bw,{children:(0,a.jsx)(n8.x,{className:"h-52",children:["void","record","trigger","integer",...nX.DL].map(e=>(0,a.jsx)(n5.Ql,{value:e,children:e},e))})})]})})}})]}),(0,a.jsx)(n3.Z,{className:x?"hidden":""}),(0,a.jsx)(n4.DN,{className:x?"hidden":"",children:(0,a.jsx)(ao,{readonly:f})}),(0,a.jsx)(n3.Z,{className:x?"hidden":""}),(0,a.jsx)(n4.DN,{className:"".concat(x?"h-full":""," !px-0"),children:(0,a.jsx)(es.Wi,{control:g.control,name:"definition",render:e=>{let{field:t}=e;return(0,a.jsxs)(es.xJ,{className:"space-y-4 flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"px-content",children:[(0,a.jsx)(es.lX,{className:"text-base text-foreground",children:"Definition"}),(0,a.jsxs)(es.pf,{className:"text-sm text-foreground-light",children:[(0,a.jsx)("p",{children:"The language below should be written in `plpgsql`."}),!f&&(0,a.jsx)("p",{children:"Change the language in the Advanced Settings below."})]})]}),(0,a.jsx)("div",{className:(0,eR.cn)("border border-default flex",x?"flex-grow ":"h-72"),children:(0,a.jsx)(as,{field:t,focused:x,setFocused:p})}),(0,a.jsx)(es.zG,{})]})}})}),(0,a.jsx)(n3.Z,{className:x?"hidden":""}),f?(0,a.jsx)(a.Fragment,{}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n4.DN,{className:x?"hidden":"",children:(0,a.jsx)("div",{className:"space-y-8 rounded bg-studio py-4 px-6 border border-overlay",children:(0,a.jsx)(eS.Z,{onChange:()=>c(!o),label:"Show advanced settings",checked:o,labelOptional:"These are settings that might be familiar for Postgres developers"})})}),o&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n4.DN,{className:x?"hidden":"space-y-2 pt-0",children:[(0,a.jsx)(ad,{}),(0,a.jsx)(es.Wi,{control:g.control,name:"behavior",render:e=>{let{field:t}=e;return(0,a.jsx)(n9.E,{label:"Behavior",layout:"horizontal",children:(0,a.jsxs)(n5.Ph,{defaultValue:t.value,onValueChange:t.onChange,children:[(0,a.jsx)(n5.i4,{className:"col-span-8",children:(0,a.jsx)(n5.ki,{})}),(0,a.jsxs)(n5.Bw,{children:[(0,a.jsx)(n5.Ql,{value:"IMMUTABLE",children:"immutable"},"IMMUTABLE"),(0,a.jsx)(n5.Ql,{value:"STABLE",children:"stable"},"STABLE"),(0,a.jsx)(n5.Ql,{value:"VOLATILE",children:"volatile"},"VOLATILE")]})]})})}})]}),(0,a.jsx)(n3.Z,{className:x?"hidden":""}),(0,a.jsx)(n4.DN,{className:x?"hidden":"",children:(0,a.jsx)(ac,{readonly:f})}),(0,a.jsx)(n3.Z,{className:x?"hidden":""}),(0,a.jsxs)(n4.DN,{className:x?"hidden":"",children:[(0,a.jsx)("h5",{className:"text-base text-foreground mb-4",children:"Type of Security"}),(0,a.jsx)(es.Wi,{control:g.control,name:"security_definer",render:e=>{let{field:t}=e;return(0,a.jsxs)(es.xJ,{children:[(0,a.jsx)(es.NI,{className:"col-span-8",children:(0,a.jsxs)(n6.Z.Group,{type:"cards",layout:"vertical",onChange:e=>t.onChange("SECURITY_DEFINER"==e.target.value),value:t.value?"SECURITY_DEFINER":"SECURITY_INVOKER",children:[(0,a.jsx)(n6.Z,{id:"SECURITY_INVOKER",label:"SECURITY INVOKER",value:"SECURITY_INVOKER",checked:!t.value,description:(0,a.jsxs)(a.Fragment,{children:["Function is to be executed with the privileges of the user that ",(0,a.jsx)("span",{className:"text-foreground",children:"calls it"}),"."]})}),(0,a.jsx)(n6.Z,{id:"SECURITY_DEFINER",label:"SECURITY DEFINER",value:"SECURITY_DEFINER",checked:t.value,description:(0,a.jsxs)(a.Fragment,{children:["Function is to be executed with the privileges of the user that ",(0,a.jsx)("span",{className:"text-foreground",children:"created it"}),"."]})})]})}),(0,a.jsx)(es.zG,{})]})}})]})]})]})]})}),(0,a.jsxs)(n4.FF,{children:[(0,a.jsx)(u.z,{disabled:v||y,type:"default",onClick:N,children:"Cancel"}),(0,a.jsx)(u.z,{form:al,htmlType:"submit",disabled:v||y,loading:v||y,children:"Confirm"})]})]}),m?(0,a.jsx)("div",{className:"border-l shadow-[rgba(0,0,0,0.13)_-4px_0px_6px_0px] z-10 w-[50%] bg-studio"}):null,(0,a.jsx)(tL.Z,{visible:i,title:"Discard changes",confirmLabel:"Discard",onCancel:()=>r(!1),onConfirm:()=>{r(!1),s(!n)},children:(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"There are unsaved changes. Are you sure you want to close the panel? Your changes will be lost."})})]})})};let ao=e=>{let{readonly:t}=e,{fields:n,append:s,remove:l}=(0,et.Dq)({name:"args"});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("h5",{className:"text-base text-foreground",children:"Arguments"}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Arguments can be referenced in the function body using either names or numbers."})]}),(0,a.jsxs)("div",{className:"space-y-2 pt-4",children:[t&&eB()(n)&&(0,a.jsx)("span",{className:"text-foreground-lighter",children:"No argument for this function"}),n.map((e,n)=>(0,a.jsxs)("div",{className:"flex flex-row space-x-1",children:[(0,a.jsx)(es.Wi,{name:"args.".concat(n,".name"),render:e=>{let{field:n}=e;return(0,a.jsxs)(es.xJ,{className:"flex-1",children:[(0,a.jsx)(es.NI,{children:(0,a.jsx)(el.I,{...n,disabled:t,placeholder:"argument_name"})}),(0,a.jsx)(es.zG,{})]})}}),(0,a.jsx)(es.Wi,{name:"args.".concat(n,".type"),render:e=>{let{field:n}=e;return(0,a.jsxs)(es.xJ,{className:"flex-1",children:[(0,a.jsx)(es.NI,{children:t?(0,a.jsx)(el.I,{value:n.value,disabled:!0,readOnly:!0,className:"h-auto"}):(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(n5.Ph,{disabled:t,onValueChange:n.onChange,defaultValue:n.value,children:[(0,a.jsx)(n5.i4,{className:"h-[38px]",children:(0,a.jsx)(n5.ki,{})}),(0,a.jsx)(n5.Bw,{children:(0,a.jsx)(n8.x,{className:"h-52",children:["integer",...nX.DL].map(e=>(0,a.jsx)(n5.Ql,{value:e,children:e},e))})})]})})}),(0,a.jsx)(es.zG,{})]})}}),!t&&(0,a.jsx)(u.z,{type:"danger",icon:(0,a.jsx)(nG.Z,{size:12}),onClick:()=>l(n),className:"h-[38px] w-[38px]"})]},e.id)),!t&&(0,a.jsx)(u.z,{type:"default",icon:(0,a.jsx)(Q.Z,{size:12}),onClick:()=>s({name:"",type:"integer"}),disabled:t,children:"Add a new argument"})]})]})},ac=e=>{let{readonly:t}=e,{fields:n,append:s,remove:l}=(0,et.Dq)({name:"config_params"});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h5",{className:"text-base text-foreground",children:"Configuration Parameters"}),(0,a.jsxs)("div",{className:"space-y-2 pt-4",children:[t&&eB()(n)&&(0,a.jsx)("span",{className:"text-foreground-lighter",children:"No argument for this function"}),n.map((e,n)=>(0,a.jsxs)("div",{className:"flex flex-row space-x-1",children:[(0,a.jsx)(es.Wi,{name:"config_params.".concat(n,".name"),render:e=>{let{field:t}=e;return(0,a.jsxs)(es.xJ,{className:"flex-1",children:[(0,a.jsx)(es.NI,{children:(0,a.jsx)(el.I,{...t,placeholder:"parameter_name"})}),(0,a.jsx)(es.zG,{})]})}}),(0,a.jsx)(es.Wi,{name:"config_params.".concat(n,".value"),render:e=>{let{field:t}=e;return(0,a.jsxs)(es.xJ,{className:"flex-1",children:[(0,a.jsx)(es.NI,{children:(0,a.jsx)(el.I,{...t,placeholder:"parameter_value"})}),(0,a.jsx)(es.zG,{})]})}}),!t&&(0,a.jsx)(u.z,{type:"danger",icon:(0,a.jsx)(nG.Z,{size:12}),onClick:()=>l(n),className:"h-[38px] w-[38px]"})]},e.id)),!t&&(0,a.jsx)(u.z,{type:"default",icon:(0,a.jsx)(Q.Z,{size:12}),onClick:()=>s({name:"",type:""}),disabled:t,children:"Add a new config"})]})]})},ad=()=>{let{project:e}=(0,P.d2)(),{data:t}=(0,eO.H)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),[n]=R()(null!=t?t:[],e=>!eL()(e.installed_version));return(0,a.jsx)(es.Wi,{name:"language",render:e=>{let{field:t}=e;return(0,a.jsx)(n9.E,{label:"Language",layout:"horizontal",children:(0,a.jsxs)(n5.Ph,{onValueChange:t.onChange,defaultValue:t.value,children:[(0,a.jsx)(n5.i4,{className:"col-span-8",children:(0,a.jsx)(n5.ki,{})}),(0,a.jsx)(n5.Bw,{children:n.filter(e=>e.name.startsWith("pl")).map(e=>(0,a.jsx)(n5.Ql,{value:e.name,children:e.name},e.name))})]})})}})};async function au(e){let{projectRef:t,connectionString:n,id:a}=e,s=new Headers;n&&s.set("x-connection-encrypted",n);let{data:l,error:i}=await (0,eu.IV)("/platform/pg-meta/{ref}/functions",{params:{header:{"x-connection-encrypted":n},path:{ref:t},query:{id:a}},headers:s});if(i)throw i;return l}let am=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,ec.NL)();return(0,ed.D)(e=>au(e),{async onSuccess(t,n,s){let{projectRef:l}=n;await a.invalidateQueries(n$.l.list(l)),await (null==e?void 0:e(t,n,s))},async onError(e,n,a){void 0===t?en.Am.error("Failed to delete database function: ".concat(e.message)):t(e,n,a)},...n})};var ah=e=>{let{func:t,visible:n,setVisible:s}=e,{project:l}=(0,P.d2)(),{id:i,name:r,schema:o}=null!=t?t:{},{mutate:c,isLoading:d}=am({onSuccess:()=>{en.ZP.success("Successfully removed function ".concat(r)),s(!1)}});async function u(){return i?l?void c({id:i,projectRef:l.ref,connectionString:l.connectionString}):console.error("Project is required"):console.error("Function ID is require")}return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(nB.Z,{variant:"warning",visible:n,onCancel:()=>s(!n),onConfirm:u,title:"Delete this function",loading:d,confirmLabel:"Delete function ".concat(r),confirmPlaceholder:"Type in name of function",confirmString:r,text:(0,a.jsxs)(a.Fragment,{children:["This will delete the function",(0,a.jsx)("span",{className:"text-bold text-foreground",children:r})," from the schema",(0,a.jsx)("span",{className:"text-bold text-foreground",children:o})]}),alert:{title:"You cannot recover this function once deleted."}})})},ax=n(6931),ap=n(40023),af=n(72860),ag=n(7340);async function aj(e){let{projectRef:t,connectionString:n,schema:a,name:s,description:l,values:i}=e,r='create type "'.concat(a,'"."').concat(s,'" as enum (').concat(i.map(e=>"'".concat(e,"'")).join(", "),");"),o=void 0!==l?'comment on type "'.concat(a,'"."').concat(s,"\" is '").concat(l,"';"):"",c=eH("".concat(r," ").concat(o)),{result:d}=await (0,eY.Rj)({projectRef:t,connectionString:n,sql:c});return d}let av=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,ec.NL)();return(0,ed.D)(e=>aj(e),{async onSuccess(t,n,s){let{projectRef:l}=n;await a.invalidateQueries(ag.P.list(l)),await (null==e?void 0:e(t,n,s))},async onError(e,n,a){void 0===t?en.ZP.error("Failed to create enumerated type: ".concat(e.message)):t(e,n,a)},...n})};var ab=n(76670),ay=e=>{let{index:t,id:n,field:s,isDisabled:l=!1,onRemoveValue:i}=e;return(0,a.jsx)(ap._l,{draggableId:n,index:t,isDragDisabled:l,children:e=>(0,a.jsxs)("div",{ref:e.innerRef,...e.draggableProps,className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{...e.dragHandleProps,className:"opacity-50 hover:opacity-100 transition ".concat(l?"text-foreground-lighter !cursor-default":"text-foreground"),children:(0,a.jsx)(ab.Z,{size:16,strokeWidth:1.5})}),(0,a.jsx)(el.I,{...s,className:"w-full"}),(0,a.jsx)(u.z,{type:"default",size:"small",disabled:l,icon:(0,a.jsx)(j.Z,{strokeWidth:1.5,size:16}),className:"px-2",onClick:()=>i()})]})})};let aN=[...nX.ji,...nX.BB,...nX.YF,...nX.Ks,...nX.XO,...nX.lb,...nX.vH,"bigint","bigserial","bit","bit varying","boolean","box","bytea","char","character","character varying","cidr","circle","date","double precision","inet","int","integer","interval","line","lseg","macaddr","macaddr8","money","numeric","decimal","path","pg_lsn","pg_snapshot","point","polygon","real","smallint","smallserial","serial","time with timezone","timestamp with timezone","tsquery","tsvector","txid_snapshot","xml"];var aw=e=>{let{visible:t,onClose:n,schema:s}=e,l={name:"",description:"",values:[{value:""}]},i=(0,d.useRef)(null),{project:r}=(0,P.d2)(),{mutate:o,isLoading:m}=av({onSuccess:(e,t)=>{en.ZP.success('Successfully created type "'.concat(t.name,'"')),y()}}),h=er.Ry({name:er.Z_().min(1,"Please provide a name for your enumerated type").refine(e=>!aN.includes(e),{message:"Name cannot be a native Postgres data type"}).default(""),description:er.Z_().default("").optional(),values:er.Ry({value:er.Z_().min(1,"Please provide a value")}).array().default([])}),p=(0,et.cI)({resolver:(0,ee.F)(h),defaultValues:l}),{fields:f,append:g,remove:j,move:v}=(0,et.Dq)({name:"values",control:p.control}),b=e=>{e.destination&&v(e.source.index,e.destination.index)},y=()=>{p.reset(l),n()};return(0,a.jsx)(ea.ZP,{loading:m,visible:t,onCancel:y,header:"Create a new enumerated type",confirmText:"Create type",onConfirm:()=>{i.current&&i.current.click()},children:(0,a.jsx)(ea.ZP.Content,{className:"py-4",children:(0,a.jsx)(es.l0,{...p,children:(0,a.jsxs)("form",{className:"space-y-4",onSubmit:p.handleSubmit(e=>{var t;return(null==r?void 0:r.ref)===void 0?console.error("Project ref required"):(null==r?void 0:r.connectionString)===void 0?console.error("Project connectionString required"):void o({projectRef:r.ref,connectionString:r.connectionString,schema:s,name:e.name,description:null===(t=e.description)||void 0===t?void 0:t.replaceAll("'","''"),values:e.values.filter(e=>e.value.length>0).map(e=>e.value.trim())})}),children:[(0,a.jsx)(es.Wi,{control:p.control,name:"name",render:e=>{let{field:t}=e;return(0,a.jsxs)(es.xJ,{children:[(0,a.jsx)(es.lX,{children:"Name"}),(0,a.jsx)(es.NI,{children:(0,a.jsx)(el.I,{...t})}),(0,a.jsx)(es.zG,{})]})}}),(0,a.jsx)(es.Wi,{control:p.control,name:"description",render:e=>{let{field:t}=e;return(0,a.jsxs)(es.xJ,{children:[(0,a.jsx)(es.lX,{children:"Description"}),(0,a.jsx)(es.NI,{children:(0,a.jsx)(el.I,{...t})}),(0,a.jsx)(es.pf,{children:"Optional"})]})}}),(0,a.jsx)(ap.Z5,{onDragEnd:e=>b(e),children:(0,a.jsx)(ap.bK,{droppableId:"enum_type_values_droppable",children:e=>(0,a.jsxs)("div",{ref:e.innerRef,children:[f.map((e,t)=>(0,a.jsx)(es.Wi,{control:p.control,name:"values.".concat(t,".value"),render:n=>{let{field:s}=n;return(0,a.jsxs)(es.xJ,{children:[(0,a.jsx)(es.lX,{className:(0,eR.cn)(0!==t&&"sr-only"),children:"Values"}),0===t&&(0,a.jsxs)(af.bZ,{children:[(0,a.jsx)(eI.Z,{strokeWidth:1.5}),(0,a.jsx)(af.Cd,{children:"After creation, values cannot be deleted or sorted"}),(0,a.jsxs)(af.X,{children:[(0,a.jsx)("p",{className:"!leading-normal track",children:"You will need to delete and recreate the enumerated type with the updated values instead."}),(0,a.jsx)(u.z,{asChild:!0,type:"default",icon:(0,a.jsx)(eD.Z,{strokeWidth:1.5}),className:"mt-2",children:(0,a.jsx)(c(),{href:"https://www.postgresql.org/message-id/21012.1459434338%40sss.pgh.pa.us",target:"_blank",rel:"noreferrer",children:"Learn more"})})]})]}),(0,a.jsx)(es.NI,{children:(0,a.jsx)(ay,{index:t,id:e.id,field:s,isDisabled:f.length<2,onRemoveValue:()=>j(t)})}),(0,a.jsx)(es.zG,{className:"ml-6"})]})}},e.id)),e.placeholder]})})}),(0,a.jsx)(u.z,{type:"default",icon:(0,a.jsx)(x.Z,{strokeWidth:1.5}),onClick:()=>g({value:""}),children:"Add value"}),(0,a.jsx)(u.z,{ref:i,htmlType:"submit",type:"default",className:"hidden",children:"Update"})]})})})})};async function a_(e){let{projectRef:t,connectionString:n,name:a,schema:s}=e,l="drop type if exists ".concat(s,'."').concat(a,'"'),{result:i}=await (0,eY.Rj)({projectRef:t,connectionString:n,sql:l});return i}let aC=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,ec.NL)();return(0,ed.D)(e=>a_(e),{async onSuccess(t,n,s){let{projectRef:l}=n;await a.invalidateQueries(ag.P.list(l)),await (null==e?void 0:e(t,n,s))},async onError(e,n,a){void 0===t?en.ZP.error("Failed to create enumerated type: ".concat(e.message)):t(e,n,a)},...n})};var aS=e=>{let{visible:t,selectedEnumeratedType:n,onClose:s}=e,{project:l}=(0,P.d2)(),{mutate:i,isLoading:r}=aC({onSuccess:()=>{en.ZP.success('Successfully deleted "'.concat(n.name,'"')),s()}}),o=()=>void 0===n?console.error("No enumerated type selected"):(null==l?void 0:l.ref)===void 0?console.error("Project ref required"):(null==l?void 0:l.connectionString)===void 0?console.error("Project connectionString required"):void i({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString,name:n.name,schema:n.schema});return(0,a.jsxs)(tL.Z,{variant:"destructive",size:"medium",loading:r,visible:t,title:(0,a.jsxs)(a.Fragment,{children:["Confirm to delete enumerated type"," ",(0,a.jsx)("code",{className:"text-sm",children:null==n?void 0:n.name})]}),confirmLabel:"Confirm delete",confirmLabelLoading:"Deleting...",onCancel:s,onConfirm:()=>o(),alert:{title:"This action cannot be undone",description:"You will need to re-create the enumerated type if you want to revert the deletion."},children:[(0,a.jsx)("p",{className:"text-sm",children:"Before deleting this enumerated type, consider:"}),(0,a.jsx)("ul",{className:"space-y-2 mt-2 text-sm text-foreground-light",children:(0,a.jsx)("li",{className:"list-disc ml-6",children:"This enumerated type is no longer in use in any tables or functions"})})]})};async function ak(e){let{projectRef:t,connectionString:n,schema:a,name:s,description:l,values:i=[]}=e,r=[];s.original!==s.updated&&r.push('alter type "'.concat(a,'"."').concat(s.original,'" rename to "').concat(s.updated,'";')),i.length>0&&i.forEach((e,t)=>{if(e.isNew){if(0===t){let t=i.find(e=>!e.isNew);r.push('alter type "'.concat(a,'"."').concat(s.updated,"\" add value '").concat(e.updated,"' before '").concat(null==t?void 0:t.original,"';"))}else r.push('alter type "'.concat(a,'"."').concat(s.updated,"\" add value '").concat(e.updated,"' after '").concat(i[t-1].updated,"';"))}else e.original!==e.updated&&r.push('alter type "'.concat(a,'"."').concat(s.updated,"\" rename value '").concat(e.original,"' to '").concat(e.updated,"';"))}),void 0!==l&&r.push('comment on type "'.concat(a,'"."').concat(s.updated,"\" is '").concat(l,"';"));let o=eH(r.join(" ")),{result:c}=await (0,eY.Rj)({projectRef:t,connectionString:n,sql:o});return c}let aE=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,ec.NL)();return(0,ed.D)(e=>ak(e),{async onSuccess(t,n,s){let{projectRef:l}=n;await a.invalidateQueries(ag.P.list(l)),await (null==e?void 0:e(t,n,s))},async onError(e,n,a){void 0===t?en.ZP.error("Failed to add value to enumerated type: ".concat(e.message)):t(e,n,a)},...n})};var aZ=e=>{var t;let{visible:n,selectedEnumeratedType:s,onClose:l}=e,i=(0,d.useRef)(null),{project:r}=(0,P.d2)(),{mutate:o,isLoading:m}=aE({onSuccess:(e,t)=>{en.ZP.success('Successfully updated type "'.concat(t.name.updated,'"')),l()}}),h=er.Ry({name:er.Z_().min(1,"Please provide a name for your enumerated type").default(""),description:er.Z_().default("").optional(),values:er.Ry({isNew:er.O7(),originalValue:er.Z_(),updatedValue:er.Z_().min(1,"Please provide a value")}).array().default([])}),p=(0,et.cI)({resolver:(0,ee.F)(h),defaultValues:{name:"",description:"",values:[{isNew:!0,originalValue:"",updatedValue:""}]}}),{fields:f,append:g,remove:j,move:v}=(0,et.Dq)({name:"values",control:p.control}),b=e=>{e.destination&&v(e.source.index,e.destination.index)},y=(null!==(t=null==s?void 0:s.enums)&&void 0!==t?t:[]).map(e=>({isNew:!1,originalValue:e,updatedValue:e}));return(0,d.useEffect)(()=>{if(void 0!==s){var e;p.reset({name:s.name,description:null!==(e=s.comment)&&void 0!==e?e:"",values:y})}void 0==s&&p.reset({values:y})},[s]),(0,a.jsx)(ea.ZP,{loading:m,visible:n,onCancel:l,header:'Update type "'.concat(null==s?void 0:s.name,'"'),confirmText:"Update type",onConfirm:()=>{i.current&&i.current.click()},children:(0,a.jsx)(ea.ZP.Content,{className:"py-4",children:(0,a.jsx)(es.l0,{...p,children:(0,a.jsxs)("form",{className:"space-y-4",onSubmit:p.handleSubmit(e=>{var t;if((null==r?void 0:r.ref)===void 0)return console.error("Project ref required");if((null==r?void 0:r.connectionString)===void 0)return console.error("Project connectionString required");if(void 0===s)return console.error("selectedEnumeratedType required");let n={schema:s.schema,name:{original:s.name,updated:e.name},values:e.values.filter(e=>0!==e.updatedValue.length).map(e=>({original:e.originalValue,updated:e.updatedValue.trim(),isNew:e.isNew})),...e.description!==s.comment?{description:null===(t=e.description)||void 0===t?void 0:t.replaceAll("'","''")}:{}};o({projectRef:r.ref,connectionString:r.connectionString,...n})}),children:[(0,a.jsx)(es.Wi,{control:p.control,name:"name",render:e=>{let{field:t}=e;return(0,a.jsxs)(es.xJ,{children:[(0,a.jsx)(es.lX,{children:"Name"}),(0,a.jsx)(es.NI,{children:(0,a.jsx)(el.I,{...t})}),(0,a.jsx)(es.zG,{})]})}}),(0,a.jsx)(es.Wi,{control:p.control,name:"description",render:e=>{let{field:t}=e;return(0,a.jsxs)(es.xJ,{children:[(0,a.jsx)(es.lX,{children:"Description"}),(0,a.jsx)(es.NI,{children:(0,a.jsx)(el.I,{...t})}),(0,a.jsx)(es.pf,{children:"Optional"})]})}}),(0,a.jsx)(ap.Z5,{onDragEnd:e=>b(e),children:(0,a.jsx)(ap.bK,{droppableId:"enum_type_values_droppable",children:e=>(0,a.jsxs)("div",{ref:e.innerRef,children:[f.map((e,t)=>(0,a.jsx)(es.Wi,{control:p.control,name:"values.".concat(t,".updatedValue"),render:n=>{let{field:s}=n;return(0,a.jsxs)(es.xJ,{children:[(0,a.jsx)(es.lX,{className:(0,eR.cn)(0!==t&&"sr-only"),children:"Values"}),0===t&&(0,a.jsxs)(af.bZ,{children:[(0,a.jsx)(eI.Z,{strokeWidth:1.5}),(0,a.jsx)(af.Cd,{children:"Existing values cannot be deleted or sorted"}),(0,a.jsxs)(af.X,{children:[(0,a.jsx)("p",{className:"!leading-normal track",children:"You will need to delete and recreate the enumerated type with the updated values instead."}),(0,a.jsx)(u.z,{asChild:!0,type:"default",icon:(0,a.jsx)(eD.Z,{strokeWidth:1.5}),className:"mt-2",children:(0,a.jsx)(c(),{href:"https://www.postgresql.org/message-id/21012.1459434338%40sss.pgh.pa.us",target:"_blank",rel:"noreferrer",children:"Learn more"})})]})]}),(0,a.jsx)(es.NI,{children:(0,a.jsx)(ay,{index:t,id:e.id,field:s,isDisabled:!e.isNew,onRemoveValue:()=>j(t)})}),(0,a.jsx)(es.zG,{className:"ml-6"})]})}},e.id)),e.placeholder]})})}),(0,a.jsx)(u.z,{type:"default",icon:(0,a.jsx)(x.Z,{strokeWidth:1.5}),onClick:()=>g({isNew:!0,originalValue:"",updatedValue:""}),children:"Add value"}),(0,a.jsx)(u.z,{ref:i,htmlType:"submit",type:"default",className:"hidden",children:"Update"})]})})})})},aT=()=>{let{project:e}=(0,P.d2)(),[t,n]=(0,d.useState)(""),[s,l]=(0,d.useState)("public"),[i,r]=(0,d.useState)(!1),[o,c]=(0,d.useState)(),[x,v]=(0,d.useState)(),{data:b}=(0,D.Q)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),{data:_,error:C,isLoading:k,isError:Z,isSuccess:T}=(0,ax.k)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),R=t.length>0?(null!=_?_:[]).filter(e=>e.schema===s&&e.name.toLowerCase().includes(t.toLowerCase())):(null!=_?_:[]).filter(e=>e.schema===s),z=(null!=b?b:[]).filter(e=>{var t;return S.F.includes(null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"")}),A=null==b?void 0:b.find(e=>e.name===s),I=z.some(e=>e.id===(null==A?void 0:A.id));return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(L.Z,{className:"w-[260px]",size:"small",showError:!1,selectedSchemaName:s,onSelectSchema:l}),(0,a.jsx)(m.Z,{size:"small",value:t,className:"w-64",onChange:e=>n(e.target.value),placeholder:"Search for a type",icon:(0,a.jsx)(h.Z,{size:14})})]}),!I&&(0,a.jsx)(u.z,{type:"primary",onClick:()=>r(!0),children:"Create type"})]}),I&&(0,a.jsx)(E.Z,{schema:s,entity:"enumerated types"}),k&&(0,a.jsx)(w.A,{}),Z&&(0,a.jsx)(N.Z,{error:C,subject:"Failed to retrieve database enumerated types"}),T&&(0,a.jsx)(y.Z,{head:[(0,a.jsx)(y.Z.th,{children:"Schema"},"schema"),(0,a.jsx)(y.Z.th,{children:"Name"},"name"),(0,a.jsx)(y.Z.th,{children:"Values"},"values"),(0,a.jsx)(y.Z.th,{},"actions")],body:(0,a.jsxs)(a.Fragment,{children:[0===R.length&&0===t.length&&(0,a.jsx)(y.Z.tr,{children:(0,a.jsxs)(y.Z.td,{colSpan:4,children:[(0,a.jsx)("p",{className:"text-sm text-foreground",children:"No enumerated types created yet"}),(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:['There are no enumerated types found in the schema "',s,'"']})]})}),0===R.length&&t.length>0&&(0,a.jsx)(y.Z.tr,{children:(0,a.jsxs)(y.Z.td,{colSpan:4,children:[(0,a.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',t,'" did not return any results']})]})}),R.length>0&&R.map(e=>(0,a.jsxs)(y.Z.tr,{children:[(0,a.jsx)(y.Z.td,{className:"w-20",children:(0,a.jsx)("p",{className:"w-20 truncate",children:e.schema})}),(0,a.jsx)(y.Z.td,{children:e.name}),(0,a.jsx)(y.Z.td,{children:e.enums.join(", ")}),(0,a.jsx)(y.Z.td,{children:!I&&(0,a.jsx)("div",{className:"flex justify-end items-center space-x-2",children:(0,a.jsxs)(p.h_,{children:[(0,a.jsx)(p.$F,{asChild:!0,children:(0,a.jsx)(u.z,{type:"default",className:"px-1",children:(0,a.jsx)(f.Z,{})})}),(0,a.jsxs)(p.AW,{side:"bottom",align:"end",className:"w-32",children:[(0,a.jsxs)(p.Xi,{className:"space-x-2",onClick:()=>c(e),children:[(0,a.jsx)(g.Z,{size:"tiny"}),(0,a.jsx)("p",{children:"Update type"})]}),(0,a.jsxs)(p.Xi,{className:"space-x-2",onClick:()=>v(e),children:[(0,a.jsx)(j.Z,{stroke:"red",size:"tiny"}),(0,a.jsx)("p",{children:"Delete type"})]})]})]})})})]},e.id))]})}),(0,a.jsx)(aw,{visible:i,onClose:()=>r(!1),schema:s}),(0,a.jsx)(aZ,{visible:void 0!==o,selectedEnumeratedType:o,onClose:()=>c(void 0)}),(0,a.jsx)(aS,{visible:void 0!==x,selectedEnumeratedType:x,onClose:()=>v(void 0)})]})}},38406:function(e,t,n){"use strict";n.d(t,{m:function(){return h}});var a=n(52322),s=n(16581),l=n(13096),i=n(5388),r=n(5632),o=n(62202),c=n(89796),d=n(53187),u=n(31840),m=n(27792);let h=e=>{var t;let{visible:n,onCancel:h,afterSubmit:x}=e,p=(0,l.Vm)(),f=(0,s.T)(),g=null!==(t=null==p?void 0:p.ref)&&void 0!==t?t:"default",j=(0,r.useRouter)();async function v(e){let{name:t,description:n}=e;try{if(!g)return;let e=await f.mutateAsync({projectRef:g,payload:{id:(0,i.k$)(),type:"report",name:t,description:n||"",visibility:"project",content:{schema_version:1,period_start:{time_period:"7d",date:""},period_end:{time_period:"today",date:""},interval:"1d",layout:[]}}});o.ZP.success("New report created");let a=e[0].id;j.push("/project/".concat(g,"/reports/").concat(a)),x()}catch(e){o.ZP.error("Failed to create report. Check console for more details."),console.error(e)}}return(0,a.jsx)(c.C,{visible:n,onCancel:h,hideFooter:!0,header:"Create a custom report",size:"small",children:(0,a.jsx)(d.Z,{onReset:h,validateOnBlur:!0,initialValues:{name:"",description:""},validate:e=>{let t={};return e.name||(t.name="Required"),t},onSubmit:e=>v(e),children:e=>{let{isSubmitting:t}=e;return(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsx)(c.C.Content,{children:(0,a.jsx)(u.Z,{label:"Name",id:"name",name:"name"})}),(0,a.jsx)(c.C.Content,{children:(0,a.jsx)(u.Z.TextArea,{label:"Description",id:"description",placeholder:"Describe your custom report",size:"medium",textAreaClassName:"resize-none"})}),(0,a.jsx)(c.C.Separator,{}),(0,a.jsx)(c.C.Content,{children:(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,a.jsx)(m.z,{htmlType:"reset",type:"default",onClick:h,disabled:t,children:"Cancel"}),(0,a.jsx)(m.z,{htmlType:"submit",loading:t,disabled:t,children:"Create report"})]})})]})}})})}},23906:function(e,t,n){"use strict";n.d(t,{Q:function(){return P},G:function(){return A}});var a=n(52322),s=n(2784),l=n(26120),i=n(27792),r=n(12467),o=n(81395),c=n(30474),d=n(50412),u=n(43801),m=n(40386),h=n(6659);let x=e=>{let{isSelected:t=!1}=e,{resolvedTheme:n}=(0,h.F)();return(0,a.jsx)("svg",{width:"53",height:"17",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsxs)("g",{opacity:t?"1":".5",children:[(0,a.jsx)("rect",{x:"37.161",y:".53",width:"15",height:"15",rx:"5.5",stroke:"light"===n?"#11181C":"#EDEDED"}),(0,a.jsx)("path",{d:"M1 10.53h32.214",stroke:"#33A7E9",strokeLinecap:"round",strokeDasharray:"2 2"}),(0,a.jsx)("rect",{x:"15.964",y:".53",width:"9",height:"15",rx:"4.5",stroke:"light"===n?"#7E868C":"#7E7E7E"}),(0,a.jsx)("path",{d:"M1 5.53h32.214",stroke:"#33A7E9",strokeLinecap:"round",strokeDasharray:"2 2"})]})})},p=e=>{let{isSelected:t=!1}=e,{resolvedTheme:n}=(0,h.F)();return(0,a.jsx)("svg",{width:"53",height:"17",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsxs)("g",{opacity:t?"1":".5",children:[(0,a.jsx)("path",{d:"M1 4.994a.5.5 0 0 0 0 1v-1Zm16.218 1h.5v-1h-.5v1ZM1 5.994h1.014v-1H1v1Zm3.04 0h2.028v-1H4.041v1Zm4.056 0h2.027v-1H8.096v1Zm4.054 0h2.027v-1H12.15v1Zm4.055 0h1.013v-1h-1.013v1Z",fill:"light"===n?"#7E868C":"#7E7E7E"}),(0,a.jsx)("path",{d:"m15.92 12.56 9.04-9.04",stroke:"light"===n?"#11181C":"#EDEDED"}),(0,a.jsx)("rect",{x:"15.964",y:".494",width:"9",height:"15",rx:"4.5",stroke:"light"===n?"#11181C":"#EDEDED"}),(0,a.jsx)("rect",{x:"37.161",y:".744",width:"15",height:"15",rx:"5.5",stroke:"light"===n?"#11181C":"#EDEDED"}),(0,a.jsx)("path",{d:"M1 10.494h32.214",stroke:"#33A7E9",strokeLinecap:"round",strokeDasharray:"2 2"}),(0,a.jsx)("path",{d:"M15.96 7.562 22.568.956M19.049 14.885l5.957-5.958",stroke:"light"===n?"#11181C":"#EDEDED"})]})})},f=e=>{let{isSelected:t=!1}=e,{resolvedTheme:n}=(0,h.F)();return(0,a.jsx)("svg",{width:"68",height:"17",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsxs)("g",{opacity:t?"1":".5",children:[(0,a.jsx)("path",{d:"M15.63 5.156a.5.5 0 1 0 0 1v-1Zm16.218 1h.5v-1h-.5v1Zm-16.218 0h1.013v-1H15.63v1Zm3.04 0h2.028v-1h-2.027v1Zm4.055 0h2.028v-1h-2.028v1Zm4.055 0h2.027v-1H26.78v1Zm4.055 0h1.013v-1h-1.013v1Z",fill:"light"===n?"#7E868C":"#7E7E7E"}),(0,a.jsx)("path",{d:"m30.55 12.722 9.04-9.04",stroke:"light"===n?"#11181C":"#EDEDED"}),(0,a.jsx)("rect",{x:"30.594",y:".656",width:"9",height:"15",rx:"4.5",stroke:"light"===n?"#11181C":"#EDEDED"}),(0,a.jsx)("rect",{x:"51.791",y:".906",width:"15",height:"15",rx:"5.5",stroke:"light"===n?"#11181C":"#EDEDED"}),(0,a.jsx)("path",{d:"M15.63 10.656h32.214",stroke:"#33A7E9",strokeLinecap:"round",strokeDasharray:"2 2"}),(0,a.jsx)("path",{d:"m30.59 7.724 6.607-6.606M33.679 15.047l5.957-5.958",stroke:"light"===n?"#11181C":"#EDEDED"}),(0,a.jsx)("path",{d:"M12.666 14.281v-1.333A2.667 2.667 0 0 0 10 10.28H6a2.667 2.667 0 0 0-2.667 2.667v1.333M8 7.615A2.667 2.667 0 1 0 8 2.28a2.667 2.667 0 0 0 0 5.334Z",stroke:"light"===n?"#11181C":"#EDEDED",strokeLinecap:"round",strokeLinejoin:"round"})]})})};var g=n(16166),j=n(60537),v=n(83036),b=function(e){return(0,a.jsx)(v.Z,{icon:j.Z,...e})},y=function(e){let{label:t,value:n,isSelected:s,onSelectedChange:l,icon:i}=e;return(0,a.jsxs)("label",{className:(0,r.cn)("border border-default rounded-md bg-surface-200 hover:bg-overlay-hover hover:border-control px-4 py-3 w-44 cursor-pointer transition-colors",s&&"border-stronger bg-surface-300"),tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&l(n)},htmlFor:"role-".concat(n),children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[i&&(0,a.jsx)("div",{children:i}),s&&(0,a.jsxs)("div",{className:"flex items-center justify-center p-0.5 bg-foreground text-background rounded-full",children:["boolean"==typeof s&&(0,a.jsx)(g.Z,{size:12,strokeWidth:"4",className:"text-background"}),"partially"===s&&(0,a.jsx)(b,{size:12,strokeWidth:"4",className:"text-background"})]})]}),(0,a.jsx)("input",{id:"role-".concat(n),type:"radio",name:"role",value:n,checked:!!s,onChange:e=>{l(e.target.value)},className:"invisible h-0 w-0 border-0"}),(0,a.jsxs)("span",{className:(0,r.cn)("text-sm text-foreground-light whitespace-nowrap select-none transition-colors",s&&"text-foreground"),children:[null!=t?t:n," role"]})]})},N=n(53111),w=n(83314),_=n(33105),C=n(81650),S=n(47716),k=n(38880),E=n(88724),Z=n(31840),T=()=>{var e,t,n,l;let[r,o]=(0,s.useState)(""),c=(0,N.Nr)(r,300),{project:m}=(0,w.d2)(),{data:h,isSuccess:x,isLoading:p,isError:f,error:g,isFetching:j,isPreviousData:v}=(0,C.xY)({projectRef:null==m?void 0:m.ref,keywords:c||void 0},{keepPreviousData:!0}),b=(0,d.fN)(),y=(null===(e=b.role)||void 0===e?void 0:e.type)==="postgrest"&&"authenticated"===b.role.role&&b.role.user;function T(e){b.setRole({type:"postgrest",role:"authenticated",user:e})}return(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("h2",{className:"text-foreground text-base",children:y?"Impersonating ".concat((0,u.G)(y,null!==(l=null!==(n=null!==(t=y.email)&&void 0!==t?t:y.phone)&&void 0!==n?n:y.id)&&void 0!==l?l:"Unknown")):"Impersonate a User"}),(0,a.jsx)("p",{className:"text-sm text-foreground-light max-w-md",children:y?"Results will respect your database's Row-Level Security policies for this user.":"Select a user to respect your database's Row-Level Security policies for that particular user."}),y?(0,a.jsx)(R,{user:y,onClick:function(){b.setRole(void 0)},isImpersonating:!0}):(0,a.jsxs)("div",{className:"flex flex-col gap-2 mt-4",children:[(0,a.jsx)(Z.Z,{className:"table-editor-search border-none",icon:v&&j?(0,a.jsx)(S.Z,{className:"animate-spin text-foreground-lighter",size:16,strokeWidth:1.5}):(0,a.jsx)(k.Z,{className:"text-foreground-lighter",size:16,strokeWidth:1.5}),placeholder:"Search for a user..",onChange:e=>o(e.target.value.trim()),value:r,size:"small",actions:r&&(0,a.jsx)(i.z,{size:"tiny",type:"text",className:"px-1",onClick:()=>o(""),children:(0,a.jsx)(E.Z,{size:12,strokeWidth:2})})}),p&&(0,a.jsxs)("div",{className:"flex flex-col gap-2 items-center justify-center h-24",children:[(0,a.jsx)(S.Z,{className:"animate-spin",size:24}),(0,a.jsx)("span",{children:"Loading users..."})]}),f&&(0,a.jsx)(_.Z,{error:g,subject:"Failed to retrieve users"}),x&&(h.users.length>0?(0,a.jsx)("ul",{className:"divide-y max-h-[192px] overflow-y-scroll",role:"list",children:h.users.map(e=>(0,a.jsx)("li",{role:"listitem",children:(0,a.jsx)(z,{user:e,onClick:T})},e.id))}):(0,a.jsx)("div",{className:"flex flex-col gap-2 items-center justify-center h-24",children:(0,a.jsx)("p",{className:"text-foreground-light text-xs",role:"status",children:"No users found"})}))]})]})};let R=e=>{var t,n,s;let{user:l,onClick:r,isImpersonating:o=!1}=e,d=(0,u.E)(l),m=(0,u.G)(l,null!==(s=null!==(n=null!==(t=l.email)&&void 0!==t?t:l.phone)&&void 0!==n?n:l.id)&&void 0!==s?s:"Unknown")+(l.is_anonymous?" (anonymous)":"");return(0,a.jsxs)("div",{className:"flex items-center gap-3 py-2 text-foreground",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 bg-surface-200 pr-5 pl-0.5 py-0.5 border rounded-full max-w-l",children:[d?(0,a.jsx)("img",{className:"rounded-full w-5 h-5",src:d,alt:m}):(0,a.jsx)("div",{className:"rounded-full w-[21px] h-[21px] bg-surface-300 border border-strong flex items-center justify-center",children:(0,a.jsx)(c.Z,{size:12,strokeWidth:2})}),(0,a.jsx)("span",{className:"text-sm truncate",children:m})]}),(0,a.jsx)(i.z,{type:"secondary",onClick:()=>{r(l)},children:o?"Stop Impersonating":"Impersonate"})]})},z=e=>{var t,n,s;let{user:l,onClick:r,isImpersonating:o=!1}=e,d=(0,u.E)(l),m=(0,u.G)(l,null!==(s=null!==(n=null!==(t=l.email)&&void 0!==t?t:l.phone)&&void 0!==n?n:l.id)&&void 0!==s?s:"Unknown")+(l.is_anonymous?" (anonymous)":"");return(0,a.jsxs)("div",{className:"flex items-center justify-between py-2 text-foreground",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[d?(0,a.jsx)("img",{className:"rounded-full w-5 h-5",src:d,alt:m}):(0,a.jsx)("div",{className:"rounded-full w-[21px] h-[21px] bg-surface-300 border text-muted flex items-center justify-center text-background",children:(0,a.jsx)(c.Z,{size:12,strokeWidth:2})}),(0,a.jsx)("span",{className:"text-sm",children:m})]}),(0,a.jsx)(i.z,{type:"secondary",onClick:()=>{r(l)},children:o?"Stop Impersonating":"Impersonate"})]})};var A=e=>{var t;let{serviceRoleLabel:n,padded:l=!0}=e,i=(0,d.fN)(),[o,c]=(0,s.useState)(()=>{var e;return(null===(e=i.role)||void 0===e?void 0:e.type)==="postgrest"&&("anon"===i.role.role||"authenticated"===i.role.role)?i.role.role:"service_role"}),u=!!("authenticated"===o&&(null===(t=i.role)||void 0===t?void 0:t.type)==="postgrest"&&"authenticated"===i.role.role&&i.role.user);function h(e){"service_role"===e&&i.setRole(void 0),"anon"===e&&i.setRole({type:"postgrest",role:e}),c(e)}return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:(0,r.cn)("flex flex-col gap-3",l?"p-5":"pb-5"),children:[(0,a.jsx)("h2",{className:"text-foreground text-base",children:"Database role settings"}),(0,a.jsx)("form",{onSubmit:e=>{e.preventDefault()},children:(0,a.jsxs)("fieldset",{className:"flex gap-3",children:[(0,a.jsx)(y,{value:"service_role",isSelected:"service_role"===o,onSelectedChange:h,label:n,icon:(0,a.jsx)(x,{isSelected:"service_role"===o})}),(0,a.jsx)(y,{value:"anon",isSelected:"anon"===o,onSelectedChange:h,icon:(0,a.jsx)(p,{isSelected:"anon"===o})}),(0,a.jsx)(y,{value:"authenticated",isSelected:"authenticated"===o&&(u||"partially"),onSelectedChange:h,icon:(0,a.jsx)(f,{isSelected:"authenticated"===o})})]})}),"service_role"===o&&(0,a.jsxs)("p",{className:"text-foreground-light text-sm",children:["The default Postgres/superuser role. This has admin privileges.",(0,a.jsx)("br",{}),"It will bypass Row Level Security (RLS) policies."]}),"anon"===o&&(0,a.jsxs)("p",{className:"text-foreground-light text-sm",children:['For "anonymous access". This is the role which the API (PostgREST) will use when a user',(0,a.jsx)("br",{}),"is not logged in. It will respect Row Level Security (RLS) policies."]}),"authenticated"===o&&(0,a.jsxs)("p",{className:"text-foreground-light text-sm",children:['For "authenticated access". This is the role which the API (PostgREST) will use when',(0,a.jsx)("br",{})," a user is logged in. It will respect Row Level Security (RLS) policies."]})]}),"authenticated"===o&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.VD,{}),(0,a.jsx)("div",{className:(0,r.cn)("py-5",l&&"px-5"),children:(0,a.jsx)(T,{})})]})]})},P=e=>{var t,n,c,u;let{serviceRoleLabel:m,variant:h="regular",align:x="end"}=e,p=(0,d.fN)(),[f,g]=(0,s.useState)(!1),j=null!==(u=null!==(c=null===(t=p.role)||void 0===t?void 0:t.role)&&void 0!==c?c:m)&&void 0!==u?u:"service role";return(0,a.jsxs)(l.J2,{open:f,onOpenChange:g,modal:!1,children:[(0,a.jsx)(l.xo,{asChild:!0,children:(0,a.jsx)(i.z,{size:"tiny",type:"default",className:(0,r.cn)("h-[26px] pr-3 gap-0","connected-on-right"===h&&"rounded-r-none border-r-0","connected-on-left"===h&&"rounded-l-none border-l-0","connected-on-both"===h&&"rounded-none border-x-0"),children:(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"text-foreground-muted",children:"role"}),(0,a.jsx)("span",{children:j}),(null===(n=p.role)||void 0===n?void 0:n.type)==="postgrest"&&"authenticated"===p.role.role&&(0,a.jsx)(L,{user:p.role.user}),(0,a.jsx)(o.Z,{className:"text-muted",strokeWidth:1,size:12})]})})}),(0,a.jsx)(l.yk,{className:"p-0 w-full overflow-hidden bg-overlay",side:"bottom",align:x,children:(0,a.jsx)(A,{serviceRoleLabel:m})})]})};let L=e=>{var t,n,s;let{user:l}=e,i=(0,u.E)(l),r=(0,u.G)(l,null!==(s=null!==(n=null!==(t=l.email)&&void 0!==t?t:l.phone)&&void 0!==n?n:l.id)&&void 0!==s?s:"Unknown");return(0,a.jsxs)("div",{className:"flex gap-1 items-center pl-0.5 pr-1.5 h-[21px] bg-surface-200 rounded-full overflow-hidden",children:[i?(0,a.jsx)("img",{className:"rounded-full w-[18px] h-[18px]",src:i,alt:r}):(0,a.jsx)("div",{className:"rounded-full w-[18px] h-[18px] bg-surface-100 border flex items-center justify-center text-light",children:(0,a.jsx)(c.Z,{size:12,strokeWidth:2})}),(0,a.jsx)("span",{className:"truncate max-w-[84px]",children:r})]})}},86630:function(e,t,n){"use strict";n.d(t,{Z:function(){return L}});var a=n(52322),s=n(39097),l=n.n(s),i=n(62202),r=n(72978),o=n(72860),c=n(27792),d=n(39127),u=n(66513),m=n(14670),h=n(83314),x=n(83033),p=n(44109),f=n(85945),g=n(48228),j=n(25424),v=n(58686),b=n(69786),y=n(64308),N=n(50412),w=n(28434);async function _(e){let{projectRef:t,connectionString:n,table:a,filters:s,impersonatedRole:l}=e,i=(0,y.Jh)(function(e){var t;let{table:n,filters:a}=e,s=new j.AE().from(n.name,null!==(t=n.schema)&&void 0!==t?t:void 0).delete();return a.filter(e=>e.value&&""!==e.value).forEach(e=>{let t=(0,w.q)(n,e);s=s.filter(e.column,e.operator,t)}),s.toSql()}({table:a,filters:s}),{projectRef:t,role:l}),{result:r}=await (0,v.Rj)({projectRef:t,connectionString:n,sql:i,isRoleImpersonationEnabled:(0,N.Gm)(l)});return r}let C=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,f.NL)();return(0,g.D)(e=>_(e),{async onSuccess(t,n,s){let{projectRef:l,table:i}=n;await a.invalidateQueries(b.M.query(l,[i.schema,i.name])),await (null==e?void 0:e(t,n,s))},async onError(e,n,a){void 0===t?i.Am.error("Failed to delete all table rows: ".concat(e.message)):t(e,n,a)},...n})};async function S(e){let{projectRef:t,connectionString:n,table:a,rows:s,impersonatedRole:l}=e,i=(0,y.Jh)(function(e){var t;let{table:n,rows:a}=e,{primaryKeys:s,error:l}=(0,w.h)({table:n});if(l)throw l;let i=new j.AE().from(n.name,null!==(t=n.schema)&&void 0!==t?t:void 0).delete();return s.forEach(e=>{let t=a.map(t=>t[e]);i=i.filter(e,"in",t)}),i.toSql()}({table:a,rows:s}),{projectRef:t,role:l}),{result:r}=await (0,v.Rj)({projectRef:t,connectionString:n,sql:i,isRoleImpersonationEnabled:(0,N.Gm)(l)});return r}let k=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,f.NL)();return(0,g.D)(e=>S(e),{async onSuccess(t,n,s){let{projectRef:l,table:i}=n;await a.invalidateQueries(b.M.query(l,[i.schema,i.name])),await (null==e?void 0:e(t,n,s))},async onError(e,n,a){void 0===t?i.Am.error("Failed to delete table row: ".concat(e.message)):t(e,n,a)},...n})};async function E(e){let{projectRef:t,connectionString:n,table:a}=e,s=function(e){var t;let{table:n}=e;return new j.AE().from(n.name,null!==(t=n.schema)&&void 0!==t?t:void 0).truncate().toSql()}({table:a}),{result:l}=await (0,v.Rj)({projectRef:t,connectionString:n,sql:s});return l}let Z=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,f.NL)();return(0,g.D)(e=>E(e),{async onSuccess(t,n,s){let{projectRef:l,table:i}=n;await a.invalidateQueries(b.M.query(l,[i.schema,i.name])),await (null==e?void 0:e(t,n,s))},async onError(e,n,a){void 0===t?i.Am.error("Failed to truncate table row: ".concat(e.message)):t(e,n,a)},...n})};var T=n(46198),R=n(36554),z=n(13096),A=n(37185),P=n(73579),L=e=>{var t,n,s,f,g,j,v,b,y;let{selectedTable:w,onAfterDeleteTable:_=A.ZT}=e,{project:S}=(0,h.d2)(),E=(0,P._2)(),[{filter:L},I]=(0,z.x3)({arrayKeys:["filter","sort"]}),D=(0,m.Yb)(L),F=(0,R.AF)({projectRef:null==S?void 0:S.ref,connectionString:null==S?void 0:S.connectionString}),O=e=>{I(t=>{var n,a;let s=null!==(n=null==t?void 0:t.filter)&&void 0!==n?n:[],l=null!==(a=null==t?void 0:t.sort)&&void 0!==a?a:[];return{...t,filter:s.filter(t=>{let[n]=t.split(":");if(n!==e)return t}),sort:l.filter(t=>{let[n]=t.split(":");if(n!==e)return t})}})},{mutate:q}=(0,p.v)({onSuccess:()=>{var e;if((null===(e=E.confirmationDialog)||void 0===e?void 0:e.type)!=="column")return;let t=E.confirmationDialog.column;O(t.name),i.ZP.success('Successfully deleted column "'.concat(t.name,'"'))},onError:e=>{var t;if((null===(t=E.confirmationDialog)||void 0===t?void 0:t.type)!=="column")return;let n=E.confirmationDialog.column;i.ZP.error("Failed to delete ".concat(n.name,": ").concat(e.message))},onSettled:()=>{E.closeConfirmationDialog()}}),{mutateAsync:W}=(0,T.H)({onSuccess:async()=>{_(await F(E.selectedSchemaName)),i.ZP.success('Successfully deleted table "'.concat(null==w?void 0:w.name,'"'))},onError:e=>{i.ZP.error("Failed to delete ".concat(null==w?void 0:w.name,": ").concat(e.message))},onSettled:()=>{E.closeConfirmationDialog()}}),{mutate:U}=k({onSuccess:()=>{var e,t,n;(null===(e=E.confirmationDialog)||void 0===e?void 0:e.type)==="row"&&(null===(t=(n=E.confirmationDialog).callback)||void 0===t||t.call(n)),i.ZP.success("Successfully deleted selected row(s)")},onError:e=>{i.ZP.error("Failed to delete row: ".concat(e.message))},onSettled:()=>{E.closeConfirmationDialog()}}),{mutateAsync:V}=C({onSuccess:()=>{var e,t,n;(null===(e=E.confirmationDialog)||void 0===e?void 0:e.type)==="row"&&(null===(t=(n=E.confirmationDialog).callback)||void 0===t||t.call(n)),i.ZP.success("Successfully deleted selected rows")},onError:e=>{i.ZP.error("Failed to delete rows: ".concat(e.message))},onSettled:()=>{E.closeConfirmationDialog()}}),{mutateAsync:M}=Z({onSuccess:()=>{var e,t,n;(null===(e=E.confirmationDialog)||void 0===e?void 0:e.type)==="row"&&(null===(t=(n=E.confirmationDialog).callback)||void 0===t||t.call(n)),i.ZP.success("Successfully deleted all rows from table")},onError:e=>{i.ZP.error("Failed to delete rows: ".concat(e.message))},onSettled:()=>{E.closeConfirmationDialog()}}),B=(null===(t=E.confirmationDialog)||void 0===t?void 0:t.type)==="row"&&E.confirmationDialog.allRowsSelected,K=(null===(n=E.confirmationDialog)||void 0===n?void 0:n.type)==="row"?E.confirmationDialog.allRowsSelected?null!==(y=E.confirmationDialog.numRows)&&void 0!==y?y:0:E.confirmationDialog.rows.length:0,Y=((null===(s=E.confirmationDialog)||void 0===s?void 0:s.type)==="column"||(null===(f=E.confirmationDialog)||void 0===f?void 0:f.type)==="table")&&E.confirmationDialog.isDeleteWithCascade,Q=async()=>{var e;if((null===(e=E.confirmationDialog)||void 0===e?void 0:e.type)!=="column"||void 0===S)return;let t=E.confirmationDialog.column;void 0!==t&&q({id:t.id,cascade:Y,projectRef:S.ref,connectionString:null==S?void 0:S.connectionString,table:w})},H=async()=>{var e;(null===(e=E.confirmationDialog)||void 0===e?void 0:e.type)==="table"&&void 0!==w&&W({projectRef:null==S?void 0:S.ref,connectionString:null==S?void 0:S.connectionString,schema:w.schema,id:w.id,cascade:Y})},G=(0,N.z6)(),X=async()=>{var e;if(!S)return console.error("Project ref is required");if(!w)return console.error("Selected table required");if((null===(e=E.confirmationDialog)||void 0===e?void 0:e.type)!=="row")return;let t=E.confirmationDialog.rows;if(E.confirmationDialog.allRowsSelected){if(0===D.length){if(void 0!==G())return E.closeConfirmationDialog(),i.ZP.error("Table truncation is not supported when impersonating a role");M({projectRef:S.ref,connectionString:S.connectionString,table:w})}else V({projectRef:S.ref,connectionString:S.connectionString,table:w,filters:D,impersonatedRole:G()})}else U({projectRef:S.ref,connectionString:S.connectionString,table:w,rows:t,impersonatedRole:G()})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.Z,{variant:"destructive",size:"small",visible:(null===(g=E.confirmationDialog)||void 0===g?void 0:g.type)==="column",title:'Confirm deletion of column "'.concat((null===(j=E.confirmationDialog)||void 0===j?void 0:j.type)==="column"&&E.confirmationDialog.column.name,'"'),confirmLabel:"Delete",confirmLabelLoading:"Deleting",onCancel:()=>{E.closeConfirmationDialog()},onConfirm:Q,children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Are you sure you want to delete the selected column? This action cannot be undone."}),(0,a.jsx)(r.Z,{label:"Drop column with cascade?",description:"Deletes the column and its dependent objects",checked:Y,onChange:()=>E.toggleConfirmationIsWithCascade()}),Y&&(0,a.jsxs)(o.bZ,{variant:"warning",title:"Warning: Dropping with cascade may result in unintended consequences",children:[(0,a.jsx)(o.Cd,{children:"All dependent objects will be removed, as will any objects that depend on them, recursively."}),(0,a.jsx)(o.X,{children:(0,a.jsx)(c.z,{asChild:!0,size:"tiny",type:"default",icon:(0,a.jsx)(d.Z,{}),children:(0,a.jsx)(l(),{href:"https://www.postgresql.org/docs/current/ddl-depend.html",target:"_blank",rel:"noreferrer",children:"About dependency tracking"})})})]})]})}),(0,a.jsx)(x.Z,{variant:"destructive",size:"small",visible:(null===(v=E.confirmationDialog)||void 0===v?void 0:v.type)==="table",title:(0,a.jsx)("span",{className:"break-words",children:'Confirm deletion of table "'.concat(null==w?void 0:w.name,'"')}),confirmLabel:"Delete",confirmLabelLoading:"Deleting",onCancel:()=>{E.closeConfirmationDialog()},onConfirm:H,children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Are you sure you want to delete the selected table? This action cannot be undone."}),(0,a.jsx)(r.Z,{label:"Drop table with cascade?",description:"Deletes the table and its dependent objects",checked:Y,onChange:()=>E.toggleConfirmationIsWithCascade(!Y)}),Y&&(0,a.jsxs)(u.b,{withIcon:!0,variant:"warning",title:"Warning: Dropping with cascade may result in unintended consequences",children:[(0,a.jsx)("p",{className:"mb-4",children:"All dependent objects will be removed, as will any objects that depend on them, recursively."}),(0,a.jsx)(c.z,{asChild:!0,size:"tiny",type:"default",icon:(0,a.jsx)(d.Z,{}),children:(0,a.jsx)(l(),{href:"https://www.postgresql.org/docs/current/ddl-depend.html",target:"_blank",rel:"noreferrer",children:"About dependency tracking"})})]})]})}),(0,a.jsx)(x.Z,{variant:"destructive",size:"small",visible:(null===(b=E.confirmationDialog)||void 0===b?void 0:b.type)==="row",title:(0,a.jsxs)("span",{className:"break-words",children:["Confirm to delete the selected row",K>1&&"s"]}),confirmLabel:"Delete",confirmLabelLoading:"Deleting",onCancel:()=>E.closeConfirmationDialog(),onConfirm:()=>X(),children:(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:["Are you sure you want to delete ",B?"all":"the selected"," ",K>1&&"".concat(K," "),"row",K>1&&"s","? This action cannot be undone."]})})})]})}},59329:function(e,t,n){"use strict";var a=n(52322),s=n(34291),l=n.n(s),i=n(2784),r=n(27792);t.Z=e=>{let{loading:t=!1,disableApply:n=!1,hideApply:s=!1,children:o,applyButtonLabel:c="Apply",backButtonLabel:d="Back",applyFunction:u,closePanel:m=l(),formId:h}=e,[x,p]=(0,i.useState)(!1),f=()=>new Promise(e=>u(e)),g=async()=>{p(!0),await f(),p(!1)};return(0,a.jsxs)("div",{className:"flex w-full justify-end space-x-3 border-t border-default px-3 py-4",children:[(0,a.jsx)(r.z,{type:"default",htmlType:"button",onClick:m,disabled:x||t,children:d}),o,void 0!==u?(0,a.jsx)(r.z,{onClick:g,disabled:n||x||t,loading:x||t,children:c}):s?(0,a.jsx)("div",{}):(0,a.jsx)(r.z,{disabled:t||n,loading:t,"data-testid":"action-bar-save-row",htmlType:"submit",form:h,children:c})]})}},29966:function(e,t,n){"use strict";n.d(t,{Of:function(){return f},QZ:function(){return m},oo:function(){return x},s8:function(){return v},uE:function(){return h},xY:function(){return p}});var a=n(55281),s=n.n(a),l=n(18149),i=n.n(l),r=n(25877),o=n.n(r),c=n(11214),d=n(5388);let u=e=>{if(["CURRENT_DATE"].includes(e)||"("===e[0]&&")"===e[e.length-1])return!0;let t=e.indexOf("("),n=e.indexOf(")");return!(e.indexOf(" ")>=0)&&t>=0&&n>t},m=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{name:t,table:n,schema:a,format:s}=e;return{id:(0,d.k$)(),name:t||"",table:n||"",schema:a||"",comment:"",format:s||"",defaultValue:null,foreignKey:void 0,check:null,isNullable:!0,isUnique:!1,isArray:!1,isPrimaryKey:!1,isIdentity:!1,isNewColumn:!0,isEncrypted:!1}},h=(e,t,n)=>{var a,s;let{primary_keys:l}=t,i=l.map(e=>e.name),r=g(e,t,n),o=(null==e?void 0:e.data_type)==="ARRAY";return{foreignKey:r,id:null!==(a=null==e?void 0:e.id)&&void 0!==a?a:(0,d.k$)(),table:e.table,schema:e.schema,name:e.name,comment:null!==(s=null==e?void 0:e.comment)&&void 0!==s?s:"",format:o?e.format.slice(1):e.format,defaultValue:null==e?void 0:e.default_value,check:e.check,isArray:o,isNullable:e.is_nullable,isIdentity:e.is_identity,isUnique:e.is_unique,isNewColumn:!1,isEncrypted:!1,isPrimaryKey:i.includes(e.name)}},x=(e,t)=>{var n,a;let s=!!t.format.includes("int")&&t.isIdentity,l=t.defaultValue;return{tableId:e,isIdentity:s,name:t.name.trim(),comment:null===(n=t.comment)||void 0===n?void 0:n.trim(),type:t.isArray?"".concat(t.format,"[]"):t.format,check:(null===(a=t.check)||void 0===a?void 0:a.trim())||void 0,isUnique:t.isUnique,isPrimaryKey:t.isPrimaryKey,...!t.isPrimaryKey&&!s&&{isNullable:t.isNullable},...!s&&{defaultValue:t.isArray&&l?j(l):l},...!s&&l&&{defaultValueFormat:o()(l)||u(l)?"expression":"literal"}}},p=(e,t,n)=>{var a,s,l,r,c;let d=t.primary_keys.map(e=>e.name).includes(e.name),m=n.isArray?"".concat(n.format,"[]"):n.format,h=(null!==(r=null===(a=n.comment)||void 0===a?void 0:a.length)&&void 0!==r?r:"")===0?null:n.comment,x={};if(i()(e.name,n.name)||(x.name=n.name),i()(e.comment,h)||(x.comment=h),i()(null===(s=e.check)||void 0===s?void 0:s.trim(),null===(l=n.check)||void 0===l?void 0:l.trim())||(x.check=null===(c=n.check)||void 0===c?void 0:c.trim()),i()(e.format,m)||(x.type=m),!i()(e.default_value,n.defaultValue)){let e=n.defaultValue;x.defaultValue=e,x.defaultValueFormat=o()(e)||u(e)?"expression":"literal"}return i()(e.is_identity,n.isIdentity)||(x.isIdentity=n.isIdentity),i()(e.is_nullable,n.isNullable)||(x.isNullable=n.isNullable),i()(e.is_unique,n.isUnique)||(x.isUnique=n.isUnique),i()(d,n.isPrimaryKey)||(x.isPrimaryKey=n.isPrimaryKey),x},f=e=>{let t={};return 0===e.name.length&&(t.name="Please assign a name for your column"),0===e.format.length&&(t.format="Please select a type for your column"),t},g=(e,t,n)=>{let{relationships:a}=t,l=s()(a,t=>t.source_schema===e.schema&&t.source_table_name===e.table&&t.source_column_name===e.name);if(void 0===l)return l;{var i,r;let e=n.find(e=>e.id===l.id);return{...l,deletion_action:null!==(i=null==e?void 0:e.deletion_action)&&void 0!==i?i:c.N.NO_ACTION,update_action:null!==(r=null==e?void 0:e.update_action)&&void 0!==r?r:c.N.NO_ACTION}}},j=e=>e?e.replaceAll("[","{").replaceAll("]","}"):null,v=e=>{switch(e){case c.N.CASCADE:return"Cascade";case c.N.RESTRICT:return"Restrict";case c.N.SET_DEFAULT:return"Set default";case c.N.SET_NULL:return"Set NULL";default:return}}},47835:function(e,t,n){"use strict";n.d(t,{Z:function(){return _}});var a=n(52322),s=n(24990),l=n(34291),i=n.n(l),r=n(39097),o=n.n(r),c=n(29078),d=n(3490);n(2784);var u=n(26445),m=n(83036),h=function(e){return(0,a.jsx)(m.Z,{icon:u.Z,...e})},x=n(99311),p=function(e){return(0,a.jsx)(m.Z,{icon:x.Z,...e})},f=n(38296),g=n(31840),j=n(55380),v=n(66513),b=n(27792),y=n(39127),N=n(84904),w=n(34876),_=e=>{var t,n,l,r;let{value:u,enumTypes:m=[],className:x,size:_="medium",layout:C,error:S,disabled:k=!1,showLabel:E=!0,description:Z,showRecommendation:T=!1,onOptionSelect:R=i()}=e,z=N.DL.concat(m.map(e=>e.name)),A=!u||z.includes(u),P=N.VP[u],L=e=>{switch(e){case"number":return(0,a.jsx)(c.Z,{size:16,className:"text-foreground",strokeWidth:1.5});case"time":return(0,a.jsx)(d.Z,{size:16,className:"text-foreground",strokeWidth:1.5});case"text":return(0,a.jsx)(h,{size:16,className:"text-foreground",strokeWidth:1.5});case"json":return(0,a.jsx)("div",{className:"text-foreground",style:{padding:"0px 1px"},children:"{ }"});case"bool":return(0,a.jsx)(p,{size:16,className:"text-foreground",strokeWidth:1.5});default:return(0,a.jsx)(f.Z,{size:16,className:"text-foreground p-0.5",strokeWidth:1.5})}};return A?k&&!E?(0,a.jsxs)(s.fC,{delayDuration:0,children:[(0,a.jsx)(s.xz,{children:(0,a.jsx)(g.Z,{readOnly:!0,disabled:!0,label:E?"Type":"",layout:E?"horizontal":void 0,className:"md:gap-x-0",size:"small",icon:L(null!==(r=null===(l=N.N0.find(e=>e.name===u))||void 0===l?void 0:l.type)&&void 0!==r?r:""),value:u})}),!E&&Z&&(0,a.jsx)(s.h_,{children:(0,a.jsxs)(s.VY,{side:"bottom",children:[(0,a.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background w-[240px]",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:Z})})]})})]}):(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(j.Z,{label:E?"Type":"",layout:C||(E?"horizontal":"vertical"),value:u,size:_,error:S,disabled:k,descriptionText:Z,className:"".concat(x," ").concat(k?"column-type-disabled":""," rounded-md"),onChange:e=>R(e),optionsWidth:480,children:[(0,a.jsx)(j.Z.Option,{value:"",label:"---",children:"---"},"empty"),m.length>0?(0,a.jsx)(j.Z.Option,{disabled:!0,value:"header-1",label:"header-1",children:"Other Data Types"},"header-1"):(0,a.jsx)(a.Fragment,{}),m.length>0?m.map(e=>(0,a.jsx)(j.Z.Option,{value:e.name,label:e.name,addOnBefore:()=>(0,a.jsx)(w.Z,{size:16,className:"text-foreground",strokeWidth:1.5}),children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("p",{className:"text-foreground",children:e.name}),void 0!==e.comment&&(0,a.jsx)("p",{className:"text-foreground-lighter",children:e.comment})]})},e.name)):(0,a.jsx)(a.Fragment,{}),(0,a.jsx)(j.Z.Option,{disabled:!0,value:"header-2",label:"header-2",children:"PostgreSQL Data Types"}),N.N0.map(e=>(0,a.jsx)(j.Z.Option,{value:e.name,label:e.name,addOnBefore:()=>L(e.type),children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("span",{className:"text-foreground",children:e.name}),(0,a.jsx)("span",{className:"text-foreground-lighter",children:e.description})]})},e.name))]}),T&&void 0!==P&&(0,a.jsxs)(v.b,{withIcon:!0,variant:"warning",title:(0,a.jsxs)(a.Fragment,{children:["It is recommended to use ",(0,a.jsx)("code",{className:"text-xs",children:P.alternative})," ","instead"]}),children:[(0,a.jsxs)("p",{children:["Postgres recommends against using the data type ",(0,a.jsx)("code",{className:"text-xs",children:u})," ","unless you have a very specific use case."]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-3",children:[(0,a.jsx)(b.z,{asChild:!0,type:"default",icon:(0,a.jsx)(y.Z,{}),children:(0,a.jsx)(o(),{href:P.reference,target:"_blank",rel:"noreferrer",children:"Read more"})}),(0,a.jsxs)(b.z,{type:"primary",onClick:()=>R(P.alternative),children:["Use ",P.alternative]})]})]})]}):(0,a.jsxs)(s.fC,{delayDuration:0,children:[(0,a.jsx)(s.xz,{children:(0,a.jsx)(g.Z,{readOnly:!0,disabled:!0,label:E?"Type":"",layout:E?"horizontal":void 0,className:"md:gap-x-0",size:"small",icon:L(null!==(n=null===(t=N.N0.find(e=>e.name===u))||void 0===t?void 0:t.type)&&void 0!==n?n:""),value:u,descriptionText:E?"Custom non-native psql data types currently cannot be changed to a different data type via Supabase Studio":""})}),!E&&(0,a.jsx)(s.h_,{children:(0,a.jsxs)(s.VY,{side:"bottom",children:[(0,a.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background w-[240px]",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:"Custom non-native psql data types currently cannot be changed to a different data type via Supabase Studio"})})]})})]})}},84904:function(e,t,n){"use strict";n.d(t,{BB:function(){return c},DL:function(){return p},Ks:function(){return d},N0:function(){return g},VP:function(){return f},XO:function(){return m},YF:function(){return o},ji:function(){return r},lb:function(){return u},nA:function(){return h},vH:function(){return x}});var a=n(829),s=n.n(a),l=n(22487),i=n.n(l);let r=["int2","int4","int8","float4","float8","numeric","double precision"],o=["json","jsonb"],c=["text","varchar"],d=["timestamp","timestamptz"],u=["date"],m=["time","timetz"],h=i()(d,u,m),x=["uuid","bool","vector"],p=s()(i()(r,o,c,h,x)),f={varchar:{alternative:"text",reference:"https://wiki.postgresql.org/wiki/Don't_Do_This#Don.27t_use_varchar.28n.29_by_default"},json:{alternative:"jsonb",reference:"https://www.postgresql.org/docs/current/datatype-json.html"},timetz:{alternative:"timestamptz",reference:"https://wiki.postgresql.org/wiki/Don't_Do_This#Don.27t_use_timetz"},timestamp:{alternative:"timestamptz",reference:"https://wiki.postgresql.org/wiki/Don't_Do_This#Don.27t_use_timestamp_.28without_time_zone.29"}},g=[{name:"int2",description:"Signed two-byte integer",type:"number"},{name:"int4",description:"Signed four-byte integer",type:"number"},{name:"int8",description:"Signed eight-byte integer",type:"number"},{name:"float4",description:"Single precision floating-point number (4 bytes)",type:"number"},{name:"float8",description:"Double precision floating-point number (8 bytes)",type:"number"},{name:"numeric",description:"Exact numeric of selectable precision",type:"number"},{name:"json",description:"Textual JSON data",type:"json"},{name:"jsonb",description:"Binary JSON data, decomposed",type:"json"},{name:"text",description:"Variable-length character string",type:"text"},{name:"varchar",description:"Variable-length character string",type:"text"},{name:"uuid",description:"Universally unique identifier",type:"text"},{name:"date",description:"Calendar date (year, month, day)",type:"time"},{name:"time",description:"Time of day (no time zone)",type:"time"},{name:"timetz",description:"Time of day, including time zone",type:"time"},{name:"timestamp",description:"Date and time (no time zone)",type:"time"},{name:"timestamptz",description:"Date and time, including time zone",type:"time"},{name:"bool",description:"Logical boolean (true/false)",type:"bool"}]},64343:function(e,t,n){"use strict";n.d(t,{ub:function(){return aZ},l5:function(){return tZ},mM:function(){return aS}});var a,s,l=n(52322),i=n(59491),r=n(85945),o=n(55281),c=n.n(o),d=n(84336),u=n.n(d),m=n(5632),h=n(62202),x=n(24459),p=n(25424),f=n(27086),g=n(83314),j=n(9575),v=n(11214),b=n(33063),y=n(88719),N=n(69786),w=n(48228),_=n(58686),C=n(64308),S=n(50412);async function k(e){let{projectRef:t,connectionString:n,table:a,payload:s,configuration:l,enumArrayColumns:i,returning:r,impersonatedRole:o}=e,c=(0,C.Jh)(function(e){var t;let{table:n,configuration:a,payload:s,returning:l=!1,enumArrayColumns:i}=e;return new p.AE().from(n.name,null!==(t=n.schema)&&void 0!==t?t:void 0).update(s,{returning:l,enumArrayColumns:i}).match(a.identifiers).toSql()}({table:a,configuration:l,payload:s,enumArrayColumns:i,returning:r}),{projectRef:t,role:o}),{result:d}=await (0,_.Rj)({projectRef:t,connectionString:n,sql:c,isRoleImpersonationEnabled:(0,S.Gm)(o)});return d}let E=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,r.NL)();return(0,w.D)(e=>k(e),{async onSuccess(t,n,s){let{projectRef:l,table:i}=n;await a.invalidateQueries(N.M.query(l,[i.schema,i.name])),await (null==e?void 0:e(t,n,s))},async onError(e,n,a){void 0===t?h.Am.error("Failed to update table row: ".concat(e.message)):t(e,n,a)},...n})};var Z=n(13096),T=n(83179),R=n(99962),z=n(37185),A=n(73579),P=n(24990),L=n(34457),I=n(69171),D=n(99354),F=n(39097),O=n.n(F),q=n(2784),W=n(27792),U=n(26120),V=n(18902),M=n(83033),B=n(70245),K=n(43449),Y=n(985),Q=n(25808),H=n(1877),G=n(23906),X=e=>{var t;let{table:n,isViewSelected:a,isTableSelected:s}=e,{ref:r}=(0,x.UO)(),{project:o}=(0,g.d2)(),c=(0,Z.N3)("realtime:all"),d=R.F.includes(n.schema),{mutate:u}=(0,H.V)({onError:e=>{h.ZP.error("Failed to toggle RLS: ".concat(e.message))},onSettled:()=>{$()}}),[m,p]=(0,q.useState)(!1),[f,j]=(0,q.useState)(!1),[v,b]=(0,q.useState)(!1),y=null==o?void 0:o.ref,{data:N}=(0,K.r)({projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString}),w=(null!=N?N:[]).filter(e=>e.schema===n.schema&&e.table===n.name),{data:_}=(0,Y.z)({projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString}),C=(null!=_?_:[]).find(e=>"supabase_realtime"===e.name),S=null!==(t=null==C?void 0:C.tables)&&void 0!==t?t:[],k=S.some(e=>e.id===(null==n?void 0:n.id)),{mutate:E,isLoading:T}=(0,Q.u)({onSuccess:()=>{p(!1)},onError:e=>{h.ZP.error("Failed to toggle realtime for ".concat(n.name,": ").concat(e.message))}}),z=(0,Z.Xo)(i.KA.TENANT_SQL_ADMIN_WRITE,"tables"),A=(0,Z.Xo)(i.KA.TENANT_SQL_ADMIN_WRITE,"columns"),F="public"===n.schema,X=async()=>{if(!o)return console.error("Project is required");if(!C)return console.error("Unable to find realtime publication");let e=S.some(e=>e.id==n.id)?S.filter(e=>e.id!=n.id).map(e=>"".concat(e.schema,".").concat(e.name)):["".concat(n.schema,".").concat(n.name)].concat(S.map(e=>"".concat(e.schema,".").concat(e.name)));E({projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString,id:C.id,tables:e})},$=()=>{b(!1)},J=async()=>{let e={id:n.id,rls_enabled:!n.rls_enabled};u({projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString,id:e.id,schema:n.schema,payload:e})};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[!z&&!A&&(0,l.jsxs)(P.fC,{delayDuration:0,children:[(0,l.jsx)(P.xz,{className:"w-full",children:(0,l.jsx)("div",{className:"border border-strong rounded bg-overlay-hover px-3 py-1 text-xs",children:"Viewing as read-only"})}),(0,l.jsx)(P.h_,{children:(0,l.jsxs)(P.VY,{side:"bottom",children:[(0,l.jsx)(P.Eh,{className:"radix-tooltip-arrow"}),(0,l.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,l.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to manage your project's data"})})]})})]}),s?n.rls_enabled?(0,l.jsx)(l.Fragment,{children:w.length<1&&!d?(0,l.jsxs)(P.fC,{delayDuration:0,children:[(0,l.jsx)(P.xz,{asChild:!0,className:"w-full",children:(0,l.jsx)(W.z,{asChild:!0,type:"default",className:"group",icon:(0,l.jsx)(L.Z,{strokeWidth:1.5,className:"text-foreground-muted"}),children:(0,l.jsx)(O(),{passHref:!0,href:"/project/".concat(y,"/auth/policies?search=").concat(n.id),children:"Add RLS policy"})})}),(0,l.jsx)(P.h_,{children:(0,l.jsxs)(P.VY,{side:"bottom",children:[(0,l.jsx)(P.Eh,{className:"radix-tooltip-arrow"}),(0,l.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,l.jsxs)("div",{className:"text-xs text-foreground p-1 leading-relaxed",children:[(0,l.jsx)("p",{children:"RLS is enabled for this table, but no policies are set. "}),(0,l.jsxs)("p",{children:["Select queries will return an ",(0,l.jsx)("u",{children:"empty array"})," of results."]})]})})]})})]}):(0,l.jsx)(W.z,{asChild:!0,type:w.length<1&&!d?"warning":"default",className:"group",icon:d||w.length>0?(0,l.jsx)("span",{className:"text-right text-xs rounded-xl px-[6px] bg-foreground-lighter/30 text-brand-1100",children:w.length}):(0,l.jsx)(L.Z,{strokeWidth:1.5}),children:(0,l.jsxs)(O(),{passHref:!0,href:"/project/".concat(y,"/auth/policies?search=").concat(n.id),children:["Auth ",w.length>1?"policies":"policy"]})})}):(0,l.jsxs)(U.J2,{open:f,onOpenChange:()=>j(!f),modal:!1,children:[(0,l.jsx)(U.xo,{asChild:!0,children:(0,l.jsx)(W.z,{type:"warning",icon:(0,l.jsx)(I.Z,{strokeWidth:1.5}),children:"RLS disabled"})}),(0,l.jsxs)(U.yk,{className:"min-w-[395px] text-sm",align:"end",children:[(0,l.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,l.jsx)(I.Z,{size:16})," Row Level Security (RLS)"]}),(0,l.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,l.jsx)("p",{children:"You can restrict and control who can read, write and update data in this table using Row Level Security."}),(0,l.jsx)("p",{children:"With RLS enabled, anonymous users will not be able to read/write data in the table."}),!d&&(0,l.jsx)("div",{className:"mt-2",children:(0,l.jsx)(W.z,{type:"default",onClick:()=>b(!v),children:"Enable RLS for this table"})})]})]})]}):null,(0,l.jsx)(G.Q,{serviceRoleLabel:"postgres"}),c&&!a&&(0,l.jsxs)(W.z,{type:"default",icon:(0,l.jsx)(D.Z,{strokeWidth:1.5,className:k?"text-brand":"text-foreground-muted"}),onClick:()=>p(!0),children:["Realtime ",k?"on":"off"]}),F&&(0,l.jsx)(V.Z,{section:["entities",n.name]})]}),(0,l.jsx)(M.Z,{visible:m,loading:T,title:"".concat(k?"Disable":"Enable"," realtime for ").concat(n.name),confirmLabel:"".concat(k?"Disable":"Enable"," realtime"),confirmLabelLoading:"".concat(k?"Disabling":"Enabling"," realtime"),onCancel:()=>p(!1),onConfirm:()=>X(),children:(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("p",{className:"text-sm",children:["Once realtime has been ",k?"disabled":"enabled",", the table will"," ",k?"no longer ":"","broadcast any changes to authorized subscribers."]}),!k&&(0,l.jsxs)("p",{className:"text-sm",children:["You may also select which events to broadcast to subscribers on the"," ",(0,l.jsx)(O(),{href:"/project/".concat(r,"/database/replication"),className:"text-brand",children:"database replication"})," ","settings."]})]})}),(0,l.jsx)(B.Z,{danger:n.rls_enabled,visible:v,title:"Confirm to enable Row Level Security",description:"Are you sure you want to enable Row Level Security for this table?",buttonLabel:"Enable RLS",buttonLoadingLabel:"Updating",onSelectCancel:$,onSelectConfirm:J})]})},$=n(98938),J=n(98263),ee=e=>{let{id:t}=e;return(0,l.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,l.jsx)("div",{className:"w-[400px]",children:(0,l.jsx)(J.Z,{icon:(0,l.jsx)($.Z,{strokeWidth:2}),title:"Unable to find your table with ID ".concat(t)})})})},et=n(45455),en=n.n(et),ea=n(34291),es=n.n(ea),el=n(10586),ei=n(49422),er=n(78464);async function eo(e){let{projectRef:t,connectionString:n,name:a,tables:s=[],publish_insert:l=!1,publish_update:i=!1,publish_delete:r=!1,publish_truncate:o=!1}=e,c=new Headers;n&&c.set("x-connection-encrypted",n);let{data:d,error:u}=await (0,ei.v_)("/platform/pg-meta/{ref}/publications",{params:{header:{"x-connection-encrypted":n},path:{ref:t}},body:{name:a,tables:s,publish_insert:l,publish_update:i,publish_delete:r,publish_truncate:o},headers:c});if(u)throw u;return d}let ec=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,r.NL)();return(0,w.D)(e=>eo(e),{async onSuccess(t,n,s){let{projectRef:l}=n;await a.invalidateQueries(er.z.list(l)),await (null==e?void 0:e(t,n,s))},async onError(e,n,a){void 0===t?h.Am.error("Failed to create database publication: ".concat(e.message)):t(e,n,a)},...n})};var ed=n(66694);async function eu(e){let{projectRef:t,connectionString:n,table:a,payload:s,enumArrayColumns:l,returning:i,impersonatedRole:r}=e,o=(0,C.Jh)(function(e){var t;let{table:n,payload:a,returning:s=!1,enumArrayColumns:l}=e;return new p.AE().from(n.name,null!==(t=n.schema)&&void 0!==t?t:void 0).insert([a],{returning:s,enumArrayColumns:l}).toSql()}({table:a,payload:s,enumArrayColumns:l,returning:i}),{projectRef:t,role:r}),{result:c}=await (0,_.Rj)({projectRef:t,connectionString:n,sql:o,isRoleImpersonationEnabled:(0,S.Gm)(r)});return c}let em=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,r.NL)();return(0,w.D)(e=>eu(e),{async onSuccess(t,n,s){let{projectRef:l,table:i}=n;await a.invalidateQueries(N.M.query(l,[i.schema,i.name])),await (null==e?void 0:e(t,n,s))},async onError(e,n,a){void 0===t?h.Am.error(e.message):t(e,n,a)},...n})};var eh=n(35618),ex=n(36554),ep=n(28846),ef=n(52797),eg=n(17414),ej=n(79378),ev=n(14670),eb=n(32483),ey=n(54563),eN=n(8243),ew=n(43712),e_=n(44294),eC=n(59329),eS=n(93586),ek=n.n(eS),eE=n(18149),eZ=n.n(eE),eT=n(90286),eR=n.n(eT),ez=n(99314),eA=n(87831);async function eP(e){let{projectRef:t,connectionString:n,payload:a}=e,s=new Headers;n&&s.set("x-connection-encrypted",n);let{data:l,error:i}=await (0,ei.v_)("/platform/pg-meta/{ref}/columns",{params:{header:{"x-connection-encrypted":n},path:{ref:t}},body:a,headers:s});if(i)throw i;return l}var eL=n(44109);async function eI(e){let{projectRef:t,connectionString:n,id:a,payload:s}=e,l=new Headers;n&&l.set("x-connection-encrypted",n);let{data:i,error:r}=await (0,ei.r$)("/platform/pg-meta/{ref}/columns",{params:{header:{"x-connection-encrypted":n},path:{ref:t},query:{id:a}},body:s,headers:l});if(r)throw r;return i}var eD=n(32735);async function eF(e){let{projectRef:t,connectionString:n,payload:a}=e,s=new Headers;n&&s.set("x-connection-encrypted",n);let{data:l,error:i}=await (0,ei.v_)("/platform/pg-meta/{ref}/tables",{params:{header:{"x-connection-encrypted":n},path:{ref:t}},body:a,headers:s});return i&&(0,ei.S3)(i),l}var eO=n(46198);async function eq(e,t){let{projectRef:n,connectionString:a,schema:s}=e;if(!n)throw Error("projectRef is required");let l=new Headers;a&&l.set("x-connection-encrypted",a);let{data:i,error:r}=await (0,ei.U2)("/platform/pg-meta/{ref}/views",{params:{header:{"x-connection-encrypted":a},path:{ref:n},query:{included_schemas:s||""}},headers:l,signal:t});return r&&(0,ei.S3)(r),i}n(5392);var eW=n(5388),eU=n(29966);let eV=(e,t)=>{let n=t.columns.map(e=>e.source),a=t.columns.map(e=>e.target);return e.deletion_action!==t.deletionAction||e.update_action!==t.updateAction||e.target_schema!==t.schema||e.target_table!==t.table||!eZ()(e.source_columns,n)||!eZ()(e.target_columns,a)},eM=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;if(!a||!(await eq({projectRef:e,connectionString:t,schema:n})).find(e=>e.name==="decrypted_".concat(a)))return[];try{return(await (0,_.Rj)({projectRef:e,connectionString:t,sql:"SELECT column_name as name FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'decrypted_".concat(a,"' and column_name like 'decrypted_%'")})).result.map(e=>e.name.split("decrypted_")[1])}catch(e){return console.error("Error fetching encrypted columns",e),[]}};function eB(e){let{schemaName:t,tableName:n}=e,{project:a}=(0,g.d2)(),[s,l]=(0,q.useState)([]);return(0,q.useEffect)(()=>{let e=!0;return(async()=>{if(void 0!==t&&void 0!==n){let s=await eM(null==a?void 0:a.ref,null==a?void 0:a.connectionString,t,n);e&&l(s)}})(),()=>{e=!1}},[t,n]),s}let eK=async(e,t,n,a,s)=>{let l=s.join('","'),i='ALTER TABLE "'.concat(n,'"."').concat(a,'" ADD PRIMARY KEY ("').concat(l,'")');return await (0,_.Rj)({projectRef:e,connectionString:t,sql:i,queryKey:["primary-keys"]})},eY=async(e,t,n,a,s)=>{let l='ALTER TABLE "'.concat(n,'"."').concat(a,'" DROP CONSTRAINT "').concat(s,'"');return await (0,_.Rj)({projectRef:e,connectionString:t,sql:l,queryKey:["drop-constraint"]})},eQ=e=>{let{table:t,foreignKeys:n}=e,a=e=>e===v.N.CASCADE?"ON DELETE CASCADE":e===v.N.RESTRICT?"ON DELETE RESTRICT":e===v.N.SET_DEFAULT?"ON DELETE SET DEFAULT":e===v.N.SET_NULL?"ON DELETE SET NULL":"",s=e=>e===v.N.CASCADE?"ON UPDATE CASCADE":e===v.N.RESTRICT?"ON UPDATE RESTRICT":"";return n.map(e=>{let{deletionAction:n,updateAction:l}=e,i=a(n),r=s(l);return'\n      ALTER TABLE "'.concat(t.schema,'"."').concat(t.name,'"\n      ADD CONSTRAINT "').concat(t.schema,"_").concat(t.name,"_").concat(e.columns.map(e=>e.source).join("_"),'_fkey"\n      FOREIGN KEY (').concat(e.columns.map(e=>'"'.concat(e.source,'"')).join(","),')\n      REFERENCES "').concat(e.schema,'"."').concat(e.table,'" (').concat(e.columns.map(e=>'"'.concat(e.target,'"')).join(","),")\n      ").concat(r,"\n      ").concat(i,"\n    ").replace(/\s+/g," ").trim()}).join(";")+";"},eH=async e=>{let{projectRef:t,connectionString:n,table:a,foreignKeys:s}=e,l=eQ({table:a,foreignKeys:s});return await (0,_.Rj)({projectRef:t,connectionString:n,sql:l,queryKey:["foreign-keys"]})},eG=e=>{let{table:t,foreignKeys:n}=e;return n.map(e=>'\nALTER TABLE IF EXISTS "'.concat(t.schema,'"."').concat(t.name,'"\nDROP CONSTRAINT IF EXISTS "').concat(e.name,'"\n').replace(/\s+/g," ").trim()).join(";")+";"},eX=async e=>{let{projectRef:t,connectionString:n,table:a,foreignKeys:s}=e,l=eG({table:a,foreignKeys:s});return await (0,_.Rj)({projectRef:t,connectionString:n,sql:l,queryKey:["foreign-keys"]})},e$=async e=>{let{projectRef:t,connectionString:n,table:a,foreignKeys:s}=e,l="\n  ".concat(eG({table:a,foreignKeys:s}),"\n  ").concat(eQ({table:a,foreignKeys:s}),"\n  ").replace(/\s+/g," ").trim();return await (0,_.Rj)({projectRef:t,connectionString:n,sql:l,queryKey:["foreign-keys"]})},eJ=async e=>{let{projectRef:t,connectionString:n,payload:a,selectedTable:s,primaryKey:l,foreignKeyRelations:i=[]}=e,r=h.ZP.loading('Creating column "'.concat(a.name,'"...'));try{let{isPrimaryKey:e,...o}=a,c=await eP({projectRef:t,connectionString:n,payload:o});if(e){h.ZP.loading("Assigning primary key to column...",{id:r});let e=s.primary_keys.map(e=>e.name);e.length>0&&void 0!==l&&await eY(t,n,c.schema,c.table,l.name);let a=e.concat([c.name]);await eK(t,n,c.schema,c.table,a)}i.length>0&&await eH({projectRef:t,connectionString:n,table:{schema:c.schema,name:c.table},foreignKeys:i}),h.ZP.success('Successfully created column "'.concat(c.name,'"'),{id:r})}catch(e){return h.ZP.error('An error occurred while creating the column "'.concat(a.name,'"'),{id:r}),{error:e}}},e0=async e=>{let{projectRef:t,connectionString:n,id:a,payload:s,selectedTable:l,primaryKey:i,foreignKeyRelations:r=[],existingForeignKeyRelations:o=[],skipPKCreation:c,skipSuccessMessage:d=!1}=e;try{let{isPrimaryKey:e,...u}=s,m=await eI({projectRef:t,connectionString:n,id:a,payload:u});if(!c&&void 0!==e){let a=l.primary_keys.map(e=>e.name);a.length>0&&void 0!==i&&await eY(t,n,m.schema,m.table,i.name);let s=e?a.concat([m.name]):a.filter(e=>e!==m.name);s.length&&await eK(t,n,m.schema,m.table,s)}r.length>0&&await e8({projectRef:t,connectionString:n,table:{schema:m.schema,name:m.table},foreignKeys:r,existingForeignKeyRelations:o}),d||h.ZP.success('Successfully updated column "'.concat(m.name,'"'))}catch(e){return{error:e}}},e1=async(e,t,n,a)=>{let s=(0,eD.g)(),{duplicateTable:l,isRLSEnabled:i,isDuplicateRows:r,foreignKeyRelations:o}=a,{name:d,schema:u}=l,m=n.name;if(await (0,_.Rj)({projectRef:e,connectionString:t,sql:['CREATE TABLE "'.concat(u,'"."').concat(m,'" (LIKE "').concat(u,'"."').concat(d,'" INCLUDING ALL);'),void 0!==n.comment?'comment on table "'.concat(u,'"."').concat(m,"\" is '").concat(n.comment,"';"):""].join("\n")}),await s.invalidateQueries(eh.W.list(e,u)),o.length>0&&await eH({projectRef:e,connectionString:t,table:{...l,name:n.name},foreignKeys:o}),r){var h;await (0,_.Rj)({projectRef:e,connectionString:t,sql:'INSERT INTO "'.concat(u,'"."').concat(m,'" SELECT * FROM "').concat(u,'"."').concat(d,'";')}),(null!==(h=l.columns)&&void 0!==h?h:[]).filter(e=>null!==e.identity_generation).map(async n=>{await (0,_.Rj)({projectRef:e,connectionString:t,sql:"SELECT setval('\"".concat(u,'"."').concat(m,"_").concat(n.name,'_seq"\', (SELECT MAX("').concat(n.name,'") FROM "').concat(u,'"."').concat(d,'"));')})})}let x=await s.fetchQuery({queryKey:eh.W.list(e,u),queryFn:n=>{let{signal:a}=n;return(0,ex.Lk)({projectRef:e,connectionString:t,schema:u},a)}}),p=c()(x,{schema:u,name:m});return i&&await (0,H.T)({projectRef:e,connectionString:t,id:null==p?void 0:p.id,schema:null==p?void 0:p.schema,payload:{rls_enabled:i}}),p},e2=async e=>{let{projectRef:t,connectionString:n,toastId:a,payload:s,columns:i=[],foreignKeyRelations:r,isRLSEnabled:o,importContent:c}=e,d=await eF({projectRef:t,connectionString:n,payload:s});try{for(let e of(o&&await (0,H.T)({projectRef:t,connectionString:n,id:d.id,schema:d.schema,payload:{rls_enabled:o}}),h.ZP.loading("Adding ".concat(i.length," columns to ").concat(d.name,"..."),{id:a}),i)){let a=(0,eU.oo)(d.id,{...e,isPrimaryKey:!1});await eP({projectRef:t,connectionString:n,payload:a})}let e=i.filter(e=>e.isPrimaryKey).map(e=>e.name);if(e.length>0&&await eK(t,n,d.schema,d.name,e),r.length>0&&await eH({projectRef:t,connectionString:n,table:{schema:d.schema,name:d.name},foreignKeys:r}),void 0!==c){if(c.file&&c.rowCount>0){let{error:e}=await e3(t,n,c.file,d,c.selectedHeaders,e=>{h.ZP.loading((0,l.jsx)("div",{className:"flex flex-col space-y-2",style:{minWidth:"220px"},children:(0,l.jsx)(eA.Z,{value:e,max:100,type:"horizontal",barClass:"bg-brand",labelBottom:"Adding ".concat(c.rowCount.toLocaleString()," rows to ").concat(d.name),labelBottomClass:"",labelTop:"".concat(e.toFixed(2),"%"),labelTopClass:"tabular-nums"})}),{id:a})});for(let e of i.filter(e=>e.isIdentity))await (0,_.Rj)({projectRef:t,connectionString:n,sql:"SELECT setval('".concat(d.name,"_").concat(e.name,"_seq', (SELECT MAX(\"").concat(e.name,'") FROM "').concat(d.name,'"));')});if(void 0!==e){h.ZP.error("Do check your spreadsheet if there are any discrepancies.");let t="Table ".concat(d.name," has been created but we ran into an error while inserting rows: ").concat(e.message);h.ZP.error(t),console.error("Error:",{error:e,message:t})}}else for(let e of(await e5(t,n,d,c.rows,c.selectedHeaders,e=>{h.ZP.loading((0,l.jsx)("div",{className:"flex flex-col space-y-2",style:{minWidth:"220px"},children:(0,l.jsx)(eA.Z,{value:e,max:100,type:"horizontal",barClass:"bg-brand",labelBottom:"Adding ".concat(c.rows.length.toLocaleString()," rows to ").concat(d.name),labelBottomClass:"",labelTop:"".concat(e.toFixed(2),"%"),labelTopClass:"tabular-nums"})}),{id:a})}),i.filter(e=>e.isIdentity)))await (0,_.Rj)({projectRef:t,connectionString:n,sql:"SELECT setval('".concat(d.name,"_").concat(e.name,"_seq', (SELECT MAX(\"").concat(e.name,'") FROM "').concat(d.name,'"));')})}return d}catch(e){throw(0,eO.W)({projectRef:t,connectionString:n,id:d.id,schema:d.schema}),e}},e4=async e=>{var t;let{projectRef:n,connectionString:a,toastId:s,table:l,payload:i,columns:r,foreignKeyRelations:o,existingForeignKeyRelations:d,primaryKey:u}=e,m=r.filter(e=>e.isPrimaryKey).map(e=>e.name),x=l.primary_keys.map(e=>e.name),p=!eZ()(m,x);p&&void 0!==u&&await eY(n,a,l.schema,l.name,u.name);let f=await (0,H.T)({projectRef:n,connectionString:a,id:l.id,schema:l.schema,payload:i}),g=null!==(t=l.columns)&&void 0!==t?t:[],j=r.map(e=>e.id);for(let e of g.filter(e=>!j.includes(e.id)))h.ZP.loading("Removing column ".concat(e.name," from ").concat(f.name),{id:s}),await (0,eL.p)({projectRef:n,connectionString:a,id:e.id});let v=!1;for(let e of r)if(e.id.includes(l.id.toString())){let t=c()(g,{id:e.id});if(t){let l=(0,eU.xY)(t,f,e);if(!en()(l)){h.ZP.loading("Updating column ".concat(e.name," from ").concat(f.name),{id:s});let t=await e0({projectRef:n,connectionString:a,id:e.id,payload:l,selectedTable:f,skipPKCreation:!0,skipSuccessMessage:!0});(null==t?void 0:t.error)&&(v=!0,h.ZP.error('Failed to update column "'.concat(e.name,'": ').concat(t.error.message)))}}}else{h.ZP.loading("Adding column ".concat(e.name," to ").concat(f.name),{id:s});let t=(0,eU.oo)(f.id,{...e,isPrimaryKey:!1});await eJ({projectRef:n,connectionString:a,payload:t,selectedTable:f})}p&&m.length>0&&await eK(n,a,f.schema,f.name,m),await e8({projectRef:n,connectionString:a,table:f,foreignKeys:o,existingForeignKeyRelations:d});let b=(0,eD.g)();return await Promise.all([b.invalidateQueries(N.M.query(n,["foreign-key-constraints"])),b.invalidateQueries(["projects",n,"tables"]),b.invalidateQueries(N.M.query(n,[l.schema,l.name])),b.invalidateQueries(N.M.query(n,["table-definition",l.schema,l.name])),b.invalidateQueries(ed.C.list(n))]),{table:await (0,e_.hC)({projectRef:n,connectionString:a,id:l.id}),hasError:v}},e3=async(e,t,n,a,s,l)=>{let i,r=0,o=new Date;return new Promise(c=>{eR().parse(n,{header:!0,dynamicTyping:!1,skipEmptyLines:!0,chunkSize:104857.6,quoteChar:"text/tab-separated-values"===n.type?"":'"',chunk:async(o,c)=>{c.pause();let d=o.data.map(e=>{let t={};return s.forEach(n=>{var s,l,i;let r=null===(s=a.columns)||void 0===s?void 0:s.find(e=>e.name===n);(null!==(l=null==r?void 0:r.data_type)&&void 0!==l?l:"")==="ARRAY"||(null!==(i=null==r?void 0:r.format)&&void 0!==i?i:"").includes("json")?t[n]=(0,eW.dW)(e[n]):""===e[n]?t[n]=(null==r?void 0:r.is_nullable)?null:"":t[n]=e[n]}),t}),u=new ez.A().from(a.name,a.schema).insert(d).toSql();try{await (0,_.Rj)({projectRef:e,connectionString:t,sql:u})}catch(e){console.warn(e),i=e,c.abort()}let m=104857.6*(r+=1)/n.size;l(m>1?100:100*m),c.resume()},complete:()=>{let e=new Date;console.log("Total time taken for importing spreadsheet: ".concat((e-o)/1e3," seconds")),c({error:i})}})})},e5=async(e,t,n,a,s,l)=>{let i;let r=0,o=a.map(e=>{let t={};return s.forEach(a=>{var s,l,i;let r=null===(s=n.columns)||void 0===s?void 0:s.find(e=>e.name===a);(null!==(l=null==r?void 0:r.data_type)&&void 0!==l?l:"")==="ARRAY"||(null!==(i=null==r?void 0:r.format)&&void 0!==i?i:"").includes("json")?t[a]=(0,eW.dW)(e[a]):""===e[a]?t[a]=(null==r?void 0:r.is_nullable)?null:"":t[a]=e[a]}),t}),d=ek()(o,1e3).map(s=>()=>Promise.race([new Promise(async(l,o)=>{let c=new ez.A().from(n.name,n.schema).insert(s).toSql();try{await (0,_.Rj)({projectRef:e,connectionString:t,sql:c})}catch(e){i=e,o(e)}r+=s.length/a.length,l({})}),(0,eW.Vs)(3e4)]));for(let e of ek()(d,10)){let t=await Promise.allSettled(e.map(e=>e()));if(c()(t,{status:"rejected"}))break;l(100*r)}return{error:i}},e8=async e=>{let{projectRef:t,connectionString:n,table:a,foreignKeys:s,existingForeignKeyRelations:l}=e,i=s.filter(e=>"string"==typeof e.id);i.length>0&&await eH({projectRef:t,connectionString:n,table:a,foreignKeys:i});let r=s.filter(e=>e.toRemove);r.length>0&&await eX({projectRef:t,connectionString:n,table:a,foreignKeys:r});let o=s.filter(e=>"number"==typeof e.id&&!e.toRemove).filter(e=>{let t=l.find(t=>e.id===t.id);return void 0!==t&&eV(t,e)});o.length>0&&await e$({projectRef:t,connectionString:n,table:a,foreignKeys:o})};var e6=n(17318),e9=n(64112),e7=e=>{let{page:t,setPage:n,rowsPerPage:a,currentPageRowsCount:s=0,isLoading:i=!1}=e;return(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[i&&(0,l.jsx)(ej.Z,{size:14,className:"animate-spin"}),(0,l.jsx)(W.z,{icon:(0,l.jsx)(e6.Z,{}),type:"outline",disabled:t<=1||i,onClick:()=>{n(e=>e-1)},title:"Previous Page",style:{padding:"3px 10px"}}),(0,l.jsx)(W.z,{icon:(0,l.jsx)(e9.Z,{}),type:"outline",disabled:s<a||i,onClick:()=>{n(e=>e+1)},title:"Next Page",style:{padding:"3px 10px"}})]})},te=n(32999),tt=n(47370),tn=n(42004);let ta=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,l.jsxs)("div",{className:"flex h-full items-center justify-center gap-2",children:[t&&(0,l.jsxs)(P.fC,{delayDuration:0,children:[(0,l.jsx)(P.xz,{children:(0,l.jsx)("div",{className:"text-brand",children:(0,l.jsx)(tn.Z,{size:"tiny",strokeWidth:2})})}),(0,l.jsx)(P.h_,{children:(0,l.jsxs)(P.VY,{side:"bottom",children:[(0,l.jsx)(P.Eh,{className:"radix-tooltip-arrow"}),(0,l.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,l.jsx)("span",{className:"text-xs text-foreground",children:"Primary key"})})]})})]}),(0,l.jsx)("span",{className:"sb-grid-column-header__inner__name",children:e})]})},ts=(e,t)=>{let n="object"==typeof t[e]?JSON.stringify(t[e]):t[e];return(0,l.jsx)("div",{className:"group sb-grid-select-cell__formatter overflow-hidden",children:(0,l.jsx)("span",{className:"text-sm truncate",children:n})})};var tl=e=>{let{table:t,rows:n,onRowSelect:a}=e,s=t.columns.map(e=>{let t=(0,te.ve)(e),n=(e.name.length+e.format.length)*te.i1;return{key:e.name,name:e.name,renderCell:t=>ts(e.name,t.row),renderHeaderCell:()=>ta(e.name,e.isPrimaryKey),resizable:!0,width:t<n?n:t,minWidth:f.mr}});return(0,l.jsx)(tt.ZP,{columns:s,rows:n,style:{height:"100%"},onCellClick:e=>a(e.row),rowClass:()=>"cursor-pointer"})},ti=e=>{var t,n,a,s,i,r;let{visible:o,foreignKey:c,onSelect:d,closePanel:u}=e,{project:m}=(0,g.d2)(),{target_id:h,target_schema:x,target_table:f,target_columns:j}=null!=c?c:{},v=h?Number(h):void 0,{data:b}=(0,e_.yp)({projectRef:null==m?void 0:m.ref,connectionString:null==m?void 0:m.connectionString,id:v}),y=eB({schemaName:x,tableName:f}),N=b&&(0,p.NK)({table:b,columns:null!==(t=b.columns)&&void 0!==t?t:[],primaryKeys:b.primary_keys,relationships:b.relationships},y),[w,_]=(0,q.useState)({filter:[],sort:[]}),C=(0,ev.rg)(null!==(n=w.sort)&&void 0!==n?n:[]),k=(0,ev.Yb)(null!==(a=w.filter)&&void 0!==a?a:[]),[E,Z]=(0,q.useState)(1),T=(0,S.fN)(),{data:R,isLoading:z,isSuccess:A,isError:P,isRefetching:L}=(0,ew.KK)({queryKey:[x,f],projectRef:null==m?void 0:m.ref,connectionString:null==m?void 0:m.connectionString,table:N,sorts:C,filters:k,page:E,limit:100,impersonatedRole:T.role},{keepPreviousData:!0});return(0,l.jsx)(eg.ZP,{visible:o,size:"large",header:(0,l.jsxs)("div",{children:["Select a record to reference from"," ",(0,l.jsxs)("code",{className:"font-mono text-sm",children:[x,".",f]})]}),onCancel:u,customFooter:(0,l.jsx)(eC.Z,{hideApply:!0,backButtonLabel:"Cancel",closePanel:u}),children:(0,l.jsx)(eg.ZP.Content,{className:"h-full !px-0",children:(0,l.jsxs)("div",{className:"h-full",children:[z&&(0,l.jsxs)("div",{className:"flex h-full py-6 flex-col items-center justify-center space-y-2",children:[(0,l.jsx)(ej.Z,{className:"animate-spin"}),(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:"Loading rows"})]}),P&&(0,l.jsx)("div",{className:"flex h-full py-6 flex-col items-center justify-center",children:(0,l.jsxs)("p",{className:"text-sm text-foreground-light",children:["Unable to load rows from"," ",(0,l.jsxs)("code",{children:[x,".",f]}),". Please try again or contact support."]})}),A&&N&&(0,l.jsxs)("div",{className:"h-full flex flex-col",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between my-2 mx-3",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(eb.Z,{table:N,isRefetching:L}),(0,l.jsx)(ey.E,{table:N,filters:null!==(s=w.filter)&&void 0!==s?s:[],setParams:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];E>1&&Z(1),_(...t)}}),(0,l.jsx)(ep.W,{backend:ef.PD,context:window,children:(0,l.jsx)(eN.f,{table:N,sorts:null!==(i=w.sort)&&void 0!==i?i:[],setParams:_})})]}),(0,l.jsx)(e7,{page:E,setPage:Z,rowsPerPage:100,currentPageRowsCount:null!==(r=null==R?void 0:R.rows.length)&&void 0!==r?r:0,isLoading:L})]}),R.rows.length>0?(0,l.jsx)(tl,{table:N,rows:R.rows,onRowSelect:e=>{var t;return d(e[null!==(t=null==j?void 0:j[0])&&void 0!==t?t:""])}}):(0,l.jsx)("div",{className:"flex h-full items-center justify-center border-b border-t border-default",children:(0,l.jsx)("span",{className:"text-foreground-light text-sm",children:"No Rows Found"})})]})]})})})},tr=n(64606),to=n(56009),tc=n(56974),td=n.n(tc),tu=n(79728),tm=n(31231),th=e=>{let{breadcrumbs:t=[],resetBreadcrumbs:n,onSelectBreadcrumb:a}=e;return(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(tu.Z,{size:16,strokeWidth:2,onClick:()=>n(),className:"cursor-pointer"}),t.length>0&&t.map(e=>(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(tm.Z,{size:16,strokeWidth:2}),e===td()(t)?(0,l.jsx)("p",{className:"font-mono text-xs",children:e}):(0,l.jsx)("p",{className:"font-mono text-xs",children:(0,l.jsx)("div",{className:"cursor-pointer",onClick:()=>a(t.slice(0,t.indexOf(e)+1)),children:e})})]},e))]})},tx=n(25877),tp=n.n(tx),tf=e=>{let{pane:t,jsonData:n,activeKey:a,onSelectKey:s=es()}=e;if(!n)return(0,l.jsx)("div",{className:"flex-1 ".concat(2===t?"border-l border-default":""),children:(0,l.jsx)("div",{className:"flex space-x-2 py-2 px-5",children:(0,l.jsx)("p",{className:"text-sm",children:"Invalid JSON"})})});if(0===Object.keys(n).length)return(0,l.jsx)("div",{className:"max-w-[50%] flex-1 ".concat(2===t?"border-l border-default":""),children:(0,l.jsx)("div",{className:"flex space-x-2 py-2 px-5",children:(0,l.jsx)("p",{className:"text-sm opacity-50",children:"No data available"})})});let i=Object.keys(n).filter(e=>"object"==typeof n[e]&&!tp()(n[e])),r=Object.keys(n).filter(e=>tp()(n[e])||"object"!=typeof n[e]);return(0,l.jsxs)("div",{className:"max-w-[50%] flex-1 ".concat(2===t?"border-l border-default":""),children:[i.map(e=>(0,l.jsxs)("div",{className:"\n              ".concat(e===a?"bg-surface-300":"","\n              group flex cursor-pointer items-center transition\n              justify-between py-2 px-5 hover:bg-surface-200\n            "),onClick:()=>s(e,t),children:[(0,l.jsx)("p",{className:"font-mono text-xs !text-blue-900",children:e}),(0,l.jsx)("div",{className:"".concat(e===a?"opacity-100":"opacity-50"," group-hover:opacity-100 transition"),children:(0,l.jsx)(tm.Z,{strokeWidth:2,size:16})})]},e)),r.map(e=>(0,l.jsxs)("div",{className:"flex space-x-2 py-2 px-5",children:[(0,l.jsxs)("p",{className:"font-mono text-xs !text-blue-900",children:[e,":"]}),(0,l.jsx)("p",{className:"break-all font-mono text-xs ".concat("string"!=typeof n[e]?"!text-green-900":"!text-yellow-900"),children:tp()(n[e])?"null":"string"==typeof n[e]?'"'.concat(n[e],'"'):n[e].toString()})]},e))]})},tg=e=>{let{jsonData:t={}}=e,[n,a]=(0,q.useState)(),[s,i]=(0,q.useState)([]),[r,o]=(0,q.useState)(t),[c,d]=(0,q.useState)({}),u=(e,t)=>{a(e);let n=s.slice();1===t&&(d(r[e]),en()(c)||n.pop(),n.push(e),i(n)),2===t&&(o(c),d(c[e]),n.push(e),i(n))};return(0,l.jsxs)("div",{className:"border border-x-0 border-t-0 border-muted",children:[(0,l.jsx)("div",{className:"h-10 px-3 flex-initial flex items-center justify-between",children:(0,l.jsx)(th,{breadcrumbs:s,onSelectBreadcrumb:e=>{let n=td()(e)||"";a(n);let l={...t};if(i(s.slice(0,s.indexOf(n)+1)),null===e)o(l),d({});else if(1===e.length)o(l),d(t[s[0]]);else{for(let t of e)l=l[t],e.indexOf(t)===e.length-2&&o(l);d(l)}},resetBreadcrumbs:()=>{a(void 0),i([]),o(t),d({})}})}),(0,l.jsxs)("div",{className:"flex items-stretch flex-auto justify-between border-t border-muted",children:[(0,l.jsx)(tf,{pane:1,jsonData:r,onSelectKey:u,activeKey:n}),(0,l.jsx)(tf,{pane:2,jsonData:c,onSelectKey:u})]})]})},tj=n(79534),tv=e=>{let{value:t="",readOnly:n=!1,onInputChange:a=es()}=e;return(0,l.jsx)(tj.default,{className:"monaco-editor",theme:"supabase",defaultLanguage:"json",value:t,loading:(0,l.jsx)("h4",{children:"Loading"}),options:{readOnly:n,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0,lineNumbersMinChars:4},onMount:e=>{e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})}),e.focus()},onChange:a})},tb=e=>{let{column:t,jsonString:n,visible:a,backButtonLabel:s,applyButtonLabel:i,readOnly:r=!1,closePanel:o,onSaveJSON:c}=e,[d,u]=(0,q.useState)("edit"),[m,x]=(0,q.useState)("");(0,q.useEffect)(()=>{a&&x((0,eW.ZO)(n))},[a]);let p=async e=>{try{let t=(0,eW.tT)(m),n=(0,eW.jn)(t);c&&c(n,e)}catch(t){e(),h.ZP.error("JSON seems to have an invalid structure.")}};return(0,l.jsx)(eg.ZP,{size:"large",header:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:["edit"===d?(0,l.jsxs)("p",{children:[r?"Viewing":"Editing"," JSON Field: ",(0,l.jsx)("code",{children:t})]}):(0,l.jsxs)("p",{children:["Viewing JSON Field: ",(0,l.jsx)("code",{children:t})]}),(0,l.jsxs)("div",{className:"flex items-center gap-x-2",children:["edit"===d&&(0,l.jsxs)(P.fC,{delayDuration:0,children:[(0,l.jsx)(P.xz,{asChild:!0,children:(0,l.jsx)(W.z,{type:"default",icon:(0,l.jsx)(tr.Z,{}),className:"px-1",onClick:()=>void x((0,eW.ZO)(m))})}),(0,l.jsx)(P.h_,{children:(0,l.jsxs)(P.VY,{side:"bottom",children:[(0,l.jsx)(P.Eh,{className:"radix-tooltip-arrow"}),(0,l.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,l.jsx)("span",{className:"text-xs text-foreground",children:"Prettify JSON"})})]})})]}),(0,l.jsx)(to.Z,{options:["view","edit"],activeOption:d,borderOverride:"border-muted",onClickOption:u})]})]}),visible:a,onCancel:o,customFooter:(0,l.jsx)(eC.Z,{hideApply:r,closePanel:o,backButtonLabel:s,applyButtonLabel:i,applyFunction:r?void 0:p}),children:(0,l.jsx)("div",{className:"flex flex-auto h-full flex-col space-y-4",children:"edit"===d?(0,l.jsx)("div",{className:"w-full h-full flex-grow",children:(0,l.jsx)(tv,{readOnly:r,onInputChange:e=>x(null!=e?e:""),value:m.toString()},n)}):(0,l.jsx)(tg,{jsonData:(0,eW.dW)(m)})})})},ty=n(73685),tN=n(86073);let tw=e=>{var t,n,a,s,i,r;let{visible:o,readOnly:c=!1,closePanel:d,onSaveField:u}=e,[m,h]=(0,q.useState)(""),[x,p]=(0,q.useState)("edit"),f=(0,A._2)(),g=null!==(i=(null===(t=f.sidePanel)||void 0===t?void 0:t.type)==="cell"&&(null===(n=f.sidePanel.value)||void 0===n?void 0:n.column))&&void 0!==i?i:"",j=(null!==(r=(null===(a=f.sidePanel)||void 0===a?void 0:a.type)==="cell"&&(null===(s=f.sidePanel.value)||void 0===s?void 0:s.row))&&void 0!==r?r:{})[g];return(0,q.useEffect)(()=>{o&&(p("edit"),h(j))},[o]),(0,l.jsx)(eg.ZP,{size:"large",visible:o,onCancel:()=>d(),header:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("p",{children:[c?"Viewing":"Editing"," value of: ",(0,l.jsx)("code",{children:g})]}),(0,l.jsx)(to.Z,{options:["view","edit"],activeOption:x,borderOverride:"border-muted",onClickOption:p})]}),customFooter:(0,l.jsx)(eC.Z,{hideApply:c,closePanel:d,backButtonLabel:"Cancel",applyButtonLabel:"Save value",applyFunction:c?void 0:e=>{u&&u(m,e)}}),children:(0,l.jsx)("div",{className:"flex flex-auto h-full flex-col space-y-4",children:"edit"===x?(0,l.jsx)("div",{className:"w-full h-full flex-grow",children:(0,l.jsx)(tj.Editor,{theme:"supabase",className:"monaco-editor",defaultLanguage:"markdown",value:m,loading:(0,l.jsx)(ej.Z,{className:"animate-spin",strokeWidth:2,size:20}),options:{readOnly:c,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0,lineNumbersMinChars:4},onMount:e=>{e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})}),e.focus()},onChange:e=>h(null!=e?e:"")},j)}):(0,l.jsx)(eg.ZP.Content,{className:"py-4 bg-default flex-grow",children:(0,l.jsx)(tN.U,{remarkPlugins:[ty.Z],className:"bg-default markdown-body",content:m})})})})};var t_=n(31840),tC=n(96331);async function tS(e){let{name:t,projectRef:n,connectionString:a}=e;if(!n)throw Error("projectRef is required");let s=new Headers;a&&s.set("x-connection-encrypted",a);let{data:l,error:i}=await (0,ei.v_)("/platform/pg-meta/{ref}/schemas",{params:{header:{"x-connection-encrypted":a},path:{ref:n}},body:{name:t,owner:"postgres"},headers:Object.fromEntries(s)});if(i)throw i;return l}let tk=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,r.NL)();return(0,w.D)(e=>tS(e),{async onSuccess(t,n,s){let{projectRef:l}=n;await a.invalidateQueries(tC.A.schemaList(l)),await (null==e?void 0:e(t,n,s))},async onError(e,n,a){void 0===t?h.Am.error("Failed to create schema: ".concat(e.message)):t(e,n,a)},...n})};var tE=e=>{let{visible:t,closePanel:n}=e,{project:a}=(0,g.d2)(),[s,i]=(0,q.useState)({name:void 0}),[r,o]=(0,q.useState)(""),{mutate:c}=tk();(0,q.useEffect)(()=>{t&&(o(""),i({name:void 0}))},[t]);let d=e=>{let t={};return(0===r.length&&(t.name="Please provide a name for your schema"),Object.keys(t).length>0)?(e(),i(t)):void 0===a?console.error("Project is required"):void c({projectRef:a.ref,connectionString:a.connectionString,name:r},{onSuccess:()=>{e(),n(),h.ZP.success('Successfully created schema "'.concat(r,'"'))}})};return(0,l.jsx)(eg.ZP,{size:"large",visible:t,header:"Create a new schema",className:"transition-all duration-100 ease-in",onCancel:n,onConfirm:()=>e=>d(e),customFooter:(0,l.jsx)(eC.Z,{backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:n,applyFunction:e=>d(e)}),children:(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(eg.ZP.Content,{children:(0,l.jsx)("div",{className:"space-y-10 py-6",children:(0,l.jsx)(t_.Z,{label:"Name",layout:"horizontal",type:"text",error:null==s?void 0:s.name,value:r,onChange:e=>o(e.target.value)})})})})},"SchemaEditor")},tZ=e=>{var t,n,a,s,i,o,c,d,m,x,p,f,j,v,b,y;let{editable:w=!0,selectedTable:_,includeColumns:C=!1,onTableCreated:k=es()}=e,T=(0,A._2)(),[R,z]=(0,Z.x3)({arrayKeys:["filter","sort"]}),P=(0,r.NL)(),{project:L}=(0,g.d2)(),[I,D]=(0,q.useState)(!1),[F,O]=(0,q.useState)(!1),W=(null!==(y=null==_?void 0:_.columns)&&void 0!==y?y:[]).filter(e=>{var t;return(null!==(t=null==e?void 0:e.enums)&&void 0!==t?t:[]).length>0&&"array"===e.data_type.toLowerCase()}).map(e=>e.name),{mutateAsync:U}=em({onSuccess(){h.Am.success("Successfully created row")}}),{mutateAsync:V}=E({onSuccess(){h.Am.success("Successfully updated row")}}),{data:B}=(0,Y.z)({projectRef:null==L?void 0:L.ref,connectionString:null==L?void 0:L.connectionString}),{mutateAsync:K}=ec(),{mutateAsync:H}=(0,Q.u)({onError:()=>{}}),G=(0,S.z6)(),X=async(e,t,n,a)=>{let s;if(!L||void 0===_)return console.error("no project or table selected");if(t)try{await U({projectRef:L.ref,connectionString:L.connectionString,table:_,payload:e,enumArrayColumns:W,impersonatedRole:G()})}catch(e){s=e}else if(!en()(e)){if(_.primary_keys.length>0)try{await V({projectRef:L.ref,connectionString:L.connectionString,table:_,configuration:n,payload:e,enumArrayColumns:W,impersonatedRole:G()})}catch(e){s=e}else s=Error("No primary key"),h.Am.error("We can't make changes to this table because there is no primary key. Please create a primary key and try again.")}a(s),s||(D(!1),T.closeSidePanel())},$=async(e,t)=>{var n,a,s,l;let i,r;if(void 0===_)return;let o={};if((null===(n=T.sidePanel)||void 0===n?void 0:n.type)==="json"){let{row:t,column:n}=T.sidePanel.jsonValue;i={[n]:null===e?null:JSON.parse(e)},_.primary_keys.forEach(e=>o[e.name]=t[e.name]),r={identifiers:o,rowIdx:t.idx}}else if((null===(a=T.sidePanel)||void 0===a?void 0:a.type)==="cell"){let t=null===(s=T.sidePanel.value)||void 0===s?void 0:s.column,n=null===(l=T.sidePanel.value)||void 0===l?void 0:l.row;if(!t||!n)return;i={[t]:null===e?null:e},_.primary_keys.forEach(e=>o[e.name]=n[e.name]),r={identifiers:o,rowIdx:n.idx}}if(void 0!==i&&void 0!==r)try{await X(i,!1,r,()=>{})}finally{t()}},J=async e=>{var t;if(void 0===_||(null===(t=T.sidePanel)||void 0===t?void 0:t.type)!=="foreign-row-selector")return;let n=T.sidePanel.foreignKey;try{let{row:t,column:a}=n,s={[a.name]:e},l={};_.primary_keys.forEach(e=>l[e.name]=t[e.name]);let i={identifiers:l,rowIdx:t.idx};X(s,!1,i,()=>{})}catch(e){}},ee=async(e,t,n,a)=>{var s;let l=(null===(s=T.sidePanel)||void 0===s?void 0:s.type)==="column"&&T.sidePanel.column,{columnId:i,primaryKey:r,foreignKeyRelations:o,existingForeignKeyRelations:c}=n,d=t?await eJ({projectRef:null==L?void 0:L.ref,connectionString:null==L?void 0:L.connectionString,payload:e,selectedTable:_,primaryKey:r,foreignKeyRelations:o}):await e0({projectRef:null==L?void 0:L.ref,connectionString:null==L?void 0:L.connectionString,id:i,payload:e,selectedTable:_,primaryKey:r,foreignKeyRelations:o,existingForeignKeyRelations:c});(null==d?void 0:d.error)?h.Am.error(d.error.message):(!t&&e.name&&l&&l.name!==e.name&&et(l.name,e.name),await Promise.all([P.invalidateQueries(N.M.query(null==L?void 0:L.ref,["foreign-key-constraints"])),P.invalidateQueries(eh.W.table(null==L?void 0:L.ref,_.id)),P.invalidateQueries(N.M.query(null==L?void 0:L.ref,[_.schema,_.name])),P.invalidateQueries(N.M.query(null==L?void 0:L.ref,["table-definition",_.schema,_.name])),P.invalidateQueries(ed.C.list(null==L?void 0:L.ref))]),D(!1),T.closeSidePanel()),a()},et=(e,t)=>{z(n=>{var a,s;let l=null!==(a=null==n?void 0:n.filter)&&void 0!==a?a:[],i=null!==(s=null==n?void 0:n.sort)&&void 0!==s?s:[];return{...n,filter:l.map(n=>{let[a]=n.split(":");return a===e?n.replace(a,t):n}),sort:i.map(n=>{let[a]=n.split(":");return a===e?n.replace(a,t):n})}})},ea=async(e,t)=>{if(!L)return console.error("Project is required");let n=(null!=B?B:[]).find(e=>"supabase_realtime"===e.name),a=await P.fetchQuery({queryKey:eh.W.list(L.ref,"public",C),queryFn:e=>{let{signal:t}=e;return(0,ex.Lk)({projectRef:L.ref,connectionString:L.connectionString,schema:"public"},t)}});try{void 0===n&&(n=await K({projectRef:L.ref,connectionString:null==L?void 0:L.connectionString,name:"supabase_realtime",publish_insert:!0,publish_update:!0,publish_delete:!0}));let{id:s,tables:l}=n;if(null===l){let n=t?a.map(e=>"".concat(e.schema,".").concat(e.name)):a.filter(t=>t.id!==e.id).map(e=>"".concat(e.schema,".").concat(e.name));await H({id:s,projectRef:L.ref,connectionString:null==L?void 0:L.connectionString,tables:n})}else{let n=l.some(t=>t.id==e.id),a=n&&!t?l.filter(t=>t.id!==e.id).map(e=>"".concat(e.schema,".").concat(e.name)):!n&&t?["".concat(e.schema,".").concat(e.name)].concat(l.map(e=>"".concat(e.schema,".").concat(e.name))):null;if(null===a)return;await H({id:s,projectRef:L.ref,connectionString:null==L?void 0:L.connectionString,tables:a})}}catch(t){console.log({error:t}),h.Am.error("Failed to update realtime for ".concat(e.name,": ").concat(t.message))}},ei=async(e,t,n,a,s,l)=>{let i;let r=!1,{importContent:o,isRLSEnabled:c,isRealtimeEnabled:d,isDuplicateRows:u,existingForeignKeyRelations:m,primaryKey:x}=s;try{var p;if((null===(p=T.sidePanel)||void 0===p?void 0:p.type)==="table"&&"duplicate"===T.sidePanel.mode&&_){i=h.Am.loading("Duplicating table: ".concat(_.name,"..."));let t=await e1(null==L?void 0:L.ref,null==L?void 0:L.connectionString,e,{isRLSEnabled:c,isDuplicateRows:u,duplicateTable:_,foreignKeyRelations:n});d&&await ea(t,d),await Promise.all([P.invalidateQueries(eh.W.list(null==L?void 0:L.ref,t.schema,C)),P.invalidateQueries(ed.C.list(null==L?void 0:L.ref))]),h.Am.success("Table ".concat(_.name," has been successfully duplicated into ").concat(t.name,"!"),{id:i}),k(t)}else if(a){i=h.Am.loading("Creating new table: ".concat(e.name,"..."));let a=await e2({projectRef:null==L?void 0:L.ref,connectionString:null==L?void 0:L.connectionString,toastId:i,payload:e,columns:t,foreignKeyRelations:n,isRLSEnabled:c,importContent:o});d&&await ea(a,!0),await Promise.all([P.invalidateQueries(eh.W.list(null==L?void 0:L.ref,a.schema,C)),P.invalidateQueries(ed.C.list(null==L?void 0:L.ref))]),h.Am.success("Table ".concat(a.name," is good to go!"),{id:i}),k(a)}else if(_){i=h.Am.loading("Updating table: ".concat(null==_?void 0:_.name,"..."));let{table:a,hasError:s}=await e4({projectRef:null==L?void 0:L.ref,connectionString:null==L?void 0:L.connectionString,toastId:i,table:_,payload:e,columns:t,foreignKeyRelations:n,existingForeignKeyRelations:m,primaryKey:x});await ea(a,d),s?(0,h.Am)("Table ".concat(a.name," has been updated, but there were some errors"),{id:i}):(P.invalidateQueries(N.M.query(null==L?void 0:L.ref,["foreign-key-constraints"])),await Promise.all([P.invalidateQueries(N.M.query(null==L?void 0:L.ref,[_.schema,_.name])),P.invalidateQueries(N.M.query(null==L?void 0:L.ref,["table-definition",_.schema,_.name])),P.invalidateQueries(ed.C.list(null==L?void 0:L.ref)),P.invalidateQueries(eh.W.table(null==L?void 0:L.ref,a.id))]),h.Am.success("Successfully updated ".concat(a.name,"!"),{id:i}))}}catch(e){r=!0,h.Am.error(e.message,{id:i})}r||(D(!1),T.closeSidePanel()),l()},er=async e=>{if(!L||void 0===_)return console.error("no project or table selected");let{file:t,rowCount:n,selectedHeaders:a,resolve:s}=e,i=h.Am.loading("Adding ".concat(n.toLocaleString()," rows to ").concat(_.name));if(t&&n>0){let e=await e3(L.ref,L.connectionString,t,_,a,e=>{h.Am.loading((0,l.jsx)(el.q,{progress:e,message:"Adding ".concat(n.toLocaleString()," rows to ").concat(_.name)}),{id:i})});if(e.error)return h.Am.error("Failed to import data: ".concat(e.error.message),{id:i}),s()}else{let t=await e5(L.ref,L.connectionString,_,e.rows,a,t=>{h.Am.loading((0,l.jsx)(el.q,{progress:t,message:"Adding ".concat(e.rows.length.toLocaleString()," rows to ").concat(_.name)}),{id:i})});if(t.error)return h.Am.error("Failed to import data: ".concat(t.error.message),{id:i}),s()}await Promise.all([P.invalidateQueries(N.M.query(null==L?void 0:L.ref,[_.schema,_.name]))]),h.Am.success("Successfully imported ".concat(n," rows of data into ").concat(_.name),{id:i}),s(),T.closeSidePanel()},eo=()=>{I?O(!0):T.closeSidePanel()};return(0,l.jsxs)(l.Fragment,{children:[!u()(_)&&(0,l.jsx)(t3,{row:(null===(t=T.sidePanel)||void 0===t?void 0:t.type)==="row"?T.sidePanel.row:void 0,selectedTable:_,visible:(null===(n=T.sidePanel)||void 0===n?void 0:n.type)==="row",closePanel:eo,saveChanges:X,updateEditorDirty:()=>D(!0)}),!u()(_)&&(0,l.jsx)(nA,{column:(null===(a=T.sidePanel)||void 0===a?void 0:a.type)==="column"?T.sidePanel.column:void 0,selectedTable:_,visible:(null===(s=T.sidePanel)||void 0===s?void 0:s.type)==="column",closePanel:eo,saveChanges:ee,updateEditorDirty:()=>D(!0)}),(0,l.jsx)(n5,{table:(null===(i=T.sidePanel)||void 0===i?void 0:i.type)==="table"&&("edit"===T.sidePanel.mode||"duplicate"===T.sidePanel.mode)?_:void 0,isDuplicating:(null===(o=T.sidePanel)||void 0===o?void 0:o.type)==="table"&&"duplicate"===T.sidePanel.mode,visible:(null===(c=T.sidePanel)||void 0===c?void 0:c.type)==="table",closePanel:eo,saveChanges:ei,updateEditorDirty:()=>D(!0)}),(0,l.jsx)(tE,{visible:(null===(d=T.sidePanel)||void 0===d?void 0:d.type)==="schema",closePanel:eo}),(0,l.jsx)(tb,{visible:(null===(m=T.sidePanel)||void 0===m?void 0:m.type)==="json",column:(null===(x=T.sidePanel)||void 0===x?void 0:x.type)==="json"&&T.sidePanel.jsonValue.column||"",jsonString:(null===(p=T.sidePanel)||void 0===p?void 0:p.type)==="json"&&T.sidePanel.jsonValue.jsonString||"",backButtonLabel:"Cancel",applyButtonLabel:"Save changes",readOnly:!w,closePanel:eo,onSaveJSON:$}),(0,l.jsx)(tw,{visible:(null===(f=T.sidePanel)||void 0===f?void 0:f.type)==="cell",closePanel:eo,onSaveField:$}),(0,l.jsx)(ti,{visible:(null===(j=T.sidePanel)||void 0===j?void 0:j.type)==="foreign-row-selector",foreignKey:(null===(v=T.sidePanel)||void 0===v?void 0:v.type)==="foreign-row-selector"?T.sidePanel.foreignKey.foreignKey:void 0,closePanel:eo,onSelect:J}),(0,l.jsx)(ag,{visible:(null===(b=T.sidePanel)||void 0===b?void 0:b.type)==="csv-import",selectedTable:_,saveContent:er,closePanel:eo,updateEditorDirty:D}),(0,l.jsx)(M.Z,{visible:F,title:"Discard changes",confirmLabel:"Discard",onCancel:()=>O(!1),onConfirm:()=>{O(!1),D(!1),T.closeSidePanel()},children:(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:"There are unsaved changes. Are you sure you want to close the panel? Your changes will be lost."})})]})},tT=n(96795),tR=n.n(tT),tz=e=>{let{isNewRecord:t,tableName:n}=e,a="".concat(t?"Add new":"Update"," row ").concat(t?"to":"from"," ");return(0,l.jsxs)(l.Fragment,{children:[a,n&&(0,l.jsx)("span",{className:"text-code font-mono",children:n})]})},tA=n(11886),tP=n.n(tA),tL=n(14774),tI=n(45236),tD=n(82631),tF=n(55380),tO=n(84904),tq=n(28879),tW=n.n(tq),tU=e=>{let{value:t,onChange:n,name:a,format:s,description:i}=e,r=function(e){return tO.lb.indexOf(e.toLowerCase())>-1?"date":tO.XO.indexOf(e.toLowerCase())>-1?"time":tO.Ks.indexOf(e.toLowerCase())>-1?"datetime-local":"text"}(s);return(0,l.jsx)(t_.Z,{layout:"horizontal",className:"w-full",label:a,descriptionText:(0,l.jsxs)("div",{className:"space-y-1",children:[i,s.includes("tz")&&(0,l.jsxs)("p",{children:["Your local timezone will be automatically applied (",tW()().format("ZZ"),")"]})]}),labelOptional:s,size:"small",value:t,type:r,onChange:function(e){let t=e.target.value;(0!==t.length||""===t)&&n(t)},step:"datetime-local"==r||"time"==r?"1":void 0})},tV=e=>{var t,n,a,s,i,r,o,c;let{field:d,errors:u,isEditable:m=!0,onUpdateField:h=es(),onEditJson:x=es(),onSelectForeignKey:p=es()}=e;if(d.enums.length>0)return"_"===d.format[0]?(0,l.jsx)("div",{className:"text-area-text-sm",children:(0,l.jsx)(t_.Z.TextArea,{layout:"horizontal",label:d.name,className:"text-sm",descriptionText:d.comment,labelOptional:d.format,disabled:!m,error:u[d.name],rows:5,value:null!==(t=d.value)&&void 0!==t?t:"",placeholder:null===d.defaultValue?"":"string"==typeof d.defaultValue&&0===d.defaultValue.length?"EMPTY":"Default: ".concat(d.defaultValue),onChange:e=>h({[d.name]:e.target.value})})}):(0,l.jsxs)(tL.ZP,{size:"medium",layout:"horizontal",value:null!==(n=d.value)&&void 0!==n?n:"",label:d.name,labelOptional:d.format,descriptionText:d.comment,disabled:!m,error:u[d.name],onChange:e=>h({[d.name]:e.target.value}),children:[(0,l.jsx)(tL.ZP.Option,{value:"",children:"---"}),d.enums.map(e=>(0,l.jsx)(tL.ZP.Option,{value:e,children:e},e))]});if(void 0!==d.foreignKey)return(0,l.jsx)(t_.Z,{layout:"horizontal",label:d.name,value:null!==(a=d.value)&&void 0!==a?a:"",descriptionText:(0,l.jsxs)(l.Fragment,{children:[d.comment&&(0,l.jsxs)("span",{className:"text-sm text-foreground-lighter",children:[d.comment," "]}),(0,l.jsxs)("span",{className:"text-sm text-foreground-lighter",children:[d.comment&&"(","Has a foreign key relation to"]}),(0,l.jsxs)("span",{className:"text-code font-mono text-xs text-foreground-lighter",children:[d.foreignKey.target_table_schema,".",d.foreignKey.target_table_name,".",d.foreignKey.target_column_name]}),d.comment&&(0,l.jsx)("span",{className:"text-sm text-foreground-lighter",children:")"})]}),labelOptional:d.format,disabled:!m,error:u[d.name],onChange:e=>h({[d.name]:e.target.value}),actions:(0,l.jsx)(W.z,{type:"default",className:"mr-1",htmlType:"button",onClick:p,icon:(0,l.jsx)(tI.Z,{}),children:"Select record"})});if(tP()(tO.BB,d.format))return(0,l.jsx)("div",{className:"text-area-text-sm",children:(0,l.jsx)(t_.Z.TextArea,{layout:"horizontal",label:d.name,className:"text-sm",descriptionText:d.comment,labelOptional:d.format,disabled:!m,error:u[d.name],rows:5,value:null!==(s=d.value)&&void 0!==s?s:"",placeholder:null===d.value&&null===d.defaultValue?"NULL":""===d.value?"EMPTY":"string"==typeof d.defaultValue&&0===d.defaultValue.length?"EMPTY":"NULL (Default: ".concat(d.defaultValue,")"),actions:(0,l.jsx)("div",{className:"mr-1 mt-0.5",children:(d.isNullable||!d.isNullable&&d.defaultValue)&&(0,l.jsx)(W.z,{type:"default",size:"tiny",onClick:()=>h({[d.name]:null}),children:"Set to NULL"})}),onChange:e=>h({[d.name]:e.target.value})})});if(tP()(tO.YF,d.format))return(0,l.jsx)(t_.Z,{layout:"horizontal",value:null!==(i=d.value)&&void 0!==i?i:"",label:d.name,descriptionText:d.comment,labelOptional:d.format,disabled:!m,placeholder:null!==(r=null==d?void 0:d.defaultValue)&&void 0!==r?r:"NULL",error:u[d.name],onChange:e=>h({[d.name]:e.target.value}),actions:(0,l.jsx)(W.z,{type:"default",htmlType:"button",onClick:()=>x({column:d.name,jsonString:d.value}),icon:(0,l.jsx)(tD.Z,{}),children:"Edit JSON"})});if(tP()(tO.nA,d.format))return(0,l.jsx)(tU,{name:d.name,format:d.format,value:null!==(o=d.value)&&void 0!==o?o:"",description:(0,l.jsxs)(l.Fragment,{children:[d.defaultValue&&(0,l.jsxs)("p",{children:["Default: ",d.defaultValue]}),d.comment&&(0,l.jsx)("p",{children:d.comment})]}),onChange:e=>h({[d.name]:e})});if("bool"===d.format){let e=[{value:"true",label:"TRUE"},{value:"false",label:"FALSE"},...d.isNullable?[{value:"null",label:"NULL"}]:[]],t="null"===d.value?d.defaultValue:d.value;return(0,l.jsx)(tF.Z,{size:"small",layout:"horizontal",name:d.name,label:d.name,labelOptional:d.format,descriptionText:d.comment,value:null===t?"null":t,onChange:e=>{"null"===e?h({[d.name]:null}):h({[d.name]:e})},children:e.map(e=>(0,l.jsx)(tF.Z.Option,{id:e.value,label:e.label,value:e.value,children:e.label},e.value))})}return(0,l.jsx)(t_.Z,{layout:"horizontal",label:d.name,descriptionText:d.comment,labelOptional:d.format,error:u[d.name],value:null!==(c=d.value)&&void 0!==c?c:"",placeholder:d.isIdentity?"Automatically generated as identity":null!==d.defaultValue?"Default: ".concat(d.defaultValue):"NULL",disabled:!m,onChange:e=>h({[d.name]:e.target.value})})},tM=n(60417),tB=n.n(tM),tK=n(85505),tY=n.n(tK),tQ=n(99686),tH=n.n(tQ);let tG=(e,t)=>{let{relationships:n,primary_keys:a}=t,s=a.map(e=>e.name);return t.columns.map(t=>({value:u()(e)&&tO.BB.includes(t.format)?null:u()(e)&&"bool"===t.format&&!t.is_nullable?t.default_value:u()(e)&&"bool"===t.format&&t.is_nullable?"null":u()(e)?"":tO.nA.includes(t.format)?t0(t.format,e[t.name]):t$(e[t.name],t.format),foreignKey:c()(n,e=>e.source_schema===t.schema&&e.source_table_name===t.table&&e.source_column_name===t.name),id:t.id,name:t.name,comment:tJ(t.comment),format:t.format,enums:t.enums,defaultValue:null==t?void 0:t.default_value,isNullable:t.is_nullable,isIdentity:t.is_identity,isPrimaryKey:s.includes(t.name)}))},tX=e=>{let t={};return e.forEach(e=>{var n,a,s;if(e.format.startsWith("_")&&e.value)try{JSON.parse(e.value)}catch(n){t[e.name]="Value is an invalid array"}if(e.format.includes("json")&&(null!==(a=null===(n=e.value)||void 0===n?void 0:n.length)&&void 0!==a?a:0)>0)try{(0,eW.jn)(null!==(s=e.value)&&void 0!==s?s:"")}catch(n){t[e.name]="Value is an invalid JSON"}if(e.isIdentity||e.defaultValue)return}),t},t$=(e,t)=>{try{if(null===e||"string"==typeof e&&0===e.length||"number"==typeof e||!t)return e;if("object"==typeof e)return JSON.stringify(e);if("boolean"==typeof e)return e.toString();else return e}catch(t){return e}},tJ=e=>{var t,n;if(!e)return"";let a=tB()(e.split("\n"));return 1==a.length?e:2==a.length?"".concat(a[0]," ").concat(null===(t=a[1])||void 0===t?void 0:t.split(".<")[0]):a.length>2?"".concat(a[0]," (").concat(a[1]," ").concat(null===(n=a[2])||void 0===n?void 0:n.split(".<")[0],")"):""},t0=(e,t)=>{if(!t||0==t.length)return"";if(tO.Ks.includes(e))return tW()(t).format("YYYY-MM-DDTHH:mm:ss");if(!tO.XO.includes(e))return t;{let e=t&&t.includes("+")?"HH:mm:ssZZ":"HH:mm:ss";return tW()(t,e).format("HH:mm:ss")}},t1=(e,t)=>{if(!t||0==t.length)return null;switch(e){case"timestamptz":return tW()(t,"YYYY-MM-DDTHH:mm:ss").format("YYYY-MM-DDTHH:mm:ssZ");case"timestamp":return tW()(t,"YYYY-MM-DDTHH:mm:ss").format("YYYY-MM-DDTHH:mm:ss");case"timetz":return tW()(t,"HH:mm:ss").format("HH:mm:ssZZ");case"time":return tW()(t,"HH:mm:ss").format("HH:mm:ss");default:return t}},t2=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={};return e.forEach(e=>{var t;let a=e.format.startsWith("_"),s=tO.BB.includes(e.format)?e.value:0===(null!==(t=null==e?void 0:e.value)&&void 0!==t?t:"").length?null:e.value;if(a&&null!==s)n[e.name]=(0,eW.dW)(s);else if(e.format.includes("json"))"object"==typeof e.value?n[e.name]=s:tY()(s)&&(n[e.name]=(0,eW.dW)(s));else if("bool"===e.format&&s)"null"===s?n[e.name]=null:n[e.name]="true"===s;else if(tO.nA.includes(e.format)){let t=2===(s||"").split(":").length?"".concat(s,":00"):s;n[e.name]=t1(e.format,t)}else n[e.name]=s}),t?n:tH()(n,tp())},t4=(e,t)=>{let n=t2(t,!0),a={};return Object.keys(n).forEach(s=>{var l;let i=null===(l=t.find(e=>e.name===s))||void 0===l?void 0:l.format;if(void 0!==i&&tO.nA.includes(i)){let t=t0(i,e[s]);t1(i,t)!==n[s]&&(a[s]=n[s])}else eZ()(e[s],n[s])||(a[s]=n[s])}),a};var t3=e=>{var t,n,a,s;let{row:i,selectedTable:r,visible:o=!1,closePanel:c=es(),saveChanges:d=es(),updateEditorDirty:m=es()}=e,[h,x]=(0,q.useState)({}),[p,f]=(0,q.useState)([]),[j,v]=(0,q.useState)(),[y,N]=(0,q.useState)(!1),[w,_]=(0,q.useState)(),C=u()(i),S=!u()(j),[k,E]=(0,q.useState)(!1),[Z,T]=tR()(p,e=>!e.isNullable),{project:R}=(0,g.d2)(),{data:z}=(0,b.X)({projectRef:null==R?void 0:R.ref,connectionString:null==R?void 0:R.connectionString,schema:r.schema}),A=(0,q.useMemo)(()=>{var e;return z&&(null==w?void 0:null===(e=w.foreignKey)||void 0===e?void 0:e.id)?z.find(e=>{var t;return e.id===(null===(t=w.foreignKey)||void 0===t?void 0:t.id)}):void 0},[z,null==w?void 0:null===(t=w.foreignKey)||void 0===t?void 0:t.id]);(0,q.useEffect)(()=>{o&&(x({}),f(tG(i,r)))},[o]);let P=e=>{let[t]=Object.keys(e);f(p.map(n=>n.name===t?{...n,value:e[t]}:n)),m()},L=async e=>{N(!0),_(e)},I=e=>{e.preventDefault();let t=tX(p);if(x(t),E(!0),en()(t)){m();let e=C?t2(p):t4(i,p),t={identifiers:{},rowIdx:-1};if(!C){let e=p.filter(e=>e.isPrimaryKey),n={};e.forEach(e=>n[e.name]=i[e.name]),t.identifiers=n,t.rowIdx=i.idx}d(e,C,t,()=>E(!1))}else E(!1)};return(0,l.jsxs)(eg.ZP,{hideFooter:!0,size:"large",visible:o,header:(0,l.jsx)(tz,{isNewRecord:C,tableName:r.name}),className:"transition-all duration-100 ease-in ".concat(S||y?" mr-32":""),onCancel:c,children:[(0,l.jsx)("form",{onSubmit:e=>I(e),className:"h-full",children:(0,l.jsxs)("div",{className:"flex h-full flex-col",children:[(0,l.jsxs)("div",{className:"flex flex-grow flex-col",children:[(0,l.jsx)(eg.ZP.Content,{children:(0,l.jsx)("div",{className:"space-y-10 py-6",children:Z.map(e=>(0,l.jsx)(tV,{field:e,errors:h,onUpdateField:P,onEditJson:v,onSelectForeignKey:()=>L(e)},e.id))})}),T.length>0&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(eg.ZP.Separator,{}),(0,l.jsx)(eg.ZP.Content,{children:(0,l.jsxs)("div",{className:"space-y-10 py-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-base text-foreground",children:"Optional Fields"}),(0,l.jsx)("p",{className:"text-sm text-foreground-lighter",children:"These are columns that do not need any value"})]}),T.map(e=>(0,l.jsx)(tV,{field:e,errors:h,onUpdateField:P,onEditJson:v,onSelectForeignKey:()=>L(e)},e.id))]})})]}),(0,l.jsx)(tb,{visible:S,column:null!==(n=null==j?void 0:j.column)&&void 0!==n?n:"",jsonString:null!==(a=null==j?void 0:j.jsonString)&&void 0!==a?a:"",closePanel:()=>v(void 0),onSaveJSON:e=>{var t;P({[null!==(t=null==j?void 0:j.column)&&void 0!==t?t:""]:e}),v(void 0)}})]}),(0,l.jsx)("div",{className:"flex-shrink",children:(0,l.jsx)(eC.Z,{loading:k,backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:c})})]})}),(0,l.jsx)(ti,{visible:y,foreignKey:A,onSelect:e=>{w&&(P({[w.name]:e}),N(!1),_(void 0))},closePanel:()=>{N(!1),_(void 0)}},"foreign-row-selector-".concat(null!==(s=null==A?void 0:A.id)&&void 0!==s?s:"null"))]},"RowEditor")},t5=n(14279),t8=n(39127),t6=n(72978),t9=n(76419),t7=n(72860),ne=n(66105),nt=n(27398);(a=s||(s={})).CHECK_CONSTRAINT="c",a.FOREIGN_KEY_CONSTRAINT="f",a.PRIMARY_KEY_CONSTRAINT="p",a.UNIQUE_CONSTRAINT="u",a.CONSTRAINT_TRIGGER="t",a.EXCLUSION_CONSTRAINT="x";let nn=e=>{let{schema:t,table:n}=e;return"\n  SELECT \n    con.oid as id,\n    con.conname as name,\n    con.contype as type\n  FROM pg_catalog.pg_constraint con\n  INNER JOIN pg_catalog.pg_class rel\n            ON rel.oid = con.conrelid\n  INNER JOIN pg_catalog.pg_namespace nsp\n            ON nsp.oid = connamespace\n  WHERE nsp.nspname = '".concat(t,"'\n        AND rel.relname = '").concat(n,"';\n").trim()},na=function(e){let{projectRef:t,connectionString:n,schema:a,table:s}=e,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,_.cp)({projectRef:t,connectionString:n,sql:nn({schema:a,table:s}),queryKey:["table-constraints"]},{enabled:void 0!==a&&void 0!==s,select(e){var t;return null!==(t=null==e?void 0:e.result)&&void 0!==t?t:[]},...l})};var ns=n(6931),nl=n(40855);let ni=e=>e.map(e=>({id:e.id,name:e.constraint_name,tableId:e.target_id,schema:e.target_schema,table:e.target_table,columns:e.source_columns.map((t,n)=>({source:t,target:e.target_columns[n]})),deletionAction:e.deletion_action,updateAction:e.update_action})),nr=(e,t,n)=>{var a;let s="update"===e?"Updating":"Deleting",i=null!==(a=(0,eU.s8)(t))&&void 0!==a?a:"No action";switch(t){case v.N.NO_ACTION:return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"text-foreground-light",children:i}),": ",s," a record from"," ",(0,l.jsx)("code",{className:"text-xs text-foreground-light",children:n})," will"," ",(0,l.jsx)("span",{className:"text-amber-900 opacity-75",children:"raise an error"})," if there are records existing in this table that reference it"]});case v.N.CASCADE:return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"text-foreground-light",children:i}),": ",s," a record from"," ",(0,l.jsx)("code",{className:"text-xs text-foreground-light",children:n})," will"," ",(0,l.jsxs)("span",{className:"text-amber-900 opacity-75",children:["also ",e]})," any records that reference it in this table"]});case v.N.RESTRICT:return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"text-foreground-light",children:i}),(0,l.jsxs)(P.fC,{delayDuration:0,children:[(0,l.jsx)(P.xz,{className:"translate-y-[3px] mx-1",children:(0,l.jsx)(nl.Z,{className:"text-foreground-light",size:16,strokeWidth:1.5})}),(0,l.jsx)(P.h_,{children:(0,l.jsxs)(P.VY,{side:"bottom",children:[(0,l.jsx)(P.Eh,{className:"radix-tooltip-arrow"}),(0,l.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow w-[300px] space-y-2 border border-background",children:(0,l.jsx)("p",{className:"text-xs text-foreground",children:"This is similar to no action, but the restrict check cannot be deferred till later in the transaction"})})]})})]}),": ",s," a record from"," ",(0,l.jsx)("code",{className:"text-xs text-foreground-light",children:n})," will"," ",(0,l.jsxs)("span",{className:"text-amber-900 opacity-75",children:["prevent ",s.toLowerCase()]})," ","existing referencing rows from this table."]});case v.N.SET_DEFAULT:return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"text-foreground-light",children:i}),": ",s," a record from"," ",(0,l.jsx)("code",{className:"text-xs text-foreground-light",children:n})," will set the value of any existing records in this table referencing it to their"," ",(0,l.jsx)("span",{className:"text-amber-900 opacity-75",children:"default value"})]});case v.N.SET_NULL:return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"text-foreground-light",children:i}),": ",s," a record from"," ",(0,l.jsx)("code",{className:"text-xs text-foreground-light",children:n})," will set the value of any existing records in this table referencing it"," ",(0,l.jsx)("span",{className:"text-amber-900 opacity-75",children:"to NULL"})]})}},no=[{name:"now()",value:"now()",description:"Returns the current date and time"},{name:"(now() at time zone 'utc')",value:"(now() at time zone 'utc')",description:"Returns the current date and time based on the specified timezone"}],nc=[{name:"Set as NULL",value:null,description:"Set the default value as NULL value"},{name:"Set as empty string",value:"",description:"Set the default value as an empty string"}],nd={uuid:[{name:"auth.uid()",value:"auth.uid()",description:"Returns the user's ID when rows are added or updated through the API"},{name:"gen_random_uuid()",value:"gen_random_uuid()",description:"Generates a version 4 UUID"}],time:[...no],timetz:[...no],timestamp:[...no],timestamptz:[...no],text:[...nc],varchar:[...nc]};var nu=n(40386),nm=n(69168),nh=e=>{let{label:t,description:n,placeholder:a,size:s,layout:i,disabled:r=!1,className:o="",value:c="",suggestions:d=[],suggestionsTooltip:u,suggestionsHeader:m,onChange:h=es(),onSelectSuggestion:x=es()}=e,p=(0,q.useRef)(null),[f,g]=(0,q.useState)(d),j=f.length>0;return(0,q.useEffect)(()=>{g(d.slice(0,3))},[d]),(0,l.jsx)("div",{ref:p,className:"relative",children:(0,l.jsx)(t_.Z,{label:t,descriptionText:n,placeholder:a,size:s,layout:i,disabled:r,className:o,inputClassName:"pr-10",type:"text",value:c,onChange:e=>{h(e);let t=e.target.value;d.length>3&&g((t?d.filter(e=>-1!==e.name.indexOf(t)):d).slice(0,3))},actions:j&&(0,l.jsxs)(nu.h_,{children:[(0,l.jsxs)(P.fC,{delayDuration:0,children:[(0,l.jsx)(nu.$F,{asChild:!0,children:(0,l.jsx)(P.xz,{asChild:!0,children:(0,l.jsx)(W.z,{type:"default",className:"!px-1 mr-0.5",children:(0,l.jsx)(nm.Z,{strokeWidth:1.5,size:14})})})}),(0,l.jsx)(P.h_,{children:(0,l.jsxs)(P.VY,{side:"bottom",children:[(0,l.jsx)(P.Eh,{className:"radix-tooltip-arrow"}),(0,l.jsx)("div",{className:"bg-alternative rounded py-1 px-2 leading-none shadow border-background border",children:(0,l.jsx)("span",{className:"text-foreground text-xs",children:u||"Suggestions"})})]})})]}),(0,l.jsxs)(nu.AW,{align:"end",side:"bottom",children:[(0,l.jsx)(nu.Ju,{children:m||"Suggestions"}),(0,l.jsx)(nu.VD,{}),f.map(e=>(0,l.jsxs)(nu.Xi,{className:"space-x-2",onClick:()=>x(e),children:[(0,l.jsx)("div",{children:e.name}),(0,l.jsx)("div",{className:"text-foreground-lighter",children:e.description})]},e.name))]})]})})})},nx=e=>{var t,n,a,s;let{columnFields:i,enumTypes:r=[],onUpdateField:o=es()}=e,c=null!==(t=null==nd?void 0:nd[i.format])&&void 0!==t?t:[];if(!tO.DL.includes(i.format)&&r.some(e=>e.name===i.format)){let e=r.find(e=>e.name===i.format),t=null!==(n=null==e?void 0:e.enums)&&void 0!==n?n:[],s=null!==(a=null==i?void 0:i.defaultValue)&&void 0!==a?a:"",c=s.includes("::")?s.split("::")[0].slice(1,-1):s;if(void 0!==e)return(0,l.jsxs)(tL.ZP,{label:"Default Value",layout:"vertical",value:c,onChange:e=>o({defaultValue:e.target.value}),children:[(0,l.jsx)(tL.ZP.Option,{value:"",children:"NULL"},"empty-enum"),t.map(e=>(0,l.jsx)(tL.ZP.Option,{value:e,children:e},e))]})}return(0,l.jsx)(nh,{label:"Default Value",layout:"vertical",description:"Can either be a literal or an expression. When using an expression wrap your expression in brackets, e.g. (gen_random_uuid())",placeholder:"string"==typeof i.defaultValue&&0===i.defaultValue.length?"EMPTY":"NULL",value:null!==(s=null==i?void 0:i.defaultValue)&&void 0!==s?s:"",suggestions:c,suggestionsHeader:"Suggested expressions",suggestionsTooltip:"Suggested expressions",onChange:e=>o({defaultValue:e.target.value}),onSelectSuggestion:e=>o({defaultValue:e.value})})},np=n(52111),nf=n(829),ng=n.n(nf),nj=n(24845),nv=n(65283),nb=n(9019),ny=n(5341);let nN=[{key:"no-action",label:"No action",value:v.N.NO_ACTION},{key:"cascade",label:"Cascade",value:v.N.CASCADE},{key:"restrict",label:"Restrict",value:v.N.RESTRICT},{key:"set-default",label:"Set default",value:v.N.SET_DEFAULT},{key:"set-null",label:"Set NULL",value:v.N.SET_NULL}],nw={id:void 0,schema:"public",table:"",columns:[],deletionAction:v.N.NO_ACTION,updateAction:v.N.NO_ACTION},n_=e=>{var t,n,a,s,i;let{visible:r,table:o,column:c,foreignKey:d,onClose:u,onSaveRelation:m}=e,{project:h}=(0,g.d2)(),x=(0,A._2)(),[p,f]=(0,q.useState)(nw),[j,v]=(0,q.useState)({}),b=(null!==(t=null==j?void 0:j.types)&&void 0!==t?t:[]).filter(e=>void 0!==e).length>0,y=(null!==(n=null==j?void 0:j.typeNotice)&&void 0!==n?n:[]).filter(e=>void 0!==e).length>0,{data:N}=(0,ny.Q)({projectRef:null==h?void 0:h.ref,connectionString:null==h?void 0:h.connectionString}),{data:w}=(0,ex.Bj)({projectRef:null==h?void 0:h.ref,connectionString:null==h?void 0:h.connectionString,schema:p.schema,includeColumns:!0}),_=(null!=w?w:[]).find(e=>e.name===p.table&&e.schema===p.schema),C=void 0===_||b,S=e=>{f({...nw,id:p.id,schema:e})},k=e=>{v({});let t=(null!=w?w:[]).find(t=>t.id===e);t&&f({...nw,id:p.id,name:p.name,tableId:t.id,schema:t.schema,table:t.name,columns:void 0!==c?[{source:c.name,target:""}]:[{source:"",target:""}]})},E=e=>{f({...p,columns:p.columns.filter((t,n)=>n!==e)})},Z=(e,t,n)=>{let a=p.columns.map((a,s)=>{var l,i,r;if(s!==e)return a;if("target"===t){let e=null==_?void 0:null===(i=_.columns)||void 0===i?void 0:null===(l=i.find(e=>e.name===n))||void 0===l?void 0:l.format;return{...a,[t]:n,targetType:e}}{let e=null===(r=o.columns.find(e=>e.name===n))||void 0===r?void 0:r.format;return{...a,[t]:n,sourceType:e}}});f({...p,columns:a})},T=(e,t)=>{v({}),f({...p,[e]:t})},R=e=>{let t={};if(p.columns.filter(e=>""===e.source||""===e.target).length>0&&(t.columns="Please ensure that columns are selected"),Object.keys(t).length>0){v(t),e();return}""!==p.table&&m(p),u(),e()},z=()=>{let e=[],t=[];p.columns.forEach(n=>{var a,s,l,i;let{source:r,target:c,sourceType:d,targetType:u}=n,m=o.columns.find(e=>e.name===r),h=null!==(l=null!=d?d:null==m?void 0:m.format)&&void 0!==l?l:"",x=null!==(i=null!=u?u:null==_?void 0:null===(s=_.columns)||void 0===s?void 0:null===(a=s.find(e=>e.name===c))||void 0===a?void 0:a.format)&&void 0!==i?i:"";return""===r||""===c?t.push(void 0):(null==m?void 0:m.isNewColumn)&&""!==x?e.push({sourceType:h,targetType:x}):tO.ji.includes(h)&&tO.ji.includes(x)||tO.BB.includes(h)&&tO.BB.includes(x)||tO.BB.includes(h)&&tO.BB.includes(x)||"uuid"===h&&"uuid"===x||h===x?t.push(void 0):void t.push({sourceType:h,targetType:x})}),v({types:t,typeNotice:e})};return(0,q.useEffect)(()=>{r&&(void 0!==d?f(d):f({...nw,id:(0,eW.k$)()}))},[r]),(0,q.useEffect)(()=>{r&&z()},[p]),(0,l.jsx)(eg.ZP,{visible:r,onCancel:u,className:"max-w-[480px]",header:"".concat(void 0===d?"Add":"Manage"," foreign key relationship").concat(void 0===d?" to":"s for"," ").concat(o.name.length>0?o.name:"new table"),customFooter:(0,l.jsx)(eC.Z,{backButtonLabel:"Cancel",disableApply:C,applyButtonLabel:"Save",closePanel:u,applyFunction:e=>R(e)}),children:(0,l.jsx)(eg.ZP.Content,{children:(0,l.jsxs)("div",{className:"py-6 space-y-6",children:[(0,l.jsx)(J.Z,{icon:(0,l.jsx)(nl.Z,{size:"large",strokeWidth:1.5}),title:"What are foreign keys?",description:"Foreign keys help maintain referential integrity of your data by ensuring that no\n                one can insert rows into the table that do not have a matching entry to another\n                table.",url:"https://www.postgresql.org/docs/current/tutorial-fk.html",urlLabel:"Postgres Foreign Key Documentation"}),(0,l.jsx)(tF.Z,{id:"schema",label:"Select a schema",value:p.schema,onChange:e=>S(e),children:null==N?void 0:N.map(e=>(0,l.jsx)(tF.Z.Option,{value:e.name,label:e.name,className:"min-w-96",addOnBefore:()=>(0,l.jsx)(nv.Z,{size:16,strokeWidth:1.5}),children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"hidden",children:e.name}),(0,l.jsx)("span",{className:"text-foreground",children:e.name})]})},e.id))}),(0,l.jsxs)(tF.Z,{id:"table",label:"Select a table to reference to",value:null!==(a=null==_?void 0:_.id)&&void 0!==a?a:1,onChange:e=>k(Number(e)),children:[(0,l.jsx)(tF.Z.Option,{className:"min-w-96",value:1,label:"---",children:"---"},"empty"),ng()(w,["schema"]).map(e=>(0,l.jsx)(tF.Z.Option,{value:e.id,label:e.name,className:"min-w-96",addOnBefore:()=>(0,l.jsx)(nj.Z,{size:16,strokeWidth:1.5}),children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"hidden",children:e.name}),(0,l.jsx)("span",{className:"text-foreground-lighter",children:e.schema}),(0,l.jsx)("span",{className:"text-foreground",children:e.name})]})},e.id))]}),p.schema&&p.table&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"flex flex-col gap-y-3",children:[(0,l.jsxs)("label",{className:"text-foreground-light text-sm",children:["Select columns from"," ",(0,l.jsxs)("code",{className:"text-xs",children:[p.schema,".",p.table]}),"to reference to"]}),(0,l.jsxs)("div",{className:"grid grid-cols-10 gap-y-2",children:[(0,l.jsxs)("div",{className:"col-span-5 text-xs text-foreground-lighter",children:[x.selectedSchemaName,".",o.name.length>0?o.name:"[unnamed table]"]}),(0,l.jsxs)("div",{className:"col-span-4 text-xs text-foreground-lighter text-right",children:[p.schema,".",p.table]}),0===p.columns.length&&(0,l.jsx)(t7.bZ,{className:"col-span-10 py-2 px-3",children:(0,l.jsx)(t7.X,{children:"There are no foreign key relations between the tables"})}),p.columns.map((e,t)=>{var n,a;return(0,l.jsxs)(q.Fragment,{children:[(0,l.jsx)("div",{className:"col-span-4",children:(0,l.jsxs)(tF.Z,{id:"column",value:p.columns[t].source,onChange:e=>Z(t,"source",e),children:[(0,l.jsx)(tF.Z.Option,{value:"",label:"---",className:"!w-[170px]",children:"---"},"empty"),(null!==(n=null==o?void 0:o.columns)&&void 0!==n?n:[]).filter(e=>0!==e.name.length).map(e=>(0,l.jsx)(tF.Z.Option,{value:e.name,label:e.name,className:"!w-[170px]",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"text-foreground",children:e.name}),(0,l.jsx)("span",{className:"text-foreground-lighter",children:""===e.format?"-":e.format})]})},e.id))]})}),(0,l.jsx)("div",{className:"col-span-1 flex justify-center items-center",children:(0,l.jsx)(e9.Z,{})}),(0,l.jsx)("div",{className:"col-span-4",children:(0,l.jsxs)(tF.Z,{id:"column",value:p.columns[t].target,onChange:e=>Z(t,"target",e),children:[(0,l.jsx)(tF.Z.Option,{value:"",label:"---",className:"!w-[170px]",children:"---"},"empty"),(null!==(a=null==_?void 0:_.columns)&&void 0!==a?a:[]).map(e=>(0,l.jsx)(tF.Z.Option,{value:e.name,label:e.name,className:"!w-[170px]",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"text-foreground",children:e.name}),(0,l.jsx)("span",{className:"text-foreground-lighter",children:e.format})]})},e.id))]})}),(0,l.jsx)("div",{className:"col-span-1 flex justify-end items-center",children:(0,l.jsx)(W.z,{type:"default",className:"px-1",icon:(0,l.jsx)(nb.Z,{}),disabled:1===p.columns.length,onClick:()=>E(t)})})]},"".concat((0,eW.k$)()))})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(W.z,{type:"default",onClick:()=>{f({...p,columns:p.columns.concat([{source:"",target:""}])})},children:"Add another column"}),j.columns&&(0,l.jsx)("p",{className:"text-red-900 text-sm",children:j.columns}),b&&(0,l.jsxs)(t7.bZ,{variant:"warning",children:[(0,l.jsx)(t7.Cd,{children:"Column types do not match"}),(0,l.jsx)(t7.X,{children:"The following columns cannot be referenced as they are not of the same type:"}),(0,l.jsx)("ul",{className:"list-disc pl-5 mt-2 text-foreground-light",children:(null!==(s=null==j?void 0:j.types)&&void 0!==s?s:[]).map((e,t)=>{var n,a;return void 0===e?null:(0,l.jsxs)("li",{children:[(0,l.jsx)("code",{className:"text-xs",children:null===(n=p.columns[t])||void 0===n?void 0:n.source})," (",e.sourceType,") and"," ",(0,l.jsx)("code",{className:"text-xs",children:null===(a=p.columns[t])||void 0===a?void 0:a.target}),"(",e.targetType,")"]},"type-error-".concat(t))})})]}),y&&(0,l.jsxs)(t7.bZ,{children:[(0,l.jsx)(t7.Cd,{children:"Column types will be updated"}),(0,l.jsx)(t7.X,{children:"The following columns will have their types updated to match their referenced column"}),(0,l.jsx)("ul",{className:"list-disc pl-5 mt-2 text-foreground-light",children:(null!==(i=null==j?void 0:j.typeNotice)&&void 0!==i?i:[]).map((e,t)=>{var n;return void 0===e?null:(0,l.jsx)("li",{children:(0,l.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,l.jsx)("code",{className:"text-xs",children:null===(n=p.columns[t])||void 0===n?void 0:n.source})," ",(0,l.jsx)(e9.Z,{})," ",e.targetType]})},"type-error-".concat(t))})})]})]})]}),(0,l.jsx)(eg.ZP.Separator,{}),(0,l.jsx)(J.Z,{icon:(0,l.jsx)(nl.Z,{size:"large",strokeWidth:1.5}),title:"Which action is most appropriate?",description:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("p",{children:"The choice of the action depends on what kinds of objects the related tables represent:"}),(0,l.jsxs)("ul",{className:"mt-2 list-disc pl-4 space-y-1",children:[(0,l.jsxs)("li",{children:[(0,l.jsx)("code",{className:"text-xs",children:"Cascade"}),": if the referencing table represents something that is a component of what is represented by the referenced table and cannot exist independently"]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("code",{className:"text-xs",children:"Restrict"})," or"," ",(0,l.jsx)("code",{className:"text-xs",children:"No action"}),": if the two tables represent independent objects"]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("code",{className:"text-xs",children:"Set NULL"})," or"," ",(0,l.jsx)("code",{className:"text-xs",children:"Set default"}),": if a foreign-key relationship represents optional information"]})]}),(0,l.jsx)("p",{className:"mt-2",children:"Typically, restricting and cascading deletes are the most common options, but the default behavior is no action"})]}),url:"https://www.postgresql.org/docs/current/ddl-constraints.html#DDL-CONSTRAINTS-FK",urlLabel:"More information"}),(0,l.jsx)(tF.Z,{id:"updateAction",value:p.updateAction,label:"Action if referenced row is updated",descriptionText:(0,l.jsx)("p",{children:nr("update",p.updateAction,"".concat(p.schema,".").concat(p.table))}),onChange:e=>T("updateAction",e),children:nN.filter(e=>["no-action","cascade","restrict"].includes(e.key)).map(e=>(0,l.jsx)(tF.Z.Option,{value:e.value,label:e.label,children:(0,l.jsx)("p",{className:"text-foreground",children:e.label})},e.key))}),(0,l.jsx)(tF.Z,{id:"deletionAction",value:p.deletionAction,className:"[&>div>label]:flex [&>div>label]:items-center",label:"Action if referenced row is removed",labelOptional:(0,l.jsx)(W.z,{asChild:!0,type:"default",icon:(0,l.jsx)(t8.Z,{}),children:(0,l.jsx)("a",{target:"_blank",rel:"noreferrer",href:"https://supabase.com/docs/guides/database/postgres/cascade-deletes",children:"Documentation"})}),descriptionText:(0,l.jsx)(l.Fragment,{children:(0,l.jsx)("p",{children:nr("delete",p.deletionAction,"".concat(p.schema,".").concat(p.table))})}),onChange:e=>T("deletionAction",e),children:nN.map(e=>(0,l.jsx)(tF.Z.Option,{value:e.value,label:e.label,children:(0,l.jsx)("p",{className:"text-foreground",children:e.label})},e.key))})]})]})})})};var nC=n(6277),nS=n(38183),nk=n(81733),nE=n(76626);let nZ=e=>{let{foreignKey:t,disabled:n=!1,status:a,layout:s="horizontal",closePanel:i,onSelectEdit:r,onSelectRemove:o,onSelectUndoRemove:c}=e,{ref:d}=(0,x.UO)();return(0,l.jsxs)("div",{className:(0,nC.default)("horizontal"===s?"items-center justify-between gap-x-2":"flex-col gap-y-3","flex border border-strong px-4 py-4","border-b-0 last:border-b first:rounded-t-md last:rounded-b-md"),children:[(0,l.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-y-1",children:[t.name&&(0,l.jsx)("p",{title:t.name,className:"text-xs text-foreground font-mono",children:t.name}),(0,l.jsxs)("div",{className:"flex items-center gap-x-2",children:[void 0!==a&&(0,l.jsx)(nk.C,{variant:"ADD"===a?"brand":"UPDATE"===a?"warning":"destructive",children:a}),(0,l.jsxs)("p",{className:"text-sm text-foreground-light",children:[t.columns.length>1?"Composite foreign":"Foreign"," key relation to:"]}),(0,l.jsx)(W.z,{asChild:!0,type:"default",title:"".concat(t.schema,".").concat(t.table),className:"py-0.5 px-1.5 font-mono",icon:(0,l.jsx)(nS.Z,{className:"table-icon",src:"".concat(nE.GW,"/img/icons/table-icon.svg"),style:{width:"16px",height:"16px",strokeWidth:"1px"},preProcessor:e=>e.replace(/svg/,'svg class="m-auto text-color-inherit"'),loader:(0,l.jsx)("span",{className:"block w-4 h-4 bg-[#133929] rounded-sm"}),cacheRequests:!0}),children:(0,l.jsxs)(O(),{href:"/project/".concat(d,"/editor/").concat(t.tableId),onClick:()=>i(),children:[t.schema,".",t.table]})})]})]}),(0,l.jsx)("div",{className:"flex flex-col gap-y-1",children:t.columns.map((e,n)=>(0,l.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,l.jsx)("code",{className:"text-xs",children:e.source}),(0,l.jsx)(e9.Z,{}),(0,l.jsxs)("code",{className:"text-xs",children:[t.schema,".",t.table,".",e.target]})]},"relation-".concat(n,"}")))})]}),!n&&(0,l.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,l.jsx)(W.z,{type:"default",onClick:r,children:"Edit"}),t.toRemove?(0,l.jsx)(W.z,{type:"default",onClick:c,children:"Cancel remove"}):(0,l.jsx)(W.z,{type:"default",onClick:o,children:"Remove"})]})]})};var nT=e=>{let{column:t,relations:n,closePanel:a,onUpdateColumnType:s,onUpdateFkRelations:i}=e,{id:r}=(0,x.UO)(),[o,c]=(0,q.useState)(!1),[d,u]=(0,q.useState)(),{project:m}=(0,g.d2)(),{data:h}=(0,b.X)({projectRef:null==m?void 0:m.ref,connectionString:null==m?void 0:m.connectionString,schema:t.schema}),p=r?Number(r):void 0,{data:f}=(0,np.Z)(p),j=e=>{let t=(null!=h?h:[]).find(t=>t.id===e.id),a=n.find(t=>t.id===e.id);return(null==a?void 0:a.toRemove)?"REMOVE":void 0===t&&void 0!==a?"ADD":void 0!==t&&void 0!==a&&eV(t,a)?"UPDATE":void 0};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"flex flex-col gap-y-2",children:[n.length>0&&(0,l.jsx)("div",{children:n.map(e=>{let t=j(e);return(0,l.jsx)(nZ,{layout:"vertical",status:t,foreignKey:e,closePanel:a,onSelectEdit:()=>{c(!0),u(e)},onSelectRemove:()=>{"ADD"===t?i(n.filter(t=>t.id!==e.id)):i(n.map(t=>t.id===e.id?{...t,toRemove:!0}:t))},onSelectUndoRemove:()=>{i(n.map(t=>t.id===e.id?{...t,toRemove:!1}:t))}},e.id)})}),(0,l.jsx)(W.z,{type:"default",className:"w-min",onClick:()=>c(!0),children:"Add foreign key"})]}),void 0!==f&&(0,l.jsx)(n_,{visible:o,column:t,table:{id:f.id,name:f.name,columns:t.isNewColumn&&t.name?f.columns.concat(t):f.columns},foreignKey:d,onClose:()=>{c(!1),u(void 0)},onSaveRelation:e=>{var a;let l=n.map(e=>e.id);void 0!==e.id&&l.includes(e.id)?i(n.map(t=>t.id===e.id?e:t)):i(n.concat([e]));let r=null===(a=e.columns.find(e=>e.source===t.name))||void 0===a?void 0:a.targetType;r&&s(r)}})]})},nR=n(47835),nz=e=>{let{table:t,column:n}=e;return n?(0,l.jsxs)(l.Fragment,{children:["Update column ",(0,l.jsx)("code",{children:n.name})," from ",(0,l.jsx)("code",{children:n.table})]}):(0,l.jsxs)(l.Fragment,{children:["Add new column to ",(0,l.jsx)("code",{children:t.name})]})},nA=e=>{var t,n,a,i,r;let{column:o,selectedTable:c,visible:d=!1,closePanel:u=es(),saveChanges:m=es(),updateEditorDirty:h=es()}=e,{ref:p}=(0,x.UO)(),{project:f}=(0,g.d2)(),[j,v]=(0,q.useState)({}),[y,N]=(0,q.useState)(),[w,_]=(0,q.useState)([]),{data:C}=(0,ns.k)({projectRef:null==f?void 0:f.ref,connectionString:null==f?void 0:f.connectionString}),S=(null!=C?C:[]).filter(e=>!R.U.includes(e.schema)),{data:k}=na({projectRef:null==f?void 0:f.ref,connectionString:null==f?void 0:f.connectionString,schema:null==c?void 0:c.schema,table:null==c?void 0:c.name}),E=(null!=k?k:[]).find(e=>e.type===s.PRIMARY_KEY_CONSTRAINT),{data:Z}=(0,b.X)({projectRef:null==f?void 0:f.ref,connectionString:null==f?void 0:f.connectionString,schema:null==c?void 0:c.schema}),T=void 0===o,z=Z||[],A=z.filter(e=>e.source_id===(null==o?void 0:o.table_id)&&e.source_columns.includes(o.name)),P=void 0!==w.find(e=>void 0!==e.columns.find(e=>e.source===(null==y?void 0:y.name))&&!e.toRemove);if((0,q.useEffect)(()=>{d&&(v({}),N(T?(0,eU.QZ)({schema:c.schema,table:c.name}):(0,eU.uE)(o,c,z)),_(ni(A)))},[d]),!y)return null;let L=e=>{tO.BB.includes(y.format)||""!==e.defaultValue||(e.defaultValue=null),N({...y,...e}),h();let t={...j};for(let n of Object.keys(e))delete t[n];v(t)},I=e=>{if(y){let t=(0,eU.Of)(y);(v(t),en()(t))?m(T?(0,eU.oo)(c.id,y):(0,eU.xY)(o,c,y),T,{columnId:null==o?void 0:o.id,primaryKey:E,foreignKeyRelations:w,existingForeignKeyRelations:A},e):e()}};return(0,l.jsxs)(eg.ZP,{size:"xlarge",visible:d,onConfirm:e=>I(e),header:(0,l.jsx)(nz,{table:c,column:o}),onCancel:u,customFooter:(0,l.jsx)(eC.Z,{backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:u,applyFunction:e=>I(e)}),children:[(0,l.jsx)(nt.hj,{header:(0,l.jsx)(nt.S0,{className:"lg:!col-span-4",children:"General"}),children:(0,l.jsxs)(nt.B4,{loading:!1,className:"lg:!col-span-8",children:[(0,l.jsx)(t_.Z,{label:"Name",type:"text",descriptionText:"Recommended to use lowercase and use an underscore to separate words e.g. column_name",placeholder:"column_name",error:j.name,value:null!==(t=null==y?void 0:y.name)&&void 0!==t?t:"",onChange:e=>L({name:e.target.value})}),(0,l.jsx)(t_.Z,{label:"Description",labelOptional:"Optional",type:"text",value:null!==(n=null==y?void 0:y.comment)&&void 0!==n?n:"",onChange:e=>L({comment:e.target.value})})]})}),(0,l.jsx)(eg.ZP.Separator,{}),(0,l.jsx)(nt.hj,{header:(0,l.jsx)(nt.S0,{className:"lg:!col-span-4",description:(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(W.z,{asChild:!0,type:"default",size:"tiny",icon:(0,l.jsx)(t5.Z,{size:14,strokeWidth:2}),children:(0,l.jsx)(O(),{href:"/project/".concat(p,"/database/types"),target:"_blank",rel:"noreferrer",children:"Create enum types"})}),(0,l.jsx)(W.z,{asChild:!0,type:"default",size:"tiny",icon:(0,l.jsx)(t8.Z,{size:14,strokeWidth:2}),children:(0,l.jsx)(O(),{href:"https://supabase.com/docs/guides/database/tables#data-types",target:"_blank",rel:"noreferrer",children:"About data types"})})]}),children:"Data Type"}),children:(0,l.jsxs)(nt.B4,{loading:!1,className:"lg:!col-span-8",children:[(0,l.jsx)(nR.Z,{showRecommendation:!0,value:null!==(a=null==y?void 0:y.format)&&void 0!==a?a:"",layout:"vertical",enumTypes:S,error:j.format,description:P?"Column type cannot be changed as it has a foreign key relation":"",disabled:P,onOptionSelect:e=>L({format:e,defaultValue:null})}),void 0===y.foreignKey&&(0,l.jsxs)("div",{className:"space-y-4",children:[y.format.includes("int")&&(0,l.jsx)("div",{className:"w-full",children:(0,l.jsx)(t6.Z,{label:"Is Identity",description:"Automatically assign a sequential unique number to the column",checked:y.isIdentity,onChange:()=>{let e=!y.isIdentity,t=!e&&y.isArray;L({isIdentity:e,isArray:t})}})}),!y.isPrimaryKey&&(0,l.jsx)("div",{className:"w-full",children:(0,l.jsx)(t6.Z,{label:"Define as Array",description:"Allow column to be defined as variable-length multidimensional arrays",checked:y.isArray,onChange:()=>{let e=!y.isArray,t=!e&&y.isIdentity;L({isArray:e,isIdentity:t})}})})]}),(0,l.jsx)(nx,{columnFields:y,enumTypes:S,onUpdateField:L})]})}),(0,l.jsx)(eg.ZP.Separator,{}),(0,l.jsx)(nt.hj,{header:(0,l.jsx)(nt.S0,{className:"lg:!col-span-4",children:"Foreign Keys"}),children:(0,l.jsx)(nt.B4,{loading:!1,className:"lg:!col-span-8",children:(0,l.jsx)(nT,{column:y,relations:w,closePanel:u,onUpdateColumnType:e=>L({format:e,defaultValue:null}),onUpdateFkRelations:_})})}),(0,l.jsx)(eg.ZP.Separator,{}),(0,l.jsx)(nt.hj,{header:(0,l.jsx)(nt.S0,{className:"lg:!col-span-4",children:"Constraints"}),children:(0,l.jsxs)(nt.B4,{loading:!1,className:"lg:!col-span-8",children:[(0,l.jsx)(t9.Z,{label:"Is Primary Key",descriptionText:"A primary key indicates that a column or group of columns can be used as a unique identifier for rows in the table",checked:null!==(i=null==y?void 0:y.isPrimaryKey)&&void 0!==i&&i,onChange:()=>L({isPrimaryKey:!(null==y?void 0:y.isPrimaryKey)})}),(0,l.jsx)(t9.Z,{label:"Allow Nullable",descriptionText:"Allow the column to assume a NULL value if no value is provided",checked:y.isNullable,onChange:()=>L({isNullable:!y.isNullable})}),(0,l.jsx)(t9.Z,{label:"Is Unique",descriptionText:"Enforce values in the column to be unique across rows",checked:y.isUnique,onChange:()=>L({isUnique:!y.isUnique})}),(0,l.jsx)(t_.Z,{label:"CHECK Constraint",labelOptional:"Optional",placeholder:"e.g length(".concat((null==y?void 0:y.name)||"column_name",") < 500"),type:"text",value:null!==(r=null==y?void 0:y.check)&&void 0!==r?r:"",onChange:e=>L({check:e.target.value}),className:"[&_input]:font-mono"})]})}),T&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(eg.ZP.Separator,{}),(0,l.jsx)(nt.hj,{header:(0,l.jsx)(nt.S0,{className:"lg:!col-span-4",children:"Security"}),children:(0,l.jsx)(nt.B4,{loading:!1,className:"lg:!col-span-8",children:(0,l.jsxs)(t7.bZ,{children:[(0,l.jsx)($.Z,{}),(0,l.jsx)(t7.Cd,{children:"Column encryption has been removed from the GUI"}),(0,l.jsxs)(t7.X,{children:[(0,l.jsxs)("p",{className:"!leading-normal",children:["You may still encrypt new columns through the SQL editor using"," ",(0,l.jsx)(O(),{href:"/project/".concat(p,"/database/extensions?filter=pgsodium"),className:"text-brand hover:underline",children:"pgsodium's"})," ","Transparent Column Encryption (TCE)."]}),(0,l.jsx)(W.z,{asChild:!0,type:"default",icon:(0,l.jsx)(t8.Z,{}),className:"mt-2",children:(0,l.jsx)(O(),{target:"_blank",rel:"noreferrer",href:"https://github.com/orgs/supabase/discussions/18849",children:"Learn more"})})]})]})})}),(0,l.jsx)(eg.ZP.Separator,{}),(0,l.jsx)(nt.hj,{header:(0,l.jsx)(nt.S0,{className:"lg:!col-span-4",children:"Column privileges"}),children:(0,l.jsx)(nt.B4,{loading:!1,className:"lg:!col-span-8",children:(0,l.jsxs)(t7.bZ,{variant:"warning",children:[(0,l.jsx)(ne.Z,{strokeWidth:2}),(0,l.jsx)(t7.Cd,{children:"This table uses column-privileges"}),(0,l.jsxs)(t7.X,{children:[(0,l.jsx)("p",{children:"Several columns in this table have column-level privileges. This new column will have privileges set to on by default."}),(0,l.jsx)("p",{className:"mt-3",children:(0,l.jsx)(O(),{href:"/project/".concat(p,"/database/privileges"),passHref:!0,children:(0,l.jsx)(W.z,{asChild:!0,type:"default",size:"tiny",children:(0,l.jsx)("a",{children:"Column-level privileges"})})})})]})]})})})]})]},"ColumnEditor")},nP=n(66513),nL=n(37891),nI=n(40023),nD=n(8448),nF=n(21784),nO=n(63952),nq=n(73485),nW=n(2448),nU=e=>{var t,n;let{column:a=z.kT,enumTypes:s=z.Z6,isNewRecord:i=!1,hasForeignKeys:r=!1,hasImportContent:o=!1,dragHandleProps:c=z.kT,onUpdateColumn:d=es(),onRemoveColumn:u=es()}=e,m=null!==(t=null==nd?void 0:nd[a.format])&&void 0!==t?t:[],h=[a.isNullable?1:0,a.isIdentity?1:0,a.isUnique?1:0,a.isArray?1:0].reduce((e,t)=>e+t,0);return(0,l.jsxs)("div",{className:"flex w-full items-center",children:[(0,l.jsx)("div",{className:"w-[5%] ".concat(i?"":"hidden"),children:(0,l.jsx)("div",{className:"cursor-drag",...c,children:(0,l.jsx)(nO.Z,{strokeWidth:1,size:15})})}),(0,l.jsx)("div",{className:"w-[25%]",children:(0,l.jsx)("div",{className:"flex w-[95%] items-center justify-between",children:(0,l.jsx)(t_.Z,{value:a.name,size:"small",title:a.name,disabled:o,placeholder:"column_name",className:"table-editor-columns-input bg-surface-100 lg:gap-0 ".concat(o?"opacity-50":""," rounded-md"),onChange:e=>d({name:e.target.value})})})}),(0,l.jsx)("div",{className:"w-[25%]",children:(0,l.jsx)("div",{className:"w-[95%]",children:(0,l.jsx)(nR.Z,{value:a.format,enumTypes:s,size:"small",showLabel:!1,className:"table-editor-column-type lg:gap-0 ",disabled:r,description:r?"Column type cannot be changed as it has a foreign key relation":"",onOptionSelect:e=>{d({format:e,defaultValue:"uuid"===e?"gen_random_uuid()":null})}})})}),(0,l.jsx)("div",{className:"".concat(i?"w-[25%]":"w-[30%]"),children:(0,l.jsx)("div",{className:"w-[95%]",children:(0,l.jsx)(nh,{placeholder:"string"==typeof a.defaultValue&&0===a.defaultValue.length?"EMPTY":"NULL",size:"small",value:null!==(n=a.defaultValue)&&void 0!==n?n:"",disabled:a.format.includes("int")&&a.isIdentity,className:"rounded bg-surface-100 lg:gap-0 ".concat(a.format.includes("int")&&a.isIdentity?"opacity-50":""),suggestions:m,suggestionsHeader:"Suggested expressions",suggestionsTooltip:"Suggested expressions",onChange:e=>d({defaultValue:e.target.value}),onSelectSuggestion:e=>d({defaultValue:e.value})})})}),(0,l.jsx)("div",{className:"w-[10%]",children:(0,l.jsx)(t6.Z,{label:"",checked:a.isPrimaryKey,onChange:()=>d({isPrimaryKey:!a.isPrimaryKey})})}),(0,l.jsx)("div",{className:"".concat(o?"w-[10%]":"w-[0%]")}),(0,l.jsx)("div",{className:"flex w-[5%] justify-end",children:(!a.isPrimaryKey||a.format.includes("int"))&&(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(nq.Z,{size:"xlarge",className:"pointer-events-auto",align:"end",modal:!0,header:(0,l.jsx)("div",{className:"flex items-center justify-center",children:(0,l.jsx)("h5",{className:"text-sm text-foreground",children:"Extra options"})}),overlay:[(0,l.jsxs)("div",{className:"flex flex-col space-y-1",children:[!a.isPrimaryKey&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(t6.Z,{label:"Is Nullable",description:"Specify if the column can assume a NULL value if no value is provided",checked:a.isNullable,className:"p-4",onChange:()=>d({isNullable:!a.isNullable})}),(0,l.jsx)(nq.Z.Separator,{})]}),(0,l.jsx)(t6.Z,{label:"Is Unique",description:"Enforce if values in the column should be unique across rows",checked:a.isUnique,className:"p-4",onChange:()=>d({isUnique:!a.isUnique})}),(0,l.jsx)(nq.Z.Separator,{}),a.format.includes("int")&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(t6.Z,{label:"Is Identity",description:"Automatically assign a sequential unique number to the column",checked:a.isIdentity,className:"p-4",onChange:()=>{let e=!a.isIdentity,t=!e&&a.isArray;d({isIdentity:e,isArray:t})}}),(0,l.jsx)(nq.Z.Separator,{})]}),!a.isPrimaryKey&&(0,l.jsx)(t6.Z,{label:"Define as Array",description:"Define your column as a variable-length multidimensional array",checked:a.isArray,className:"p-4",onChange:()=>{let e=!a.isArray,t=!e&&a.isIdentity;d({isArray:e,isIdentity:t})}})]},"".concat(a.id,"_configuration"))],children:(0,l.jsxs)("div",{className:"group flex items-center -space-x-1",children:[h>0&&(0,l.jsx)("div",{className:"rounded-full bg-foreground py-0.5 px-2 text-xs text-background",children:h}),(0,l.jsx)("div",{className:"text-foreground-light transition-colors group-hover:text-foreground",children:(0,l.jsx)(nW.Z,{size:18,strokeWidth:1})})]})})})}),!o&&(0,l.jsx)("div",{className:"flex w-[5%] justify-end",children:(0,l.jsx)("button",{className:"cursor-pointer",onClick:()=>u(),children:(0,l.jsx)(nb.Z,{strokeWidth:1})})})]})},nV=e=>{var t;let{columns:n=[],relations:a,enumTypes:s=[],importContent:i,isNewRecord:r,onColumnsUpdated:o=es(),onSelectImportData:c=es(),onClearImportContent:d=es()}=e,u=!en()(i),[m,h]=tR()(n,e=>e.isPrimaryKey),x=e=>void 0!==a.find(t=>t.columns.find(t=>t.source===e.name)),p=(e,t)=>{o(n.map(n=>{if(n.id!==e.id)return n;if(tO.BB.includes(e.format)||""!==t.defaultValue||(t.defaultValue=null),"name"in t&&void 0!==n.foreignKey){var a;let e={...n.foreignKey,source_column_name:null!==(a=null==t?void 0:t.name)&&void 0!==a?a:""};return{...n,...t,foreignKey:e}}return{...n,...t}}))},f=()=>{let e=(0,eU.QZ)();o(n.concat(e))},g=e=>{o(n.filter(t=>t.id!==e.id))},j=(e,t)=>{if(e.destination){if("pks"===t){let t=m.slice(),[n]=t.splice(e.source.index,1);return t.splice(e.destination.index,0,n),o(t.concat(h))}if("others"===t){let t=h.slice(),[n]=t.splice(e.source.index,1);return t.splice(e.destination.index,0,n),o(m.concat(t))}}};return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{className:"w-full space-y-4 table-editor-columns",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,l.jsx)("h5",{children:"Columns"}),(0,l.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,l.jsx)(W.z,{asChild:!0,type:"default",icon:(0,l.jsx)(t8.Z,{size:12,strokeWidth:2}),children:(0,l.jsx)("a",{href:"https://supabase.com/docs/guides/database/tables#data-types",target:"_blank",rel:"noreferrer",children:"About data types"})}),r&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"py-3 border-r"}),u?(0,l.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,l.jsx)(W.z,{type:"default",icon:(0,l.jsx)(nD.Z,{}),onClick:c,children:"Edit content"}),(0,l.jsx)(W.z,{type:"danger",icon:(0,l.jsx)(nF.Z,{}),onClick:d,children:"Remove content"})]}):(0,l.jsx)(W.z,{type:"default",onClick:c,children:"Import data via spreadsheet"})]})]})]}),u&&(0,l.jsxs)("p",{className:"text-sm text-foreground-light my-2",children:["Your table will be created with ",null==i?void 0:null===(t=i.rowCount)||void 0===t?void 0:t.toLocaleString()," rows and the following ",n.length," columns."]}),0===m.length&&(0,l.jsx)(nP.b,{title:"Warning: No primary keys selected",variant:"warning",withIcon:!0,children:"Tables require at least one column as a primary key in order to uniquely identify each row. Without a primary key, you will not be able to update or delete rows from the table."}),m.length>1&&(0,l.jsx)(J.Z,{block:!0,icon:(0,l.jsx)(tn.Z,{className:"text-white",size:"large"}),title:"Composite primary key selected",description:"The columns that you've selected will be grouped as a primary key, and will serve as the unique identifier for the rows in your table"}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"flex w-full px-3",children:[r&&(0,l.jsx)("div",{className:"w-[5%]"}),(0,l.jsxs)("div",{className:"w-[25%] flex items-center space-x-2",children:[(0,l.jsx)("h5",{className:"text-xs text-foreground-lighter",children:"Name"}),(0,l.jsxs)(P.fC,{delayDuration:0,children:[(0,l.jsx)(P.xz,{children:(0,l.jsx)("h5",{className:"text-xs text-foreground-lighter",children:(0,l.jsx)(nl.Z,{size:15,strokeWidth:1.5})})}),(0,l.jsx)(P.h_,{children:(0,l.jsxs)(P.VY,{side:"bottom",children:[(0,l.jsx)(P.Eh,{className:"radix-tooltip-arrow"}),(0,l.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background w-[300px]",children:(0,l.jsx)("span",{className:"text-xs text-foreground",children:"Recommended to use lowercase and use an underscore to separate words e.g. column_name"})})]})})]})]}),(0,l.jsx)("div",{className:"w-[25%]",children:(0,l.jsx)("h5",{className:"text-xs text-foreground-lighter",children:"Type"})}),(0,l.jsxs)("div",{className:"".concat(r?"w-[25%]":"w-[30%]"," flex items-center space-x-2"),children:[(0,l.jsx)("h5",{className:"text-xs text-foreground-lighter",children:"Default Value"}),(0,l.jsxs)(P.fC,{delayDuration:0,children:[(0,l.jsx)(P.xz,{children:(0,l.jsx)("h5",{className:"text-xs text-foreground-lighter",children:(0,l.jsx)(nl.Z,{size:15,strokeWidth:1.5})})}),(0,l.jsx)(P.h_,{children:(0,l.jsxs)(P.VY,{side:"bottom",children:[(0,l.jsx)(P.Eh,{className:"radix-tooltip-arrow"}),(0,l.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background w-[300px]",children:(0,l.jsx)("span",{className:"text-xs text-foreground",children:"Can either be a literal or an expression. When using an expression wrap your expression in brackets, e.g. (gen_random_uuid())"})})]})})]})]}),(0,l.jsx)("div",{className:"w-[10%]",children:(0,l.jsx)("h5",{className:"text-xs text-foreground-lighter",children:"Primary"})}),(0,l.jsx)("div",{className:"".concat(u?"w-[10%]":"w-0")}),(0,l.jsx)("div",{className:"w-[5%]"}),!u&&(0,l.jsx)("div",{className:"w-[5%]"})]}),m.length>0&&(0,l.jsx)(nI.Z5,{onDragEnd:e=>j(e,"pks"),children:(0,l.jsx)(nI.bK,{droppableId:"pk_columns_droppable",children:e=>(0,l.jsxs)("div",{ref:e.innerRef,className:"space-y-2 rounded-md bg-surface-200 px-3 py-2 ".concat(r?"":"-mx-3"),children:[m.map((e,t)=>(0,l.jsx)(nI._l,{draggableId:e.id,index:t,children:t=>(0,l.jsx)("div",{ref:t.innerRef,...t.draggableProps,children:(0,l.jsx)(nU,{column:e,enumTypes:s,hasForeignKeys:x(e),isNewRecord:r,hasImportContent:u,dragHandleProps:t.dragHandleProps,onUpdateColumn:t=>p(e,t),onRemoveColumn:()=>g(e)})})},e.id)),e.placeholder]})})}),(0,l.jsx)(nI.Z5,{onDragEnd:e=>j(e,"others"),children:(0,l.jsx)(nI.bK,{droppableId:"other_columns_droppable",children:e=>(0,l.jsxs)("div",{ref:e.innerRef,className:"space-y-2 py-2 ".concat(r?"px-3 ":""),children:[h.map((e,t)=>(0,l.jsx)(nI._l,{draggableId:e.id,index:t,children:t=>(0,l.jsx)("div",{ref:t.innerRef,...t.draggableProps,children:(0,l.jsx)(nU,{column:e,enumTypes:s,isNewRecord:r,hasForeignKeys:x(e),hasImportContent:u,dragHandleProps:t.dragHandleProps,onUpdateColumn:t=>p(e,t),onRemoveColumn:()=>g(e)})})},e.id)),e.placeholder]})})})]}),!u&&(0,l.jsx)("div",{className:"flex items-center justify-center rounded border border-strong border-dashed py-3",children:(0,l.jsx)(W.z,{type:"default",onClick:()=>f(),children:"Add column"})})]})})},nM=n(33105),nB=n(54175);let nK=e=>{let{table:t,relations:n,closePanel:a,setEditorDirty:s,onUpdateFkRelations:i}=e,{project:r}=(0,g.d2)(),o=(0,A._2)(),[c,d]=(0,q.useState)(!1),[u,m]=(0,q.useState)(),{data:h,error:x,isLoading:p,isSuccess:f,isError:j}=(0,b.X)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,schema:o.selectedSchemaName}),v=e=>{let t=(null!=h?h:[]).find(t=>t.id===e.id),a=n.find(t=>t.id===e.id);return(null==a?void 0:a.toRemove)?"REMOVE":void 0===t&&void 0!==a?"ADD":void 0!==t&&void 0!==a&&eV(t,a)?"UPDATE":void 0};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"w-full space-y-4 ",children:[(0,l.jsx)("h5",{children:"Foreign keys"}),p&&(0,l.jsx)(nB.A,{}),j&&(0,l.jsx)(nM.Z,{error:x,subject:"Failed to retrieve foreign key relationships"}),f&&(0,l.jsx)("div",{children:n.map(e=>{let t=v(e);return(0,l.jsx)(nZ,{status:t,foreignKey:e,closePanel:a,onSelectEdit:()=>{d(!0),m(e)},onSelectRemove:()=>{s(),"ADD"===t?i(n.filter(t=>t.id!==e.id)):i(n.map(t=>t.id===e.id?{...t,toRemove:!0}:t))},onSelectUndoRemove:()=>{s(),i(n.map(t=>t.id===e.id?{...t,toRemove:!1}:t))}},e.id)})}),(0,l.jsx)("div",{className:"flex items-center justify-center rounded border border-strong border-dashed py-3",children:(0,l.jsx)(W.z,{type:"default",onClick:()=>d(!0),children:"Add foreign key relation"})})]}),(0,l.jsx)(n_,{visible:c,table:{id:t.id,name:t.name,columns:t.columns},foreignKey:u,onClose:()=>{d(!1),m(void 0)},onSaveRelation:e=>{s();let t=n.map(e=>e.id);void 0!==e.id&&t.includes(e.id)?i(n.map(t=>t.id===e.id?e:t)):i(n.concat([e]))}})]})};var nY=e=>{let{schema:t,table:n,isDuplicating:a}=e;return n?a?(0,l.jsxs)(l.Fragment,{children:["Duplicate table ",(0,l.jsx)("code",{className:"text-sm",children:null==n?void 0:n.name})]}):(0,l.jsxs)(l.Fragment,{children:["Update table ",(0,l.jsx)("code",{className:"text-sm",children:null==n?void 0:n.name})]}):(0,l.jsxs)(l.Fragment,{children:["Create a new table under ",(0,l.jsx)("code",{className:"text-sm",children:t})]})},nQ=n(41532),nH=n(35723),nG=n(12203);function nX(){return(0,l.jsx)("div",{className:"my-6",children:(0,l.jsxs)("div",{className:"text-sm text-foreground-light grid gap-4",children:[(0,l.jsxs)("div",{className:"grid gap-1",children:[(0,l.jsx)(nP.b,{variant:"warning",className:"!px-4 !py-3",title:"This table will be publicly readable and writable",withIcon:!0,children:(0,l.jsx)("p",{children:"Anyone can edit or delete data in this table."})}),(0,l.jsxs)("ul",{className:"mt-4 space-y-5",children:[(0,l.jsxs)("li",{className:"flex gap-3",children:[(0,l.jsx)(nQ.Z,{}),(0,l.jsx)("span",{children:"All requests to this table will be accepted."})]}),(0,l.jsxs)("li",{className:"flex gap-3",children:[(0,l.jsx)(nH.Z,{}),(0,l.jsx)("span",{children:"Auth policies will not be enforced."})]}),(0,l.jsxs)("li",{className:"flex gap-3",children:[(0,l.jsx)(nG.Z,{w:14,className:"flex-shrink-0"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("strong",{children:"Before you turn off Row Level Security, consider:"}),(0,l.jsxs)("ul",{className:"space-y-2 mt-2",children:[(0,l.jsx)("li",{className:"list-disc ml-4",children:"Any personal information in this table will be publicly accessible."}),(0,l.jsx)("li",{className:"list-disc ml-4",children:"Anyone will be able to modify, add or delete any row in this table."})]})]})]})]})]}),(0,l.jsx)("div",{className:"mt-3",children:(0,l.jsx)("p",{className:"mt-2",children:(0,l.jsx)(W.z,{asChild:!0,type:"default",icon:(0,l.jsx)(nL.Z,{strokeWidth:1.5}),children:(0,l.jsx)(O(),{href:"https://supabase.com/docs/guides/auth/row-level-security",target:"_blank",rel:"noreferrer",children:"RLS Documentation"})})})})]})})}let n$=[{id:(0,eW.k$)(),name:"id",schema:"",table:"",format:"int8",defaultValue:null,check:null,foreignKey:void 0,isNullable:!1,isUnique:!1,isArray:!1,isPrimaryKey:!0,isIdentity:!0,isNewColumn:!0,isEncrypted:!1},{id:(0,eW.k$)(),name:"created_at",schema:"",table:"",format:"timestamptz",defaultValue:"now()",check:null,foreignKey:void 0,isNullable:!1,isUnique:!1,isArray:!1,isPrimaryKey:!1,isIdentity:!1,isNewColumn:!0,isEncrypted:!1}];var nJ=n(51525),n0=n.n(nJ);let n1=e=>{let t={};return 0===e.name.length&&(t.name="Please assign a name for your table"),n0()(e.columns,e=>0===e.format.length)&&(t.columns="Ensure that all your columns are assigned a type"),n0()(e.columns,e=>0===e.name.length)&&(t.columns="Ensure that all your columns are named"),t},n2=()=>({id:0,name:"",comment:"",columns:n$,isRLSEnabled:!0,isRealtimeEnabled:!1}),n4=function(e,t){var n;let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return{id:e.id,name:a?"".concat(e.name,"_duplicate"):e.name,comment:a?"This is a duplicate of ".concat(e.name):null!==(n=null==e?void 0:e.comment)&&void 0!==n?n:"",columns:e.columns.map(n=>(0,eU.uE)(n,e,t)),isRLSEnabled:e.rls_enabled,isRealtimeEnabled:s}},n3=e=>{let{headers:t,selectedHeaders:n,columnTypeMap:a}=e;return t.filter(e=>n.includes(e)).map(e=>{let t=a[e];return(0,eU.QZ)({name:e,format:t})})};var n5=e=>{var t,n;let{table:a,isDuplicating:i,visible:r=!1,closePanel:o=es(),saveChanges:c=es(),updateEditorDirty:d=es()}=e,m=(0,A._2)(),{project:x}=(0,g.d2)(),p=u()(a),f=(0,Z.N3)("realtime:all"),{data:j}=(0,ns.k)({projectRef:null==x?void 0:x.ref,connectionString:null==x?void 0:x.connectionString}),v=(null!=j?j:[]).filter(e=>!R.U.includes(e.schema)),{data:y}=(0,Y.z)({projectRef:null==x?void 0:x.ref,connectionString:null==x?void 0:x.connectionString}),N=(null!=y?y:[]).find(e=>"supabase_realtime"===e.name),w=null!==(t=null==N?void 0:N.tables)&&void 0!==t?t:[],_=!p&&w.some(e=>e.id===(null==a?void 0:a.id)),[C,S]=(0,q.useState)({}),[k,E]=(0,q.useState)(),[T,z]=(0,q.useState)([]),[P,L]=(0,q.useState)(!1),[I,D]=(0,q.useState)(),[F,U]=(0,q.useState)(!1),[V,B]=(0,q.useState)(!1),{data:K}=na({projectRef:null==x?void 0:x.ref,connectionString:null==x?void 0:x.connectionString,schema:null==a?void 0:a.schema,table:null==a?void 0:a.name}),Q=(null!=K?K:[]).find(e=>e.type===s.PRIMARY_KEY_CONSTRAINT),{data:H}=(0,b.X)({projectRef:null==x?void 0:x.ref,connectionString:null==x?void 0:x.connectionString,schema:null==a?void 0:a.schema}),G=(null!=H?H:[]).filter(e=>e.source_schema===(null==a?void 0:a.schema)&&e.source_table===(null==a?void 0:a.name)),X=e=>{E({...k,...e}),d();let t={...C};for(let n of Object.keys(e))delete t[n];S(t)},$=e=>{if(k){let n=n1(k);if(n.columns&&h.ZP.error(n.columns),S(n),en()(n)){var t;let n={name:k.name.trim(),schema:m.selectedSchemaName,comment:null===(t=k.comment)||void 0===t?void 0:t.trim(),...!p&&{rls_enabled:k.isRLSEnabled}},s={tableId:null==a?void 0:a.id,importContent:I,isRLSEnabled:k.isRLSEnabled,isRealtimeEnabled:k.isRealtimeEnabled,isDuplicateRows:P,existingForeignKeyRelations:G,primaryKey:Q};c(n,k.columns.map(e=>({...e,name:e.name.trim()})),T,p,s,e)}else e()}};return((0,q.useEffect)(()=>{r&&(S({}),D(void 0),L(!1),p?(E(n2()),z([])):(E(n4(a,H||[],i,_)),z(ni(G))))},[r]),(0,q.useEffect)(()=>{I&&!en()(I)&&X({columns:n3(I)})},[I]),k)?(0,l.jsxs)(eg.ZP,{size:"large",visible:r,header:(0,l.jsx)(nY,{schema:m.selectedSchemaName,table:a,isDuplicating:i}),className:"transition-all duration-100 ease-in ".concat(F?" mr-32":""),onCancel:o,onConfirm:()=>e=>$(e),customFooter:(0,l.jsx)(eC.Z,{backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:o,applyFunction:e=>$(e)}),children:[(0,l.jsxs)(eg.ZP.Content,{className:"space-y-10 py-6",children:[(0,l.jsx)(t_.Z,{label:"Name",layout:"horizontal",type:"text",error:C.name,value:null==k?void 0:k.name,onChange:e=>X({name:e.target.value})}),(0,l.jsx)(t_.Z,{label:"Description",placeholder:"Optional",layout:"horizontal",type:"text",value:null!==(n=null==k?void 0:k.comment)&&void 0!==n?n:"",onChange:e=>X({comment:e.target.value})})]}),(0,l.jsx)(eg.ZP.Separator,{}),(0,l.jsxs)(eg.ZP.Content,{className:"space-y-10 py-6",children:[(0,l.jsx)(t6.Z,{id:"enable-rls",label:(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("span",{children:"Enable Row Level Security (RLS)"}),(0,l.jsx)(nk.C,{children:"Recommended"})]}),description:(0,l.jsx)(l.Fragment,{children:(0,l.jsx)("p",{children:"Restrict access to your table by enabling RLS and writing Postgres policies."})}),checked:k.isRLSEnabled,onChange:()=>{k.isRLSEnabled?B(!0):X({isRLSEnabled:!k.isRLSEnabled})},size:"medium"}),k.isRLSEnabled?(0,l.jsxs)(nP.b,{withIcon:!0,variant:"info",className:"!px-4 !py-3 !mt-3",title:"Policies are required to query data",children:[(0,l.jsxs)("p",{children:["You need to write an access policy before you can query data from this table. Without a policy, querying this table will result in an ",(0,l.jsx)("u",{children:"empty array"})," of results."]}),p&&(0,l.jsx)("p",{className:"mt-3",children:"You can create policies after you create this table."}),(0,l.jsx)("p",{className:"mt-4",children:(0,l.jsx)(W.z,{asChild:!0,type:"default",icon:(0,l.jsx)(nL.Z,{strokeWidth:1.5}),children:(0,l.jsx)(O(),{href:"https://supabase.com/docs/guides/auth/row-level-security",target:"_blank",rel:"noreferrer",children:"RLS Documentation"})})})]}):(0,l.jsxs)(nP.b,{withIcon:!0,variant:"warning",className:"!px-4 !py-3 mt-3",title:"You are allowing anonymous access to your table",children:[(0,l.jsxs)("p",{children:[k.name?"The table ".concat(k.name):"Your table"," will be publicly writable and readable"]}),(0,l.jsx)("p",{className:"mt-4",children:(0,l.jsx)(W.z,{asChild:!0,type:"default",icon:(0,l.jsx)(nL.Z,{strokeWidth:1.5}),children:(0,l.jsx)(O(),{href:"https://supabase.com/docs/guides/auth/row-level-security",target:"_blank",rel:"noreferrer",children:"RLS Documentation"})})})]}),f&&(0,l.jsx)(t6.Z,{id:"enable-realtime",label:"Enable Realtime",description:"Broadcast changes on this table to authorized subscribers",checked:k.isRealtimeEnabled,onChange:()=>X({isRealtimeEnabled:!k.isRealtimeEnabled}),size:"medium"})]}),(0,l.jsx)(eg.ZP.Separator,{}),(0,l.jsxs)(eg.ZP.Content,{className:"space-y-10 py-6",children:[!i&&(0,l.jsx)(nV,{columns:null==k?void 0:k.columns,relations:T,enumTypes:v,isNewRecord:p,importContent:I,onColumnsUpdated:e=>X({columns:e}),onSelectImportData:()=>U(!0),onClearImportContent:()=>{X({columns:n$}),D(void 0)}}),i&&(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(t6.Z,{id:"duplicate-rows",label:"Duplicate table entries",description:"This will copy all the data in the table into the new table",checked:P,onChange:()=>L(!P),size:"medium"})}),(0,l.jsx)(ag,{visible:F,headers:null==I?void 0:I.headers,rows:null==I?void 0:I.rows,saveContent:e=>{D(e),U(!1)},closePanel:()=>U(!1)}),(0,l.jsx)(M.Z,{visible:V,title:"Turn off Row Level Security",confirmLabel:"Confirm",size:"medium",onCancel:()=>B(!1),onConfirm:()=>{X({isRLSEnabled:!k.isRLSEnabled}),B(!1)},children:(0,l.jsx)(nX,{})})]}),!i&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(eg.ZP.Separator,{}),(0,l.jsx)(eg.ZP.Content,{className:"py-6",children:(0,l.jsx)(nK,{table:k,relations:T,closePanel:o,setEditorDirty:()=>d(),onUpdateFkRelations:e=>{if(void 0===k)return;let t=[];e.forEach(e=>{e.columns.forEach(e=>{let n=k.columns.find(t=>t.name===e.source);(null==n?void 0:n.isNewColumn)&&e.targetType&&t.push({...n,format:e.targetType})})}),t.length>0&&E({...k,columns:k.columns.map(e=>t.find(t=>t.id===e.id)||e)}),z(e)}})})]})]},"TableEditor"):null},n8=n(54073),n6=n.n(n8),n9=n(96383),n7=n(46398),ae=e=>{let{parseProgress:t,uploadedFile:n,onFileUpload:a,removeUploadedFile:s}=e,[i,r]=(0,q.useState)(!1),o=(0,q.useRef)(null),c=e=>{"dragover"!==e.type||i?("dragleave"===e.type||"drop"===e.type)&&r(!1):r(!0),e.stopPropagation(),e.preventDefault()};return(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("p",{className:"mb-2 text-sm text-foreground-light",children:["Upload a CSV or TSV file. The first row should be the headers of the table, and your headers should not include any special characters other than hyphens (",(0,l.jsx)("span",{className:"text-code",children:"-"}),") or underscores (",(0,l.jsx)("span",{className:"text-code",children:"_"}),")."]}),(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:"Tip: Datetime columns should be formatted as YYYY-MM-DD HH:mm:ss"})]}),n?(0,l.jsxs)("div",{className:"flex h-28 flex-col items-center justify-center space-y-2 rounded-md border border-dashed border-strong",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(n7.Z,{size:14,strokeWidth:1.5}),(0,l.jsx)("p",{className:"text-sm text-foreground",children:n.name})]}),100===t?(0,l.jsx)(W.z,{type:"outline",onClick:s,children:"Remove File"}):(0,l.jsxs)("div",{className:"flex w-3/5 items-center space-x-2",children:[(0,l.jsx)(ej.Z,{className:"h-4 w-4 animate-spin"}),(0,l.jsx)(eA.Z,{value:t,max:100,type:"horizontal",barClass:"bg-green-900",labelBottom:"Checking file...",labelTop:"".concat(t,"%")})]})]}):(0,l.jsx)("div",{className:"flex h-48 cursor-pointer items-center justify-center rounded-md border border-dashed border-strong ".concat(i?"bg-gray-500":""),onDragOver:c,onDragLeave:c,onDrop:e=>{c(e),a(e)},onClick:()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.click()},children:(0,l.jsxs)("p",{className:"text-sm",children:["Drag and drop, or ",(0,l.jsx)("span",{className:"text-brand",children:"browse"})," your files"]})}),(0,l.jsx)("input",{ref:o,className:"hidden",type:"file",onChange:a})]})},at=n(15998),an=n(56599),aa=e=>{let{spreadsheetData:t,selectedHeaders:n,onToggleHeader:a}=e,[s,i]=(0,q.useState)(!1);return(0,l.jsxs)(at.ZP,{open:s,onOpenChange:i,className:"",children:[(0,l.jsx)(at.ZP.Trigger,{asChild:!0,children:(0,l.jsx)(eg.ZP.Content,{children:(0,l.jsxs)("div",{className:"py-1 flex items-center justify-between",children:[(0,l.jsx)("p",{className:"text-sm",children:"Configure import data"}),(0,l.jsx)(W.z,{type:"text",icon:(0,l.jsx)(an.Z,{size:18,strokeWidth:2,className:(0,nC.default)("text-foreground-light",s&&"rotate-180")}),className:"px-1",onClick:()=>i(!s)})]})})}),(0,l.jsx)(at.ZP.Content,{children:(0,l.jsx)(eg.ZP.Content,{children:(0,l.jsxs)("div",{className:"py-2 space-y-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:"Select which columns to import"}),(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:"By default, all columns are selected to be imported from your CSV"})]}),(0,l.jsx)("div",{className:"flex items-center flex-wrap gap-2 pl-0.5 pb-0.5",children:t.headers.map(e=>{let t=n.includes(e);return(0,l.jsx)(W.z,{type:t?"primary":"default",className:(0,nC.default)("transition",t?"opacity-100":"opacity-75"),onClick:()=>a(e),children:e},e)})})]})})})]})},as=e=>{let{input:t,onInputChange:n}=e;return(0,l.jsxs)("div",{className:"space-y-10",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("p",{className:"mb-2 text-sm text-foreground-light",children:["Copy a table from a spreadsheet program such as Google Sheets or Excel and paste it in the field below. The first row should be the headers of the table, and your headers should not include any special characters other than hyphens (",(0,l.jsx)("code",{children:"-"}),") or underscores (",(0,l.jsx)("code",{children:"_"}),")."]}),(0,l.jsx)("p",{className:"text-sm text-foreground-lighter",children:"Tip: Datetime columns should be formatted as YYYY-MM-DD HH:mm:ss"})]}),(0,l.jsx)(t_.Z.TextArea,{size:"tiny",className:"font-mono",rows:15,style:{resize:"none"},value:t,onChange:n})]})};let al=["text/csv","text/tab-separated-values","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],ai=["csv","tsv"],ar={headers:[],rows:[],rowCount:0,columnTypeMap:{}};var ao=n(93352),ac=n.n(ao);let ad=e=>{let t={};return new Promise(n=>{eR().parse(e,{header:!0,dynamicTyping:!1,skipEmptyLines:!0,complete:e=>{let a=e.meta.fields||[],s=e.data,l=e.errors;a.forEach(n=>{let a=am(n,e.data);ac()(t,n)?t[n]!==a&&(t[n]="text"):t[n]=a}),n({headers:a,rows:s,previewRows:e.data.slice(0,20),columnTypeMap:t,errors:l})}})})},au=(e,t)=>{let n=[],a=0,s=0,l=[],i={},r=[];return new Promise(o=>{eR().parse(e,{header:!0,dynamicTyping:!1,skipEmptyLines:!0,worker:!0,quoteChar:"text/tab-separated-values"===e.type?"":'"',chunkSize:262144,chunk:o=>{if((n=o.meta.fields).forEach(e=>{let t=am(e,o.data);ac()(i,e)?i[e]!==t&&(i[e]="text"):i[e]=t}),s+=o.data.length,l=o.data.slice(0,20),o.errors.length>0){let e=o.errors.map(e=>({...e,data:o.data[e.row]}));r.push(...e)}let c=262144*(a+=1)/e.size;t(c>1?100:Number((100*c).toFixed(2)))},complete:()=>{o({headers:n,rowCount:s,previewRows:l,columnTypeMap:i,errors:r})}})})},am=(e,t)=>{if(0===t.length)return"text";let n=t[0][e],a=t.map(t=>t[e]);if(null==n)return"text";if(Number(n)){let n=t.map(t=>Number(t[e]));return n.includes(NaN)?"text":n.map(e=>e%1).every(e=>0===e)?"int8":"float8"}return tP()(["true","false"],n.toString().toLowerCase())&&a.every(e=>null==e||tP()(["true","false"],e.toString().toLowerCase()))?"bool":(0,eW.dW)(n)&&a.every(e=>(0,eW.dW)(n))?"jsonb":Date.parse(n)&&a.every(e=>tW()(e,"YYYY-MM-DD hh:mm:ss").isValid())?"timestamptz":"text"},ah=e=>{let t=null==e?void 0:e.name.split(".").pop().toLowerCase();return ai.includes(t)};var ax=n(12467),ap=e=>{let{headers:t=[],rows:n=[],height:a}=e,s=t.slice(0,20),i=n.slice(0,20);return(0,l.jsx)(tt.ZP,{columns:s.map(e=>{let t=Math.max(Math.max(...i.map(t=>{var n,a;return null!==(a=null===(n=t[e])||void 0===n?void 0:n.toString())&&void 0!==a?a:""}).map(e=>e.length)),e.length);return{key:e,name:e,width:t>20?200:10*t,resizable:!0,renderHeaderCell:()=>(0,l.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,l.jsx)("p",{className:"text-xs",children:e})}),renderCell:t=>{let{row:n}=t,a=!n[e];return(0,l.jsx)("span",{className:(0,ax.cn)("text-sm flex items-center",a&&"text-foreground-light"),children:a?"NULL":n[e]})}}}),rows:i,className:"!border-l !border-r",style:{height:a||"".concat(34+34*(i.length||1),"px")}})},af=e=>{let{selectedTable:t,spreadsheetData:n,errors:a=[],selectedHeaders:s,incompatibleHeaders:i}=e,[r,o]=(0,q.useState)(!1),[c,d]=(0,q.useState)([]),{headers:u,rows:m}=n,h=u.filter(e=>s.includes(e)).slice(0,20),x=m.slice(0,20),p=void 0===t||0===i.length;(0,q.useEffect)(()=>{o(!0)},[n]);let f=e=>{c.includes(e)?d(c.filter(t=>t!==e)):d(c.concat([e]))};return(0,l.jsxs)(at.ZP,{open:r,onOpenChange:o,className:"",children:[(0,l.jsx)(at.ZP.Trigger,{asChild:!0,children:(0,l.jsx)(eg.ZP.Content,{children:(0,l.jsxs)("div",{className:"py-1 flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("p",{className:"text-sm",children:"Preview data to be imported"}),!p&&(0,l.jsx)(nk.C,{variant:"destructive",children:"Data incompatible"}),a.length>0&&(0,l.jsxs)(nk.C,{variant:"warning",children:[a.length," issues found"]})]}),(0,l.jsx)(W.z,{type:"text",icon:(0,l.jsx)(an.Z,{size:18,strokeWidth:2,className:(0,nC.default)("text-foreground-light",r&&"rotate-180")}),className:"px-1",onClick:()=>o(!r)})]})})}),(0,l.jsx)(at.ZP.Content,{children:(0,l.jsxs)(eg.ZP.Content,{children:[(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:void 0===t?"Your table will have ".concat(n.rowCount.toLocaleString()," rows and the\n                        following ").concat(n.headers.length," columns."):"A total of ".concat(n.rowCount.toLocaleString(),' rows will be added to the table "').concat(t.name,'"')}),(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:"Here is a preview of the data that will be added (up to the first 20 columns and first 20 rows)."})]}),(0,l.jsx)("div",{className:"mb-4",children:h.length>0&&x.length>0?(0,l.jsx)(ap,{height:350,headers:h,rows:x}):(0,l.jsxs)("div",{className:"flex items-center justify-center py-4 border border-control rounded-md space-x-2",children:[(0,l.jsx)($.Z,{size:16,strokeWidth:1.5,className:"text-foreground-light"}),(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:0===h.length?"No headers have been selected":0===x.length?"Your CSV contains no data":""})]})}),(!p||a.length>0)&&(0,l.jsxs)("div",{className:"space-y-2 my-4",children:[(0,l.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,l.jsx)("p",{className:"text-sm",children:"Issues found in spreadsheet"}),p&&(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:void 0!==t?"This CSV can still be imported into your table despite issues in the following rows.":"Your table can still be created nonetheless despite issues in the following rows."})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[!p&&(0,l.jsx)("div",{className:"space-y-2",children:(0,l.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,l.jsx)("div",{className:"w-[14px] h-[14px] flex items-center justify-center translate-y-[3px]",children:(0,l.jsx)("div",{className:"w-[6px] h-[6px] rounded-full bg-foreground-lighter"})}),(0,l.jsxs)("p",{className:"text-sm",children:["This CSV ",(0,l.jsx)("span",{className:"text-red-900",children:"cannot"})," be imported into your table due to incompatible headers:",(0,l.jsx)("br",{}),"The column",i.length>1?"s":""," ",i.map(e=>'"'.concat(e,'"')).join(", ")," ",i.length>1?"are":"is"," not present in your table"]})]})}),a.map((e,t)=>{var a,s;let i="import-error-".concat(t),r=c.includes(i);return(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2 cursor-pointer",onClick:()=>f(i),children:[void 0!==e.data?(0,l.jsx)(tm.Z,{size:14,className:"transform ".concat(r?"rotate-90":"")}):(0,l.jsx)("div",{className:"w-[14px] h-[14px] flex items-center justify-center",children:(0,l.jsx)("div",{className:"w-[6px] h-[6px] rounded-full bg-foreground-lighter"})}),void 0!==e.data&&(0,l.jsxs)("p",{className:"text-sm w-14",children:["Row: ",e.row]}),(0,l.jsx)("p",{className:"text-sm",children:e.message}),(null===(a=e.data)||void 0===a?void 0:a.__parsed_extra)&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e9.Z,{size:14}),(0,l.jsx)("p",{className:"text-sm",children:"Extra field(s):"}),null===(s=e.data)||void 0===s?void 0:s.__parsed_extra.map((e,t)=>(0,l.jsx)("code",{className:"text-xs",children:e},t))]})]}),void 0!==e.data&&r&&(0,l.jsx)(ap,{headers:n.headers,rows:[e.data]})]},i)})]})]})]})})]})},ag=e=>{var t;let{visible:n=!1,debounceDuration:a=250,headers:s=[],rows:i=[],selectedTable:r,saveContent:o,closePanel:c,updateEditorDirty:d=es()}=e;(0,q.useEffect)(()=>{n&&0===s.length&&R()},[n]);let[u,m]=(0,q.useState)("fileUpload"),[x,p]=(0,q.useState)(""),[f,g]=(0,q.useState)(),[j,v]=(0,q.useState)(0),[b,y]=(0,q.useState)({headers:s,rows:i,rowCount:0,columnTypeMap:{}}),[N,w]=(0,q.useState)([]),[_,C]=(0,q.useState)([]),S=(null!==(t=null==r?void 0:r.columns)&&void 0!==t?t:[]).map(e=>e.name),k=_.filter(e=>!S.includes(e)),E=void 0===r||0===k.length,Z=e=>{v(e)},T=async e=>{v(0),e.persist();let[t]=e.target.files||e.dataTransfer.files;if(t.size>104857600)return e.target.value="",(0,h.ZP)((0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("p",{children:"The dashboard currently only supports importing of CSVs below 100MB."}),(0,l.jsx)("p",{children:"For bulk data loading, we recommend doing so directly through the database."}),(0,l.jsx)(W.z,{asChild:!0,type:"default",icon:(0,l.jsx)(t8.Z,{}),className:"!mt-2",children:(0,l.jsx)(O(),{href:"https://supabase.com/docs/guides/database/tables#bulk-data-loading",target:"_blank",rel:"noreferrer",children:"Learn more"})})]}),{duration:1/0});if(t&&tP()(al,null==t?void 0:t.type)&&ah(t)){d(!0),g(t);let{headers:e,rowCount:n,columnTypeMap:a,errors:s,previewRows:l}=await au(t,Z);s.length>0&&h.ZP.error("Some issues have been detected on ".concat(s.length," rows. More details below the content preview.")),w(s),C(e),y({headers:e,rows:l,rowCount:n,columnTypeMap:a})}else h.ZP.error("Sorry! We only accept CSV or TSV file types, please upload another file.");e.target.value=""},R=()=>{p(""),y(ar),g(void 0),w([]),d(!1)},z=async e=>{if(e.length>0){let{headers:t,rows:n,columnTypeMap:a,errors:s}=await ad(e);s.length>0&&h.ZP.error("Some issues have been detected on ".concat(s.length," rows. More details below the content preview.")),w(s),C(t),y({headers:t,rows:n,rowCount:n.length,columnTypeMap:a})}else y(ar)},A=(0,q.useCallback)(n6()(z,a),[]);return(0,l.jsxs)(eg.ZP,{size:"large",visible:n,align:"right",header:void 0!==r?(0,l.jsxs)(l.Fragment,{children:["Add data to"," ",(0,l.jsxs)("code",{className:"text-sm",children:[r.schema,".",r.name]})]}):"Add content to new table",onCancel:()=>c(),customFooter:(0,l.jsx)(eC.Z,{backButtonLabel:"Cancel",applyButtonLabel:void 0===r?"Save":"Import data",closePanel:c,applyFunction:e=>{"fileUpload"===u&&void 0===f?(h.ZP.error("Please upload a file to import your data with"),e()):0===_.length?(h.ZP.error("Please select at least one header from your CSV"),e()):E?o({file:f,...b,selectedHeaders:_,resolve:e}):(h.ZP.error("The data that you are trying to import is incompatible with your table structure"),e())}}),children:[(0,l.jsx)(eg.ZP.Content,{children:(0,l.jsx)("div",{className:"pt-6",children:(0,l.jsxs)(n9.Z,{block:!0,type:"pills",onChange:m,children:[(0,l.jsx)(n9.Z.Panel,{id:"fileUpload",label:"Upload CSV",children:(0,l.jsx)(ae,{parseProgress:j,uploadedFile:f,onFileUpload:T,removeUploadedFile:R})}),(0,l.jsx)(n9.Z.Panel,{id:"pasteText",label:"Paste text",children:(0,l.jsx)(as,{input:x,onInputChange:e=>{p(e.target.value),A(e.target.value)}})})]})})}),b.headers.length>0&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"pt-4",children:(0,l.jsx)(eg.ZP.Separator,{})}),(0,l.jsx)(aa,{spreadsheetData:b,selectedHeaders:_,onToggleHeader:e=>{C(_.includes(e)?_.filter(t=>t!==e):_.concat([e]))}}),(0,l.jsx)(eg.ZP.Separator,{}),(0,l.jsx)(af,{selectedTable:r,spreadsheetData:b,errors:N,selectedHeaders:_,incompatibleHeaders:k}),(0,l.jsx)(eg.ZP.Separator,{})]})]})},aj=n(6659),av=n(82784),ab=n(41303);let ay=e=>{let{schema:t="public",name:n}=e;return"\n    ".concat(v.k,"\n\n    select pg_temp.pg_get_tabledef (\n      '").concat(t,"',\n      '").concat(n,"',\n      false,\n      'FKEYS_INTERNAL',\n      'INCLUDE_TRIGGERS'\n    ) as definition\n  ").trim()},aN=function(e){let{projectRef:t,connectionString:n,schema:a,name:s}=e,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,_.cp)({projectRef:t,connectionString:n,sql:ay({schema:a,name:s}),queryKey:["table-definition",a,s]},{select:e=>e.result[0].definition.trim(),...l})},aw=e=>{let{schema:t,name:n}=e;return"\n    select pg_get_viewdef(to_regclass('\"".concat(t,'"."').concat(n,"\"'), true) as definition\n  ").trim()},a_=function(e){let{projectRef:t,connectionString:n,schema:a,name:s}=e,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,_.cp)({projectRef:t,connectionString:n,sql:aw({schema:a,name:s}),queryKey:["view-definition",a,s]},{select:e=>e.result[0].definition.trim(),enabled:void 0!==a&&void 0!==s,...l})};var aC=e=>{let{id:t}=e,{ref:n}=(0,x.UO)(),a=(0,q.useRef)(null),s=(0,q.useRef)(null),{resolvedTheme:i}=(0,aj.F)(),r=(0,T.Z)(t),{project:o}=(0,g.d2)(),c=a_({schema:null==r?void 0:r.schema,name:null==r?void 0:r.name,projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString},{enabled:(null==r?void 0:r.type)===y.l.VIEW||(null==r?void 0:r.type)===y.l.MATERIALIZED_VIEW}),d=aN({schema:null==r?void 0:r.schema,name:null==r?void 0:r.name,projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString},{enabled:(null==r?void 0:r.type)===y.l.TABLE}),{data:u,isLoading:m}=(null==r?void 0:r.type)===y.l.VIEW||(null==r?void 0:r.type)===y.l.MATERIALIZED_VIEW?c:d,h=(null==r?void 0:r.type)===y.l.VIEW?"create view ".concat(r.schema,".").concat(r.name," as\n"):(null==r?void 0:r.type)===y.l.MATERIALIZED_VIEW?"create materialized view ".concat(r.schema,".").concat(r.name," as\n"):"",p=e=>{try{return(0,av.WU)(e,{language:"postgresql",keywordCase:"lower"})}catch(t){return e}},f=(0,q.useMemo)(()=>u?p(h+u):void 0,[u]),j=async(e,t)=>{a.current=e,s.current=t,e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})}),await (0,eW.Vs)(500),null==e||e.focus()};return m?(0,l.jsxs)("div",{className:"h-full grid",children:[(0,l.jsx)("div",{className:"p-4",children:(0,l.jsx)(nB.A,{})}),(0,l.jsx)("div",{className:"mt-auto",children:(0,l.jsx)(ab.Z,{})})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"flex-grow overflow-y-auto border-t border-muted relative",children:[(0,l.jsx)(W.z,{asChild:!0,type:"default",className:"absolute top-2 right-5 z-10",children:(0,l.jsx)(O(),{href:"/project/".concat(n,"/sql/new?content=").concat(encodeURIComponent(null!=f?f:"")),children:"Open in SQL Editor"})}),(0,l.jsx)(tj.default,{className:"monaco-editor",theme:(null==i?void 0:i.includes("dark"))?"vs-dark":"vs",onMount:j,defaultLanguage:"pgsql",value:f,path:"",options:{domReadOnly:!0,readOnly:!0,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0}})]}),(0,l.jsx)(ab.Z,{})]})},aS=e=>{var t,n,a,s,o;let{theme:d="dark",isLoadingSelectedTable:w=!1,selectedTable:_}=e,C=(0,m.useRouter)(),{ref:k,id:P}=(0,x.UO)(),{project:L}=(0,g.d2)(),I=(0,A._2)(),D=(0,S.z6)(),[{view:F="data"}]=(0,Z.x3)(),O=(0,Z.Xo)(i.KA.TENANT_SQL_ADMIN_WRITE,"tables"),q=(0,Z.Xo)(i.KA.TENANT_SQL_ADMIN_WRITE,"columns"),W=!O&&!q,U=eB({schemaName:null==_?void 0:_.schema,tableName:null==_?void 0:_.name}),V=(0,r.NL)(),{mutate:M}=E({async onMutate(e){let{projectRef:t,table:n,configuration:a,payload:s}=e,l=new Set(Object.keys(a.identifiers)),i=N.M.query(t,[n.schema,n.name,{table:{name:n.name,schema:n.schema}}]);await V.cancelQueries(i);let r=V.getQueriesData(i);return V.setQueriesData(i,e=>{var t;return{result:null!==(t=null==e?void 0:e.result.map(e=>Object.entries(e).filter(e=>{let[t]=e;return l.has(t)}).every(e=>{let[t,n]=e;return n===a.identifiers[t]})?{...e,...s}:e))&&void 0!==t?t:[]}}),{previousRowsQueries:r}},onError(e,t,n){let{previousRowsQueries:a}=n;a.forEach(e=>{let[t,n]=e;n&&V.setQueriesData(t,n),V.invalidateQueries(t)}),el(e)}}),{data:B}=(0,b.X)({projectRef:null==L?void 0:L.ref,connectionString:null==L?void 0:L.connectionString,schema:null==_?void 0:_.schema}),K=B||[],Y=(0,T.Z)(null==_?void 0:_.id),Q=(0,Z.dU)(null!==(t=null==_?void 0:_.columns)&&void 0!==t?t:z.Z6);if(w)return(0,l.jsx)(j.Z,{});if(u()(_))return(0,l.jsx)(ee,{id:Number(P)});let H=(null==Y?void 0:Y.type)===y.l.VIEW||(null==Y?void 0:Y.type)===y.l.MATERIALIZED_VIEW,G=(null==Y?void 0:Y.type)===y.l.TABLE,$=(null==Y?void 0:Y.type)===y.l.FOREIGN_TABLE,J=R.F.includes(null!==(n=null==Y?void 0:Y.schema)&&void 0!==n?n:""),et=G&&!J,en=("relationships"in _&&_.relationships||[]).map(e=>{var t;let n=K.find(t=>t.id===e.id);return{...e,deletion_action:null!==(t=null==n?void 0:n.deletion_action)&&void 0!==t?t:v.N.NO_ACTION}}),ea=H||$?(0,p.NK)({table:_,columns:null!==(o=_.columns)&&void 0!==o?o:[],primaryKeys:[],relationships:[]}):(0,p.NK)({table:_,columns:null!==(a=_.columns)&&void 0!==a?a:[],primaryKeys:null!==(s=_.primary_keys)&&void 0!==s?s:[],relationships:en},U),es="".concat(_.schema,"_").concat(_.name),el=e=>{var t,n;h.ZP.error(null!==(n=null!==(t=null==e?void 0:e.details)&&void 0!==t?t:null==e?void 0:e.message)&&void 0!==n?n:e)};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(p.zB,{theme:d,gridProps:{height:"100%"},projectRef:k,editable:!W&&et,schema:_.schema,table:ea,headerActions:G||H||et?(0,l.jsx)(X,{table:_,canEditViaTableEditor:et,isViewSelected:H,isTableSelected:G}):null,onAddColumn:I.onAddColumn,onEditColumn:e=>{let t=c()(Q.current,{name:e});t?I.onEditColumn(t):h.ZP.error("Unable to find column ".concat(e," in ").concat(null==_?void 0:_.name))},onDeleteColumn:e=>{var t;let n=c()(null!==(t=Q.current)&&void 0!==t?t:[],{name:e});n?I.onDeleteColumn(n):h.ZP.error("Unable to find column ".concat(e," in ").concat(null==_?void 0:_.name))},onAddRow:I.onAddRow,updateTableRow:(e,t)=>{var n;if(!L)return;let a="columns"in _&&(null===(n=_.columns)||void 0===n?void 0:n.filter(e=>{var t;return(null!==(t=null==e?void 0:e.enums)&&void 0!==t?t:[]).length>0&&"array"===e.data_type.toLowerCase()}).map(e=>e.name))||[],s={};_.primary_keys.forEach(t=>s[t.name]=e[t.name]),0===Object.keys(s).length&&h.ZP.error(f.jg),M({projectRef:L.ref,connectionString:L.connectionString,table:ea,configuration:{identifiers:s},payload:t,enumArrayColumns:a,impersonatedRole:D()})},onEditRow:I.onEditRow,onImportData:I.onImportData,onError:el,onExpandJSONEditor:(e,t)=>{I.onExpandJSONEditor({column:e,row:t,jsonString:JSON.stringify(t[e])||""})},onExpandTextEditor:(e,t)=>{I.onExpandTextEditor(e,t)},onEditForeignKeyColumnValue:I.onEditForeignKeyColumnValue,showCustomChildren:(H||G)&&"definition"===F,customHeader:(H||G)&&"definition"===F?(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsxs)("p",{children:["SQL Definition of ",(0,l.jsx)("code",{className:"text-sm",children:_.name})," "]}),(0,l.jsx)("p",{className:"text-foreground-light text-sm",children:"(Read only)"})]}):null,children:(H||G)&&(0,l.jsx)(aC,{id:null==_?void 0:_.id})},es),void 0!==I.selectedSchemaName&&(0,l.jsx)(tZ,{editable:!W&&et,selectedTable:_,onTableCreated:e=>{C.push("/project/".concat(k,"/editor/").concat(e.id))}})]})},ak=n(37107),aE=n(38161),aZ=e=>{var t,n;let{}=e,a=(0,A._2)(),s=R.F.includes(a.selectedSchemaName),r=(0,Z.Xo)(i.KA.TENANT_SQL_ADMIN_WRITE,"tables")&&!s,[o]=(0,Z._)("table-editor-sort","alphabetical"),{project:c}=(0,g.d2)(),{data:d}=(0,aE.H)({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString,schema:a.selectedSchemaName,sort:o}),u=null!==(n=null==d?void 0:null===(t=d.pages)||void 0===t?void 0:t[0].data.count)&&void 0!==n?n:0;return(0,l.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:0===u?(0,l.jsx)(ak.Z,{title:"Table Editor",ctaButtonLabel:r?"Create a new table":void 0,onClickCta:r?a.onAddTable:void 0,children:(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:"There are no tables available in this schema."})}):(0,l.jsx)("div",{className:"flex flex-col items-center space-y-4",children:(0,l.jsx)(ak.Z,{title:"Table Editor",ctaButtonLabel:r?"Create a new table":void 0,onClickCta:r?a.onAddTable:void 0,children:(0,l.jsxs)("p",{className:"text-sm text-foreground-light",children:["Select a table from the navigation panel on the left to view its data",r&&", or create a new one."]})})})})}},36872:function(e,t,n){"use strict";n.d(t,{Z:function(){return m}});var a=n(52322),s=n(59491),l=n(5632),i=n(47203),r=n(53071),o=n(13096),c=n(3593),d=n(76626);let u=(e,t)=>{var n,a,s,l;let i=null!==(n=null==e?void 0:e.ref)&&void 0!==n?n:"default",r=null===(a=null==t?void 0:t.auth)||void 0===a||a,o=null===(s=null==t?void 0:t.storage)||void 0===s||s,c=null===(l=null==t?void 0:t.realtime)||void 0===l||l;return[{title:"Logs Explorer",items:[{key:"explorer",name:"Query",root:!0},d.Qy?{key:"saved",name:"Saved Queries"}:null,{key:"recent",name:"Recent Queries"},{key:"templates",name:"Templates"}].filter(e=>e).map(e=>{let{key:t,name:n,root:a}=e;return{name:n,key:t,url:"/project/".concat(i,"/logs/explorer").concat(a?"":"/"+t),items:[]}})},{title:"Infrastructure",items:[{name:d.Qy?"API Edge Network":"Kong API",key:"edge-logs",url:"/project/".concat(i,"/logs/edge-logs"),items:[]},{name:"Postgres",key:"postgres-logs",url:"/project/".concat(i,"/logs/postgres-logs"),items:[]},{name:"PostgREST",key:"postgrest-logs",url:"/project/".concat(i,"/logs/postgrest-logs"),items:[]},d.Qy?{name:"Pooler",key:"pooler-logs",url:"/project/".concat(i,"/logs/pooler-logs"),items:[]}:null,,r?{name:"Auth",key:"auth-logs",url:"/project/".concat(i,"/logs/auth-logs"),items:[]}:null,o?{name:"Storage",key:"storage-logs",url:"/project/".concat(i,"/logs/storage-logs"),items:[]}:null,c?{name:"Realtime",key:"realtime-logs",url:"/project/".concat(i,"/logs/realtime-logs"),items:[]}:null].filter(e=>e)}]};var m=(0,o.QO)(e=>{let{title:t,children:n}=e,d=(0,l.useRouter)().pathname.split("/"),m=d[d.length-1],{projectAuthAll:h,projectStorageAll:x,realtimeAll:p}=(0,o.N3)(["project_storage:all","project_auth:all","realtime:all"]),f=(0,o.Vm)();return(0,o.Xo)(s.KA.ANALYTICS_READ,"logflare")?(0,a.jsx)(c.AM,{title:t,product:"Logs",productMenu:(0,a.jsx)(r.Q,{page:m,menu:u(f,{auth:h,storage:x,realtime:p})}),children:(0,a.jsx)("main",{style:{maxHeight:"100vh"},className:"flex-1 overflow-y-auto",children:n})}):(0,a.jsx)(c.AM,{children:(0,a.jsx)("main",{style:{maxHeight:"100vh"},className:"flex-1 overflow-y-auto",children:(0,a.jsx)(i.Z,{isFullPage:!0,resourceText:"access your project's logs explorer"})})})})},63598:function(e,t,n){"use strict";n.d(t,{CG:function(){return h},I7:function(){return u},Lc:function(){return p},Wv:function(){return g},_S:function(){return d},g$:function(){return x},gW:function(){return v},jX:function(){return m},q7:function(){return c},tM:function(){return f},tU:function(){return o},ur:function(){return j}});var a=n(52322),s=n(2784),l=n(12467);let i="mx-auto w-full max-w-[1600px]",r="px-6 lg:px-14 xl:px-28 2xl:px-32",o=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)("header",{...s,ref:t,className:(0,l.cn)("w-full","flex-col gap-3",n)})}),c=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)("h1",{ref:t,...s,className:(0,l.cn)("text-3xl pt-6 pb-4",n)})}),d=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)("div",{ref:t,...s,className:(0,l.cn)(i,r,n)})}),u=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)("div",{ref:t,...s,className:(0,l.cn)("w-full h-px bg-border",n)})}),m=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)("div",{ref:t,...s,className:(0,l.cn)("flex flex-col gap-3 py-6","lg:grid md:grid-cols-12 lg:py-12",n)})}),h=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)("div",{ref:t,...s,className:(0,l.cn)("flex flex-col gap-3","min-w-[420px]",n)})}),x=s.forwardRef((e,t)=>{let{className:n,children:s,title:i,...r}=e;return(0,a.jsxs)("div",{ref:t,...r,className:(0,l.cn)("col-span-4 xl:col-span-5 prose text-sm",n),children:[i&&(0,a.jsx)("h2",{children:i}),s]})}),p=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)("div",{ref:t,...s,className:(0,l.cn)("col-span-8 xl:col-span-7","flex flex-col gap-6",n)})}),f=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)("div",{ref:t,...s,className:(0,l.cn)("flex flex-col gap-3 items-center",n)})}),g=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)("div",{ref:t,...s,className:(0,l.cn)("flex w-full items-center",n)})}),j=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)("div",{ref:t,...s,className:(0,l.cn)("flex flex-row gap-3",n)})}),v=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)("div",{ref:t,...s,className:(0,l.cn)(i,r,"my-8 flex flex-col gap-8",n)})});o.displayName="ScaffoldHeader",c.displayName="ScaffoldTitle",d.displayName="ScaffoldContainer",u.displayName="ScaffoldDivider",m.displayName="ScaffoldSection",h.displayName="ScaffoldColumn",x.displayName="ScaffoldSectionDetail",p.displayName="ScaffoldSectionContent",f.displayName="ScaffoldFilterAndContent",g.displayName="ScaffoldActionsContainer",j.displayName="ScaffoldActionsGroup",v.displayName="ScaffoldContainerLegacy"},99217:function(e,t,n){"use strict";var a=n(52322),s=n(97729),l=n.n(s),i=n(76626),r=n(25463);t.Z=e=>{let{children:t}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l(),{children:(0,a.jsx)("title",{children:"Supabase + Vercel"})}),(0,a.jsxs)("main",{className:"flex flex-col w-full h-full",children:[(0,a.jsx)("div",{children:(0,a.jsx)("div",{className:"mx-auto px-4 sm:px-6",children:(0,a.jsx)("div",{className:"max-w-xl flex justify-between items-center mx-auto py-4",children:(0,a.jsx)("div",{className:"flex justify-start lg:w-0 lg:flex-1",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"sr-only",children:"Supabase"}),(0,a.jsx)("img",{className:"h-6 w-auto sm:h-6",src:"".concat(i.GW,"/img/supabase-logo.svg"),alt:""})]})})})})}),(0,a.jsx)(r.Z,{}),(0,a.jsx)("div",{className:"flex-grow overflow-y-auto",children:(0,a.jsx)("div",{className:"max-w-7xl h-full mx-auto px-4 sm:px-6",children:(0,a.jsx)("div",{className:"max-w-xl h-full mx-auto py-10",children:t})})})]})]})}},80489:function(e,t,n){"use strict";n.d(t,{p:function(){return m}});var a=n(52322),s=n(39097),l=n.n(s),i=n(13096),r=n(76626),o=n(31231),c=n(41580),d=n(65382);let u=e=>{let{organization:t,project:n,children:s}=e;return(0,a.jsxs)("div",{className:"flex w-full flex-col",children:[(0,a.jsx)(h,{organization:t,project:n}),(0,a.jsx)("div",{className:"overflow-auto",children:(0,a.jsx)("section",{className:"has-slide-in slide-in relative mx-auto my-10 max-w-2xl",children:s})})]})};t.Z=(0,i.QO)(u);let m=u,h=e=>{let{organization:t,project:n}=e,s=t?1:n?2:0;return(0,a.jsx)("div",{className:"border-b p-3 border-default",children:(0,a.jsx)("div",{className:"PageHeader",children:(0,a.jsxs)("div",{className:"Breadcrumbs flex justify-between",children:[(0,a.jsx)("div",{className:"flex items-center text-sm",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(l(),{href:"/projects",children:(0,a.jsx)("img",{src:"".concat(r.GW,"/img/supabase-logo.svg"),alt:"Supabase",className:"rounded border p-1 hover:border-white border-default",style:{height:24}})}),(0,a.jsx)(o.Z,{size:"small",className:"text-foreground-light"}),(0,a.jsx)("p",{className:"text-sm",children:t?"Organization: ".concat(t.name):"Create an organization"}),(0,a.jsx)(o.Z,{size:"small",className:"text-foreground-light"}),(0,a.jsx)("p",{className:"text-sm ".concat(s<1?"text-foreground-light":""),children:n?n.name:"Create a new project"}),(0,a.jsx)(o.Z,{size:"small",className:"text-foreground-light"}),(0,a.jsx)("p",{className:"text-sm ".concat(s<2?"text-foreground-light":""),children:n?n.name:"Extend your database"})]})}),(0,a.jsx)("div",{className:"flex"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(d.Z,{}),(0,a.jsx)(c.v,{})]})]})})})}},3593:function(e,t,n){"use strict";n.d(t,{p0:function(){return D},g1:function(){return U},_h:function(){return Y},zt:function(){return et},gm:function(){return tT},Uj:function(){return en.Z},Ix:function(){return el},AM:function(){return ei.Z},li:function(){return eE},Vk:function(){return tS},dU:function(){return eo},_J:function(){return tL},ro:function(){return nl},lz:function(){return nT},Ru:function(){return nR.Z}});var a=n(52322),s=n(97729),l=n.n(s),i=n(5632),r=n(2784),o=n(5761),c=n(13096),d=n(18308),u=n(76626),m=n(24459),h=n(22867),x=n(60417),p=n.n(x),f=n(6277),g=n(39097),j=n.n(g),v=e=>{let{href:t,label:n,isActive:s}=e;return(0,a.jsx)("div",{children:(0,a.jsx)(j(),{href:t,className:(0,f.default)("text-sm",s?"text-foreground":"text-foreground-light hover:text-foreground transition"),children:n})})},b=()=>{let e=(0,i.useRouter)(),t=p()([{label:"Preferences",pathname:"/account/me"},{label:"Access Tokens",pathname:"/account/tokens"},{label:"Security",pathname:"/account/security"},{label:"Audit logs",pathname:"/account/audit"}]);return(0,a.jsx)("div",{className:"space-y-10",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Account Settings"}),t.map(t=>(0,a.jsx)(v,{label:t.label,href:t.pathname,isActive:t.pathname===e.pathname},t.label))]})})},y=()=>{let e=(0,i.useRouter)(),t=(0,c.lL)();return(0,a.jsx)("div",{className:"space-y-10",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Organization"}),[{label:"General",pathname:"/org/[slug]/general"},{label:"Members",pathname:"/org/[slug]/team"},{label:"Integrations",pathname:"/org/[slug]/integrations"},{label:"Billing",pathname:"/org/[slug]/billing"},{label:"Usage",pathname:"/org/[slug]/usage"},{label:"Invoices",pathname:"/org/[slug]/invoices"},{label:"OAuth Apps",pathname:"/org/[slug]/apps"},{label:"Audit Logs",pathname:"/org/[slug]/audit"},{label:"Legal Documents",pathname:"/org/[slug]/documents"}].map(n=>(0,a.jsx)(v,{label:n.label,href:void 0!==t?n.pathname.replace("[slug]",t.slug):"/",isActive:n.pathname===e.pathname},n.label))]})})},N=e=>{let{children:t}=e,n=(0,i.useRouter)(),{ref:s,slug:l}=(0,m.UO)();return(0,a.jsx)(h.Z,{children:(0,a.jsxs)("div",{className:"flex h-full",children:["/projects"!==n.pathname&&(0,a.jsx)("div",{className:"h-full overflow-y-auto min-w-[280px] border-r px-8 py-8",children:void 0===l&&void 0===s?(0,a.jsx)(b,{}):(0,a.jsx)(y,{})}),(0,a.jsx)("div",{className:"h-full overflow-y-auto flex-grow",children:t})]})})},w=n(84336),_=n.n(w),C=n(72762),S=n(81733),k=n(73193),E=n(83036),Z=function(e){return(0,a.jsx)(E.Z,{icon:k.Z,...e})},T=n(2760),R=function(e){return(0,a.jsx)(E.Z,{icon:T.Z,...e})},z=n(27790),A=e=>{let{title:t,header:n,breadcrumbs:s=[],children:l,sections:i,subitems:r,subitemsParentKey:o,hideSidebar:d=!1,customSidebarContent:u}=e,m=!i&&!u,h=(0,c.P5)("navigationLayoutV2");return(0,a.jsxs)("div",{className:"flex h-full",children:[!d&&!m&&(0,a.jsxs)("div",{id:"with-sidebar",className:"h-full bg-studio hide-scrollbar w-64 overflow-auto border-r border-default",children:[t&&(0,a.jsx)("div",{className:"mb-2",children:(0,a.jsx)("div",{className:"flex h-12 max-h-12 items-center border-b px-6 border-default",children:(0,a.jsx)("h4",{className:"mb-0 text-lg truncate",title:t,children:t})})}),n&&n,(0,a.jsx)("div",{className:"-mt-1",children:(0,a.jsxs)(C.ZP,{children:[u,i.map(e=>e.heading?(0,a.jsx)(P,{section:e,subitems:r,subitemsParentKey:o},e.key):(0,a.jsx)("div",{className:"border-b py-5 px-6 border-default",children:(0,a.jsx)(L,{links:e.links,subitems:r,subitemsParentKey:o})},e.key))]})})]}),(0,a.jsxs)("div",{className:"flex flex-1 flex-col",children:[!h&&(0,a.jsx)(z.N,{breadcrumbs:s}),(0,a.jsx)("div",{className:"flex-1 flex-grow overflow-y-auto",children:l})]})]})};let P=e=>{let{section:t,subitems:n,subitemsParentKey:s}=e;return(0,a.jsxs)("div",{className:"border-b py-5 px-6 border-default",children:[t.heading&&(0,a.jsx)(C.ZP.Group,{title:t.heading}),t.versionLabel&&(0,a.jsx)("div",{className:"mb-1 px-3",children:(0,a.jsx)(S.C,{variant:"warning",children:t.versionLabel})}),(0,a.jsx)(L,{links:t.links,subitems:n,subitemsParentKey:s})]},t.heading)},L=e=>{let{links:t,subitems:n,subitemsParentKey:s}=e;return(0,a.jsx)("ul",{className:"space-y-1",children:t.map((e,t)=>{let l=e.isActive&&!n,i=(0,a.jsx)(I,{id:"".concat(e.key,"-").concat(t),isActive:l,label:e.label,href:e.href,onClick:e.onClick,isExternal:e.isExternal||!1},"".concat(e.key,"-").concat(t,"-sidebarItem"));return n&&e.subitemsKey===s&&(i=[i,...n.map((t,n)=>(0,a.jsx)(I,{id:"".concat(t.key||t.as,"-").concat(n),isSubitem:!0,label:t.label,onClick:t.onClick,isExternal:e.isExternal||!1},"".concat(t.key||t.as,"-").concat(n,"-sidebarItem")))]),i})})},I=e=>{let{id:t,label:n,href:s,isActive:l,isSubitem:i,isExternal:r,onClick:o}=e;if(_()(s)){let e;return r&&(e=(0,a.jsx)(Z,{size:"tiny"})),"Log out"===n&&(e=(0,a.jsx)(R,{size:"tiny"})),(0,a.jsx)(C.ZP.Item,{rounded:!0,style:{marginLeft:i?".5rem":"0rem"},active:!!l,onClick:o||(()=>{}),icon:e,children:i?(0,a.jsx)("p",{className:"text-sm",children:n}):n},t)}return(0,a.jsx)(j(),{href:s||"",className:"block",target:r?"_blank":"_self",children:(0,a.jsxs)("span",{className:"group flex max-w-full cursor-pointer items-center space-x-2 border-default py-1 font-normal outline-none ring-foreground focus-visible:z-10 focus-visible:ring-1 group-hover:border-foreground-muted",children:[r&&(0,a.jsx)("span",{className:"truncate text-sm text-foreground-lighter transition group-hover:text-foreground-light",children:(0,a.jsx)(Z,{size:"tiny"})}),(0,a.jsx)("span",{title:n,className:"w-full truncate text-sm text-foreground-light transition group-hover:text-foreground",children:i?(0,a.jsx)("p",{children:n}):n})]})})};var D=(0,c.QO)(e=>{let{children:t,title:n,breadcrumbs:s}=e,m=(0,i.useRouter)(),{data:h}=(0,o.tl)(),x=(0,c.lL)(),p=(0,c.P5)("navigationLayoutV2"),f=(0,d.QJ)(),g=async()=>{await f(),await m.push("/sign-in")};(0,r.useEffect)(()=>{u.Qy||m.push("/project/default")},[m]);let j=(null!=h?h:[]).map(e=>({isActive:m.pathname.startsWith("/org/")&&(null==x?void 0:x.slug)===e.slug,label:e.name,href:"/org/".concat(e.slug,"/general"),key:e.slug})).sort((e,t)=>e.label.localeCompare(t.label)),v=[{heading:"Projects",key:"projects",links:[{isActive:"/projects"===m.pathname,label:"All projects",href:"/projects",key:"all-projects-item"}]},...u.Qy&&(null==j?void 0:j.length)>0?[{heading:"Organizations",key:"organizations",links:j}]:[],...u.Qy?[{heading:"Account",key:"account",links:[{isActive:"/account/me"===m.pathname,icon:"".concat(m.basePath,"/img/user.svg"),label:"Preferences",href:"/account/me",key:"/account/me"},{isActive:"/account/tokens"===m.pathname,icon:"".concat(m.basePath,"/img/user.svg"),label:"Access Tokens",href:"/account/tokens",key:"/account/tokens"},{isActive:"/account/security"===m.pathname,icon:"".concat(m.basePath,"/img/user.svg"),label:"Security",href:"/account/security",key:"/account/security"},{isActive:"/account/audit"===m.pathname,icon:"".concat(m.basePath,"/img/user.svg"),label:"Audit Logs",href:"/account/audit",key:"/account/audit"}]}]:[],{heading:"Documentation",key:"documentation",links:[{key:"ext-guides",icon:"".concat(m.basePath,"/img/book.svg"),label:"Guides",href:"https://supabase.com/docs",isExternal:!0},{key:"ext-guides",icon:"".concat(m.basePath,"/img/book-open.svg"),label:"API Reference",href:"https://supabase.com/docs/guides/api",isExternal:!0}]},...u.Qy?[{key:"logout-link",links:[{key:"logout",icon:"/icons/feather/power.svg",label:"Log out",href:void 0,onClick:g}]}]:[]];return p?(0,a.jsx)(N,{children:t}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(l(),{children:[(0,a.jsx)("title",{children:n?"".concat(n," | Supabase"):"Supabase"}),(0,a.jsx)("meta",{name:"description",content:"Supabase Studio"})]}),(0,a.jsx)("div",{className:"h-screen min-h-[0px] basis-0 flex-1",children:(0,a.jsx)(A,{hideSidebar:p,title:n,breadcrumbs:s,sections:v,children:t})})]})}),F=n(88439),O=n(53071),q=n(36322);let W=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return[{title:"Manage",items:[{name:"Users",key:"users",url:"/project/".concat(e,"/auth/users"),items:[]}]},{title:"Configuration",items:[{name:"Policies",key:"policies",url:"/project/".concat(e,"/auth/policies"),items:[]},...(null==t?void 0:t.columnLevelPrivileges)?[{name:"Column Privileges",key:"column-privileges",url:"/project/".concat(e,"/auth/column-privileges"),items:[],label:"ALPHA"}]:[],...u.Qy?[{name:"Providers",key:"providers",url:"/project/".concat(e,"/auth/providers"),items:[]},{name:"Rate Limits",key:"rate-limits",url:"/project/".concat(e,"/auth/rate-limits"),items:[]},{name:"Email Templates",key:"templates",url:"/project/".concat(e,"/auth/templates"),items:[]},{name:"URL Configuration",key:"url-configuration",url:"/project/".concat(e,"/auth/url-configuration"),items:[]},{name:"Hooks",key:"hooks",url:"/project/".concat(e,"/auth/hooks"),items:[],label:"BETA"}]:[]]}]};var U=(0,c.QO)(e=>{let{title:t,children:n}=e,{ref:s="default"}=(0,m.UO)(),l=(0,F.ar)();(0,q.kM)({projectRef:s});let r=(0,i.useRouter)().pathname.split("/")[4];return(0,a.jsx)(ei.Z,{title:t||"Authentication",product:"Authentication",productMenu:(0,a.jsx)(O.Q,{page:r,menu:W(null!=s?s:"default",{columnLevelPrivileges:l})}),isBlocking:!1,children:(0,a.jsx)("main",{style:{maxHeight:"100vh"},className:"flex-1 overflow-y-auto",children:n})})}),V=n(9019);(0,c.QO)(e=>{let{children:t}=e,n=(0,c.lL)(),s=(0,c.Vm)();return(0,a.jsx)(ei.Z,{hideHeader:!0,hideIconBar:!0,children:(0,a.jsxs)("div",{className:"flex h-full w-full flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4 border-b py-4 px-5 border-default",children:[(0,a.jsx)(j(),{href:"/org/".concat(null==n?void 0:n.slug,"/billing"),className:"text-foreground-lighter transition-colors hover:text-foreground",children:(0,a.jsx)(V.Z,{size:16,strokeWidth:1.5})}),(0,a.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,a.jsx)("h1",{className:"text-sm text-foreground",children:"Customize your plan"}),(0,a.jsx)("div",{className:"h-6 w-px bg-selection"}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:null==n?void 0:n.name}),(0,a.jsx)("span",{className:"text-border-stronger",children:(0,a.jsx)("svg",{viewBox:"0 0 24 24",width:"16",height:"16",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",fill:"none",shapeRendering:"geometricPrecision",children:(0,a.jsx)("path",{d:"M16 3.549L7.12 20.600"})})}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:null==s?void 0:s.name})]})]})]}),(0,a.jsx)("div",{className:"overflow-auto",children:(0,a.jsx)("section",{className:"relative",children:t})})]})})});var M=n(73883),B=n(43283);let K=(e,t)=>{var n;let a=null!==(n=null==e?void 0:e.ref)&&void 0!==n?n:"default",{pgNetExtensionExists:s,pitrEnabled:l}=t||{};return[{title:"Database",items:[{name:"Tables",key:"tables",url:"/project/".concat(a,"/database/tables"),items:[]},{name:"Schema Visualizer",key:"schemas",url:"/project/".concat(a,"/database/schemas"),items:[]},{name:"Triggers",key:"triggers",url:"/project/".concat(a,"/database/triggers"),items:[]},{name:"Functions",key:"functions",url:"/project/".concat(a,"/database/functions"),items:[]},{name:"Extensions",key:"extensions",url:"/project/".concat(a,"/database/extensions"),items:[]},{name:"Roles",key:"roles",url:"/project/".concat(a,"/database/roles"),items:[]},{name:"Replication",key:"replication",url:"/project/".concat(a,"/database/replication"),items:[]},...s?[{name:"Webhooks",key:"hooks",url:"/project/".concat(a,"/database/hooks"),items:[]}]:[],{name:"Wrappers",key:"wrappers",url:"/project/".concat(a,"/database/wrappers"),items:[]},...u.Qy?[{name:"Backups",key:"backups",url:l?"/project/".concat(a,"/database/backups/pitr"):"/project/".concat(a,"/database/backups/scheduled"),items:[]}]:[],{name:"Migrations",key:"migrations",url:"/project/".concat(a,"/database/migrations"),items:[]},{name:"Indexes",key:"indexes",url:"/project/".concat(a,"/database/indexes"),items:[]},{name:"Enumerated Types",key:"types",url:"/project/".concat(a,"/database/types"),items:[]},{name:"Query Performance",key:"query-performance",url:"/project/".concat(a,"/database/query-performance"),items:[]},{name:"Database Linter",key:"linter",url:"/project/".concat(a,"/database/linter"),items:[]}]}]};var Y=(0,c.QO)(e=>{let{children:t}=e,n=(0,c.Vm)(),s=(0,i.useRouter)().pathname.split("/")[4],{data:l}=(0,M.H)({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString}),{data:r}=(0,B.F)({projectRef:null==n?void 0:n.ref}),o=void 0!==(null!=l?l:[]).find(e=>"pg_net"===e.name),d=(null==r?void 0:r.selected_addons.find(e=>"pitr"===e.type))!==void 0;return(0,a.jsx)(ei.Z,{product:"Database",productMenu:(0,a.jsx)(O.Q,{page:s,menu:K(n,{pgNetExtensionExists:o,pitrEnabled:d})}),isBlocking:!1,children:(0,a.jsx)("main",{style:{maxHeight:"100vh"},className:"flex-1 overflow-y-auto",children:t})})}),Q=n(27792);function H(e){let{error:t}=e;return(0,r.useEffect)(()=>{console.error("Error",t)},[]),(0,a.jsxs)("div",{className:"mx-auto flex h-full w-full flex-col items-center justify-center space-y-6",children:[(0,a.jsxs)("div",{className:"flex w-[320px] flex-col items-center justify-center space-y-3",children:[(0,a.jsx)("h4",{className:"text-lg",children:"Something went wrong \uD83E\uDD15"}),(0,a.jsx)("p",{className:"text-center text-sm text-foreground-light",children:"Sorry about that, please try again later or feel free to reach out to us if the problem persists."})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(Q.z,{asChild:!0,children:(0,a.jsx)(j(),{href:"/projects",children:"Head back"})}),(0,a.jsx)(Q.z,{asChild:!0,type:"secondary",children:(0,a.jsx)(j(),{href:"/support/new",children:"Submit a support request"})})]}),(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:["Error: [",null==t?void 0:t.code,"] ",null==t?void 0:t.message]})]})}var G=n(86800),X=n(38183),$=n(61679),J=n(37891);let ee=(e,t,n,s)=>[{title:"Getting Started",items:[{name:"Introduction",key:"introduction",url:"/project/".concat(e,"/api"),items:[]},{name:"Authentication",key:"auth",url:"/project/".concat(e,"/api?page=auth"),items:[]},...(null==s?void 0:s.authEnabled)?[{name:"User Management",key:"users",url:"/project/".concat(e,"/api?page=users"),items:[]}]:[]]},{title:"Tables and Views",items:[{name:"Introduction",key:"tables-intro",url:"/project/".concat(e,"/api?page=tables-intro"),items:[]},...t.sort().map(t=>({name:t,key:t,url:"/project/".concat(e,"/api?resource=").concat(t),items:[]}))]},{title:"Stored Procedures",items:[{name:"Introduction",key:"rpc-intro",url:"/project/".concat(e,"/api?page=rpc-intro"),items:[]},...n.map(t=>({name:t,key:t,url:"/project/".concat(e,"/api?rpc=").concat(t),items:[]}))]},{title:"GraphQL",items:[{name:"GraphiQL",key:"graphiql",url:"/project/".concat(e,"/api/graphiql"),icon:(0,a.jsx)(X.Z,{src:"".concat(u.GW,"/img/graphql.svg"),style:{width:"".concat(16,"px"),height:"".concat(16,"px")},className:"text-foreground",preProcessor:e=>e.replace(/svg/,'svg class="m-auto text-color-inherit"')}),items:[]}]},{title:"More Resources",items:[{name:"Guides",key:"guides",url:"https://supabase.com/docs",icon:(0,a.jsx)($.Z,{size:14,strokeWidth:2}),items:[],isExternal:!0},{name:"API Reference",key:"api-reference",url:"https://supabase.com/docs/guides/api",icon:(0,a.jsx)(J.Z,{size:14,strokeWidth:2}),items:[],isExternal:!0}]}];var et=(0,c.QO)(function(e){var t,n,s;let{title:l,children:r}=e,o=(0,i.useRouter)(),{ref:d}=(0,m.UO)(),h=(0,c.Vm)(),x=(null==h?void 0:h.status)===u.S.INACTIVE,{data:p,isLoading:f,error:g}=(0,G.H)({projectRef:d},{enabled:!x}),j=(0,F.cg)()&&o.pathname.endsWith("/graphiql"),{projectAuthAll:v}=(0,c.N3)(["project_auth:all"]);if(g)return(0,a.jsx)(ei.Z,{product:"API Docs",children:(0,a.jsx)(H,{error:g})});let b=null!==(t=null==h?void 0:h.ref)&&void 0!==t?t:"default",y=(null!==(n=null==p?void 0:p.tables)&&void 0!==n?n:[]).map(e=>e.name),N=(null!==(s=null==p?void 0:p.functions)&&void 0!==s?s:[]).map(e=>e.name);return(0,a.jsx)(ei.Z,{title:l||"API Docs",isLoading:f,product:"API Docs",productMenu:!j&&(0,a.jsx)(O.Q,{page:(()=>{if(o.pathname.endsWith("graphiql"))return"graphiql";let{page:e,resource:t}=o.query;return e||t?e||t||"":"introduction"})(),menu:ee(b,y,N,{authEnabled:v})}),children:r})}),en=n(36872),ea=n(29947),es=n(63598),el=e=>{var t,n;let{children:s}=e,l=(0,c.lL)(),r=(0,i.useRouter)(),{slug:o}=(0,m.UO)(),d=(0,c.N3)("billing:invoices");if((0,c.P5)("navigationLayoutV2"))return(0,a.jsx)(N,{children:s});let u=[{label:"General",href:"/org/".concat(o,"/general")},{label:"Team",href:"/org/".concat(o,"/team")},{label:"Integrations",href:"/org/".concat(o,"/integrations")},{label:"Billing",href:"/org/".concat(o,"/billing")},{label:"Usage",href:"/org/".concat(o,"/usage")},{label:"Invoices",href:"/org/".concat(o,"/invoices"),hidden:!d},{label:"OAuth Apps",href:"/org/".concat(o,"/apps")},{label:"Audit Logs",href:"/org/".concat(o,"/audit")},{label:"Legal Documents",href:"/org/".concat(o,"/documents")}].filter(e=>!e.hidden);return(0,a.jsxs)(D,{title:null!==(t=null==l?void 0:l.name)&&void 0!==t?t:"Supabase",breadcrumbs:[{key:"org-settings",label:"Settings"}],children:[(0,a.jsxs)(es.tU,{children:[(0,a.jsx)(es._S,{id:"billing-page-top",children:(0,a.jsxs)(es.q7,{children:[null!==(n=null==l?void 0:l.name)&&void 0!==n?n:"Organization"," settings"]})}),(0,a.jsx)(es._S,{children:(0,a.jsx)(ea.M,{className:"border-none","aria-label":"Organization menu navigation",children:u.map(e=>(0,a.jsx)(ea._,{active:e.href===r.asPath,children:(0,a.jsx)(j(),{href:e.href,children:e.label})},e.label))})})]}),(0,a.jsx)(es.I7,{}),s]})},ei=n(36647);let er=(e,t,n,a)=>{var s,l,i;let r=(null==t?void 0:t.status)===u.S.COMING_UP,o="/project/".concat(e,"/building"),c=null===(s=null==a?void 0:a.auth)||void 0===s||s,d=null===(l=null==a?void 0:a.edgeFunctions)||void 0===l||l,m=null===(i=null==a?void 0:a.storage)||void 0===i||i;return[{title:"Project Settings",items:[{name:"General",key:"general",url:"/project/".concat(e,"/settings/general"),items:[]},{name:"Infrastructure",key:"infrastructure",url:r?o:"/project/".concat(e,"/settings/infrastructure"),items:[]},...u.Qy?[{name:"Integrations",key:"integrations",url:"/project/".concat(e,"/settings/integrations"),items:[]}]:[],{name:"Add Ons",key:"addons",url:"/project/".concat(e,"/settings/addons"),items:[]},{name:"Vault",key:"vault",url:r?o:"/project/".concat(e,"/settings/vault/secrets"),items:[],label:"BETA"}]},{title:"Configuration",items:[{name:"Database",key:"database",url:r?o:"/project/".concat(e,"/settings/database"),items:[]},{name:"API",key:"api",url:r?o:"/project/".concat(e,"/settings/api"),items:[]},...u.Qy&&c?[{name:"Authentication",key:"auth",url:r?o:"/project/".concat(e,"/settings/auth"),items:[]}]:[],...u.Qy&&m?[{name:"Storage",key:"storage",url:"/project/".concat(e,"/settings/storage"),items:[]}]:[],...u.Qy&&d?[{name:"Edge Functions",key:"functions",url:"/project/".concat(e,"/settings/functions"),items:[]}]:[]]},{title:"Billing",items:[{name:"Subscription",key:"subscription",url:"/org/".concat(null==n?void 0:n.slug,"/billing"),items:[]},{name:"Usage",key:"usage",url:"/org/".concat(null==n?void 0:n.slug,"/usage?projectRef=").concat(e),items:[]}]}]};var eo=(0,c.QO)(e=>{let{title:t,children:n}=e,s=(0,i.useRouter)(),{ref:l}=(0,m.UO)(),o=(0,c.Vm)(),d=(0,c.lL)();(0,r.useEffect)(()=>{u.Qy||s.push("/project/default")},[s]);let h=s.pathname.includes("billing")?s.pathname.split("/")[5]:s.pathname.split("/")[4],{projectAuthAll:x,projectEdgeFunctionAll:p,projectStorageAll:f,billingInvoices:g}=(0,c.N3)(["project_auth:all","project_edge_function:all","project_storage:all","billing:invoices"]),j=er(l,o,d,{auth:x,edgeFunctions:p,storage:f,invoices:g});return(0,a.jsx)(ei.Z,{isBlocking:!1,title:t||"Settings",product:"Settings",productMenu:(0,a.jsx)(O.Q,{page:h,menu:j}),children:(0,a.jsx)("main",{style:{maxHeight:"100vh"},className:"flex-1 overflow-y-auto",children:n})})}),ec=n(34389),ed=n(81395),eu=n(78450),em=n(54373),eh=n(62202),ex=n(38406),ep=n(89796),ef=n(53187),eg=n(31840);let ej=e=>{let{visible:t,onCancel:n,onSubmit:s,initialValues:l}=e;return(0,a.jsx)(ep.C,{visible:t,onCancel:n,hideFooter:!0,header:"Update custom report",size:"small",children:(0,a.jsx)(ef.Z,{onReset:n,validateOnBlur:!0,initialValues:l,validate:function(e){let t={};return e.name||(t.name="Required"),t},onSubmit:s,children:e=>{let{isSubmitting:t}=e;return(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsx)(ep.C.Content,{children:(0,a.jsx)(eg.Z,{label:"Name",id:"name",name:"name"})}),(0,a.jsx)(ep.C.Content,{children:(0,a.jsx)(eg.Z.TextArea,{label:"Description",id:"description",placeholder:"Describe your custom report",size:"medium",textAreaClassName:"resize-none"})}),(0,a.jsx)(ep.C.Separator,{}),(0,a.jsx)(ep.C.Content,{children:(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,a.jsx)(Q.z,{htmlType:"reset",type:"default",onClick:n,disabled:t,children:"Cancel"}),(0,a.jsx)(Q.z,{htmlType:"submit",loading:t,disabled:t,children:"Save custom report"})]})})]})}})})};var ev=n(54175),eb=n(63927),ey=n(52718),eN=n(67931),ew=n(12467),e_=n(40386),eC=n(72860),eS=n(83033),ek=()=>{var e;let t=(0,i.useRouter)(),{id:n}=t.query,s=(0,c.Vm)(),l=(0,eb.z)(),o=(0,eN.R)(),d=(0,c.N3)("project_storage:all"),u=n||t.pathname.split("/")[4],m=null!==(e=null==s?void 0:s.ref)&&void 0!==e?e:"default",[h,x]=r.useState(!1),[p,f]=r.useState(!1),[g,v]=r.useState(!1),[b,y]=r.useState(),{data:N,isLoading:w}=(0,ey.I1)(m),_=function(){if(!N)return[];let e=null==N?void 0:N.content.filter(e=>"report"===e.type);return(null==e?void 0:e.sort((e,t)=>e.name<t.name?-1:e.name>t.name?1:0)).map((e,t)=>({id:e.id,name:e.name,description:e.description||"",key:e.id||t+"-report",url:"/project/".concat(m,"/reports/").concat(e.id),hasDropdownActions:!0,report:e}))}(),S=[{title:"Built-in reports",key:"builtin-reports",items:[{name:"API",key:"api-overview",url:"/project/".concat(m,"/reports/api-overview")},...d?[{name:"Storage",key:"storage",url:"/project/".concat(m,"/reports/storage")}]:[],{name:"Database",key:"database",url:"/project/".concat(m,"/reports/database")}]}];return(0,a.jsx)(C.ZP,{type:"pills",className:"mt-6",children:w?(0,a.jsxs)("div",{className:"px-5 my-4 space-y-2",children:[(0,a.jsx)(ev.Z,{}),(0,a.jsx)(ev.Z,{className:"w-3/4"}),(0,a.jsx)(ev.Z,{className:"w-1/2"})]}):(0,a.jsxs)("div",{className:"flex flex-col px-2 gap-y-6",children:[(0,a.jsx)("div",{className:"flex px-2",children:(0,a.jsx)(Q.z,{type:"default",className:"justify-start flex-grow",onClick:()=>{f(!0)},icon:(0,a.jsx)(ec.Z,{size:12}),children:"New custom report"})}),_.length>0?(0,a.jsxs)("div",{children:[(0,a.jsx)(C.ZP.Group,{title:"Your custom reports"}),_.map((e,t)=>(0,a.jsxs)(j(),{className:(0,ew.cn)("pr-2 h-7 pl-3 mt-1 text-foreground-light group-hover:text-foreground/80 text-sm","flex items-center justify-between rounded-md group relative",e.key===u?"bg-surface-300 text-foreground":"hover:bg-surface-200"),href:e.url,children:[(0,a.jsx)("div",{children:e.name}),(0,a.jsxs)(e_.h_,{children:[(0,a.jsx)(e_.$F,{children:(0,a.jsx)(Q.z,{type:"text",className:"px-1 opacity-50 hover:opacity-100",icon:(0,a.jsx)(ed.Z,{size:12,strokeWidth:2})})}),(0,a.jsxs)(e_.AW,{align:"start",className:"w-52 *:space-x-2",children:[(0,a.jsxs)(e_.Xi,{onClick:()=>{e.id&&(y(e.report),v(!0))},children:[(0,a.jsx)(eu.Z,{size:12}),(0,a.jsx)("div",{children:"Rename"})]}),(0,a.jsx)(e_.VD,{}),(0,a.jsxs)(e_.Xi,{onClick:async()=>{e.id&&(y(e.report),x(!0))},children:[(0,a.jsx)(em.Z,{size:12}),(0,a.jsx)("div",{children:"Delete"})]})]})]})]},e.key+"-menukey"))]}):null,S.map(e=>(0,a.jsx)("div",{children:e.items?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(C.ZP.Group,{title:e.title}),(0,a.jsx)("div",{className:"flex flex-col",children:e.items.map(e=>(0,a.jsx)("li",{className:(0,ew.cn)("pr-2 mt-1 text-foreground-light group-hover:text-foreground/80 text-sm","flex items-center justify-between rounded-md group relative",e.key===u?"bg-surface-300 text-foreground":"hover:bg-surface-200"),children:(0,a.jsx)(j(),{href:e.url,className:"flex-grow h-7 flex items-center pl-3",children:e.name})},e.key))},e.key)]}):null},e.key+"-menu-group")),(0,a.jsxs)(eC.bZ,{children:[(0,a.jsx)(eC.Cd,{className:"text-sm",children:"Query Performance and Project Linter reports have been shifted"}),(0,a.jsxs)(eC.X,{className:"text-xs",children:[(0,a.jsx)("p",{className:"mb-2",children:"They can now be found in the menu under the database section."}),(0,a.jsx)(Q.z,{asChild:!0,type:"default",size:"tiny",children:(0,a.jsx)(j(),{href:"/project/".concat(m,"/database/query-performance"),children:"Head over to Database"})})]})]}),(0,a.jsx)(ej,{onSubmit:async e=>{try{if(!b||!b.id||!b.project_id)return;await o.mutateAsync({projectRef:m,payload:{...b,project_id:b.project_id,id:b.id,name:e.name,description:e.description||""}}),eh.ZP.success("Report updated"),v(!1)}catch(e){eh.ZP.error("Failed to update report. Check console for more details."),console.error(e)}},onCancel:()=>v(!1),visible:g,initialValues:{name:(null==b?void 0:b.name)||"",description:(null==b?void 0:b.description)||""}}),(0,a.jsx)(eS.Z,{title:"Delete custom report",confirmLabel:"Delete report",confirmLabelLoading:"Deleting report",size:"medium",loading:l.isLoading,visible:h,onCancel:()=>x(!1),onConfirm:async()=>{if(b){if(!b.id)return;await l.mutateAsync({projectRef:m,ids:[b.id]}),eh.ZP.success("Report deleted"),t.push("/project/".concat(m,"/reports"))}x(!1)},children:(0,a.jsx)("div",{className:"text-sm text-foreground-light grid gap-4",children:(0,a.jsx)("div",{className:"grid gap-1",children:(0,a.jsxs)("p",{children:["Are you sure you want to delete '",null==b?void 0:b.name,"'?"]})})})}),(0,a.jsx)(ex.m,{visible:p,onCancel:()=>{f(!1)},afterSubmit:()=>{f(!1)}})]})})},eE=(0,c.QO)(e=>{let{title:t,children:n}=e;return(0,a.jsx)(ei.Z,{title:t,product:"Reports",productMenu:(0,a.jsx)(ek,{}),children:(0,a.jsx)("main",{style:{maxHeight:"100vh"},className:"flex-1 overflow-y-auto",children:n})})}),eZ=n(59491),eT=n(96795),eR=n.n(eT),ez=n(12047),eA=n(50853);function eP(e){return"sql"===e.type}let eL=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,ey.I1)(e,{select:e=>({snippets:e.content.filter(eP)}),...t})};var eI=n(5388),eD=n(8237),eF=n(71929),eO=n(40414),eq=n(38880),eW=n(66650),eU=n(97351),eV=n(50416),eM=n(62767);let eB=(0,r.forwardRef)((e,t)=>{let{...n}=e;return(0,a.jsx)(eW.zF,{...n,className:(0,ew.cn)("w-full px-2",n.className)})}),eK=(0,r.forwardRef)((e,t)=>{let{...n}=e;return(0,a.jsx)(eW.wy,{disabled:!0,ref:t,...n,className:(0,ew.cn)("w-full flex gap-1 items-center group px-3 text-xs font-normal font-mono uppercase text-lighter tracking-wide",n.className),children:(0,a.jsx)("span",{className:"group-hover:not-disabled:text-foreground",children:n.title})})}),eY=(0,r.forwardRef)((e,t)=>{let{...n}=e;return(0,a.jsx)(eW.Fw,{...n,className:(0,ew.cn)("w-full data-[state=open]:pt-1 flex flex-col gap-2",n.className)})}),eQ=(0,r.forwardRef)((e,t)=>(0,a.jsx)("div",{ref:t,...e,className:(0,ew.cn)("h-px bg-border-muted",e.className)})),eH=(0,r.forwardRef)((e,t)=>{let{className:n,isActive:s,forceHoverState:l,...i}=e;return(0,a.jsx)(j(),{ref:t,...i,"aria-current":s,className:(0,ew.cn)("text-sm","h-7 pl-3 pr-2","flex items-center justify-between rounded-md group relative",s?"bg-selection":"hover:bg-surface-200",l&&"bg-surface-200",s?"text-foreground":"text-foreground-light hover:text-foreground",n)})}),eG=(0,r.forwardRef)((e,t)=>(0,a.jsx)("div",{ref:t,...e,className:(0,ew.cn)("flex px-2 gap-2 items-center",e.className)})),eX=(0,r.forwardRef)((e,t)=>{let{children:n,...s}=e;return(0,a.jsxs)("label",{htmlFor:s.name,className:"relative w-full",children:[(0,a.jsx)("span",{className:"sr-only",children:s["aria-labelledby"]}),(0,a.jsx)(eU.I,{ref:t,type:"text",className:(0,ew.cn)("h-[28px] w-full","text-xs","pl-7","pr-7","w-full","rounded",s.className),...s}),n,(0,a.jsx)(eq.Z,{className:"absolute left-2 top-2 text-foreground-muted",size:14,strokeWidth:1.5})]})}),e$=(0,r.forwardRef)((e,t)=>{let{value:n,onValueChange:s,contentClassName:l,triggerClassName:i,...r}=e;return(0,a.jsxs)(e_.h_,{modal:!1,children:[(0,a.jsxs)(eO.u,{delayDuration:0,children:[(0,a.jsx)(e_.$F,{asChild:!0,className:(0,ew.cn)("absolute right-1 top-[.3rem]","text-foreground-muted transition-colors hover:text-foreground data-[state=open]:text-foreground",i),children:(0,a.jsx)(eO.aJ,{children:(0,a.jsx)(eV.Z,{size:18,strokeWidth:1})})}),(0,a.jsx)(eO._v,{side:"bottom",children:"Sort By"})]}),(0,a.jsx)(e_.AW,{side:"bottom",align:"end",className:(0,ew.cn)("w-48",l),children:(0,a.jsx)(e_._x,{value:n,onValueChange:s,children:r.children})})]})}),eJ=(0,r.forwardRef)((e,t)=>(0,a.jsx)(e_.qB,{ref:t,...e})),e0=(0,r.forwardRef)((e,t)=>(0,a.jsxs)("div",{ref:t,...e,className:(0,ew.cn)("flex flex-col px-2 gap-1 pb-4",e.className),children:[(0,a.jsx)(eM.Z,{className:"w-full h-7 rounded-md",delayIndex:0}),(0,a.jsx)(eM.Z,{className:"w-full h-7 rounded-md",delayIndex:1}),(0,a.jsx)(eM.Z,{className:"w-full h-7 rounded-md",delayIndex:2})]})),e1=(0,r.forwardRef)((e,t)=>{let{illustration:n,title:s,description:l,actions:i,...r}=e;return(0,a.jsx)("div",{ref:t,...r,className:(0,ew.cn)("border bg-surface-100/50 flex flex-col gap-y-3 items-center justify-center rounded-md px-3 py-4",r.className),children:(0,a.jsxs)("div",{className:"flex flex-col gap-y-1 items-center justify-center",children:[n,s&&(0,a.jsx)("p",{className:"text-xs text-foreground-light",children:s}),l&&(0,a.jsx)("p",{className:"text-xs text-foreground-lighter text-center",children:l}),i&&(0,a.jsx)("div",{className:"mt-2",children:i})]})})});var e2=n(34291),e4=n.n(e2),e3=n(832),e5=n(18227),e8=n(57370),e6=n.n(e8),e9=n(68202),e7=n(96383),te=n(37268),tt=n(39127),tn=n(56009),ta=n(86073),ts=e=>{let{id:t,...n}=e,s=(0,eF.W2)().snippets[t].snippet,l=e6()(s.name),[i,o]=(0,r.useState)("CLI"),c=[{id:"migration",label:"Migration",title:"Download as migration",description:"Download the snippet in a new migration named `".concat(l,"`"),cli:(0,eA.kL)(t,l),npm:(0,eA.kL)(t,l,!0)},{id:"seed",label:"Seed file",title:"Download as seed file",description:"If your query consists of sample data, append the snippet to the end of `supabase/seed.sql`",cli:(0,eA.YI)(t),npm:(0,eA.YI)(t,!0)},{id:"sql",label:"SQL file",title:"Download as SQL file",description:"Download the snippet directly into a new SQL file named `".concat(l,".sql`"),cli:(0,eA.y4)(t,l),npm:(0,eA.y4)(t,l,!0)}];return(0,a.jsx)(ep.C,{hideFooter:!0,showCloseButton:!0,size:"xlarge",header:(0,a.jsx)("p",{children:"Download snippet as local migration file via the Supabase CLI."}),...n,children:(0,a.jsx)(e9.Z,{children:(0,a.jsxs)("div",{className:"flex flex-col items-start justify-between gap-4 py-5 relative",children:[(0,a.jsx)(e7.Z,{type:"underlined",listClassNames:"pl-5",children:c.map(e=>(0,a.jsxs)(e7.Z.Panel,{id:e.id,label:e.label,className:"px-5",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,a.jsx)("h2",{className:"text-lg",children:e.title}),(0,a.jsx)(ta.U,{className:"text-sm text-scale-1000 [&>p>code]:!break-normal",content:e.description})]}),(0,a.jsx)(tn.Z,{width:75,options:["CLI","NPM"],activeOption:i,borderOverride:"border-muted",onClickOption:()=>"CLI"===i?o("NPM"):o("CLI")})]}),(0,a.jsx)("pre",{children:(0,a.jsx)(te.d,{language:"bash",className:"language-bash prose dark:prose-dark max-w-none",children:"CLI"===i?e.cli:e.npm})})]},e.id))}),(0,a.jsxs)("div",{className:"w-full flex items-center justify-between",children:[(0,a.jsx)("p",{className:"text-xs text-lighter mx-5",children:"Run this command from your project directory"}),(0,a.jsxs)("div",{className:"flex justify-between items-center gap-x-2 mx-5",children:[(0,a.jsx)(Q.z,{asChild:!0,type:"default",icon:(0,a.jsx)(tt.Z,{size:14,strokeWidth:1.5}),children:(0,a.jsx)(j(),{href:"https://supabase.com/docs/guides/cli/local-development#database-migrations",target:"_blank",rel:"noreferrer",children:"About migrations"})}),(0,a.jsx)(Q.z,{asChild:!0,type:"default",icon:(0,a.jsx)(tt.Z,{size:14,strokeWidth:1.5}),children:(0,a.jsx)(j(),{href:"https://supabase.com/docs/guides/cli/local-development",target:"_blank",rel:"noreferrer",children:"About CLI"})})]})]})]})})})},tl=n(54738),ti=n(4646),tr=n(9181),to=n(38147),tc=n(81199),td=e=>{let{snippet:t,visible:n,onCancel:s,onComplete:l}=e,{ref:i}=(0,m.UO)(),o=(0,c.lL)(),d=(0,eF.W2)(),{data:u}=(0,ti.G)({orgSlug:null==o?void 0:o.slug}),h=(0,tc.$)(u),{id:x,name:p,description:f}=t,[g,j]=(0,r.useState)(p),[v,b]=(0,r.useState)(f);(0,r.useEffect)(()=>{j(p)},[p]);let y=async(e,t)=>{let{setSubmitting:n}=t;if(!i)return console.error("Project ref is required");if(!x)return console.error("Snippet ID is required");n(!0);try{return d.renameSnippet(x,g,v),l&&l(),Promise.resolve()}catch(e){eh.ZP.error("Failed to rename query: ".concat(e.message))}},{mutateAsync:N,isLoading:w}=(0,tl.g)(),_=!!t.content.sql;return(0,a.jsx)(ep.C,{visible:n,onCancel:s,hideFooter:!0,header:"Rename",size:"small",children:(0,a.jsx)(ef.Z,{onReset:s,validateOnBlur:!0,initialValues:{name:null!=p?p:"",description:null!=f?f:""},validate:()=>{let e={};return g||(e.name="Please enter a query name"),e},onSubmit:y,children:e=>{let{isSubmitting:n}=e;return(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsxs)(ep.C.Content,{children:[(0,a.jsx)(eg.Z,{label:"Name",id:"name",name:"name",value:g,onChange:e=>j(e.target.value)}),(0,a.jsx)("div",{className:"flex w-full justify-end mt-2",children:!h&&_&&(0,a.jsx)(Q.z,{type:"default",onClick:async()=>{try{let{title:e,description:n}=await N({sql:t.content.sql});j(e),v||b(n)}catch(e){(0,tr.V)(e)&&eh.ZP.error("Failed to rename query: ".concat(e.message))}},size:"tiny",disabled:w,children:(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("div",{className:"scale-75",children:(0,a.jsx)(to.c,{loading:w})}),(0,a.jsx)("span",{children:"Rename with Supabase AI"})]})})})]}),(0,a.jsx)(ep.C.Content,{children:(0,a.jsx)(eg.Z.TextArea,{label:"Description",id:"description",placeholder:"Describe query",size:"medium",textAreaClassName:"resize-none",value:v,onChange:e=>b(e.target.value)})}),(0,a.jsx)(ep.C.Separator,{}),(0,a.jsx)(ep.C.Content,{children:(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,a.jsx)(Q.z,{htmlType:"reset",type:"default",onClick:s,disabled:n,children:"Cancel"}),(0,a.jsx)(Q.z,{htmlType:"submit",loading:n,disabled:n,children:"Rename query"})]})})]})}})})},tu=n(42288),tm=n(26518),th=n(76817),tx=n(24154),tp=n(9261),tf=n(55050),tg=n(47277);let tj=e=>{let{tabInfo:t,open:n,setOpen:s,onSelectRenameQuery:l,onSelectDeleteQuery:r,onSelectShareQuery:o,onSelectDownloadQuery:d}=e,{ref:u}=(0,m.UO)(),h=(0,i.useRouter)(),{profile:x}=(0,eD.Un)(),p=(0,eF.W2)(),f=(0,c.Vm)(),{id:g,name:j,visibility:v,content:b}=t||{},y=(0,c.Xo)(eZ.KA.CREATE,"user_content",{resource:{type:"sql",owner_id:null==x?void 0:x.id},subject:{id:null==x?void 0:x.id}}),{id:N}=t||{},w=void 0!==N&&p.snippets&&void 0!==p.snippets[N]?p.snippets[N]:null,_=(null==x?void 0:x.id)===(null==w?void 0:w.snippet.owner_id),C=async()=>{if(!u)return console.error("Project ref is required");if(!g)return console.error("Snippet ID is required");try{let e=(0,eA.UA)({id:(0,eI.k$)(),name:j,sql:b.sql,owner_id:null==x?void 0:x.id,project_id:null==f?void 0:f.id});p.addSnippet(e,u),p.addNeedsSaving(e.id),h.push("/project/".concat(u,"/sql/").concat(e.id))}catch(e){eh.ZP.error("Failed to create a personal copy of this query: ".concat(e.message))}};return(0,a.jsx)(a.Fragment,{children:m.Qy?(0,a.jsxs)(e_.h_,{open:n,onOpenChange:s,children:[(0,a.jsx)(e_.$F,{className:"opacity-0 group-hover:opacity-100 group-focus:opacity-100 focus:opacity-100 data-[state=open]:opacity-100",asChild:!0,name:"Query actions",children:(0,a.jsx)(Q.z,{type:"text",className:"px-1 text-lighter data-[state=open]:text-foreground",icon:(0,a.jsx)(th.Z,{size:14,strokeWidth:2}),onClick:e=>e.preventDefault()})}),(0,a.jsxs)(e_.AW,{side:"bottom",align:"start",className:"w-52",children:[_&&(0,a.jsxs)(e_.Xi,{onClick:e=>{e.stopPropagation(),l()},className:"flex gap-2",children:[(0,a.jsx)(tx.Z,{size:14}),"Rename query"]}),"user"===v&&y&&(0,a.jsxs)(e_.Xi,{onClick:e=>{e.stopPropagation(),o()},className:"flex gap-2",children:[(0,a.jsx)(tp.Z,{size:14}),"Share query"]}),"project"===v&&y&&(0,a.jsxs)(e_.Xi,{onClick:C,className:"flex gap-2",children:[(0,a.jsx)(tf.Z,{size:14}),"Duplicate personal copy"]}),m.Qy&&(0,a.jsxs)(e_.Xi,{onClick:()=>d(),className:"flex gap-2",children:[(0,a.jsx)(tg.Z,{size:14}),"Download as migration file"]}),_&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e_.VD,{}),(0,a.jsxs)(e_.Xi,{onClick:e=>{e.stopPropagation(),r()},className:"flex gap-2",children:[(0,a.jsx)(em.Z,{size:14}),"Delete query"]})]})]})]}):(0,a.jsx)(Q.z,{asChild:!0,disabled:!0,type:"text",style:{padding:"3px"},children:(0,a.jsx)("span",{})})})};var tv=n(85120),tb=n(35484),ty=e=>{let{tabInfo:t,isSelected:n=!1,hasQueriesSelected:s=!1,onSelectQuery:l=e4(),onDeleteQuery:i=e4()}=e,[o,c]=(0,r.useState)(!1),[d,u]=(0,r.useState)(!1),[h,x]=(0,r.useState)(!1),[p,f]=(0,r.useState)(!1),[g,j]=(0,r.useState)(!1),{ref:v,id:b}=(0,m.UO)(),y=(0,eF.W2)(),{id:N,name:w,description:_,content:C,visibility:S}=t||{},k=N===b,E=(0,r.useRef)(null),Z=o||k||d||h||p||g,{mutate:T,isLoading:R}=(0,eb.z)({onSuccess:e=>{i(e)},onError:(e,t)=>{e.message.includes("Contents not found")?i(t.ids):eh.ZP.error("Failed to delete query: ".concat(e.message))}}),z=async()=>v?N?void T({projectRef:v,ids:[N]}):console.error("Snippet ID is required"):console.error("Project ref is required");(0,r.useEffect)(()=>{k&&E.current&&setTimeout(()=>{var e;null===(e=E.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"nearest"})},0)});let A=async()=>{if(N)try{return y.shareSnippet(N,"project"),Promise.resolve()}catch(e){eh.ZP.error("Failed to share query: ".concat(e.message))}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(e3.zs,{openDelay:200,children:[(0,a.jsx)(e3.Yi,{asChild:!0,children:(0,a.jsxs)(eH,{title:_||w,ref:k?E:null,href:"/project/".concat(v,"/sql/").concat(N),className:"flex gap-3 items-center",forceHoverState:o,isActive:k,children:["user"===S&&(0,a.jsx)(e5.X,{className:(0,ew.cn)("transition absolute left-2.5 border-strong",s?"":"opacity-0 group-hover:opacity-100"),checked:n,onCheckedChange:l}),(0,a.jsx)("span",{className:(0,ew.cn)("transition-all","w-full overflow-hidden truncate",s&&"user"===S?"ml-5":"user"===S?"group-hover:ml-5":"","text-ellipsis truncate"),children:w}),!s&&(0,a.jsx)(tj,{tabInfo:t,open:o,setOpen:c,onSelectDeleteQuery:()=>f(!0),onSelectRenameQuery:()=>u(!0),onSelectShareQuery:()=>x(!0),onSelectDownloadQuery:()=>j(!0)})]},N)}),!Z&&(0,a.jsx)(e3.bZ,{side:"right",align:"center",className:"w-96",animate:"slide-in",children:(0,a.jsxs)(a.Fragment,{children:[C.sql.trim()?(0,a.jsx)(tu.Z,{showCopy:!1,className:"sql",parentClassName:"!p-0 [&>div>span]:text-xs [&>div>span]:tracking-tighter",children:C.sql.replaceAll("\n"," ").replaceAll(/\s+/g," ").slice(0,43)+"".concat(C.sql.length>43?"...":"")}):(0,a.jsx)("p",{className:"text-xs text-foreground-lighter",children:"This query is empty"}),C.sql.trim()&&(0,a.jsx)(tm.Z,{iconOnly:!0,type:"default",className:"px-1 absolute top-1.5 right-1.5",text:C.sql})]})})]}),(0,a.jsx)(td,{snippet:t,visible:d,onCancel:()=>u(!1),onComplete:()=>u(!1)}),(0,a.jsx)(eS.Z,{title:"Confirm to delete query",confirmLabel:"Delete query",confirmLabelLoading:"Deleting query",size:"medium",loading:R,visible:p,variant:"destructive",onCancel:()=>f(!1),onConfirm:z,alert:"project"===S?{title:"This SQL snippet will be lost forever",description:"Deleting this query will remove it for all members of the project team."}:{},children:(0,a.jsxs)("p",{className:"text-sm",children:["Are you sure you want to delete '",w,"'?"]})}),(0,a.jsx)(eS.Z,{title:"Confirm sharing query",size:"medium",confirmLabel:"Share query",confirmLabelLoading:"Sharing query",visible:h,onCancel:()=>x(!1),onConfirm:A,alert:{title:"This SQL query will become public to all team members",description:"Anyone with access to the project can view it"},children:(0,a.jsxs)("ul",{className:"text-sm text-foreground-light space-y-5",children:[(0,a.jsxs)("li",{className:"flex gap-3",children:[(0,a.jsx)(tv.Z,{}),(0,a.jsx)("span",{children:"Project members will have read-only access to this query."})]}),(0,a.jsxs)("li",{className:"flex gap-3",children:[(0,a.jsx)(tb.Z,{}),(0,a.jsx)("span",{children:"Anyone will be able to duplicate it to their personal snippets."})]})]})}),(0,a.jsx)(ts,{id:N,visible:g,onCancel:()=>j(!1)})]})},tN=n(75652),tw=n.n(tN);let t_=(e,t,n)=>{let a=t.findIndex(e=>e.id===n[n.length-1]),s=t.findIndex(t=>t.id===e),l=t.slice(Math.min(s,a),Math.max(s,a)+1);if(s<a&&l.reverse(),!n.includes(e))return tw()(n.concat(l.map(e=>e.id)));{let t=l.map(e=>e.id);return n.filter(n=>n===e||!t.includes(n))}};var tC=()=>{let{ref:e,id:t}=(0,m.UO)(),n=(0,i.useRouter)(),{profile:s}=(0,eD.Un)(),l=(0,c.Vm)(),[o,d]=(0,r.useState)(""),[u,h]=(0,r.useState)(!1),[x,p]=(0,r.useState)([]),f=(0,eF.W2)(),{isLoading:g,isSuccess:j}=eL(e,{refetchOnWindowFocus:!1,staleTime:300,onSuccess(t){e&&f.setRemoteSnippets(t.snippets,e)}}),{mutate:v,isLoading:b}=(0,eb.z)({onSuccess:e=>y(e),onError:(e,t)=>{404===e.code&&e.message.includes("Content not found")?y(t.ids):eh.ZP.error("Failed to delete queries: ".concat(e.message))}}),y=a=>{var s;h(!1),p([]),a.length>0&&a.forEach(e=>f.removeSnippet(e));let l=(null!==(s=f.orders[e])&&void 0!==s?s:[]).filter(e=>!a.includes(e));0===l.length?n.push("/project/".concat(e,"/sql/new")):a.includes(t)&&n.push("/project/".concat(e,"/sql/").concat(l[0]))},N=(0,eF.Fy)(e),w=(0,r.useMemo)(()=>N.filter(e=>"project"===e.visibility),[N]),_=(0,r.useMemo)(()=>o.length>0?w.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())):w,[w,o]),C=(0,r.useMemo)(()=>{let e=N.filter(e=>"user"===e.visibility&&!e.content.favorite);return o.length>0?e.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())):e},[o,N]),S=(0,r.useMemo)(()=>N.filter(e=>e.content.favorite),[N]),k=(0,r.useMemo)(()=>o.length>0?S.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())):S,[S,o]),E=(0,c.Xo)(eZ.KA.CREATE,"user_content",{resource:{type:"sql",owner_id:null==s?void 0:s.id},subject:{id:null==s?void 0:s.id}}),Z=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0!==e){if(t){let[t,n]=eR()(x,e=>{var t;return null===(t=N.find(t=>t.id===e))||void 0===t?void 0:t.content.favorite}),a=N.find(t=>t.id===e);(null==a?void 0:a.content.favorite)?t.length>0?p(t_(e,k,t).concat(n)):T(e):n.length>0?p(t_(e,C,n).concat(t)):T(e)}else T(e)}},T=e=>{x.includes(e)?p(x.filter(t=>t!==e)):p(x.concat([e]))},R=async()=>{if(!e)return console.error("Project is required");if(!s)return console.error("Profile is required");if(!E)return(0,eh.ZP)("Your queries will not be saved as you do not have sufficient permissions");try{let t=(0,eA.UA)({id:(0,eI.k$)(),name:ez.$C,owner_id:null==s?void 0:s.id,project_id:null==l?void 0:l.id});f.addSnippet(t,e),n.push("/project/".concat(e,"/sql/").concat(t.id)),d("")}catch(e){eh.ZP.error("Failed to create new query: ".concat(e.message))}},z=async()=>{if(!e)return console.error("Project ref is required");v({projectRef:e,ids:x})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mt-6",children:g?(0,a.jsx)(e0,{}):j?(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsx)(Q.z,{type:"default",className:"justify-start mx-4",onClick:()=>R(),icon:(0,a.jsx)(ec.Z,{className:"text-foreground-muted",strokeWidth:1,size:14}),children:"New query"}),(0,a.jsxs)("div",{className:"px-2",children:[(0,a.jsx)(eH,{title:"Templates",isActive:n.asPath==="/project/".concat(e,"/sql/templates"),href:"/project/".concat(e,"/sql/templates"),children:"Templates"}),(0,a.jsx)(eH,{title:"Quickstarts",isActive:n.asPath==="/project/".concat(e,"/sql/quickstarts"),href:"/project/".concat(e,"/sql/quickstarts"),children:"Quickstarts"})]}),N.length>0&&(0,a.jsx)(eG,{className:"mx-2",children:(0,a.jsx)(eX,{name:"search-queries",placeholder:"Search queries...",onChange:e=>d(e.target.value.trim()),value:o,"aria-labelledby":"Search queries"})}),o.length>0&&0===_.length&&0===k.length&&0===_.length&&(0,a.jsx)(e1,{className:"mx-4",title:"No project queries found",description:"Click the New query button to create a new query",actions:(0,a.jsx)(Q.z,{type:"default",onClick:()=>R(),children:"New query"})}),_.length>0&&(0,a.jsxs)(eB,{className:"editor-product-menu",defaultOpen:!0,children:[(0,a.jsx)(eK,{title:"Project queries"}),(0,a.jsx)(eY,{children:(0,a.jsx)(a.Fragment,{children:_.map(e=>(0,a.jsx)(ty,{tabInfo:e,onDeleteQuery:y,hasQueriesSelected:x.length>0},e.id))})})]}),x.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eQ,{}),(0,a.jsxs)("div",{className:"px-4 flex items-center gap-x-2 py-2",children:[(0,a.jsxs)(Q.z,{block:!0,type:"danger",onClick:()=>h(!0),children:["Delete ",x.length.toLocaleString()," quer",x.length>1?"ies":"y"]}),(0,a.jsxs)(eO.u,{delayDuration:100,children:[(0,a.jsx)(eO.aJ,{asChild:!0,children:(0,a.jsx)(Q.z,{type:"default",onClick:()=>p([]),children:"Cancel"})}),(0,a.jsx)(eO._v,{side:"bottom",children:"Clear selection"})]})]})]}),k.length>0&&(0,a.jsxs)(eB,{className:"editor-product-menu",defaultOpen:!0,children:[(0,a.jsx)(eK,{title:"Favorites"}),(0,a.jsx)(eY,{children:(0,a.jsx)(a.Fragment,{children:k.map(e=>(0,a.jsx)(ty,{tabInfo:e,isSelected:x.includes(e.id),hasQueriesSelected:x.length>0,onSelectQuery:t=>Z(e.id,t),onDeleteQuery:y},e.id))})})]}),C.length>0&&(0,a.jsxs)(eB,{className:"editor-product-menu",defaultOpen:!0,children:[(0,a.jsx)(eK,{title:"Your queries"}),(0,a.jsx)(eY,{className:"editor-product-menu",children:(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("div",{className:"space-y-0.5",children:C.map(e=>(0,a.jsx)(ty,{tabInfo:e,isSelected:x.includes(e.id),hasQueriesSelected:x.length>0,onSelectQuery:t=>Z(e.id,t),onDeleteQuery:y},e.id))})})})]})]})}):null}),(0,a.jsx)(eS.Z,{title:"Confirm to delete query",confirmLabel:"Delete ".concat(x.length.toLocaleString()," quer").concat(x.length>1?"ies":"y"),confirmLabelLoading:"Deleting query",size:"medium",loading:b,visible:u,onConfirm:z,onCancel:()=>h(!1),variant:"destructive",alert:{title:"This action cannot be undone",description:"The selected SQL snippets cannot be recovered once deleted"},children:(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:["Are you sure you want to delete the selected ",x.length," quer",x.length>1?"ies":"y","?"]})})]})},tS=(0,c.QO)(e=>{let{title:t,children:n}=e,s=(0,r.useMemo)(()=>(0,a.jsx)(tC,{},"sql-editor-menu"),[]);return(0,a.jsx)(ei.Z,{title:t||"SQL",product:"SQL Editor",productMenu:s,isBlocking:!1,resizableSidebar:!0,children:n})}),tk=n(6659),tE=n(38421),tZ=n.n(tE),tT=e=>{let{heading:t,subheading:n,logoLinkToMarketingSite:s=!1,showHeadings:l=!0,children:i}=e,{resolvedTheme:r}=(0,tk.F)();return(0,a.jsxs)("div",{className:"flex-1 bg-studio flex flex-col gap-8 lg:gap-16 xl:gap-32",children:[(0,a.jsx)("div",{className:"sticky top-0 mx-auto w-full max-w-7xl px-8 pt-6 sm:px-6 lg:px-8",children:(0,a.jsx)("nav",{className:"relative flex items-center justify-between sm:h-10",children:(0,a.jsx)("div",{className:"flex flex-shrink-0 flex-grow items-center lg:flex-grow-0",children:(0,a.jsx)("div",{className:"flex w-full items-center justify-between md:w-auto",children:(0,a.jsx)(j(),{href:s?"https://supabase.com":"/projects",children:(0,a.jsx)(tZ(),{src:(null==r?void 0:r.includes("dark"))?"".concat(u.GW,"/img/supabase-dark.svg"):"".concat(u.GW,"/img/supabase-light.svg"),alt:"",height:24,width:120})})})})})}),(0,a.jsx)("div",{className:"flex flex-col justify-center items-center",children:(0,a.jsxs)("main",{className:"max-w-[448px] w-full flex flex-col px-5",children:[l&&(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl lg:text-3xl mt-8 mb-2",children:t}),(0,a.jsx)("h2",{className:"text-foreground-light text-sm",children:n})]}),i]})})]})},tR=n(85945),tz=n(69276),tA=n(39383),tP=n(46398),tL=e=>{let{heading:t,subheading:n,showDisclaimer:s=!0,logoLinkToMarketingSite:l=!1,children:o}=e,d=(0,i.useRouter)(),m=(0,tR.NL)(),{resolvedTheme:h}=(0,tk.F)(),x=(0,c.P5)("ongoingIncident");(0,r.useEffect)(()=>{tz.I8.initialize().then(async e=>{let{error:t}=e;if(!t){if(await (0,tz.hP)()){let{data:e,error:t}=await tz.I8.mfa.getAuthenticatorAssuranceLevel();if(t)return;if(e){if("/sign-in-mfa"===d.pathname)return;if(e.currentLevel!==e.nextLevel){let e=(0,tz.lJ)("/sign-in-mfa");d.replace(e);return}}await m.resetQueries(),d.push((0,tz.nD)())}else{let e=(0,tz.lJ)("/sign-in");d.replace(e);return}}}).catch(()=>{})},[]);let[p,f]=(0,r.useState)(null);return(0,r.useEffect)(()=>{f(tA.UW[Math.floor(Math.random()*tA.UW.length)])},[]),(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"flex flex-col flex-1 bg-alternative",children:[(0,a.jsx)("div",{className:"absolute top-0 w-full px-8 mx-auto sm:px-6 lg:px-8 ".concat(x?"mt-14":"mt-6"),children:(0,a.jsxs)("nav",{className:"relative flex items-center justify-between sm:h-10",children:[(0,a.jsx)("div",{className:"flex items-center flex-grow flex-shrink-0 lg:flex-grow-0",children:(0,a.jsx)("div",{className:"flex items-center justify-between w-full md:w-auto",children:(0,a.jsx)(j(),{href:l?"https://supabase.com":"/projects",children:(0,a.jsx)(tZ(),{src:(null==h?void 0:h.includes("dark"))?"".concat(u.GW,"/img/supabase-dark.svg"):"".concat(u.GW,"/img/supabase-light.svg"),alt:"Supabase Logo",height:24,width:120})})})}),(0,a.jsx)("div",{className:"items-center hidden space-x-3 md:ml-10 md:flex md:pr-4",children:(0,a.jsx)(Q.z,{asChild:!0,type:"default",icon:(0,a.jsx)(tP.Z,{}),children:(0,a.jsx)(j(),{href:"https://supabase.com/docs",target:"_blank",rel:"noreferrer",children:"Documentation"})})})]})}),(0,a.jsxs)("div",{className:"flex flex-1",children:[(0,a.jsxs)("main",{className:"flex flex-col items-center flex-1 flex-shrink-0 px-5 pt-16 pb-8 border-r shadow-lg bg-studio border-default",children:[(0,a.jsxs)("div",{className:"flex-1 flex flex-col justify-center w-[330px] sm:w-[384px]",children:[(0,a.jsxs)("div",{className:"mb-10",children:[(0,a.jsx)("h1",{className:"mt-8 mb-2 text-2xl lg:text-3xl",children:t}),(0,a.jsx)("h2",{className:"text-sm text-foreground-light",children:n})]}),o]}),s&&(0,a.jsx)("div",{className:"sm:text-center",children:(0,a.jsxs)("p",{className:"text-xs text-foreground-lighter sm:mx-auto sm:max-w-sm",children:["By continuing, you agree to Supabase's"," ",(0,a.jsx)(j(),{href:"https://supabase.com/terms",className:"underline hover:text-foreground-light",children:"Terms of Service"})," ","and"," ",(0,a.jsx)(j(),{href:"https://supabase.com/privacy",className:"underline hover:text-foreground-light",children:"Privacy Policy"}),", and to receive periodic emails with updates."]})})]}),(0,a.jsx)("aside",{className:"flex-col items-center justify-center flex-1 flex-shrink hidden basis-1/4 xl:flex",children:null!==p&&(0,a.jsxs)("div",{className:"relative flex flex-col gap-6",children:[(0,a.jsx)("div",{className:"absolute select-none -top-12 -left-11",children:(0,a.jsx)("span",{className:"text-[160px] leading-none text-foreground-muted/30",children:""})}),(0,a.jsx)("blockquote",{className:"z-10 max-w-lg text-3xl",children:p.text}),(0,a.jsxs)("a",{href:p.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-4",children:[(0,a.jsx)("img",{src:"https://supabase.com".concat(p.img_url),alt:p.handle,className:"w-12 h-12 rounded-full"}),(0,a.jsx)("div",{className:"flex flex-col",children:(0,a.jsxs)("cite",{className:"not-italic font-medium text-foreground-light whitespace-nowrap",children:["@",p.handle]})})]})]})})]})]})})},tI=n(67959),tD=n(82978),tF=n(24990),tO=n(21603),tq=n(26871),tW=n(49336),tU=n(48228),tV=n(71436),tM=n(25528);async function tB(e){let{projectRef:t,id:n,isPublic:a,file_size_limit:s,allowed_mime_types:l}=e;if(!t)throw Error("projectRef is required");if(!n)throw Error("Bucket name is requried");let i=await (0,tV.v_)("".concat(u.T5,"/storage/").concat(t,"/buckets"),{id:n,public:a,file_size_limit:s,allowed_mime_types:l});if(i.error)throw i.error;return i}let tK=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,tR.NL)();return(0,tU.D)(e=>tB(e),{async onSuccess(t,n,s){let{projectRef:l}=n;await a.invalidateQueries(tM.m.buckets(l)),await (null==e?void 0:e(t,n,s))},async onError(e,n,a){void 0===t?eh.Am.error("Failed to create bucket: ".concat(e.message)):t(e,n,a)},...n})};var tY=n(76419),tQ=n(66513),tH=n(15998),tG=n(56599),tX=n(55380),t$=e=>{var t;let{visible:n,onClose:s}=e,{ref:l}=(0,m.UO)(),o=(0,i.useRouter)(),{mutate:c,isLoading:d}=tK({onSuccess:e=>{eh.ZP.success("Successfully created bucket ".concat(e.name)),o.push("/project/".concat(l,"/storage/buckets/").concat(e.name)),s()}}),{data:h}=(0,tW.k)({projectRef:l},{enabled:u.Qy}),{value:x,unit:p}=(0,tq.K)(null!==(t=null==h?void 0:h.fileSizeLimit)&&void 0!==t?t:0),f="".concat(x," ").concat(p),[g,v]=(0,r.useState)(tO.b.BYTES),[b,y]=(0,r.useState)(!1),N=async e=>{if(!l)return console.error("Project ref is required");c({projectRef:l,id:e.name,isPublic:e.public,file_size_limit:e.has_file_size_limit?(0,tq.F)(e.formatted_size_limit,g):null,allowed_mime_types:e.allowed_mime_types.length>0?e.allowed_mime_types.split(",").map(e=>e.trim()):null})};return(0,r.useEffect)(()=>{n&&(v(tO.b.BYTES),y(!1))},[n]),(0,a.jsx)(ep.C,{hideFooter:!0,visible:n,size:"medium",header:"Create storage bucket",onCancel:()=>s(),children:(0,a.jsx)(ef.Z,{validateOnBlur:!1,initialValues:{name:"",public:!1,file_size_limit:0,allowed_mime_types:"",has_file_size_limit:!1,formatted_size_limit:0},validate:e=>{let t={};return e.name||(t.name="Please provide a name for your bucket"),e.name&&e.name.endsWith(" ")&&(t.name="The name of the bucket cannot end with a whitespace"),e.has_file_size_limit&&e.formatted_size_limit<0&&(t.formatted_size_limit="File size upload limit has to be at least 0"),"public"===e.name&&(t.name='"public" is a reserved name. Please choose another name'),t},onSubmit:N,children:e=>{let{values:t}=e;return(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsxs)(ep.C.Content,{children:[(0,a.jsx)(eg.Z,{id:"name",name:"name",type:"text",className:"w-full",layout:"vertical",label:"Name of bucket",labelOptional:"Buckets cannot be renamed once created.",descriptionText:"Only lowercase letters, numbers, dots, and hyphens"}),(0,a.jsxs)("div",{className:"space-y-2 mt-6",children:[(0,a.jsx)(tY.Z,{id:"public",name:"public",layout:"flex",label:"Public bucket",descriptionText:"Anyone can read any object without any authorization"}),t.public&&(0,a.jsxs)(tQ.b,{title:"Public buckets are not protected",variant:"warning",withIcon:!0,children:[(0,a.jsx)("p",{className:"mb-2",children:"Users can read objects in public buckets without any authorization."}),(0,a.jsx)("p",{children:"Row level security (RLS) policies are still required for other operations such as object uploads and deletes."})]})]})]}),(0,a.jsxs)(tH.ZP,{open:b,onOpenChange:()=>y(!b),children:[(0,a.jsx)(tH.ZP.Trigger,{asChild:!0,children:(0,a.jsxs)("div",{className:"w-full cursor-pointer py-3 px-5 flex items-center justify-between border-t border-default",children:[(0,a.jsx)("p",{className:"text-sm",children:"Additional configuration"}),(0,a.jsx)(tG.Z,{size:18,strokeWidth:2,className:(0,ew.cn)("text-foreground-light",b&&"rotate-180")})]})}),(0,a.jsx)(tH.ZP.Content,{className:"py-4",children:(0,a.jsxs)("div",{className:"w-full space-y-4 px-5",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(tY.Z,{id:"has_file_size_limit",name:"has_file_size_limit",layout:"flex",label:"Restrict file upload size for bucket",descriptionText:"Prevent uploading of file sizes greater than a specified limit"}),t.has_file_size_limit&&(0,a.jsxs)("div",{className:"grid grid-cols-12 col-span-12 gap-x-2 gap-y-1",children:[(0,a.jsx)("div",{className:"col-span-8",children:(0,a.jsx)(eg.Z,{type:"number",step:1,id:"formatted_size_limit",name:"formatted_size_limit",disabled:!1,onKeyPress:e=>{(e.charCode<48||e.charCode>57)&&e.preventDefault()},descriptionText:"Equivalent to ".concat((0,tq.F)(t.formatted_size_limit,g).toLocaleString()," bytes.")})}),(0,a.jsx)("div",{className:"col-span-4",children:(0,a.jsx)(tX.Z,{id:"size_limit_units",disabled:!1,value:g,onChange:v,children:Object.values(tO.b).map(e=>(0,a.jsx)(tX.Z.Option,{label:e,value:e,children:(0,a.jsx)("div",{children:e})},e))})}),u.Qy&&(0,a.jsx)("div",{className:"col-span-12",children:(0,a.jsxs)("p",{className:"text-foreground-light text-sm",children:["Note: The"," ",(0,a.jsx)(j(),{href:"/project/".concat(l,"/settings/storage"),className:"text-brand opacity-80 hover:opacity-100 transition",children:"global upload limit"})," ","takes precedence over this value (",f,")"]})})]})]}),(0,a.jsx)(eg.Z,{id:"allowed_mime_types",name:"allowed_mime_types",layout:"vertical",label:"Allowed MIME types",placeholder:"e.g image/jpeg, image/png, audio/mpeg, video/mp4, etc",labelOptional:"Comma separated values",descriptionText:"Wildcards are allowed, e.g. image/*. Leave blank to allow any MIME type."})]})})]}),(0,a.jsx)("div",{className:"w-full border-t border-default !mt-0"}),(0,a.jsx)(ep.C.Content,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-2 justify-end",children:[(0,a.jsx)(Q.z,{type:"default",htmlType:"button",disabled:d,onClick:()=>s(),children:"Cancel"}),(0,a.jsx)(Q.z,{type:"primary",htmlType:"submit",loading:d,disabled:d,children:"Save"})]})})]})}})})};async function tJ(e){let{projectRef:t,id:n,isPublic:a,file_size_limit:s,allowed_mime_types:l}=e;if(!t)throw Error("projectRef is required");if(!n)throw Error("Bucket name is requried");let i=await (0,tV.r$)("".concat(u.T5,"/storage/").concat(t,"/buckets/").concat(n),{public:a,file_size_limit:s,allowed_mime_types:l});if(i.error)throw i.error;return i}let t0=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,tR.NL)();return(0,tU.D)(e=>tJ(e),{async onSuccess(t,n,s){let{projectRef:l}=n;await a.invalidateQueries(tM.m.buckets(l)),await (null==e?void 0:e(t,n,s))},async onError(e,n,a){void 0===t?eh.Am.error("Failed to update bucket: ".concat(e.message)):t(e,n,a)},...n})};var t1=e=>{var t;let{visible:n,bucket:s,onClose:l}=e,{ref:i}=(0,m.UO)(),{mutate:o,isLoading:c}=t0({onSuccess:()=>{eh.ZP.success('Successfully updated bucket "'.concat(null==s?void 0:s.name,'"')),l()}}),{data:d}=(0,tW.k)({projectRef:i},{enabled:u.Qy}),{value:h,unit:x}=(0,tq.K)(null!==(t=null==d?void 0:d.fileSizeLimit)&&void 0!==t?t:0),p="".concat(h," ").concat(x),[f,g]=(0,r.useState)(tO.b.BYTES),[v,b]=(0,r.useState)(!1),y=async e=>void 0===s?console.error("Bucket is required"):void 0===i?console.error("Project ref is required"):void o({projectRef:i,id:s.id,isPublic:e.public,file_size_limit:e.has_file_size_limit?(0,tq.F)(e.formatted_size_limit,f):null,allowed_mime_types:e.allowed_mime_types.length>0?e.allowed_mime_types.split(",").map(e=>e.trim()):null});return(0,r.useEffect)(()=>{if(n){var e;let{unit:t}=(0,tq.K)(null!==(e=null==s?void 0:s.file_size_limit)&&void 0!==e?e:0);g(t),b(!1)}},[n]),(0,a.jsx)(ep.C,{hideFooter:!0,visible:n,size:"medium",header:'Edit bucket "'.concat(null==s?void 0:s.name,'"'),onCancel:l,children:(0,a.jsx)(ef.Z,{validateOnBlur:!1,initialValues:{},validate:e=>{let t={};return e.has_file_size_limit&&e.formatted_size_limit<0&&(t.formatted_size_limit="File size upload limit has to be at least 0"),t},onSubmit:y,children:e=>{let{values:t,resetForm:o}=e;return(0,r.useEffect)(()=>{if(n&&void 0!==s){var e,t,a;let{value:n}=(0,tq.K)(null!==(e=s.file_size_limit)&&void 0!==e?e:0),l={name:null!==(t=s.name)&&void 0!==t?t:"",public:s.public,file_size_limit:s.file_size_limit,allowed_mime_types:(null!==(a=s.allowed_mime_types)&&void 0!==a?a:[]).join(", "),has_file_size_limit:null!==s.file_size_limit,formatted_size_limit:null!=n?n:0};o({values:l,initialValues:l})}},[n]),(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsxs)(ep.C.Content,{children:[(0,a.jsx)(eg.Z,{disabled:!0,id:"name",name:"name",type:"text",className:"w-full",layout:"vertical",label:"Name of bucket",labelOptional:"Buckets cannot be renamed once created."}),(0,a.jsxs)("div",{className:"space-y-2 mt-6",children:[(0,a.jsx)(tY.Z,{id:"public",name:"public",layout:"flex",label:"Public bucket",descriptionText:"Anyone can read any object without any authorization"}),(null==s?void 0:s.public)!==t.public&&(0,a.jsx)(tQ.b,{title:(null==s?void 0:s.public)||!t.public?(null==s?void 0:s.public)&&!t.public?"Warning: Making bucket private":"":"Warning: Making bucket public",variant:"warning",withIcon:!0,children:(0,a.jsx)("p",{className:"mb-2",children:(null==s?void 0:s.public)||!t.public?(null==s?void 0:s.public)&&!t.public?'All objects in "'.concat(null==s?void 0:s.name,'" will be made private and will only be accessible via signed URLs or downloaded with the right authorisation headers'):"":'This will make all objects in the bucket "'.concat(null==s?void 0:s.name,'" public')})})]})]}),(0,a.jsxs)(tH.ZP,{open:v,onOpenChange:()=>b(!v),children:[(0,a.jsx)(tH.ZP.Trigger,{asChild:!0,children:(0,a.jsxs)("div",{className:"w-full cursor-pointer py-3 px-5 flex items-center justify-between border-t border-default",children:[(0,a.jsx)("p",{className:"text-sm",children:"Additional configuration"}),(0,a.jsx)(tG.Z,{size:18,strokeWidth:2,className:(0,ew.cn)("text-foreground-light",v&&"rotate-180")})]})}),(0,a.jsx)(tH.ZP.Content,{className:"py-4",children:(0,a.jsxs)("div",{className:"w-full space-y-4 px-5",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(tY.Z,{id:"has_file_size_limit",name:"has_file_size_limit",layout:"flex",label:"Restrict file upload size for bucket",descriptionText:"Prevent uploading of file sizes greater than a specified limit"}),t.has_file_size_limit&&(0,a.jsxs)("div",{className:"grid grid-cols-12 col-span-12 gap-x-2 gap-y-1",children:[(0,a.jsx)("div",{className:"col-span-8",children:(0,a.jsx)(eg.Z,{type:"number",step:1,id:"formatted_size_limit",name:"formatted_size_limit",disabled:!1,onKeyPress:e=>{(e.charCode<48||e.charCode>57)&&e.preventDefault()},descriptionText:"Equivalent to ".concat((0,tq.F)(t.formatted_size_limit,f).toLocaleString()," bytes.")})}),(0,a.jsx)("div",{className:"col-span-4",children:(0,a.jsx)(tX.Z,{id:"size_limit_units",disabled:!1,value:f,onChange:g,children:Object.values(tO.b).map(e=>(0,a.jsx)(tX.Z.Option,{label:e,value:e,children:(0,a.jsx)("div",{children:e})},e))})}),u.Qy&&(0,a.jsx)("div",{className:"col-span-12",children:(0,a.jsxs)("p",{className:"text-foreground-light text-sm",children:["Note: The"," ",(0,a.jsx)(j(),{href:"/project/".concat(i,"/settings/storage"),className:"text-brand opacity-80 hover:opacity-100 transition",children:"global upload limit"})," ","takes precedence over this value (",p,")"]})})]})]}),(0,a.jsx)(eg.Z,{id:"allowed_mime_types",name:"allowed_mime_types",layout:"vertical",label:"Allowed MIME types",placeholder:"e.g image/jpeg, image/png, audio/mpeg, video/mp4, etc",labelOptional:"Comma separated values",descriptionText:"Wildcards are allowed, e.g. image/*. Leave blank to allow any MIME type."})]})})]}),(0,a.jsx)("div",{className:"w-full border-t border-default !mt-0"}),(0,a.jsx)(ep.C.Content,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-2 justify-end",children:[(0,a.jsx)(Q.z,{type:"default",disabled:c,onClick:()=>l(),children:"Cancel"}),(0,a.jsx)(Q.z,{type:"primary",htmlType:"submit",loading:c,disabled:c,children:"Save"})]})})]})}})})},t2=n(68018),t4=n(49422);async function t3(e){let{projectRef:t,id:n}=e;if(!t)throw Error("projectRef is required");if(!n)throw Error("Bucket name is requried");let{data:a,error:s}=await (0,t4.v_)("/platform/storage/{ref}/buckets/{id}/empty",{params:{path:{id:n,ref:t}}});if(s)throw s;return a}let t5=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,tR.NL)();return(0,tU.D)(e=>t3(e),{async onSuccess(t,n,s){let{projectRef:l}=n;await a.invalidateQueries(tM.m.buckets(l)),await (null==e?void 0:e(t,n,s))},async onError(e,n,a){void 0===t?eh.Am.error("Failed to empty bucket: ".concat(e.message)):t(e,n,a)},...n})},t8=e=>{let{visible:t=!1,bucket:n,onClose:s}=e,{ref:l}=(0,m.UO)(),{fetchFolderContents:i}=(0,tD.H)(),{mutate:r,isLoading:o}=t5({onSuccess:async()=>{void 0!==n&&(await i(n.id,n.name,-1),eh.ZP.success("Successfully deleted bucket ".concat(n.name)),s())}}),c=async()=>l?n?void r({projectRef:l,id:n.id}):console.error("No bucket is selected"):console.error("Project ref is required");return(0,a.jsx)(eS.Z,{variant:"destructive",size:"small",title:"Confirm to delete all contents from ".concat(null==n?void 0:n.name),confirmLabel:"Empty bucket",visible:t,onCancel:()=>s(),onConfirm:c,alert:{title:"This action cannot be undone",description:"The contents of your bucket cannot be recovered once deleted"},children:(0,a.jsxs)("p",{className:"text-sm",children:['Are you sure you want to empty the bucket "',null==n?void 0:n.name,'"?']})})};var t6=n(60479),t9=n(8448),t7=n(82631),ne=n(93684),nt=function(e){return(0,a.jsx)(E.Z,{icon:ne.Z,...e})},nn=n(21784),na=e=>{let{bucket:t,projectRef:n="",isSelected:s=!1,onSelectEmptyBucket:l=e4(),onSelectDeleteBucket:i=e4(),onSelectEditBucket:r=e4()}=e,o=(0,c.Xo)(eZ.KA.STORAGE_ADMIN_WRITE,"*");return(0,a.jsxs)("div",{className:(0,f.default)("group flex items-center justify-between rounded-md",s&&"text-foreground bg-surface-100"),children:[(0,a.jsx)(j(),{href:"/project/".concat(n,"/storage/buckets/").concat(encodeURIComponent(t.id)),className:(0,ew.cn)("py-1 px-3",s?"w-[88%]":"w-full"),children:(0,a.jsxs)("div",{className:"flex items-center justify-between space-x-2 truncate w-full",children:[(0,a.jsx)("p",{className:"text-sm group-hover:text-foreground transition truncate ".concat(s?"text-foreground":"text-foreground-light"),title:t.name,children:t.name}),t.public&&(0,a.jsx)(S.C,{variant:"warning",children:"Public"})]})}),o&&s?(0,a.jsxs)(e_.h_,{children:[(0,a.jsx)(e_.$F,{asChild:!0,children:(0,a.jsx)(Q.z,{type:"text",icon:(0,a.jsx)(tG.Z,{size:"tiny",strokeWidth:2,className:"text-foreground-light"}),className:"mr-1 p-0.5"})}),(0,a.jsxs)(e_.AW,{side:"bottom",align:"start",children:[(0,a.jsxs)(e_.Xi,{className:"space-x-2",onClick:()=>r(),children:[(0,a.jsx)(t7.Z,{size:"tiny"}),(0,a.jsx)("p",{children:"Edit bucket"})]},"toggle-private"),(0,a.jsx)(e_.VD,{}),(0,a.jsxs)(e_.Xi,{className:"space-x-2",onClick:()=>l(),children:[(0,a.jsx)(nt,{size:"tiny"}),(0,a.jsx)("p",{children:"Empty bucket"})]},"delete-bucket"),(0,a.jsxs)(e_.Xi,{className:"space-x-2",onClick:()=>i(),children:[(0,a.jsx)(nn.Z,{size:"tiny"}),(0,a.jsx)("p",{children:"Delete bucket"})]},"delete-bucket")]})]}):(0,a.jsx)("div",{className:"w-5"})]},t.id)},ns=()=>{let e=(0,i.useRouter)(),{ref:t,bucketId:n}=(0,m.UO)(),s=(0,c.Vm)(),l=(null==s?void 0:s.parent_project_ref)!==void 0,[o,d]=(0,r.useState)(!1),[u,h]=(0,r.useState)(),[x,p]=(0,r.useState)(),[f,g]=(0,r.useState)(),v=(0,c.Xo)(eZ.KA.STORAGE_ADMIN_WRITE,"*"),b=e.pathname.split("/")[4],{data:y,error:N,isLoading:w,isError:_,isSuccess:S}=(0,t6.K)({projectRef:t}),k=null!=y?y:[],E=(null==N?void 0:N.message.includes("Tenant config"))&&l;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(C.ZP,{type:"pills",className:"my-6 flex flex-grow flex-col px-5",children:[(0,a.jsx)("div",{className:"mb-6 px-2",children:(0,a.jsxs)(tF.fC,{delayDuration:0,children:[(0,a.jsx)(tF.xz,{className:"w-full",children:(0,a.jsx)(Q.z,{block:!0,type:"default",icon:(0,a.jsx)("div",{className:"text-foreground-lighter",children:(0,a.jsx)(t9.Z,{size:14})}),disabled:!v,style:{justifyContent:"start"},onClick:()=>d(!0),children:"New bucket"})}),!v&&(0,a.jsx)(tF.h_,{children:(0,a.jsxs)(tF.VY,{side:"bottom",children:[(0,a.jsx)(tF.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to create buckets"})})]})})]})}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(C.ZP.Group,{title:"All buckets"}),w&&(0,a.jsxs)("div",{className:"space-y-2 mx-2",children:[(0,a.jsx)(ev.Z,{className:"!py-2.5"}),(0,a.jsx)(ev.Z,{className:"!py-2.5"}),(0,a.jsx)(ev.Z,{className:"!py-2.5"})]}),_&&(0,a.jsx)("div",{className:"px-2",children:(0,a.jsxs)(eC.bZ,{variant:E?"default":"warning",children:[(0,a.jsx)(eC.Cd,{className:"text-xs tracking-normal",children:E?"Storage is not available on preview branches for now":"Failed to fetch buckets"}),(0,a.jsx)(eC.X,{className:"text-xs",children:E?"We're actively looking into making this available on preview branches":"Please refresh to try again"})]})}),S&&(0,a.jsxs)(a.Fragment,{children:[0===k.length&&(0,a.jsx)("div",{className:"px-2",children:(0,a.jsxs)(eC.bZ,{children:[(0,a.jsx)(eC.Cd,{children:"No buckets available"}),(0,a.jsx)(eC.X,{children:"Buckets that you create will appear here"})]})}),k.map((e,s)=>{let l=n===e.id;return(0,a.jsx)(na,{bucket:e,projectRef:t,isSelected:l,onSelectEmptyBucket:()=>p(e),onSelectDeleteBucket:()=>g(e),onSelectEditBucket:()=>h(e)},"".concat(s,"_").concat(e.id))})]})]}),(0,a.jsx)("div",{className:"h-px w-full bg-border"}),(0,a.jsxs)("div",{children:[(0,a.jsx)(C.ZP.Group,{title:"Configuration"}),(0,a.jsx)(j(),{href:"/project/".concat(t,"/storage/policies"),legacyBehavior:!0,children:(0,a.jsx)(C.ZP.Item,{rounded:!0,active:"policies"===b,children:(0,a.jsx)("p",{className:"truncate",children:"Policies"})})})]})]})]}),(0,a.jsx)(t$,{visible:o,onClose:()=>d(!1)}),(0,a.jsx)(t1,{visible:void 0!==u,bucket:u,onClose:()=>h(void 0)}),(0,a.jsx)(t8,{visible:void 0!==x,bucket:x,onClose:()=>p(void 0)}),(0,a.jsx)(t2.Iw,{visible:void 0!==f,bucket:f,onClose:()=>g(void 0)})]})},nl=(0,c.QO)(e=>{let{title:t,children:n}=e,{ref:s}=(0,m.UO)(),l=(0,c.Vm)(),i=(0,tD.H)(),{data:o,isLoading:d}=(0,tI.q)({projectRef:s}),h=null==o?void 0:o.autoApiService,x=(null==l?void 0:l.status)===u.S.INACTIVE;(0,r.useEffect)(()=>{!d&&h&&p(h)},[d,s]);let p=async e=>{x||(e.endpoint?i.initStore(s,e.endpoint,e.serviceApiKey,e.protocol):eh.ZP.error("Failed to fetch project configuration. Try refreshing your browser, or reach out to us at support@supabase.io"),i.setLoaded(!0))};return(0,a.jsx)(ei.Z,{title:t||"Storage",product:"Storage",productMenu:(0,a.jsx)(ns,{}),children:n})}),ni=n(47203),nr=n(14049),no=n(33105),nc=n(72339),nd=n(1003),nu=n(5341),nm=n(38161),nh=n(99962),nx=n(73579),np=n(83314),nf=n(46782),ng=n.n(nf),nj=n(92002),nv=n(90286),nb=n.n(nv),ny=n(25424),nN=n(88719),nw=n(43712),n_=n(44294),nC=n(38282),nS=n(12203),nk=n(42760),nE=e=>{var t,n,s,l,i,r,o,c;let{id:d,projectRef:u,item:h,isLocked:x}=e,{project:p}=(0,np.d2)(),f=(0,nx._2)(),g=Number(d)===h.id,v=async()=>{if(m.Qy&&!(null==p?void 0:p.connectionString))return console.error("Connection string is required");let e=eh.ZP.loading("Exporting ".concat(h.name," as CSV..."));try{var t;let n=await (0,n_.hC)({id:h.id,projectRef:u,connectionString:null==p?void 0:p.connectionString}),a=n&&(0,ny.NK)({table:n,columns:null!==(t=n.columns)&&void 0!==t?t:[],primaryKeys:n.primary_keys,relationships:n.relationships},[]),s=(await (0,nw.wF)({projectRef:u,connectionString:null==p?void 0:p.connectionString,table:a})).map(e=>(Object.keys(e).map(t=>{"object"==typeof e[t]&&null!==e[t]&&(e[t]=JSON.stringify(e[t]))}),e));if(s.length>0){let e=nb().unparse(s,{columns:a.columns.map(e=>e.name)}),t=new Blob([e],{type:"text/csv;charset=utf-8;"});ng()(t,"".concat(h.name,"_rows.csv"))}eh.ZP.success("Successfully exported ".concat(h.name," as CSV"),{id:e})}catch(t){eh.ZP.error("Failed to export table: ".concat(t.message),{id:e})}};return(0,a.jsxs)(j(),{title:h.name,href:"/project/".concat(u,"/editor/").concat(h.id),role:"button","aria-label":"View ".concat(h.name),className:(0,ew.cn)("w-full","flex items-center gap-2","py-1 px-2","text-light","rounded-md",g?"bg-selection":"hover:bg-surface-200 focus:bg-surface-200","group","transition"),children:[(0,a.jsxs)(tF.fC,{delayDuration:0,disableHoverableContent:!0,children:[(0,a.jsx)(tF.xz,{className:"min-w-4",asChild:!0,children:h.type===nN.l.TABLE?(0,a.jsx)(nj.Z,{size:15,strokeWidth:1.5,className:"text-foreground-lighter"}):h.type===nN.l.VIEW?(0,a.jsx)(tv.Z,{size:15,strokeWidth:1.5,className:"text-foreground-lighter"}):(0,a.jsx)("div",{className:(0,ew.cn)("flex items-center justify-center text-xs h-4 w-4 rounded-[2px] font-bold",h.type===nN.l.FOREIGN_TABLE&&"text-yellow-900 bg-yellow-500",h.type===nN.l.MATERIALIZED_VIEW&&"text-purple-1000 bg-purple-500",h.type===nN.l.PARTITIONED_TABLE&&"text-foreground-light bg-border-stronger"),children:null===(s=Object.entries(nN.l).find(e=>{let[,t]=e;return t===h.type}))||void 0===s?void 0:null===(n=s[0])||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.toUpperCase()})}),(0,a.jsx)(tF.h_,{children:(0,a.jsxs)(tF.VY,{side:"bottom",className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background text-xs text-foreground capitalize",children:[(0,a.jsx)(tF.Eh,{className:"radix-tooltip-arrow"}),(l=h.type,null===(c=Object.entries(nN.l).find(e=>{let[,t]=e;return t===l}))||void 0===c?void 0:null===(o=c[0])||void 0===o?void 0:null===(r=o.toLowerCase())||void 0===r?void 0:null===(i=r.split("_"))||void 0===i?void 0:i.join(" "))]})})]}),(0,a.jsxs)("div",{className:(0,ew.cn)("truncate","overflow-hidden text-ellipsis whitespace-nowrap flex items-center gap-2 relative w-full",g&&"text-foreground"),children:[(0,a.jsx)("span",{className:(0,ew.cn)(g?"text-foreground":"text-foreground-light group-hover:text-foreground","text-sm","transition","truncate"),children:h.name}),h.type===nN.l.TABLE&&!h.rls_enabled&&(0,a.jsx)(tb.Z,{size:14,strokeWidth:2,className:(0,ew.cn)("min-w-4",g?"text-warning-600":"text-warning-500")})]}),h.type===nN.l.TABLE&&g&&!x&&(0,a.jsxs)(e_.h_,{children:[(0,a.jsx)(e_.$F,{className:"text-foreground-lighter transition-all hover:text-foreground data-[state=open]:text-foreground",children:(0,a.jsx)(th.Z,{size:14,strokeWidth:2})}),(0,a.jsxs)(e_.AW,{side:"bottom",align:"start",children:[(0,a.jsxs)(e_.Xi,{className:"space-x-2",onClick:e=>{e.stopPropagation(),f.onEditTable()},children:[(0,a.jsx)(t9.Z,{size:"tiny"}),(0,a.jsx)("span",{children:"Edit Table"})]},"edit-table"),(0,a.jsxs)(e_.Xi,{className:"space-x-2",onClick:e=>{e.stopPropagation(),f.onDuplicateTable()},children:[(0,a.jsx)(nC.Z,{size:"tiny"}),(0,a.jsx)("span",{children:"Duplicate Table"})]},"duplicate-table"),(0,a.jsx)(e_.Xi,{className:"space-x-2",asChild:!0,children:(0,a.jsxs)(j(),{href:"/project/".concat(u,"/auth/policies?schema=").concat(f.selectedSchemaName,"&search=").concat(h.id),children:[(0,a.jsx)(nS.Z,{size:"tiny"}),(0,a.jsx)("span",{children:"View Policies"})]},"view-policies")},"view-policies"),(0,a.jsxs)(e_.Xi,{className:"space-x-2",onClick:e=>{e.stopPropagation(),v()},children:[(0,a.jsx)(nk.Z,{size:"tiny"}),(0,a.jsx)("span",{children:"Export as CSV"})]},"download-table-csv"),(0,a.jsx)(e_.VD,{}),(0,a.jsxs)(e_.Xi,{className:"space-x-2",onClick:e=>{e.stopPropagation(),f.onDeleteTable()},children:[(0,a.jsx)(nn.Z,{size:"tiny"}),(0,a.jsx)("span",{children:"Delete Table"})]},"delete-table")]})]})]})},nZ=()=>{var e,t,n;let s=(0,i.useRouter)(),{id:l}=(0,m.UO)(),o=(0,nx._2)(),[d,u]=(0,r.useState)(!1),[h,x]=(0,r.useState)(""),[p,f]=(0,c._)("table-editor-sort","alphabetical"),{project:g}=(0,np.d2)(),{data:j,isLoading:v,isSuccess:b,isError:y,error:N,refetch:w,hasNextPage:_,isFetchingNextPage:C,fetchNextPage:S}=(0,nm.H)({projectRef:null==g?void 0:g.ref,connectionString:null==g?void 0:g.connectionString,schema:o.selectedSchemaName,search:h||void 0,sort:p},{keepPreviousData:!!h}),k=(0,r.useMemo)(()=>null==j?void 0:j.pages.flatMap(e=>e.data.entities),[null==j?void 0:j.pages]),{data:E}=(0,nu.Q)({projectRef:null==g?void 0:g.ref,connectionString:null==g?void 0:g.connectionString}),Z=null==E?void 0:E.find(e=>e.name===o.selectedSchemaName),T=(0,c.Xo)(eZ.KA.TENANT_SQL_ADMIN_WRITE,"tables"),[R]=eR()((null!=E?E:[]).sort((e,t)=>e.name.localeCompare(t.name)),e=>{var t;return nh.F.includes(null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"")}),z=R.some(e=>e.id===(null==Z?void 0:Z.id));return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"pt-5 flex flex-col flex-grow gap-5 h-full",style:{maxHeight:"calc(100vh - 48px)"},children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)(nd.Z,{className:"mx-4 h-7",selectedSchemaName:o.selectedSchemaName,onSelectSchema:e=>{x(""),o.setSelectedSchemaName(e),s.push("/project/".concat(null==g?void 0:g.ref,"/editor"))},onSelectCreateSchema:()=>o.onAddSchema()}),(0,a.jsx)("div",{className:"grid gap-3 mx-4",children:z?(0,a.jsxs)(eC.bZ,{children:[(0,a.jsx)(eC.Cd,{className:"text-sm",children:"Viewing protected schema"}),(0,a.jsxs)(eC.X,{className:"text-xs",children:[(0,a.jsx)("p",{className:"mb-2",children:"This schema is managed by Supabase and is read-only through the table editor"}),(0,a.jsx)(Q.z,{type:"default",size:"tiny",onClick:()=>u(!0),children:"Learn more"})]})]}):(0,a.jsxs)(tF.fC,{delayDuration:0,children:[(0,a.jsx)(tF.xz,{className:"w-full",asChild:!0,children:(0,a.jsx)(Q.z,{title:"Create a new table",name:"New table",block:!0,disabled:!T,size:"tiny",icon:(0,a.jsx)(ec.Z,{size:14,strokeWidth:1.5,className:"text-foreground-muted"}),type:"default",className:"justify-start",onClick:o.onAddTable,children:"New table"})}),!T&&(0,a.jsx)(tF.h_,{children:(0,a.jsxs)(tF.VY,{side:"bottom",children:[(0,a.jsx)(tF.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to create tables"})})]})})]})})]}),(0,a.jsxs)("div",{className:"flex flex-auto flex-col gap-2 pb-4 px-2",children:[(0,a.jsx)(eG,{children:(0,a.jsx)(eX,{name:"search-tables","aria-labelledby":"Search tables",onChange:e=>{x(e.target.value.trim())},value:h,placeholder:"Search tables...",children:(0,a.jsxs)(e$,{value:p,onValueChange:e=>f(e),children:[(0,a.jsx)(eJ,{value:"alphabetical",className:"flex gap-2",children:"Alphabetical"},"alphabetical"),(0,a.jsx)(eJ,{value:"grouped-alphabetical",children:"Entity Type"},"grouped-alphabetical")]})})}),v&&(0,a.jsx)(e0,{}),y&&(0,a.jsx)(no.Z,{error:null!=N?N:null,subject:"Failed to retrieve tables"}),b&&(0,a.jsxs)(a.Fragment,{children:[0===h.length&&(null!==(e=null==k?void 0:k.length)&&void 0!==e?e:0)<=0&&(0,a.jsx)(e1,{className:"mx-2",title:"No entities available",description:"This schema has no entities available yet"}),h.length>0&&(null!==(t=null==k?void 0:k.length)&&void 0!==t?t:0)<=0&&(0,a.jsx)(e1,{className:"mx-2",title:"No results found",description:'Your search for "'.concat(h,'" did not return any results')}),(null!==(n=null==k?void 0:k.length)&&void 0!==n?n:0)>0&&(0,a.jsx)("div",{className:"flex flex-1",children:(0,a.jsx)(nc.Z,{items:k,ItemComponent:nE,itemProps:{projectRef:null==g?void 0:g.ref,id:Number(l),isLocked:z},getItemSize:()=>28,hasNextPage:_,isLoadingNextPage:C,onLoadNextPage:()=>S()})})]})]})]}),(0,a.jsx)(nr.b,{visible:d,onClose:()=>u(!1)})]})},nT=e=>{let{children:t}=e,n=(0,c.Xo)(eZ.KA.TENANT_SQL_ADMIN_READ,"tables"),s=(0,c.N4)(),l=(0,r.useMemo)(()=>(0,a.jsx)(nZ,{}),[]);return s&&!n?(0,a.jsx)(ei.$,{isBlocking:!1,children:(0,a.jsx)(ni.Z,{isFullPage:!0,resourceText:"view tables from this project"})}):(0,a.jsx)(ei.$,{product:"Table Editor",productMenu:l,isBlocking:!1,resizableSidebar:!0,children:t})};n(99217);var nR=n(80489)},31043:function(e,t,n){"use strict";var a=n(52322),s=n(38183),l=n(76626);t.Z=()=>(0,a.jsxs)("div",{className:"flex h-64 flex-col items-center justify-center",children:[(0,a.jsx)(s.Z,{src:"".concat(l.GW,"/img/no-search-results.svg"),preProcessor:e=>e.replace(/svg/,'svg className="mb-2 w-16 h-16 text-color-inherit"')}),(0,a.jsx)("p",{className:"w-64 text-center text-sm opacity-50",children:"Hmm, we couldn't find any results that match your query."})]})},37107:function(e,t,n){"use strict";var a=n(52322),s=n(24990),l=n(27792),i=n(39127);t.Z=e=>{let{title:t="",size:n="medium",children:r,ctaButtonLabel:o="",infoButtonLabel:c="",infoButtonUrl:d="",onClickCta:u=()=>{},loading:m=!1,disabled:h=!1,disabledMessage:x=""}=e,p=o&&u||d&&c;return(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,a.jsx)("div",{className:"flex space-x-4 rounded border bg-surface-100 p-6 shadow-md",children:(0,a.jsx)("div",{className:"flex flex-col",children:(0,a.jsxs)("div",{className:"".concat("medium"===n?"w-80":"w-[400px]"," space-y-4"),children:[(0,a.jsx)("h5",{children:t}),(0,a.jsx)("div",{className:"flex flex-col space-y-2",children:r}),p&&(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[o&&u&&(0,a.jsxs)(s.fC,{delayDuration:0,children:[(0,a.jsx)(s.xz,{asChild:!0,children:(0,a.jsx)(l.z,{type:"primary",onClick:u,loading:m,disabled:m||h,children:o})}),h&&x.length>0&&(0,a.jsx)(s.h_,{children:(0,a.jsxs)(s.VY,{side:"bottom",children:[(0,a.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:x})})]})})]}),d&&c?(0,a.jsx)(l.z,{type:"default",icon:(0,a.jsx)(i.Z,{size:14,strokeWidth:1.5}),children:(0,a.jsx)("a",{target:"_blank",rel:"noreferrer",href:d,children:c})}):null]})]})})})})}},72293:function(e,t,n){"use strict";n.d(t,{De:function(){return s},Eb:function(){return c},Qo:function(){return a},R9:function(){return o},Ye:function(){return l},fh:function(){return r},l6:function(){return d},sd:function(){return i}});let a={WEEK:604800,MONTH:2592e3,YEAR:31536e3},s={COLUMNS:"COLUMNS",LIST:"LIST"},l={NAME:"name",UPDATED_AT:"updated_at",CREATED_AT:"created_at",LAST_ACCESSED_AT:"last_accessed_at"},i={ASC:"asc",DESC:"desc"},r={BUCKET:"BUCKET",FILE:"FILE",FOLDER:"FOLDER"},o={READY:"READY",LOADING:"LOADING",EDITING:"EDITING"},c={upload:["INSERT"],download:["SELECT"],list:["SELECT"],update:["SELECT","UPDATE"],move:["SELECT","UPDATE"],copy:["SELECT","INSERT"],remove:["SELECT","DELETE"],createSignedUrl:["SELECT"],createSignedUrls:["SELECT"],getPublicUrl:[]},d={STORAGE_COLUMN:"STORAGE_COLUMN",STORAGE_ITEM:"STORAGE_ITEM",STORAGE_FOLDER:"STORAGE_FOLDER"}},21603:function(e,t,n){"use strict";var a,s;n.d(t,{H:function(){return l},b:function(){return a}});let l=53687091200;(s=a||(a={})).BYTES="bytes",s.KB="KB",s.MB="MB",s.GB="GB"},26871:function(e,t,n){"use strict";n.d(t,{F:function(){return l},K:function(){return s}});var a=n(21603);let s=(e,t)=>{if(e<=0)return{value:0,unit:a.b.BYTES};let n=void 0!==t?Object.values(a.b).indexOf(t):Math.floor(Math.log(e)/Math.log(1024)),s=void 0!==t?n<0?0:n:n>3?3:n,l=Object.values(a.b)[s];return{value:e/Math.pow(1024,s),unit:l}},l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.b.BYTES,n=Object.values(a.b).indexOf(t);return e<0||n<0?0:e*Math.pow(1024,n)}},68018:function(e,t,n){"use strict";n.d(t,{Iw:function(){return nl},cm:function(){return e7},S:function(){return tX},cx:function(){return t7}});var a=n(52322),s=n(24459),l=n(60417),i=n.n(l),r=n(72579),o=n.n(r),c=n(45455),d=n.n(c),u=n(84636),m=n.n(u),h=n(46776),x=n(2784),p=n(62202),f=n(25622),g=n(72309),j=n(76626),v=n(5388),b=n(82978),y=n(72293),N=n(34291),w=n.n(N),_=n(89796),C=n(27792),S=n(66513),k=e=>{let{visible:t=!1,selectedItemsToDelete:n=[],onSelectCancel:s=w(),onSelectDelete:l=w()}=e,[i,r]=(0,x.useState)(!1);(0,x.useEffect)(()=>{r(!1)},[t]);let o=n.length>1,c=o?"Confirm deletion of ".concat(n.length," items"):1===n.length?"Confirm deletion of ".concat(n[0].name):"",d=o?"Are you sure you want to delete the selected ".concat(n.length," items?"):1===n.length?"Are you sure you want to delete the selected ".concat(n[0].type.toLowerCase(),"?"):"";return(0,a.jsx)(_.C,{visible:t,header:(0,a.jsx)("span",{className:"break-words",children:c}),size:"medium",onCancel:s,customFooter:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(C.z,{type:"default",disabled:i,onClick:s,children:"Cancel"}),(0,a.jsx)(C.z,{type:"danger",disabled:i,loading:i,onClick:()=>{r(!0),l()},children:i?"Deleting":"Delete"})]}),children:(0,a.jsx)(_.C.Content,{children:(0,a.jsx)("div",{className:"my-4",children:(0,a.jsx)(S.b,{withIcon:!0,variant:"danger",title:"This action cannot be undone.",children:d})})})})},E=n(28879),Z=n.n(E),T=n(53187),R=n(31840),z=n(55380);let A={days:86400,weeks:604800,months:2592e3,years:31536e3};var P=(0,h.Pi)(e=>{let{onCopyUrl:t}=e,{getFileUrl:n,selectedFileCustomExpiry:s,setSelectedFileCustomExpiry:l}=(0,b.H)(),i=()=>l(void 0);return(0,a.jsx)(_.C,{hideFooter:!0,size:"small",header:"Custom expiry for signed URL",visible:void 0!==s,alignFooter:"right",confirmText:"Get URL",onCancel:()=>i(),children:(0,a.jsx)(T.Z,{validateOnBlur:!0,initialValues:{expiresIn:"",units:"days"},onSubmit:async(e,a)=>{let{setSubmitting:l}=a;l(!0),t(s.name,await n(s,e.expiresIn*A[e.units])),l(!1),i()},validate:e=>{let t={};return""!==e.expiresIn&&e.expiresIn<=0&&(t.expiresIn="Expiry duration cannot be less than 0"),t},children:e=>{let{values:t,isSubmitting:n}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"pt-4 pb-2",children:(0,a.jsxs)(_.C.Content,{children:[(0,a.jsx)("p",{className:"text-sm text-foreground-light mb-2",children:"Enter the duration for which the URL will be valid for:"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(R.Z,{disabled:n,type:"number",id:"expiresIn",className:"w-full"}),(0,a.jsxs)(z.Z,{id:"units",className:"w-[150px]",children:[(0,a.jsx)(z.Z.Option,{id:"days",label:"days",value:"days",children:"days"}),(0,a.jsx)(z.Z.Option,{id:"weeks",label:"weeks",value:"weeks",children:"weeks"}),(0,a.jsx)(z.Z.Option,{id:"months",label:"months",value:"months",children:"months"}),(0,a.jsx)(z.Z.Option,{id:"years",label:"years",value:"years",children:"years"})]})]}),""!==t.expiresIn&&(0,a.jsxs)("p",{className:"text-sm text-foreground-light mt-2",children:["URL will expire on"," ",Z()().add(t.expiresIn,t.units).format(j.Cu)]})]})}),(0,a.jsx)(_.C.Separator,{}),(0,a.jsx)(_.C.Content,{children:(0,a.jsxs)("div",{className:"flex items-center justify-end space-x-2 pt-1 pb-3",children:[(0,a.jsx)(C.z,{type:"default",onClick:()=>i(),children:"Cancel"}),(0,a.jsx)(C.z,{disabled:""===t.expiresIn||n,loading:n,htmlType:"submit",type:"primary",children:"Get signed URL"})]})})]})}})})}),L=n(59491),I=n(71623);n(48603);var D=n(13096),F=n(29123),O=n(31231),q=n(8448),W=n(97607),U=n(83036),V=function(e){return(0,a.jsx)(U.Z,{icon:W.Z,...e})},M=n(42760),B=n(70696),K=function(e){return(0,a.jsx)(U.Z,{icon:B.Z,...e})},Y=(0,h.Pi)(e=>{let{id:t="",onCopyUrl:n=w()}=e,{getFileUrl:s,downloadFile:l,selectedBucket:i,setSelectedItemsToDelete:r,setSelectedItemToRename:o,setSelectedItemsToMove:c,setSelectedFileCustomExpiry:d}=(0,b.H)(),u=i.public,m=(0,D.Xo)(L.KA.STORAGE_ADMIN_WRITE,"*"),h=async(e,t,a)=>{if(!t.isCorrupted)switch(e){case"copy":if(void 0!==a&&a<0)return d(t);return n(t.name,await s(t,a));case"rename":return o(t);case"move":return c([t]);case"download":return await l(t)}};return(0,a.jsxs)(I.v2,{id:t,animation:"fade",children:[u?(0,a.jsxs)(I.ck,{onClick:e=>{let{props:t}=e;return h("copy",t.item)},children:[(0,a.jsx)(F.Z,{size:"tiny"}),(0,a.jsx)("span",{className:"ml-2 text-xs",children:"Get URL"})]}):(0,a.jsxs)(I.rS,{label:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(F.Z,{size:"tiny"}),(0,a.jsx)("span",{className:"text-xs",children:"Get URL"})]}),arrow:(0,a.jsx)(O.Z,{size:"tiny"}),children:[(0,a.jsx)(I.ck,{onClick:e=>{let{props:t}=e;return h("copy",t.item,y.Qo.WEEK)},children:(0,a.jsx)("span",{className:"ml-2 text-xs",children:"Expire in 1 week"})}),(0,a.jsx)(I.ck,{onClick:e=>{let{props:t}=e;return h("copy",t.item,y.Qo.MONTH)},children:(0,a.jsx)("span",{className:"ml-2 text-xs",children:"Expire in 1 month"})}),(0,a.jsx)(I.ck,{onClick:e=>{let{props:t}=e;return h("copy",t.item,y.Qo.YEAR)},children:(0,a.jsx)("span",{className:"ml-2 text-xs",children:"Expire in 1 year"})}),(0,a.jsx)(I.ck,{onClick:e=>{let{props:t}=e;return h("copy",t.item,-1)},children:(0,a.jsx)("span",{className:"ml-2 text-xs",children:"Custom expiry"})})]}),m&&[(0,a.jsxs)(I.ck,{onClick:e=>{let{props:t}=e;return h("rename",t.item)},children:[(0,a.jsx)(q.Z,{size:"tiny"}),(0,a.jsx)("span",{className:"ml-2 text-xs",children:"Rename"})]},"rename-file"),(0,a.jsxs)(I.ck,{onClick:e=>{let{props:t}=e;return h("move",t.item)},children:[(0,a.jsx)(V,{size:"tiny"}),(0,a.jsx)("span",{className:"ml-2 text-xs",children:"Move"})]},"move-file"),(0,a.jsxs)(I.ck,{onClick:e=>{let{props:t}=e;return h("download",t.item)},children:[(0,a.jsx)(M.Z,{size:"tiny"}),(0,a.jsx)("span",{className:"ml-2 text-xs",children:"Download"})]},"download-file"),(0,a.jsx)(I.Z0,{},"file-separator"),(0,a.jsxs)(I.ck,{onClick:e=>{let{props:t}=e;return r([t.item])},children:[(0,a.jsx)(K,{size:"tiny",stroke:"red"}),(0,a.jsx)("span",{className:"ml-2 text-xs",children:"Delete"})]},"delete-file")]]})});let Q=(e,t)=>{let n=e.slice(0,t.columnIndex).map(e=>e.name),a=n.length>0?"".concat(n.join("/"),"/").concat(t.name):t.name;(0,v.vQ)(a),p.ZP.success('Copied path to folder "'.concat(t.name,'"'))};var H=e=>{let{id:t=""}=e,{openedFolders:n,downloadFolder:s,setSelectedItemToRename:l,setSelectedItemsToDelete:i}=(0,b.H)(),r=(0,D.Xo)(L.KA.STORAGE_ADMIN_WRITE,"*");return(0,a.jsxs)(I.v2,{id:t,animation:"fade",children:[r&&(0,a.jsxs)(I.ck,{onClick:e=>{let{props:t}=e;return l(t.item)},children:[(0,a.jsx)(q.Z,{size:"tiny"}),(0,a.jsx)("span",{className:"ml-2 text-xs",children:"Rename"})]}),(0,a.jsxs)(I.ck,{onClick:e=>{let{props:t}=e;return s(t.item)},children:[(0,a.jsx)(M.Z,{size:"tiny"}),(0,a.jsx)("span",{className:"ml-2 text-xs",children:"Download"})]}),(0,a.jsxs)(I.ck,{onClick:e=>{let{props:t}=e;return Q(n,t.item)},children:[(0,a.jsx)(F.Z,{size:"tiny"}),(0,a.jsx)("span",{className:"ml-2 text-xs",children:"Copy path to folder"})]}),r&&[(0,a.jsx)(I.Z0,{},"separator"),(0,a.jsxs)(I.ck,{onClick:e=>{let{props:t}=e;return i([t.item])},children:[(0,a.jsx)(K,{size:"tiny",stroke:"red"}),(0,a.jsx)("span",{className:"ml-2 text-xs",children:"Delete"})]},"delete")]]})},G=n(78027),X=function(e){return(0,a.jsx)(U.Z,{icon:G.Z,...e})},$=n(36238),J=n(50416),ee=n(93471),et=function(e){return(0,a.jsx)(U.Z,{icon:ee.Z,...e})},en=e=>{let{id:t=""}=e,{columns:n,selectedItems:s,setSelectedItems:l,setView:r,setSortBy:o,setSortByOrder:c,addNewFolderPlaceholder:d}=(0,b.H)(),u=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;d(e)},h=e=>{let t=n[e].items.filter(e=>e.type===y.fh.FILE).map(t=>({...t,columnIndex:e})),a=i()(t.map(e=>e.id));s.filter(e=>a.includes(e.id)).length===t.length?l(s.filter(e=>!a.includes(e.id))):l(m()(s.concat(t),"id"))};return(0,a.jsxs)(I.v2,{id:t,animation:"fade",children:[(0,a.jsxs)(I.ck,{onClick:e=>{let{props:t}=e;return u(t.index)},children:[(0,a.jsx)(X,{size:"tiny"}),(0,a.jsx)("span",{className:"ml-2 text-xs",children:"New folder"})]}),(0,a.jsx)(I.Z0,{}),(0,a.jsxs)(I.ck,{onClick:e=>{let{props:t}=e;return h(t.index)},children:[(0,a.jsx)(F.Z,{size:"tiny"}),(0,a.jsx)("span",{className:"ml-2 text-xs",children:"Select all items"})]}),(0,a.jsxs)(I.rS,{label:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)($.Z,{size:"tiny"}),(0,a.jsx)("span",{className:"text-xs",children:"View"})]}),arrow:(0,a.jsx)(O.Z,{size:"tiny"}),children:[(0,a.jsx)(I.ck,{onClick:()=>r(y.De.COLUMNS),children:(0,a.jsx)("span",{className:"ml-2 text-xs",children:"As columns"})}),(0,a.jsx)(I.ck,{onClick:()=>r(y.De.LIST),children:(0,a.jsx)("span",{className:"ml-2 text-xs",children:"As list"})})]}),(0,a.jsxs)(I.rS,{label:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(J.Z,{size:"tiny"}),(0,a.jsx)("span",{className:"ml-2 text-xs",children:"Sort by"})]}),arrow:(0,a.jsx)(O.Z,{size:"tiny"}),children:[(0,a.jsx)(I.ck,{onClick:()=>o(y.Ye.NAME),children:(0,a.jsx)("span",{className:"ml-2 text-xs",children:"Name"})}),(0,a.jsx)(I.ck,{onClick:()=>o(y.Ye.CREATED_AT),children:(0,a.jsx)("span",{className:"ml-2 text-xs",children:"Last created"})}),(0,a.jsx)(I.ck,{onClick:()=>o(y.Ye.UPDATED_AT),children:(0,a.jsx)("span",{className:"ml-2 text-xs",children:"Last modified"})}),(0,a.jsx)(I.ck,{onClick:()=>o(y.Ye.LAST_ACCESSED_AT),children:(0,a.jsx)("span",{className:"ml-2 text-xs",children:"Last accessed"})})]}),(0,a.jsxs)(I.rS,{label:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(et,{size:"tiny"}),(0,a.jsx)("span",{className:"ml-2 text-xs",children:"Sort by order"})]}),arrow:(0,a.jsx)(O.Z,{size:"tiny"}),children:[(0,a.jsx)(I.ck,{onClick:()=>c(y.sd.ASC),children:(0,a.jsx)("span",{className:"ml-2 text-xs",children:"Ascending"})}),(0,a.jsx)(I.ck,{onClick:()=>c(y.sd.DESC),children:(0,a.jsx)("span",{className:"ml-2 text-xs",children:"Descending"})})]})]})},ea=n(86263),es=n(94030),el=n.n(es),ei=n(39161),er=n(72978),eo=n(72339),ec=n(54175),ed=n(9162),eu=n(4741);let em=(0,ed.sj)({isSearching:!1,setIsSearching:e=>{em.isSearching=e}}),eh=e=>(0,eu.R)(em,e);var ex=n(24990),ep=n(55281),ef=n.n(ep),eg=n(18149),ej=n.n(eg),ev=n(38183),eb=n(79378),ey=n(16222),eN=n(79983),ew=function(e){return(0,a.jsx)(U.Z,{icon:eN.Z,...e})},e_=n(88599),eC=function(e){return(0,a.jsx)(U.Z,{icon:e_.Z,...e})},eS=n(57393),ek=function(e){return(0,a.jsx)(U.Z,{icon:eS.Z,...e})},eE=n(98938),eZ=n(40386),eT=n(38055),eR=n(93352),ez=n.n(eR),eA=e=>{var t;let{item:n,view:s,columnIndex:l}=e,{renameFile:i,renameFolder:r,addNewFolder:o}=(0,b.H)(),c=(0,x.useRef)(null),[d,u]=(0,x.useState)(n.name),m=async(e,t)=>{t&&(t.preventDefault(),t.stopPropagation()),n.type===y.fh.FILE?await i(n,e,l):ez()(n,"id")?r({...n,columnIndex:l},e,l):o(e,l)};return(0,x.useEffect)(()=>{if(c.current){let e=n.name.lastIndexOf("."),t=-1!==e?e:n.name.length;c.current.setSelectionRange(0,t),c.current.focus()}let e=e=>{"Escape"===e.key&&((null==n?void 0:n.id)!==void 0?m(n.name):o("",l))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]),(0,a.jsx)("div",{className:"storage-row flex items-center justify-between rounded bg-gray-500",children:(0,a.jsxs)("div",{className:"flex h-full flex-grow items-center px-2.5",children:[(0,a.jsx)("div",{children:(0,a.jsx)(eP,{view:s,status:n.status,fileType:n.type,mimeType:null===(t=n.metadata)||void 0===t?void 0:t.mimetype})}),(0,a.jsxs)("form",{className:"h-9",onSubmit:e=>m(d,e),children:[(0,a.jsx)("input",{autoFocus:!0,ref:c,className:"storage-row-input ml-3 h-full bg-inherit p-0 px-1 text-sm",type:"text",value:d,onChange:e=>u(e.target.value),onBlur:e=>m(d,e)}),(0,a.jsx)("button",{className:"hidden",type:"submit",onClick:e=>m(d,e)})]})]})})};let eP=e=>{let{view:t,status:n,fileType:s,mimeType:l}=e;if(t===y.De.LIST&&n===y.R9.LOADING)return(0,a.jsx)(eb.Z,{size:16,strokeWidth:2,className:"animate-spin"});if(s===y.fh.BUCKET||s===y.fh.FOLDER){let e=s===y.fh.BUCKET?"".concat(j.GW,"/img/bucket-filled.svg"):s===y.fh.FOLDER?"".concat(j.GW,"/img/folder-filled.svg"):"".concat(j.GW,"/img/file-filled.svg");return(0,a.jsx)(ev.Z,{src:e,preProcessor:e=>e.replace(/svg/,'svg class="w-4 h-4 text-color-inherit opacity-75"')})}return(null==l?void 0:l.includes("image"))?(0,a.jsx)(ey.Z,{size:16,strokeWidth:2}):(null==l?void 0:l.includes("audio"))?(0,a.jsx)(ew,{size:16,strokeWidth:2}):(null==l?void 0:l.includes("video"))?(0,a.jsx)(eC,{size:16,strokeWidth:2}):(0,a.jsx)(ek,{size:16,strokeWidth:2})};var eL=e=>{var t;let{index:n,item:s={},view:l=y.De.COLUMNS,columnIndex:i=0,selectedItems:r=[],openedFolders:o=[],selectedFilePreview:c={},onCopyUrl:u}=e,{getFileUrl:m,popColumnAtIndex:h,pushOpenedFolderAtIndex:x,popOpenedFoldersAtIndex:p,setFilePreview:f,closeFilePreview:g,clearSelectedItems:j,selectedBucket:N,setSelectedItems:w,setSelectedItemsToDelete:_,setSelectedItemToRename:C,setSelectedItemsToMove:S,setSelectedFileCustomExpiry:k,fetchFolderContents:E,downloadFile:Z,downloadFolder:T,selectRangeItems:R}=(0,b.H)(),z=N.public,A={...s,columnIndex:i},P=void 0!==ef()(r,s),O=o.length>i&&ej()(o[i],s),W=!d()(c)&&ej()(c.id,s.id),U=(0,D.Xo)(L.KA.STORAGE_ADMIN_WRITE,"*"),{show:B}=(0,I.av)(),Y=async(e,t)=>{h(e),p(e-1),f(t),j()},H=async(e,t)=>{g(),j(e+1),p(e-1),x(t,e),await E(t.id,t.name,e)},G=e=>{if(e&&0!==r.length){R(i,n);return}void 0!==ef()(r,e=>A.id===e.id)?w(r.filter(e=>A.id!==e.id)):w([...r,A]),g()},X=s.type===y.fh.FOLDER?[...U?[{name:"Rename",icon:(0,a.jsx)(q.Z,{size:"tiny"}),onClick:()=>C(A)}]:[],{name:"Download",icon:(0,a.jsx)(M.Z,{size:"tiny"}),onClick:()=>T(A)},{name:"Copy path to folder",icon:(0,a.jsx)(F.Z,{size:"tiny"}),onClick:()=>Q(o,A)},...U?[{name:"Separator",icon:void 0,onClick:void 0},{name:"Delete",icon:(0,a.jsx)(K,{size:"tiny"}),onClick:()=>_([A])}]:[]]:[...s.isCorrupted?[]:[...z?[{name:"Get URL",icon:(0,a.jsx)(F.Z,{size:"tiny"}),onClick:async()=>u(A.name,await m(A))}]:[{name:"Get URL",icon:(0,a.jsx)(F.Z,{size:"tiny"}),children:[{name:"Expire in 1 week",onClick:async()=>u(A.name,await m(A,y.Qo.WEEK))},{name:"Expire in 1 month",onClick:async()=>u(A.name,await m(A,y.Qo.MONTH))},{name:"Expire in 1 year",onClick:async()=>u(A.name,await m(A,y.Qo.YEAR))},{name:"Custom expiry",onClick:async()=>k(A)}]}],...U?[{name:"Rename",icon:(0,a.jsx)(q.Z,{size:"tiny"}),onClick:()=>C(A)},{name:"Move",icon:(0,a.jsx)(V,{size:"tiny"}),onClick:()=>S([A])},{name:"Download",icon:(0,a.jsx)(M.Z,{size:"tiny"}),onClick:async()=>await Z(A)},{name:"Separator",icon:void 0,onClick:void 0}]:[]],...U?[{name:"Delete",icon:(0,a.jsx)(K,{size:"tiny"}),onClick:()=>_([A])}]:[]],$=s.metadata?(0,v.td)(s.metadata.size):"-",J=s.metadata?s.metadata.mimetype:"-",ee=s.created_at?new Date(s.created_at).toLocaleString():"-",et=s.updated_at?new Date(s.updated_at).toLocaleString():"-",en=(e,t)=>{B(e,{id:t===y.fh.FILE?y.l6.STORAGE_ITEM:y.l6.STORAGE_FOLDER,props:{item:A}})},ea=l===y.De.LIST&&s.isCorrupted?"calc(100% - 60px)":l!==y.De.LIST||s.isCorrupted?"100%":"calc(100% - 50px)";return s.status===y.R9.EDITING?(0,a.jsx)(eA,{view:l,item:s,columnIndex:i}):(0,a.jsx)("div",{className:"h-full border-b border-default",onContextMenu:e=>{e.stopPropagation(),s.type===y.fh.FILE?en(e,y.fh.FILE):en(e,y.fh.FOLDER)},children:(0,a.jsxs)("div",{className:["storage-row group flex h-full items-center px-2.5","hover:bg-panel-footer-light [[data-theme*=dark]_&]:hover:bg-panel-footer-dark","".concat(O?"bg-surface-200":""),"".concat(W?"bg-green-500 hover:bg-green-500":""),"".concat(s.status!==y.R9.LOADING?"cursor-pointer":"")].join(" "),onClick:e=>{e.stopPropagation(),e.preventDefault(),s.status===y.R9.LOADING||O||W||(s.type===y.fh.FOLDER||s.type===y.fh.BUCKET?H(i,s):Y(i,s))},children:[(0,a.jsxs)("div",{className:["flex items-center",l===y.De.LIST?"w-[40%] min-w-[250px]":"w-[90%]"].join(" "),children:[(0,a.jsxs)("div",{className:"relative w-[30px]",onClick:e=>e.stopPropagation(),children:[!P&&(0,a.jsx)("div",{className:"absolute ".concat(s.type===y.fh.FILE?"group-hover:hidden":""),style:{top:"2px"},children:(0,a.jsx)(eP,{view:l,status:s.status,fileType:s.type,mimeType:null===(t=s.metadata)||void 0===t?void 0:t.mimetype})}),(0,a.jsx)(er.Z,{label:"",className:"w-full ".concat(s.type!==y.fh.FILE?"invisible":""," ").concat(P?"opacity-100":"opacity-0 group-hover:opacity-100"),checked:P,onChange:e=>{e.stopPropagation(),G(e.nativeEvent.shiftKey)}})]}),(0,a.jsx)("p",{title:s.name,className:"truncate text-sm",style:{width:ea},children:s.name}),s.isCorrupted&&(0,a.jsxs)(ex.fC,{delayDuration:0,children:[(0,a.jsx)(ex.xz,{children:(0,a.jsx)(eE.Z,{size:18,strokeWidth:2,className:"text-foreground-light"})}),(0,a.jsx)(ex.h_,{children:(0,a.jsxs)(ex.VY,{side:"bottom",children:[(0,a.jsx)(ex.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:"File is corrupted, please delete and reupload again."})})]})})]})]}),l===y.De.LIST&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"w-[11%] min-w-[100px] truncate text-sm",children:$}),(0,a.jsx)("p",{className:"w-[14%] min-w-[100px] truncate text-sm",children:J}),(0,a.jsx)("p",{className:"w-[15%] min-w-[160px] truncate text-sm",children:ee}),(0,a.jsx)("p",{className:"w-[15%] min-w-[160px] truncate text-sm",children:et})]}),(0,a.jsx)("div",{className:"flex items-center justify-end ".concat(l===y.De.LIST?"flex-grow":"w-[10%]"),onClick:e=>e.stopPropagation(),children:s.status===y.R9.LOADING?(0,a.jsx)(eb.Z,{className:"animate-spin ".concat(l===y.De.LIST?"invisible":""),size:16,strokeWidth:2}):(0,a.jsxs)(eZ.h_,{modal:!1,children:[(0,a.jsx)(eZ.$F,{children:(0,a.jsx)("div",{className:"storage-row-menu opacity-0",children:(0,a.jsx)(eT.Z,{size:16,strokeWidth:2})})}),(0,a.jsx)(eZ.AW,{side:"bottom",align:"end",children:X.map(e=>{var t,n,s;return(null!==(t=null==e?void 0:e.children)&&void 0!==t?t:[]).length>0?(0,a.jsxs)(eZ.Ph,{children:[(0,a.jsxs)(eZ.kt,{className:"space-x-2",children:[e.icon||(0,a.jsx)(a.Fragment,{}),(0,a.jsx)("p",{children:e.name})]}),(0,a.jsx)(eZ.cq,{children:(0,a.jsx)(eZ.TG,{children:null===(n=null!==(s=null==e?void 0:e.children)&&void 0!==s?s:[])||void 0===n?void 0:n.map(e=>(0,a.jsx)(eZ.Xi,{onClick:e.onClick,children:(0,a.jsx)("p",{children:e.name})},e.name))})})]},e.name):"Separator"===e.name?(0,a.jsx)(eZ.VD,{},e.name):(0,a.jsxs)(eZ.Xi,{className:"space-x-2",onClick:e.onClick,children:[e.icon||(0,a.jsx)(a.Fragment,{}),(0,a.jsx)("p",{children:e.name})]},e.name)})})]})})]})})};let eI=e=>{let{isOpen:t,onDragLeave:n,onDrop:s,folderIsEmpty:l}=e;return(0,a.jsx)(ea.u,{show:t,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0",enterTo:"transform opacity-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100",leaveTo:"transform opacity-0",className:"h-full w-full absolute top-0",children:(0,a.jsx)("div",{onDragLeave:n,onDrop:s,className:"absolute top-0 flex h-full w-full items-center justify-center",style:{backgroundColor:l?"rgba(0,0,0,0.1)":"rgba(0,0,0,0.2)"},children:!l&&(0,a.jsxs)("div",{className:"w-3/4 h-32 border-2 border-dashed border-muted rounded-md flex flex-col items-center justify-center p-6 pointer-events-none",style:{backgroundColor:"rgba(0,0,0,0.4)"},children:[(0,a.jsx)(ei.Z,{className:"text-white pointer-events-none",size:20,strokeWidth:2}),(0,a.jsx)("p",{className:"text-center text-sm  text-white mt-2 pointer-events-none",children:"Drop your files to upload to this folder"})]})})})};var eD=e=>{let{index:t=0,view:n=y.De.COLUMNS,column:s,fullWidth:l=!1,openedFolders:i=[],selectedItems:r=[],selectedFilePreview:c={},itemSearchString:d,onFilesUpload:u=w(),onSelectAllItemsInColumn:m=w(),onSelectColumnEmptySpace:h=w(),onColumnLoadMore:p=w(),onCopyUrl:f=w()}=e,[g,b]=(0,x.useState)(!1),N=(0,x.useRef)(null),_=eh();(0,x.useEffect)(()=>{if(N){let{scrollHeight:e,clientHeight:t}=N.current;e>t&&(N.current.scrollTop+=e-t)}},[s]);let C=r.length>0,S=s.items.map(e=>e.id),k=s.items.filter(e=>e.type===y.fh.FILE),E=r.filter(e=>S.includes(e.id)).filter(e=>e.type===y.fh.FILE),Z=s.items,T=el()(Z.map(e=>o()(e,["metadata","size"],0))),R=0===s.items.filter(e=>e.status!==y.R9.LOADING).length,{show:z}=(0,I.av)(),A=e=>{e&&(e.stopPropagation(),e.preventDefault(),"dragover"!==e.type||g||b(!0))},P=()=>(0,a.jsx)(er.Z,{label:"",className:"-mt-0.5",checked:0!==k.length&&E.length===k.length,disabled:0===k.length,onChange:()=>m(t)});return(0,a.jsxs)("div",{ref:N,className:"\n        ".concat(l?"w-full":"w-64 border-r border-overlay","\n        ").concat((y.De.COLUMNS,""),"\n        hide-scrollbar relative flex flex-shrink-0 flex-col overflow-auto\n      "),onContextMenu:e=>{z(e,{id:y.l6.STORAGE_COLUMN,props:{index:t}})},onDragOver:A,onDrop:e=>{A(e),u(e,t)},onClick:e=>{let n=o()(e.target,["className"],"");"string"==typeof n&&n.includes("react-contexify")||h(t)},children:[n===y.De.COLUMNS&&(0,a.jsx)("div",{className:"sticky top-0 z-10 mb-0 flex items-center bg-table-header-light px-2.5 [[data-theme*=dark]_&]:bg-table-header-dark ".concat(C?"h-10 py-3 opacity-100":"h-0 py-0 opacity-0"," transition-all duration-200"),onClick:e=>e.stopPropagation(),children:k.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(P,{}),(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:["Select all ",k.length," files"]})]}):(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"No files available for selection"})}),n===y.De.LIST&&(0,a.jsxs)("div",{className:" sticky top-0 z-10 flex min-w-min items-center border-b border-overlay bg-surface-100 px-2.5 py-2 ",children:[(0,a.jsxs)("div",{className:"flex w-[40%] min-w-[250px] items-center",children:[(0,a.jsx)(P,{}),(0,a.jsx)("p",{className:"text-sm",children:"Name"})]}),(0,a.jsx)("p",{className:"w-[11%] min-w-[100px] text-sm",children:"Size"}),(0,a.jsx)("p",{className:"w-[14%] min-w-[100px] text-sm",children:"Type"}),(0,a.jsx)("p",{className:"w-[15%] min-w-[160px] text-sm",children:"Created at"}),(0,a.jsx)("p",{className:"w-[15%] min-w-[160px] text-sm",children:"Last modified at"})]}),s.status===y.R9.LOADING&&(0,a.jsxs)("div",{className:"\n            ".concat(l?"w-full":"w-64 border-r border-default","\n            px-2 py-1 my-1 flex flex-shrink-0 flex-col space-y-2 overflow-auto\n          "),children:[(0,a.jsx)(ec.Z,{}),(0,a.jsx)(ec.Z,{}),(0,a.jsx)(ec.Z,{})]}),(0,a.jsx)(eo.Z,{items:Z,itemProps:{view:n,columnIndex:t,selectedItems:r,openedFolders:i,selectedFilePreview:c,onCopyUrl:f},ItemComponent:eL,getItemSize:e=>0!==e&&e===Z.length?85:37,hasNextPage:s.status!==y.R9.LOADING&&s.hasMoreItems,isLoadingNextPage:s.isLoadingMoreItems,onLoadNextPage:()=>p(t,s)}),!(_.isSearching&&d.length>0)&&0===s.items.length&&s.status!==y.R9.LOADING&&(0,a.jsxs)("div",{className:"h-full w-full flex flex-col items-center justify-center",children:[(0,a.jsx)("img",{alt:"storage-placeholder",src:"".concat(j.GW,"/img/storage-placeholder.svg"),className:"opacity-75 pointer-events-none"}),(0,a.jsx)("p",{className:"text-sm my-3 opacity-75",children:"Drop your files here"}),(0,a.jsx)("p",{className:"w-40 text-center text-xs text-foreground-light",children:'Or upload them via the "Upload file" button above'})]}),_.isSearching&&d.length>0&&R&&s.status!==y.R9.LOADING&&(0,a.jsxs)("div",{className:"h-full w-full flex flex-col items-center justify-center",children:[(0,a.jsx)("p",{className:"text-sm my-3 text-foreground",children:"No results found in this folder"}),(0,a.jsxs)("p",{className:"w-40 text-center text-sm text-foreground-light",children:['Your search for "',d,'" did not return any results']})]}),(0,a.jsx)(eI,{isOpen:g,folderIsEmpty:R,onDragLeave:()=>b(!1),onDrop:()=>b(!1)}),n===y.De.LIST&&(0,a.jsx)("div",{className:" sticky bottom-0 z-10 flex min-w-min items-center bg-panel-footer-light px-2.5 py-2 [[data-theme*=dark]_&]:bg-panel-footer-dark ",children:(0,a.jsxs)("p",{className:"text-sm",children:[(0,v.td)(T)," for ",Z.length," items"]})})]})},eF=(0,h.Pi)(e=>{let{view:t=y.De.COLUMNS,columns:n=[],openedFolders:s=[],selectedItems:l=[],selectedFilePreview:i={},itemSearchString:r,onFilesUpload:o=w(),onSelectAllItemsInColumn:c=w(),onSelectColumnEmptySpace:d=w(),onColumnLoadMore:u=w(),onCopyUrl:m=w()}=e,h=(0,x.useRef)(null);return(0,x.useEffect)(()=>{if(h){let{scrollWidth:e,clientWidth:t}=h.current;e>t&&(h.current.scrollLeft+=e-t)}},[n]),(0,a.jsxs)("div",{ref:h,className:"file-explorer flex flex-grow overflow-x-auto justify-between h-full w-full",children:[(0,a.jsx)(en,{id:y.l6.STORAGE_COLUMN}),(0,a.jsx)(Y,{id:y.l6.STORAGE_ITEM,onCopyUrl:m}),(0,a.jsx)(H,{id:y.l6.STORAGE_FOLDER}),t===y.De.COLUMNS?(0,a.jsx)("div",{className:"flex",children:n.map((e,n)=>(0,a.jsx)(eD,{index:n,view:t,column:e,openedFolders:s,selectedItems:l,selectedFilePreview:i,itemSearchString:r,onFilesUpload:o,onSelectAllItemsInColumn:c,onSelectColumnEmptySpace:d,onColumnLoadMore:u,onCopyUrl:m},"column-".concat(n)))}):t===y.De.LIST?(0,a.jsx)(a.Fragment,{children:n.length>0&&(0,a.jsx)(eD,{fullWidth:!0,index:n.length-1,view:t,column:n[n.length-1],selectedItems:l,selectedFilePreview:i,itemSearchString:r,onFilesUpload:o,onSelectAllItemsInColumn:c,onSelectColumnEmptySpace:d,onColumnLoadMore:u,onCopyUrl:m})}):(0,a.jsxs)("div",{children:["Unknown view: ",t]})]})}),eO=n(54073),eq=n.n(eO),eW=n(82631),eU=n(13128),eV=n(28024),eM=n(69168),eB=n(52712),eK=n(16166),eY=n(34124),eQ=n(9019),eH=n(88439),eG=n(18902);let eX=[{key:y.De.COLUMNS,name:"As columns"},{key:y.De.LIST,name:"As list"}],e$=[{key:y.Ye.NAME,name:"Name"},{key:y.Ye.CREATED_AT,name:"Time created"},{key:y.Ye.UPDATED_AT,name:"Time modified"},{key:y.Ye.LAST_ACCESSED_AT,name:"Time last accessed"}],eJ=[{key:y.sd.ASC,name:"Ascending"},{key:y.sd.DESC,name:"Descending"}],e0=e=>{let{loading:t,isSearching:n,breadcrumbs:s,togglePathEdit:l}=e;return(0,a.jsx)("div",{className:"group ".concat(t?"":"cursor-pointer"),onClick:()=>t.isLoading?{}:l(),children:t.isLoading?(0,a.jsxs)("div",{className:"ml-2 flex items-center",children:[(0,a.jsx)(eb.Z,{size:16,strokeWidth:2,className:"animate-spin"}),(0,a.jsx)("p",{className:"ml-3 text-sm",children:t.message})]}):(0,a.jsxs)("div",{className:"flex cursor-pointer items-center",children:[(0,a.jsx)("p",{className:"ml-3 text-sm truncate",children:s[s.length-1]||""}),!n&&(0,a.jsx)("div",{className:"ml-3 flex items-center space-x-2 opacity-0 transition group-hover:opacity-100",children:(0,a.jsx)(C.z,{type:"text",icon:(0,a.jsx)(eW.Z,{}),children:"Navigate"})})]})})},e1=e=>{let{loading:t,isSearching:n,breadcrumbs:s,selectBreadcrumb:l}=e,i=s.map((e,t)=>({name:e,index:t})),r=i.length<=5?i:i.slice(0,2).concat([{name:"...",index:-1}]).concat(i.slice(i.length-2,i.length));return t.isLoading?(0,a.jsxs)("div",{className:"ml-2 flex items-center",children:[(0,a.jsx)(eb.Z,{size:16,strokeWidth:2,className:"animate-spin"}),(0,a.jsx)("p",{className:"ml-3 text-sm",children:t.message})]}):(0,a.jsx)("div",{className:"ml-3 flex items-center ".concat(n&&"max-w-[140px] overflow-x-auto"),children:r.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center",children:[0!==t&&(0,a.jsx)(O.Z,{size:10,strokeWidth:2,className:"mx-3"}),(0,a.jsx)("p",{className:"truncate text-sm ".concat("..."!==e.name?"cursor-pointer":""),style:{maxWidth:"6rem"},onClick:()=>"..."!==e.name?l(e.index):{},children:e.name},e.name)]},e.name))})};var e2=e=>{let{itemSearchString:t="",setItemSearchString:n=w(),onFilesUpload:s=w()}=e,l=eh(),r=(0,eH.cg)(),[o,c]=(0,x.useState)(""),[d,u]=(0,x.useState)(""),[m,h]=(0,x.useState)({isLoading:!1,message:""}),[p,f]=(0,x.useState)(!1),[g,j]=(0,x.useState)(!1),v=(0,x.useRef)(null),N=(0,x.useRef)(null),{view:_,setView:S,columns:k,sortBy:E,setSortBy:Z,sortByOrder:T,setSortByOrder:z,popColumn:A,popColumnAtIndex:P,popOpenedFolders:I,popOpenedFoldersAtIndex:F,fetchFoldersByPath:O,refetchAllOpenedFolders:q,addNewFolderPlaceholder:W,clearOpenedFolders:U,closeFilePreview:V,selectedBucket:M}=(0,b.H)(),B=k.map(e=>e.name),K=k.length<=1,Y=(0,D.Xo)(L.KA.STORAGE_ADMIN_WRITE,"*");(0,x.useEffect)(()=>{t&&u(t)},[]),(0,x.useEffect)(()=>{ej()(N.current,B)||(f(!1),N.current=B)},[B]);let Q=(0,x.useCallback)(eq()(n,300),[]),H=()=>{A(),I(),V()},G=async e=>{if(0===e.length)P(0),U(),V();else{let t=e.join("/");h({isLoading:!0,message:"Navigating to ".concat(t,"...")}),await O(e),h({isLoading:!1,message:""})}},$=()=>{u(""),l.setIsSearching(!1),n("")},J=async()=>{j(!0),await q(),j(!1)};return(0,a.jsxs)("div",{className:" flex h-[40px] pl-2 items-center justify-between rounded-t-md border-b border-overlay bg-surface-100",children:[(0,a.jsxs)("div",{className:"flex items-center ".concat(p?"w-1/2":""),children:[B.length>0&&(0,a.jsx)(C.z,{icon:(0,a.jsx)(eU.Z,{size:16,strokeWidth:2}),size:"tiny",type:"text",className:"".concat(B.length>1?"opacity-100":"opacity-25"," px-1"),disabled:K,onClick:()=>{f(!1),H()}}),p?(0,a.jsx)("form",{className:"ml-2 flex-grow",children:(0,a.jsx)(R.Z,{autoFocus:!0,type:"text",size:"small",value:o,onChange:e=>{c(e.target.value)},placeholder:"e.g Parent Folder/Child Folder",actions:[(0,a.jsx)(C.z,{type:"default",htmlType:"button",onClick:()=>{f(!1)},children:"Cancel"},"cancelPath"),(0,a.jsx)(C.z,{type:"primary",htmlType:"submit",onClick:e=>{e&&(e.preventDefault(),e.stopPropagation()),f(!1),G(i()(o.split("/")))},children:"Go to folder"},"setPath")]},"pathSet")}):_===y.De.COLUMNS?(0,a.jsx)(e0,{loading:m,isSearching:l.isSearching,breadcrumbs:B,togglePathEdit:()=>{f(!0),c(B.slice(1).join("/")),l.isSearching&&$()}}):(0,a.jsx)(e1,{loading:m,isSearching:l.isSearching,breadcrumbs:B,selectBreadcrumb:e=>{P(e),F(e-1)}})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1 px-2",children:[(0,a.jsx)(C.z,{size:"tiny",icon:(0,a.jsx)(eV.Z,{}),type:"text",loading:g,onClick:J,children:"Reload"}),(0,a.jsxs)(eZ.h_,{children:[(0,a.jsx)(eZ.$F,{asChild:!0,children:(0,a.jsx)(C.z,{type:"text",icon:"LIST"===_?(0,a.jsx)(eM.Z,{size:16,strokeWidth:2}):(0,a.jsx)(eB.Z,{size:16,strokeWidth:2}),children:"View"})}),(0,a.jsxs)(eZ.AW,{align:"end",className:"w-40 min-w-0",children:[eX.map(e=>(0,a.jsx)(eZ.Xi,{onClick:()=>S(e.key),children:(0,a.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,a.jsx)("p",{children:e.name}),_===e.key&&(0,a.jsx)(eK.Z,{className:"text-brand",strokeWidth:2})]})},e.key)),(0,a.jsx)(eZ.VD,{}),(0,a.jsxs)(eZ.Ph,{children:[(0,a.jsx)(eZ.kt,{children:"Sort by"}),(0,a.jsx)(eZ.TG,{className:"w-44",children:e$.map(e=>(0,a.jsx)(eZ.Xi,{onClick:()=>Z(e.key),children:(0,a.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,a.jsx)("p",{children:e.name}),E===e.key&&(0,a.jsx)(eK.Z,{className:"text-brand",strokeWidth:2})]})},e.key))})]}),(0,a.jsxs)(eZ.Ph,{children:[(0,a.jsx)(eZ.kt,{children:"Sort order"}),(0,a.jsx)(eZ.TG,{children:eJ.map(e=>(0,a.jsx)(eZ.Xi,{onClick:()=>z(e.key),children:(0,a.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,a.jsx)("p",{children:e.name}),T===e.key&&(0,a.jsx)(eK.Z,{className:"text-brand",strokeWidth:2})]})},e.key))})]})]})]})]}),(0,a.jsx)("div",{className:"h-6 border-r border-control"}),(0,a.jsxs)("div",{className:"flex items-center space-x-1 px-2",children:[(0,a.jsx)("div",{className:"hidden",children:(0,a.jsx)("input",{ref:v,type:"file",multiple:!0,onChange:s})}),(0,a.jsxs)(ex.fC,{delayDuration:0,children:[(0,a.jsx)(ex.xz,{className:"w-full",children:(0,a.jsx)(C.z,{icon:(0,a.jsx)(ei.Z,{size:16,strokeWidth:2}),type:"text",disabled:!Y||0===B.length,onClick:()=>{v.current&&v.current.click()},children:"Upload files"})}),!Y&&(0,a.jsx)(ex.h_,{children:(0,a.jsxs)(ex.VY,{side:"bottom",children:[(0,a.jsx)(ex.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to upload files"})})]})})]}),(0,a.jsxs)(ex.fC,{delayDuration:0,children:[(0,a.jsx)(ex.xz,{className:"w-full",children:(0,a.jsx)(C.z,{icon:(0,a.jsx)(X,{size:16,strokeWidth:2}),type:"text",disabled:!Y||0===B.length,onClick:()=>W(-1),children:"Create folder"})}),!Y&&(0,a.jsx)(ex.h_,{children:(0,a.jsxs)(ex.VY,{side:"bottom",children:[(0,a.jsx)(ex.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to create folders"})})]})})]})]}),(0,a.jsx)("div",{className:"h-6 border-r border-control"}),(0,a.jsx)("div",{className:"flex items-center px-2",children:l.isSearching?(0,a.jsx)(R.Z,{size:"tiny",autoFocus:!0,className:"w-52",icon:(0,a.jsx)(eY.Z,{size:"tiny",strokeWidth:2}),actions:[(0,a.jsx)(eQ.Z,{className:"mx-2 cursor-pointer text-foreground",size:"tiny",strokeWidth:2,onClick:$},"close")],placeholder:"Search for a file or folder",type:"text",value:d,onChange:e=>{u(e.target.value),Q(e.target.value)}}):(0,a.jsx)(C.z,{icon:(0,a.jsx)(eY.Z,{size:16,strokeWidth:2}),size:"tiny",type:"text",className:"px-1",onClick:()=>{f(!1),l.setIsSearching(!0)}})}),r&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"h-6 border-r border-control"}),(0,a.jsx)("div",{className:"mx-2",children:(0,a.jsx)(eG.Z,{section:["storage",M.name]})})]})]})]})},e4=()=>{let{selectedItems:e,downloadFile:t,downloadSelectedFiles:n,clearSelectedItems:s,setSelectedItemsToDelete:l,setSelectedItemsToMove:i}=(0,b.H)();return(0,a.jsxs)("div",{className:"z-10 flex h-[40px] items-center rounded-t-md bg-brand-400 px-2 py-1 shadow [[data-theme*=dark]_&]:bg-brand-500",children:[(0,a.jsx)(C.z,{icon:(0,a.jsx)(eQ.Z,{size:16,strokeWidth:2}),type:"text",onClick:()=>s()}),(0,a.jsxs)("div",{className:"ml-1 flex items-center space-x-3",children:[(0,a.jsxs)("p",{className:"mb-0 text-sm text-foreground",children:[(0,a.jsx)("span",{style:{fontVariantNumeric:"tabular-nums"},children:e.length})," items selected"]}),(0,a.jsx)(C.z,{icon:(0,a.jsx)(M.Z,{size:16,strokeWidth:2}),type:"primary",onClick:async()=>{1===e.length?await t(e[0]):await n(e)},children:"Download"}),(0,a.jsx)("div",{className:"border-r border-green-900 py-3 opacity-50"}),(0,a.jsx)(C.z,{icon:(0,a.jsx)(K,{size:16,strokeWidth:2}),type:"primary",onClick:()=>l(e),children:"Delete"}),(0,a.jsx)(C.z,{icon:(0,a.jsx)(V,{size:16,strokeWidth:2}),type:"primary",onClick:()=>i(e),children:"Move"})]})]})},e3=e=>{var t;let{bucketName:n="",visible:s=!1,selectedItemsToMove:l=[],onSelectCancel:i=w(),onSelectMove:r=w()}=e,[o,c]=(0,x.useState)(!1),[d,u]=(0,x.useState)("");(0,x.useEffect)(()=>{c(!1),u("")},[s]);let m=l.length>1,h=m?"Moving ".concat(l.length," items within ").concat(n):1===l.length?"Moving ".concat(null===(t=l[0])||void 0===t?void 0:t.name," within ").concat(n):"",p=e=>{e&&e.preventDefault(),c(!0),r("/"===d[0]?d.slice(1):d)};return(0,a.jsx)(_.C,{visible:s,header:h,description:"Enter the path to where you'd like to move the file".concat(m?"s":""," to."),size:"medium",onCancel:i,customFooter:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(C.z,{type:"default",onClick:i,children:"Cancel"}),(0,a.jsx)(C.z,{type:"primary",loading:o,onClick:p,children:o?"Moving files":"Move files"})]}),children:(0,a.jsx)(_.C.Content,{children:(0,a.jsxs)("form",{className:"my-4",children:[(0,a.jsx)("div",{className:"relative flex items-center",children:(0,a.jsx)(R.Z,{autoFocus:!0,label:"Path to new directory in ".concat(n),type:"text",className:"w-full",placeholder:"e.g folder1/subfolder2",value:d,descriptionText:"Leave blank to move items to the root of the bucket",onChange:e=>u(e.target.value)})}),(0,a.jsx)("button",{className:"hidden",type:"submit",onClick:p})]})})})},e5=n(56599);let e8=e=>{let{mimeType:t,previewUrl:n}=e;return t&&n?"loading"===n?(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center text-foreground-lighter",children:(0,a.jsx)(eb.Z,{size:14,strokeWidth:2,className:"animate-spin"})}):"skipped"===n?(0,a.jsxs)("div",{className:"flex h-full w-full flex-col items-center justify-center",children:[(0,a.jsx)(ev.Z,{src:"".concat(j.GW,"/img/file-filled.svg"),preProcessor:e=>e.replace(/svg/,'svg class="mx-auto w-32 h-32 text-color-inherit opacity-75"')}),(0,a.jsx)("p",{className:"mt-2 w-2/5 text-center text-sm",children:"File size is too large to preview in the explorer"})]}):t.includes("image")?(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center bg-contain bg-center bg-no-repeat",style:{backgroundImage:"url('".concat(n,"')")}}):t.includes("audio")?(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center px-10",children:(0,a.jsxs)("audio",{controls:!0,style:{width:"inherit"},children:[(0,a.jsx)("source",{src:n,type:"audio/mpeg"}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Your browser does not support the audio element."})]},n)}):t.includes("video")?(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,a.jsxs)("video",{controls:!0,style:{maxHeight:"100%"},children:[(0,a.jsx)("source",{src:n,type:"video/mp4"}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Your browser does not support the video tag."})]},n)}):(0,a.jsx)(ev.Z,{src:"".concat(j.GW,"/img/file-filled.svg"),preProcessor:e=>e.replace(/svg/,'svg class="mx-auto w-32 h-32 text-color-inherit opacity-75"')}):(0,a.jsx)(ev.Z,{src:"".concat(j.GW,"/img/file-filled.svg"),preProcessor:e=>e.replace(/svg/,'svg class="mx-auto w-32 h-32 text-color-inherit opacity-75"')})};var e6=e=>{let{onCopyUrl:t}=e,{getFileUrl:n,downloadFile:s,selectedBucket:l,selectedFilePreview:i,closeFilePreview:r,setSelectedItemsToDelete:o,setSelectedFileCustomExpiry:c}=(0,b.H)(),u=!d()(i),m=i.metadata?(0,v.td)(i.metadata.size):null,h=i.metadata?i.metadata.mimetype:null,x=i.created_at?new Date(i.created_at).toLocaleString():"Unknown",p=i.updated_at?new Date(i.updated_at).toLocaleString():"Unknown",f=(0,D.Xo)(L.KA.STORAGE_ADMIN_WRITE,"*");return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(ea.u,{show:u,enter:"transition ease-out duration-150",enterFrom:"transform opacity-0",enterTo:"transform opacity-100",leave:"transition ease-in duration-100",leaveFrom:"transform opacity-100",leaveTo:"transform opacity-0",children:(0,a.jsxs)("div",{className:" h-full border-l border-overlay bg-surface-100 p-4",style:{width:450},children:[(0,a.jsx)("div",{className:"flex w-full justify-end text-foreground-lighter transition-colors hover:text-foreground",children:(0,a.jsx)(eQ.Z,{className:"cursor-pointer",size:14,strokeWidth:2,onClick:()=>r()})}),(0,a.jsx)("div",{className:"my-4 border border-overlay",children:(0,a.jsx)("div",{className:"flex h-56 w-full items-center 2xl:h-72",children:(0,a.jsx)(e8,{mimeType:h,previewUrl:i.previewUrl})})}),(0,a.jsxs)("div",{className:"w-full space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("h5",{className:"break-words text-base text-foreground",children:i.name}),i.isCorrupted&&(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(eE.Z,{size:14,strokeWidth:2,className:"text-foreground-light"}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"File is corrupted, please delete and reupload this file again"})]}),h&&(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:[h,m&&(0,a.jsxs)("span",{children:[" - ",m]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"mb-1 text-xs text-foreground-lighter",children:"Added on"}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:x})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"mb-1 text-xs text-foreground-lighter",children:"Last modified"}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:p})]})]}),(0,a.jsxs)("div",{className:"flex space-x-2 border-b border-overlay pb-4",children:[(0,a.jsx)(C.z,{type:"default",icon:(0,a.jsx)(M.Z,{size:16,strokeWidth:2}),disabled:i.isCorrupted,onClick:async()=>await s(i),children:"Download"}),l.public?(0,a.jsx)(C.z,{type:"outline",icon:(0,a.jsx)(F.Z,{size:16,strokeWidth:2}),onClick:async()=>t(i.name,await n(i)),disabled:i.isCorrupted,children:"Get URL"}):(0,a.jsxs)(eZ.h_,{children:[(0,a.jsx)(eZ.$F,{asChild:!0,children:(0,a.jsx)(C.z,{type:"outline",icon:(0,a.jsx)(F.Z,{size:16,strokeWidth:2}),iconRight:(0,a.jsx)(e5.Z,{}),disabled:i.isCorrupted,children:"Get URL"})}),(0,a.jsxs)(eZ.AW,{side:"bottom",align:"center",children:[(0,a.jsx)(eZ.Xi,{onClick:async()=>t(i.name,await n(i,y.Qo.WEEK)),children:"Expire in 1 week"},"expires-one-week"),(0,a.jsx)(eZ.Xi,{onClick:async()=>t(i.name,await n(i,y.Qo.MONTH)),children:"Expire in 1 month"},"expires-one-month"),(0,a.jsx)(eZ.Xi,{onClick:async()=>t(i.name,await n(i,y.Qo.YEAR)),children:"Expire in 1 year"},"expires-one-year"),(0,a.jsx)(eZ.Xi,{onClick:()=>c(i),children:"Custom expiry"},"custom-expiry")]})]})]}),(0,a.jsxs)(ex.fC,{delayDuration:0,children:[(0,a.jsx)(ex.xz,{asChild:!0,children:(0,a.jsx)(C.z,{type:"outline",disabled:!f,size:"tiny",icon:(0,a.jsx)(K,{size:16,strokeWidth:2}),onClick:()=>o([i]),children:"Delete file"})}),!f&&(0,a.jsx)(ex.h_,{children:(0,a.jsxs)(ex.VY,{side:"bottom",children:[(0,a.jsx)(ex.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to delete this file"})})]})})]})]})]})})})};let e9=e=>{var t,n,l;let{bucket:r}=e,{columns:c,selectedFilePreview:u,closeFilePreview:h,selectedItems:N,setSelectedItems:w,clearSelectedItems:_,selectedItemsToDelete:C,clearSelectedItemsToDelete:S,openedFolders:E,popColumnAtIndex:Z,popOpenedFoldersAtIndex:T,selectedItemsToMove:R,clearSelectedItemsToMove:z,view:A,currentBucketName:L,openBucket:I,loadExplorerPreferences:D,fetchFolderContents:F,fetchMoreFolderContents:O,fetchFoldersByPath:q,deleteFolder:W,uploadFiles:U,deleteFiles:V,moveFiles:M}=(0,b.H)(),B=(0,x.useRef)(null),{ref:K}=(0,s.UO)(),{data:Y}=(0,g.z)({projectRef:K}),{data:Q}=(0,f.o)({projectRef:K}),H=(null!==(t=null==Q?void 0:Q.services)&&void 0!==t?t:[]).find(e=>e.app.id==j.pG),G=null==H?void 0:H.app_config,X="".concat(null!==(n=null==G?void 0:G.protocol)&&void 0!==n?n:"https","://").concat(null!==(l=null==G?void 0:G.endpoint)&&void 0!==l?l:"-"),[$,J]=(0,x.useState)(""),ee=window.innerHeight-122;(0,x.useEffect)(()=>{(async()=>{if(A===y.De.LIST){let e=E.length-1,t=E[e];$?t?await F(t.id,t.name,e,$):await F(r.id,r.name,-1,$):t?await F(t.id,t.name,e):await F(r.id,r.name,-1)}else A===y.De.COLUMNS&&q(E.map(e=>e.name),$,!0)})()},[$]),(0,x.useEffect)(()=>{D()},[]),(0,x.useEffect)(()=>{I(r)},[r]);let et=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;e.persist();let n=e.target.files||e.dataTransfer.items,a=!d()(o()(e,["dataTransfer","items"],[]));await U(n,t,a),e.target.value=""},en=async e=>{await M(e)},ea=async()=>{if(1===C.length){let[e]=C;if(e)switch(e.type){case y.fh.FOLDER:await W(e);break;case y.fh.FILE:await V([e])}}else await V(C)},es=(e,t)=>{var n;let a=(null==Y?void 0:null===(n=Y.customDomain)||void 0===n?void 0:n.status)==="active"?t.replace(X,"https://".concat(Y.customDomain.hostname)):t;(0,v.vQ)(a,()=>{p.ZP.success("Copied URL for ".concat(e," to clipboard."))})};return(0,a.jsxs)("div",{ref:B,className:" bg-studio border-overlay flex h-full w-full flex-col rounded-md border",children:[0===N.length?(0,a.jsx)(e2,{itemSearchString:$,setItemSearchString:J,onFilesUpload:et}):(0,a.jsx)(e4,{}),(0,a.jsxs)("div",{className:"flex h-full",style:{height:ee},children:[(0,a.jsx)(eF,{view:A,columns:c,openedFolders:E,selectedItems:N,selectedFilePreview:u,itemSearchString:$,onFilesUpload:et,onSelectAllItemsInColumn:e=>{let t=c[e].items.filter(e=>e.type===y.fh.FILE).map(t=>({...t,columnIndex:e})),n=i()(t.map(e=>e.id));N.filter(e=>n.includes(e.id)).length===t.length?w(N.filter(e=>!n.includes(e.id))):w(m()(N.concat(t),"id"))},onSelectColumnEmptySpace:e=>{Z(e),T(e-1),h(),_()},onColumnLoadMore:(e,t)=>O(e,t,$),onCopyUrl:es}),(0,a.jsx)(e6,{onCopyUrl:es})]}),(0,a.jsx)(k,{visible:C.length>0,selectedItemsToDelete:C,onSelectCancel:S,onSelectDelete:ea}),(0,a.jsx)(e3,{bucketName:L,visible:R.length>0,selectedItemsToMove:R,onSelectCancel:z,onSelectMove:en}),(0,a.jsx)(P,{onCopyUrl:es})]})};e9.displayName="StorageExplorer";var e7=(0,h.Pi)(e9),te=n(90882),tt=n.n(te),tn=n(94203),ta=n(83314),ts=n(43449),tl=n(85945),ti=n(48228),tr=n(49422),to=n(33747);async function tc(e){let{projectRef:t,connectionString:n,payload:a}=e,s=new Headers;n&&s.set("x-connection-encrypted",n);let{data:l,error:i}=await (0,tr.v_)("/platform/pg-meta/{ref}/policies",{params:{header:{"x-connection-encrypted":n},path:{ref:t}},body:a,headers:s});if(i)throw i;return l}let td=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,tl.NL)();return(0,ti.D)(e=>tc(e),{async onSuccess(t,n,s){let{projectRef:l}=n;await a.invalidateQueries(to.R.list(l)),await (null==e?void 0:e(t,n,s))},async onError(e,n,a){void 0===t?p.Am.error("Failed to create database policy: ".concat(e.message)):t(e,n,a)},...n})};var tu=n(43518),tm=n(9782),th=n(60479),tx=n(70245),tp=n(3440),tf=n.n(tp),tg=n(17335),tj=n.n(tg);let tv=e=>{let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return new Uint32Array([t])[0].toString(36)},tb=(e,t)=>0===t.length?t:tw(ty(e,t)),ty=(e,t)=>{let n=e.map(e=>e.name);return t.map(e=>{let{definition:t,check:a}=e,s=null!==t?tN(t):tN(a);return s&&n.includes(s)?{...e,bucket:s}:{...e,bucket:"Ungrouped"}})},tN=e=>{var t;let[n]=(null!==(t=null==e?void 0:e.split(" AND "))&&void 0!==t?t:[]).filter(e=>e.includes("bucket_id"));return n?n.split("'")[1]:null},tw=e=>{let t=tf()(e,"bucket");return Object.keys(t).map(e=>({name:e,policies:t[e]}))},t_=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{name:a,definition:s,allowedOperations:l,roles:i}=t,r=s?s.replace(/\s+/g," ").trim():"";return l.map((t,s)=>tC(s,e,a,r,t,i,n))},tC=(e,t,n,a,s,l,i)=>{let r=tv(t);return{name:i?"".concat(n," ").concat(r,"_").concat(e):n,definition:"INSERT"===s?void 0:"(".concat(a,")"),action:"PERMISSIVE",check:"INSERT"===s?"(".concat(a,")"):void 0,command:s,schema:"storage",table:"objects",roles:l.length>0?l:void 0}},tS=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Object.keys(y.Eb).filter(t=>{let n=y.Eb[t];if(0===tj()(n,e).length)return t})},tk=(e,t,n,a,s,l,i)=>{let r=tv(t),o=i?"".concat(n," ").concat(r,"_").concat(e):n,c="Add policy for the ".concat(s,' operation under the policy "').concat(n,'"'),d=0===l.length?["public"]:l;return{description:c,statement:'\n    CREATE POLICY "'.concat(o,'"\n    ON storage.objects\n    FOR ').concat(s,"\n    TO ").concat(d.join(", "),"\n    ").concat("INSERT"===s?"WITH CHECK":"USING"," (").concat(a,");\n").replace(/\s+/g," ").trim()}},tE=function(e,t){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{name:a,definition:s,allowedOperations:l,roles:i}=t;return l.map((t,l)=>tk(l,e,a,s||"",t,i,n))},tZ=(e,t)=>e.replace("{bucket_id}","'".concat(t,"'"));var tT=n(40068),tR=n(21784),tz=n(71234),tA=n(81733);let tP=e=>{let{policy:t,table:n,bucketName:s,onSelectPolicyEdit:l=()=>{},onSelectPolicyDelete:i=()=>{}}=e,{name:r,command:o}=t;return(0,a.jsx)("div",{className:"group",children:(0,a.jsxs)(tT.Z.Content,{className:"flex justify-between gap-2 border-b border-overlay py-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center",children:[(0,a.jsx)("div",{className:"font-mono text-xs text-foreground-lighter",children:o}),(0,a.jsx)("div",{className:"flex flex-col gap-2 lg:flex-row",children:(0,a.jsx)("span",{className:"truncate text-sm text-foreground",children:r})})]}),(0,a.jsxs)(eZ.h_,{children:[(0,a.jsx)(eZ.$F,{children:(0,a.jsx)(C.z,{type:"default",style:{paddingLeft:4,paddingRight:4},icon:(0,a.jsx)(eT.Z,{})})}),(0,a.jsxs)(eZ.AW,{side:"bottom",align:"end",children:[(0,a.jsxs)(eZ.Xi,{className:"space-x-2",onClick:()=>l(t,s,n),children:[(0,a.jsx)(q.Z,{size:14}),(0,a.jsx)("p",{children:"Edit"})]}),(0,a.jsx)(eZ.VD,{}),(0,a.jsxs)(eZ.Xi,{className:"space-x-2",onClick:()=>i(t),children:[(0,a.jsx)(tR.Z,{size:14}),(0,a.jsx)("p",{children:"Delete"})]})]})]})]})})};var tL=e=>{let{table:t="",label:n="",bucket:s={},policies:l=[],onSelectPolicyAdd:i=()=>{},onSelectPolicyEdit:r=()=>{},onSelectPolicyDelete:o=()=>{}}=e;return(0,a.jsx)(tT.Z,{title:[(0,a.jsxs)("div",{className:"flex w-full items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(tz.Z,{className:"text-foreground-light",size:"small"}),(0,a.jsx)("h4",{className:"m-0 text-lg",children:(0,a.jsx)("span",{children:n})}),s.public&&(0,a.jsx)(tA.C,{variant:"warning",children:"Public"})]}),(0,a.jsx)(C.z,{type:"outline",onClick:()=>i(s.name,t),children:"New policy"})]},n)],children:0===l.length?(0,a.jsx)("div",{className:"p-4 px-6",children:(0,a.jsx)("p",{className:"text-sm text-foreground-lighter",children:"No policies created yet"})}):(0,a.jsxs)("div",{className:"grid grid-cols-1 divide-y [[data-theme*=dark]_&]:divide-dark",children:[l.map(e=>(0,a.jsx)(tP,{policy:e,table:t,bucketName:s.name,onSelectPolicyEdit:r,onSelectPolicyDelete:o},e.name)),0!==l.length?(0,a.jsx)("div",{className:"px-6 py-2",children:(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:d()(s)?"objects"===t?"".concat(l.length," polic").concat(l.length>1?"ies":"y"," that are not tied to any buckets"):"".concat(l.length," polic").concat(l.length>1?"ies":"y"," that target your buckets"):"".concat(l.length," polic").concat(l.length>1?"ies":"y"," in ").concat(s.name)})}):null]})})},tI=n(2284),tD=n.n(tI),tF=n(39127);let tO=[{id:"policy-1",templateName:"Allow access to JPG images in a public folder to anonymous users",description:"This policy uses native postgres functions, functions from auth and storage schema",name:"Give anon users access to JPG images in folder",statement:"\nCREATE POLICY \"policy_name\"\nON storage.objects FOR {operation} {USING | WITH CHECK} (\n  -- restrict bucket\n  bucket_id = {bucket_name}\n  -- allow access to only jpg file\n  AND storage.\"extension\"(name) = 'jpg'\n  -- in the public folder\n  AND LOWER((storage.foldername(name))[1]) = 'public'\n  -- to anonymous users\n  AND auth.role() = 'anon'\n);\n    ".trim(),definition:"bucket_id = {bucket_id} AND storage.\"extension\"(name) = 'jpg' AND LOWER((storage.foldername(name))[1]) = 'public' AND auth.role() = 'anon'",allowedOperations:[]},{id:"policy-2",templateName:"Give users access to only their own top level folder named as uid",description:"For example a user with id d7bed83c-44a0-4a4f-925f-efc384ea1e50 will be able to access anything under the folder d7bed83c-44a0-4a4f-925f-efc384ea1e50/",name:"Give users access to own folder",statement:'\nCREATE POLICY "policy_name"\nON storage.objects FOR {operation} {USING | WITH CHECK} (\n    -- restrict bucket\n    bucket_id = {bucket_name}\n    and auth.uid()::text = (storage.foldername(name))[1]\n);\n    '.trim(),definition:"bucket_id = {bucket_id} AND auth.uid()::text = (storage.foldername(name))[1]",allowedOperations:[]},{id:"policy-3",templateName:"Give users access to a folder only to authenticated users",description:"This policy gives users access to a folder (e.g private) only if they are authenticated",name:"Give users authenticated access to folder",statement:"\nCREATE POLICY \"policy_name\"\nON storage.objects FOR {operation} {USING | WITH CHECK} (\n    -- restrict bucket\n    bucket_id = {bucket_name}\n    AND (storage.foldername(name))[1] = 'private'\n    AND auth.role() = 'authenticated'\n);\n    ".trim(),definition:"bucket_id = {bucket_id} AND (storage.foldername(name))[1] = 'private' AND auth.role() = 'authenticated'",allowedOperations:[]},{id:"policy-4",templateName:"Give access to a nested folder called admin/assets only to a specific user",description:'This policy gives read access to all authenticated users for your project to the folder "public"',name:"Give access to a folder",statement:"\nCREATE POLICY \"policy_name\"\nON storage.objects FOR {operation} {USING | WITH CHECK} (\n	  -- restrict bucket\n    bucket_id = {bucket_name}\n    AND (storage.foldername(name))[1] = 'admin' AND (storage.foldername(name))[2] = 'assets'\n    AND auth.uid()::text = 'd7bed83c-44a0-4a4f-925f-efc384ea1e50'\n);\n    ".trim(),definition:"bucket_id = {bucket_id} AND (storage.foldername(name))[1] = 'admin' AND (storage.foldername(name))[2] = 'assets' AND auth.uid()::text = 'd7bed83c-44a0-4a4f-925f-efc384ea1e50'",allowedOperations:[]},{id:"policy-5",templateName:"Give access to a file to a user",description:"This policy gives access to a specific file to a specific user",name:"Give access to a file to user",statement:"\nCREATE POLICY \"policy_name\"\nON storage.objects FOR {operation} {USING | WITH CHECK} (\n	  -- restrict bucket\n    bucket_id = {bucket_name}\n    AND name = 'admin/assets/Costa Rican Frog.jpg'\n    AND auth.uid()::text = 'd7bed83c-44a0-4a4f-925f-efc384ea1e50'\n);\n    ".trim(),definition:"bucket_id = {bucket_id} AND name = 'admin/assets/Costa Rican Frog.jpg' AND auth.uid()::text = 'd7bed83c-44a0-4a4f-925f-efc384ea1e50'",allowedOperations:[]}];var tq=n(65189),tW=n(25321);let tU=e=>{let{definition:t="",onUpdatePolicyDefinition:n=()=>{}}=e;return(0,a.jsxs)("div",{className:"flex space-x-12",children:[(0,a.jsxs)("div",{className:"flex w-1/3 flex-col space-y-2",children:[(0,a.jsx)("label",{className:"text-base text-foreground-light",htmlFor:"policy-name",children:"Policy definition"}),(0,a.jsx)("p",{className:"text-sm text-foreground-lighter",children:"Provide a SQL conditional expression that returns a boolean."})]}),(0,a.jsx)("div",{className:"h-56 w-2/3",children:(0,a.jsx)(tW.Z,{defaultValue:t,onInputChange:n})})]})},tV=e=>{let{allowedOperations:t=[],onToggleOperation:n=()=>{}}=e,s=tS(t);return(0,a.jsxs)("div",{className:"flex justify-between space-x-12",children:[(0,a.jsxs)("div",{className:"flex w-1/3 flex-col space-y-2",children:[(0,a.jsx)("label",{className:"text-base text-foreground-light",htmlFor:"allowed-operation",children:"Allowed operation"}),(0,a.jsxs)("p",{className:"text-sm text-foreground-lighter",children:["Based on the operations you have selected, you can use the highlighted functions in the"," ",(0,a.jsx)("a",{href:"https://supabase.com/docs/reference/javascript/storage-from-list",target:"_blank",rel:"noreferrer",className:"underline",children:"client library"}),"."]})]}),(0,a.jsxs)("div",{className:"w-2/3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-8",children:[(0,a.jsx)(er.Z,{label:"SELECT",onChange:()=>n("SELECT"),checked:t.includes("SELECT")}),(0,a.jsx)(er.Z,{label:"INSERT",onChange:()=>n("INSERT"),checked:t.includes("INSERT")}),(0,a.jsx)(er.Z,{label:"UPDATE",onChange:()=>n("UPDATE"),checked:t.includes("UPDATE")}),(0,a.jsx)(er.Z,{label:"DELETE",onChange:()=>n("DELETE"),checked:t.includes("DELETE")})]}),(0,a.jsx)("div",{className:"flex w-5/6 flex-wrap",children:Object.keys(y.Eb).map(e=>(0,a.jsx)("div",{className:"mr-2 mt-2 font-mono",children:(0,a.jsx)(tA.C,{variant:s.includes(e)?"brand":"default",children:e})},e))})]})]})},tM=e=>{let{onViewTemplates:t=()=>{},onReviewPolicy:n=()=>{}}=e;return(0,a.jsxs)("div",{className:"flex w-full items-center justify-end gap-x-2 border-t px-6 py-3 border-default",children:[(0,a.jsx)(C.z,{type:"default",onClick:t,children:"View templates"}),(0,a.jsx)(C.z,{type:"primary",onClick:n,children:"Review"})]})};var tB=e=>{let{policyFormFields:t={},onViewTemplates:n=w(),onUpdatePolicyName:s=w(),onUpdatePolicyDefinition:l=w(),onToggleOperation:i=w(),onUpdatePolicyRoles:r=w(),onReviewPolicy:o=w()}=e,c=t.definition,d=t.roles;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mb-8 space-y-8 py-6",children:[(0,a.jsx)(_.C.Content,{children:(0,a.jsx)(tq.CM,{name:t.name,limit:50,onUpdatePolicyName:s})}),(0,a.jsx)(_.C.Separator,{}),(0,a.jsx)(_.C.Content,{children:(0,a.jsx)(tV,{allowedOperations:t.allowedOperations,onToggleOperation:i})}),(0,a.jsx)(_.C.Separator,{}),(0,a.jsx)(_.C.Content,{children:(0,a.jsx)(tq.$L,{selectedRoles:d,onUpdateSelectedRoles:r})}),(0,a.jsx)(_.C.Separator,{}),(0,a.jsx)(_.C.Content,{children:(0,a.jsx)(tU,{definition:c,onUpdatePolicyDefinition:l})})]}),(0,a.jsx)(tM,{onViewTemplates:n,onReviewPolicy:o})]})};let tK=()=>(0,a.jsx)("div",{className:"my-10 flex items-center justify-center space-x-2 opacity-50",children:(0,a.jsx)("p",{children:"There are no changes made to this policy"})});var tY=e=>{let{policyStatements:t=[],onSelectBack:n=()=>{},onSelectSave:s=()=>{}}=e,[l,i]=(0,x.useState)(!1);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(_.C.Content,{children:(0,a.jsxs)("div",{className:"space-y-6 py-8",children:[(0,a.jsx)("div",{className:"flex items-center justify-between space-y-8 space-x-4",children:(0,a.jsx)("div",{className:"flex flex-col",children:(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:["These are the SQL statements that will be used to create your policies. The suffix appended to the end of your policy name (",(0,a.jsx)("code",{children:"[hashString]_[number]"}),") just functions as a unique identifier for each of your policies."]})})}),(0,a.jsxs)("div",{className:"space-y-4 overflow-y-auto",style:{maxHeight:"25rem"},children:[0===t.length&&(0,a.jsx)(tK,{}),t.map((e,t)=>{let n=e.statement||"";return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("span",{children:e.description}),(0,a.jsx)("div",{className:"h-40",children:(0,a.jsx)(tW.Z,{readOnly:!0,defaultValue:n})})]},"policy_".concat(t))})]})]})}),(0,a.jsxs)("div",{className:"flex w-full items-center justify-end gap-2 border-t px-6 py-4 border-default",children:[(0,a.jsx)(C.z,{type:"default",onClick:n,children:"Back to edit"}),t.length>0&&(0,a.jsx)(C.z,{type:"primary",onClick:()=>{i(!0),s()},loading:l,children:"Save policy"})]})]})};let tQ={name:"",roles:[],policyIds:[],definition:"",allowedOperations:[]};var tH=e=>{let{visible:t=!1,bucketName:n="",onSelectCancel:s=()=>{},onCreatePolicies:l=()=>{},onSaveSuccess:i=()=>{}}=e,[r,o]=(0,x.useState)(""),[c,d]=(0,x.useState)(""),[u,m]=(0,x.useState)(tQ),[h,f]=(0,x.useState)([]);(0,x.useEffect)(()=>{t&&(g(),m(tQ))},[t]);let g=()=>d(tn.$A.SELECTION),j=e=>{"new"===e&&m({...u,definition:"bucket_id = '".concat(n,"'")}),d(tn.$A.EDITOR)},v=()=>{o(c),d(tn.$A.TEMPLATES)},b=()=>d(tn.$A.REVIEW),y=async e=>{-1!==(await l(e)).indexOf(!0)?j():i()};return(0,a.jsx)(_.C,{hideFooter:!0,size:c===tn.$A.SELECTION?"medium":"xxlarge",visible:t,contentStyle:{padding:0},header:[(0,a.jsx)(e=>{let{view:t,bucketName:n,onSelectBackFromTemplates:s=w()}=e;return t===tn.$A.TEMPLATES?(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("span",{onClick:s,className:"cursor-pointer text-foreground-lighter transition-colors hover:text-foreground",children:(0,a.jsx)(eU.Z,{strokeWidth:2,size:14})}),(0,a.jsx)("h4",{className:"textlg m-0",children:"Select a template to use for your new policy"})]})}):(0,a.jsxs)("div",{className:"w-full flex items-center justify-between gap-x-2",children:[(0,a.jsx)("h4",{className:"m-0 truncate",children:t===tn.$A.EDITOR||t===tn.$A.SELECTION?"Adding new policy to ".concat(n):t===tn.$A.REVIEW?"Reviewing policies to be created for ".concat(n):void 0}),(0,a.jsx)(C.z,{asChild:!0,type:"default",icon:(0,a.jsx)(tF.Z,{size:14}),children:(0,a.jsxs)("a",{href:"https://supabase.com/docs/learn/auth-deep-dive/auth-policies",target:"_blank",rel:"noreferrer",children:[" ","Documentation"]})})]})},{view:c,bucketName:n,onSelectBackFromTemplates:()=>d(r)},"0")],onCancel:s,children:(0,a.jsx)("div",{className:"w-full",children:c===tn.$A.SELECTION?(0,a.jsx)(tn.pT,{description:"PostgreSQL policies control access to your files and folders",onViewTemplates:v,onViewEditor:()=>j("new"),showAssistantPreview:!1}):c===tn.$A.EDITOR?(0,a.jsx)(tB,{policyFormFields:u,onViewTemplates:v,onUpdatePolicyName:e=>{e.length<=50&&m({...u,name:e})},onUpdatePolicyDefinition:e=>{m({...u,definition:e})},onToggleOperation:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t)return m({...u,allowedOperations:[e]});let n=u.allowedOperations.includes(e)?tD()(u.allowedOperations.slice(),e):u.allowedOperations.concat([e]);return m({...u,allowedOperations:n})},onUpdatePolicyRoles:e=>{m({...u,roles:e})},onReviewPolicy:()=>{let{name:e,definition:t,allowedOperations:a}=u;return 0===e.length?p.ZP.error("Please provide a name for your policy"):0===t.length?p.ZP.error("Please provide a definition for your policy"):0===a.length?p.ZP.error("Please allow at least one operation in your policy"):void(f(tE(n,u)),b())}}):c===tn.$A.TEMPLATES?(0,a.jsx)(tn.jm,{templates:tO,onUseTemplate:e=>{let{id:t,...a}=e,s=tZ(a.definition,n);m({...u,...a,definition:s}),j()},templatesNote:""}):c===tn.$A.REVIEW?(0,a.jsx)(tY,{policyStatements:h,onSelectBack:j,onSelectSave:()=>{y(t_(n,u))}}):(0,a.jsx)("div",{})})})},tG=()=>(0,a.jsx)(tT.Z,{title:[(0,a.jsx)("div",{className:"flex w-full items-center justify-between",children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(tz.Z,{size:"small"}),(0,a.jsx)("h4",{children:"Bucket policies"})]})},"storagePlaceholder")],children:(0,a.jsx)("div",{className:"p-4 px-6",children:(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Create a bucket first to start writing policies!"})})}),tX=()=>{let{project:e}=(0,ta.d2)(),{ref:t}=(0,s.UO)(),{data:n,isLoading:l}=(0,th.K)({projectRef:t}),i=null!=n?n:[],[r,c]=(0,x.useState)({}),[u,m]=(0,x.useState)({}),[h,f]=(0,x.useState)({}),{data:g,refetch:j,isLoading:v}=(0,ts.r)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString,schema:"storage"}),b=null!=g?g:[],{mutateAsync:y}=td({onError:()=>{}}),{mutateAsync:N}=(0,tm.k)(),{mutate:w}=(0,tu.l)({onSuccess:async()=>{await j(),p.ZP.success("Successfully deleted policy!"),m({})}}),_=d()(r)&&!d()(h)&&o()(h,["bucket"],"").length>0,C=!d()(h)&&!_,S=tb(i,tt()(b,{table:"objects"})),k=o()(ef()(S,{name:"Ungrouped"}),["policies"],[]),E=tt()(b,{table:"buckets"}),Z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";c({}),f({bucket:e,table:t})},T=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";f({bucket:t,table:n}),c(e)},R=()=>{f({})},z=e=>m(e),A=async()=>{p.ZP.success("Successfully saved policy!"),await j(),R()},P=async t=>e?await Promise.all(t.map(async t=>{try{return await y({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString,payload:t}),!1}catch(e){return p.ZP.error("Error adding policy: ".concat(e.message)),!0}})):(console.error("Project is required"),!0),L=async t=>{if(!e)return console.error("Project is required"),!0;try{return await y({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString,payload:t}),!1}catch(e){return p.ZP.error("Error adding policy: ".concat(e.message)),!0}},I=async t=>{if(!e)return console.error("Project is required"),!0;try{return await N({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString,id:t.id,payload:t}),!1}catch(e){return p.ZP.error("Error updating policy: ".concat(e.message)),!0}},D=async()=>{if(!e)return console.error("Project is required");w({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString,id:u.id})};return(0,a.jsxs)("div",{className:"flex min-h-full w-full flex-col",children:[(0,a.jsx)("h3",{className:"text-xl",children:"Storage policies"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-foreground-light",children:"Safeguard your files with policies that define the operations allowed for your users at the bucket level."}),l||v?(0,a.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,a.jsx)(eb.Z,{className:"animate-spin",size:16})}):(0,a.jsxs)("div",{className:"mt-4 space-y-4",children:[0===i.length&&(0,a.jsx)(tG,{}),i.map(e=>{let t=o()(ef()(S,{name:e.name}),["policies"],[]).sort((e,t)=>e.name.localeCompare(t.name));return(0,a.jsx)(tL,{table:"objects",label:e.name,bucket:e,policies:t,onSelectPolicyAdd:Z,onSelectPolicyEdit:T,onSelectPolicyDelete:z},e.name)}),(0,a.jsx)("div",{className:"!mb-4 w-full border-b border-muted"}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"You may also write policies for the tables under the storage schema directly for greater control"}),(0,a.jsx)(tL,{table:"objects",label:"Other policies under storage.objects",policies:k,onSelectPolicyAdd:Z,onSelectPolicyEdit:T,onSelectPolicyDelete:z}),(0,a.jsx)(tL,{table:"buckets",label:"Policies under storage.buckets",policies:E,onSelectPolicyAdd:Z,onSelectPolicyEdit:T,onSelectPolicyDelete:z})]}),(0,a.jsx)(tH,{visible:_,bucketName:h.bucket,onSelectCancel:R,onCreatePolicies:P,onSaveSuccess:A}),(0,a.jsx)(tn.yV,{schema:"storage",visible:C,table:h.table,selectedPolicyToEdit:r,onSelectCancel:R,onCreatePolicy:L,onUpdatePolicy:I,onSaveSuccess:A}),(0,a.jsx)(tx.Z,{danger:!0,visible:!d()(u),title:"Confirm to delete policy",description:'This is permanent! Are you sure you want to delete the policy "'.concat(u.name,'"'),buttonLabel:"Delete",buttonLoadingLabel:"Deleting",onSelectCancel:()=>m({}),onSelectConfirm:D})]})},t$=n(15941),tJ=n(33105),t0=n(27398),t1=n(48577),t2=n(49336),t4=n(71436),t3=n(71824);async function t5(e){let{projectRef:t,fileSizeLimit:n}=e,a=await (0,t4.r$)("".concat(j.T5,"/projects/").concat(t,"/config/storage"),{fileSizeLimit:n});if(a.error)throw a.error;return a}let t8=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,tl.NL)();return(0,ti.D)(e=>t5(e),{async onSuccess(t,n,s){let{projectRef:l}=n;await a.invalidateQueries(t3.U.storage(l)),await (null==e?void 0:e(t,n,s))},async onError(e,n,a){void 0===t?p.ZP.error("Failed to update storage settings: ".concat(e.message)):t(e,n,a)},...n})};var t6=n(21603),t9=n(26871),t7=()=>{let{ref:e}=(0,s.UO)(),t=(0,D.lL)(),n=null==t?void 0:t.slug,l=(0,D.Xo)(L.KA.STORAGE_ADMIN_WRITE,"*"),{data:i,error:r,isLoading:o,isSuccess:c,isError:d}=(0,t2.k)({projectRef:e},{enabled:j.Qy}),{fileSizeLimit:u,isFreeTier:m}=i||{},{value:h,unit:f}=(0,t9.K)(u),[g,v]=(0,x.useState)(f),b={fileSizeLimit:h,unformattedFileSizeLimit:u},{mutate:y,isLoading:N}=t8({onSuccess:e=>{b={fileSizeLimit:(0,t9.K)(e.fileSizeLimit).value,unformattedFileSizeLimit:e.fileSizeLimit},p.ZP.success("Successfully updated storage settings")}}),w="".concat(new Intl.NumberFormat("en-US").format(t6.H)," bytes"),{value:_}=(0,t9.K)(t6.H,g),S=e=>{let t={};return e.fileSizeLimit>_&&(t.fileSizeLimit="Maximum limit is up to ".concat(_.toLocaleString()," ").concat(g,".")),t},k=async t=>e?S(t).fileSizeLimit?p.ZP.error("Upload file size limit must be up to 50GB (".concat(w,")")):void y({projectRef:e,fileSizeLimit:(0,t9.F)(t.fileSizeLimit,g)}):console.error("Project ref is required");return(0,a.jsx)("div",{children:(0,a.jsx)(T.Z,{validateOnBlur:!0,initialValues:b,validate:S,onSubmit:k,children:t=>{let{values:s,resetForm:i,handleReset:u}=t,h=b.unformattedFileSizeLimit!==(0,t9.F)(s.fileSizeLimit,g);return(0,x.useEffect)(()=>{i({values:b,initialValues:b})},[c]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t0.ph,{title:"Storage Settings",description:"Configure your project's storage settings."}),o&&(0,a.jsx)(ec.A,{}),d&&(0,a.jsx)(tJ.Z,{error:r,subject:"Failed to retrieve project's storage configuration"}),c&&(0,a.jsxs)("div",{className:"bg-surface-100 overflow-hidden border-muted rounded-md border shadow",children:[(0,a.jsx)("div",{className:"flex flex-col gap-0 divide-y divide-border-muted",children:(0,a.jsxs)("div",{className:"grid grid-cols-12 gap-6 px-8 py-8 lg:gap-12",children:[(0,a.jsx)("div",{className:"relative flex flex-col col-span-12 gap-6 lg:col-span-4",children:(0,a.jsx)("p",{className:"text-sm",children:"Upload file size limit"})}),(0,a.jsxs)("div",{className:"relative flex flex-col col-span-12 gap-x-6 gap-y-2 lg:col-span-8",children:[(0,a.jsxs)("div",{className:"grid grid-cols-12 col-span-12 gap-2",children:[(0,a.jsx)("div",{className:"col-span-8",children:(0,a.jsx)(R.Z,{id:"fileSizeLimit",name:"fileSizeLimit",type:"number",disabled:m||!l,step:1,onKeyPress:e=>{(e.charCode<48||e.charCode>57)&&e.preventDefault()}})}),(0,a.jsx)("div",{className:"col-span-4",children:(0,a.jsx)(z.Z,{disabled:m,value:g,onChange:v,children:Object.values(t6.b).map(e=>(0,a.jsx)(z.Z.Option,{disabled:m,label:e,value:e,children:(0,a.jsx)("div",{children:e})},e))})})]}),(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:[g!==t6.b.BYTES&&"Equivalent to ".concat((0,t9.F)(s.fileSizeLimit,g).toLocaleString()," bytes. "),"Maximum size in bytes of a file that can be uploaded is 5 GB (",w,")."]})]})]})}),m&&(0,a.jsx)("div",{className:"px-6 pb-6",children:(0,a.jsx)(t1.Z,{icon:(0,a.jsx)(t$.Z,{size:"large"}),organizationSlug:null!=n?n:"",primaryText:"Free Plan has a fixed upload file size limit of 50 MB.",projectRef:null!=e?e:"",secondaryText:"Upgrade to the Pro plan for a configurable upload file size limit of up to 5 GB."})}),(0,a.jsx)("div",{className:"border-t border-overlay"}),(0,a.jsx)("div",{className:"flex justify-between px-8 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between w-full gap-2",children:[l?(0,a.jsx)("div",{}):(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"You need additional permissions to update storage settings"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(C.z,{type:"default",htmlType:"reset",onClick:()=>u(),disabled:N||!h&&void 0!==h,children:"Cancel"}),(0,a.jsx)(C.z,{type:"primary",htmlType:"submit",loading:N,disabled:!l||N||!h&&void 0!==h,children:"Save"})]})]})})]})]})}})})},ne=n(5632),nt=n(58905),nn=n(25528);async function na(e){let{projectRef:t,id:n}=e;if(!t)throw Error("projectRef is required");if(!n)throw Error("Bucket name is requried");let a=await (0,t4.v_)("".concat(j.T5,"/storage/").concat(t,"/buckets/").concat(n,"/empty"),{});if(a.error)throw a.error;let s=await (0,t4.$v)("".concat(j.T5,"/storage/").concat(t,"/buckets/").concat(n));if(s.error)throw s.error;return s}let ns=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,tl.NL)();return(0,ti.D)(e=>na(e),{async onSuccess(t,n,s){let{projectRef:l}=n;await a.invalidateQueries(nn.m.buckets(l)),await (null==e?void 0:e(t,n,s))},async onError(e,n,a){void 0===t?p.Am.error("Failed to delete bucket: ".concat(e.message)):t(e,n,a)},...n})};var nl=e=>{var t;let{visible:n=!1,bucket:l,onClose:i}=e,r=(0,ne.useRouter)(),{ref:c}=(0,s.UO)(),{project:d}=(0,ta.d2)(),{data:u}=(0,th.K)({projectRef:c}),{data:m}=(0,ts.r)({projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString,schema:"storage"}),{mutateAsync:h}=(0,tu.l)(),{mutate:x,isLoading:f}=ns({onSuccess:async()=>{if(!d)return console.error("Project is required");let e=tb(g,(null!=m?m:[]).filter(e=>"objects"===e.table)),t=o()(ef()(e,{name:l.name}),["policies"],[]);await Promise.all(t.map(e=>h({projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString,id:e.id}))),p.ZP.success("Successfully deleted bucket ".concat(l.name)),r.push("/project/".concat(c,"/storage/buckets")),i()}}),g=null!=u?u:[],j=async()=>c?l?void x({projectRef:c,id:l.id}):console.error("No bucket is selected"):console.error("Project ref is required");return(0,a.jsx)(nt.Z,{variant:"destructive",visible:n,title:"Confirm deletion of ".concat(null==l?void 0:l.name),confirmPlaceholder:"Type in name of bucket",onConfirm:j,onCancel:i,confirmString:null!==(t=null==l?void 0:l.name)&&void 0!==t?t:"",loading:f,text:(0,a.jsxs)(a.Fragment,{children:["Your bucket ",(0,a.jsx)("span",{className:"font-bold text-foreground",children:null==l?void 0:l.name})," and all its contents will be permanently deleted."]}),alert:{title:"You cannot recover this bucket once deleted.",description:"All bucket data will be lost."},confirmLabel:"Delete bucket"})}},18902:function(e,t,n){"use strict";var a=n(52322),s=n(1674),l=n(65981),i=n(27792);t.Z=e=>{let{section:t}=e,n=(0,l.WZ)();return(0,a.jsx)(i.z,{size:"tiny",type:"default",onClick:()=>{t&&n.setActiveDocsSection(t),n.setShowProjectApiDocs(!0)},icon:(0,a.jsx)(s.Z,{strokeWidth:1.5,className:"text-foreground-muted"}),children:"API Docs"})}},40449:function(e,t,n){"use strict";var a=n(52322),s=n(39097),l=n.n(s);n(2784);var i=n(79378),r=n(31231),o=n(12467);t.Z=e=>{let t,{title:n,description:s,children:c,footer:d,url:u="",linkHref:m="",imgUrl:h,imgAlt:x,icon:p,className:f,loading:g=!1,fixedHeight:j=!0,hideChevron:v=!1,titleClass:b="",...y}=e,N=u||m||y.onClick,w={};y.onClick?(t="button",w=y):m?(t=l(),w={href:m,...y}):u?(t="a",w={href:u,...y}):(t="div",w=y);let _=["group relative text-left","bg-surface-100","border border-surface","rounded-md p-5 flex flex-row","transition ease-in-out duration-150"];N&&(_=[..._,"cursor-pointer","hover:bg-surface-200","hover:border-control"]),j&&(_=[..._,"h-32"]);let C=e=>{let{children:t}=e;return(0,a.jsx)("div",{className:"mr-4 flex flex-col",children:t})},S=(0,a.jsxs)(a.Fragment,{children:[h&&(0,a.jsx)(C,{children:(0,a.jsx)("img",{className:" transition-all group-hover:scale-110 ",src:"".concat(h),alt:"".concat(x),width:"26"})}),p&&(0,a.jsx)(C,{children:p}),(0,a.jsxs)("div",{className:"flex h-full w-full flex-col space-y-2",children:["string"==typeof n?(0,a.jsx)("h5",{className:"text-foreground ".concat(b),children:n}):n,(c||s)&&(0,a.jsxs)("div",{className:"flex w-full flex-1 flex-col",children:[(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:s}),(0,a.jsx)("div",{className:"w-full",children:c&&c})]}),d&&(0,a.jsx)("div",{className:"w-full !mt-auto",children:d})]}),N&&(0,a.jsx)("div",{className:" absolute right-4 top-4 text-foreground-lighter transition-all duration-200 group-hover:right-3 group-hover:text-foreground ",children:g?(0,a.jsx)(i.Z,{className:"animate-spin"}):v?(0,a.jsx)(a.Fragment,{}):(0,a.jsx)(r.Z,{})})]});return(0,a.jsx)(t,{...w,className:(0,o.cn)(_,f),children:S})}},27398:function(e,t,n){"use strict";n.d(t,{iN:function(){return j},ph:function(){return u},by:function(){return g},hj:function(){return h},B4:function(){return f},S0:function(){return x},ld:function(){return s}});var a=n(52322);function s(e){return(0,a.jsxs)("div",{className:"mx-auto max-w-4xl px-5 pt-12 pb-20",children:[e.header&&(0,a.jsx)("h1",{className:"text-foreground mb-8 text-3xl",children:e.header}),(0,a.jsx)("div",{className:"space-y-20",children:e.children})]})}var l=n(30877),i=n(39097),r=n.n(i),o=n(29071),c=n(86073),d=n(27792);let u=e=>{let{title:t,description:n,docsUrl:s,className:i}=e;return(0,a.jsxs)("div",{className:"mb-6 flex items-center justify-between ".concat(i),children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("h3",{className:"text-foreground text-xl",children:(0,a.jsx)(o.D,{unwrapDisallowed:!0,disallowedElements:["p"],children:t})}),n&&(0,a.jsx)(c.U,{content:n,className:"max-w-full"})]}),void 0!==s&&(0,a.jsx)(d.z,{asChild:!0,type:"default",icon:(0,a.jsx)(l.Z,{size:14}),children:(0,a.jsx)(r(),{href:s,target:"_blank",rel:"noreferrer",children:"Documentation"})})]})};var m=n(2784);let h=e=>{let{children:t,id:n,header:s,disabled:l,className:i}=e;return(0,a.jsxs)("div",{id:n,className:["grid grid-cols-12 gap-6 px-8 py-8","".concat(l?" opacity-30":" opacity-100"),"".concat(i)].join(" "),children:[s,t]})},x=e=>{let{children:t,className:n="",description:s}=e;return void 0!==s?(0,a.jsxs)("div",{className:"flex flex-col space-y-2 col-span-12 lg:col-span-5 ".concat(n),children:[(0,a.jsx)("label",{className:"text-foreground text-sm",children:t}),s]}):(0,a.jsx)("label",{className:"text-foreground col-span-12 text-sm lg:col-span-5 ".concat(n),children:t})},p=()=>(0,a.jsxs)("div",{className:"flex w-full flex-col gap-2",children:[(0,a.jsx)("div",{className:"shimmering-loader h-2 w-1/3 rounded"}),(0,a.jsx)("div",{className:"flex flex-col justify-between space-y-2",children:(0,a.jsx)("div",{className:"shimmering-loader h-[34px] w-2/3 rounded"})})]}),f=e=>{let{children:t,loading:n=!0,fullWidth:s,className:l}=e;return(0,a.jsx)("div",{className:"\n        relative col-span-12 flex flex-col gap-6 lg:col-span-7\n        ".concat(s&&"!col-span-12","\n        ").concat(l,"\n      "),children:n?m.Children.map(t,()=>(0,a.jsx)(p,{})):t})},g=e=>{let{children:t,header:n,footer:s}=e;return(0,a.jsxs)("div",{className:" bg-surface-100 border-default overflow-hidden  rounded-md border shadow",children:[n&&(0,a.jsx)("div",{className:"border-default border-b px-8 py-4",children:n}),(0,a.jsx)("div",{className:"divide-border flex flex-col gap-0 divide-y",children:t}),s&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"border-default border-t"}),s]})]})},j=e=>{let{form:t,hasChanges:n,handleReset:s,helper:l,disabled:i=!1,isSubmitting:r,submitText:o="Save"}=e,c=r||i||!n&&void 0!==n;return(0,a.jsxs)("div",{className:["flex w-full items-center gap-2",l?"justify-between":"justify-end"].join(" "),children:[l&&(0,a.jsx)("span",{className:"text-sm text-foreground-lighter",children:l}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(d.z,{disabled:c,type:"default",htmlType:"reset",onClick:()=>s(),children:"Cancel"}),(0,a.jsx)(d.z,{form:t,type:"primary",htmlType:"submit",disabled:c,loading:r,children:o})]})]})}},47203:function(e,t,n){"use strict";var a=n(52322),s=n(98938);t.Z=e=>{let{resourceText:t,isFullPage:n=!1}=e,l=()=>(0,a.jsx)("div",{className:"block w-full rounded border border-opacity-20 py-4 px-6 border-overlay bg-surface-200",children:(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)(s.Z,{size:"large"})}),(0,a.jsx)("div",{className:"flex w-full items-center justify-between",children:(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("p",{className:"text-sm",children:["You need additional permissions to ",t]}),(0,a.jsx)("div",{children:(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Contact your organization owner or adminstrator for assistance."})})]})})]})});return n?(0,a.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,a.jsx)("div",{className:"w-[550px]",children:(0,a.jsx)(l,{})})}):(0,a.jsx)(l,{})}},88230:function(e,t,n){"use strict";var a=n(52322),s=n(12467),l=n(27792);t.Z=e=>{let{searchString:t,onResetFilter:n,className:i}=e;return(0,a.jsxs)("div",{className:(0,s.cn)("bg-surface-100 border border-default px-6 py-4 rounded flex items-center justify-between",i),children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',t,'" did not return any results']})]}),void 0!==n&&(0,a.jsx)(l.z,{type:"default",onClick:()=>n(),children:"Reset filter"})]})}},53071:function(e,t,n){"use strict";n.d(t,{Q:function(){return d}});var a=n(52322),s=n(72762),l=n(81733),i=n(39097),r=n.n(i),o=n(27792),c=e=>{let{name:t="",isActive:n,isExternal:i,icon:c,url:d="",target:u="_self",onClick:m,textClassName:h="",hoverText:x="",label:p}=e,f=(0,a.jsx)(s.ZP.Item,{icon:c,rounded:!0,active:n,onClick:m,children:(0,a.jsx)("div",{className:"flex w-full items-center justify-between gap-1",children:(0,a.jsxs)("div",{title:x||("string"==typeof t?t:""),className:"flex items-center gap-2 truncate w-full "+h,children:[(0,a.jsxs)("span",{className:"truncate",children:[t," "]}),void 0!==p&&(0,a.jsx)(l.C,{variant:"warning",children:p})]})})});return d?i?(0,a.jsx)(o.z,{asChild:!0,block:!0,className:"!justify-start",type:"text",size:"small",icon:c,children:(0,a.jsx)(r(),{href:d,target:"_blank",rel:"noreferrer",children:t})}):(0,a.jsx)(r(),{href:d,className:"block",target:u,children:f}):f},d=e=>{let{page:t,menu:n}=e;return(0,a.jsx)("div",{className:"flex flex-col space-y-8 overflow-y-auto",children:(0,a.jsx)(s.ZP,{type:"pills",children:n.map((e,i)=>(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"my-6 space-y-8",children:(0,a.jsxs)("div",{className:"mx-3",children:[(0,a.jsx)(s.ZP.Group,{title:e.title?(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsx)("span",{children:e.title}),e.isPreview&&(0,a.jsx)(l.C,{variant:"warning",children:"Not production ready"})]}):null}),(0,a.jsx)("div",{children:e.items.map(e=>(0,a.jsx)(c,{url:e.url,name:e.name,icon:e.icon,isActive:t===e.key,isExternal:e.isExternal,target:e.isExternal?"_blank":"_self",label:e.label},e.key))})]})}),i!==n.length-1&&(0,a.jsx)("div",{className:"h-px w-full bg-border-overlay"})]},e.key||e.title))})})}},1003:function(e,t,n){"use strict";var a=n(52322),s=n(46336),l=n(83030),i=n(34389),r=n(2784),o=n(83314),c=n(5341),d=n(27792),u=n(72860),m=n(26120),h=n(54511),x=n(80203);t.Z=e=>{let{className:t,disabled:n=!1,size:p="tiny",showError:f=!0,selectedSchemaName:g,supportSelectAll:j=!1,excludedSchemas:v=[],onSelectSchema:b,onSelectCreateSchema:y}=e,[N,w]=(0,r.useState)(!1),{project:_}=(0,o.d2)(),{data:C,isLoading:S,isSuccess:k,isError:E,error:Z,refetch:T}=(0,c.Q)({projectRef:null==_?void 0:_.ref,connectionString:null==_?void 0:_.connectionString}),R=(C||[]).filter(e=>!v.includes(e.name)).sort((e,t)=>e.name.localeCompare(t.name));return(0,a.jsxs)("div",{className:t,children:[S&&(0,a.jsx)(d.z,{type:"default",className:"justify-start",block:!0,size:p,loading:!0,children:"Loading schemas..."}),f&&E&&(0,a.jsxs)(u.bZ,{variant:"warning",className:"!px-3 !py-3",children:[(0,a.jsx)(u.Cd,{className:"text-xs text-amber-900",children:"Failed to load schemas"}),(0,a.jsxs)(u.X,{className:"text-xs mb-2 break-words",children:["Error: ",null==Z?void 0:Z.message]}),(0,a.jsx)(d.z,{type:"default",size:"tiny",onClick:()=>T(),children:"Reload schemas"})]}),k&&(0,a.jsxs)(m.J2,{open:N,onOpenChange:w,modal:!1,children:[(0,a.jsx)(m.xo,{asChild:!0,children:(0,a.jsx)(d.z,{size:p,disabled:n,type:"default",className:"w-full [&>span]:w-full",iconRight:(0,a.jsx)(s.Z,{className:"text-foreground-muted",strokeWidth:2,size:14}),children:(0,a.jsxs)("div",{className:"w-full flex gap-1",children:[(0,a.jsx)("p",{className:"text-foreground-lighter",children:"schema:"}),(0,a.jsx)("p",{className:"text-foreground",children:"*"===g?"All schemas":g})]})})}),(0,a.jsx)(m.yk,{className:"p-0",side:"bottom",align:"start",sameWidthAsTrigger:!0,children:(0,a.jsxs)(h.mY,{children:[(0,a.jsx)(h.sZ,{placeholder:"Find schema..."}),(0,a.jsxs)(h.e8,{children:[(0,a.jsx)(h.rb,{children:"No schemas found"}),(0,a.jsx)(h.fu,{children:(0,a.jsxs)(x.x,{className:(R||[]).length>7?"h-[210px]":"",children:[j&&(0,a.jsxs)(h.di,{className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{b("*"),w(!1)},onClick:()=>{b("*"),w(!1)},children:[(0,a.jsx)("span",{children:"All schemas"}),"*"===g&&(0,a.jsx)(l.Z,{className:"text-brand",strokeWidth:2,size:16})]},"select-all"),null==R?void 0:R.map(e=>(0,a.jsxs)(h.di,{className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{b(e.name),w(!1)},onClick:()=>{b(e.name),w(!1)},children:[(0,a.jsx)("span",{children:e.name}),g===e.name&&(0,a.jsx)(l.Z,{className:"text-brand",strokeWidth:2,size:16})]},e.id))]})}),void 0!==y&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.zz,{}),(0,a.jsx)(h.fu,{children:(0,a.jsxs)(h.di,{className:"cursor-pointer flex items-center gap-x-2 w-full",onSelect:()=>{y(),w(!1)},onClick:()=>{y(),w(!1)},children:[(0,a.jsx)(i.Z,{size:12}),"Create a new schema"]})})]})]})]})})]})]})}},87831:function(e,t,n){"use strict";var a=n(52322),s=n(6277);t.Z=e=>{let{max:t=100,value:n=0,barClass:l="bg-foreground",bgClass:i="",type:r="vertical",borderClass:o="",labelBottom:c="",labelBottomClass:d="tabular-nums",labelTop:u="",labelTopClass:m=""}=e;if("horizontal"===r){let e=Number(n/t*100),r=c||u;return(0,a.jsxs)("div",{className:"flex flex-col w-full",children:[r&&(0,a.jsxs)("div",{className:"flex align-baseline justify-between pb-1 space-x-8",children:[(0,a.jsx)("p",{className:(0,s.default)("text-foreground text-sm truncate capitalize-sentence",u.length>0&&"max-w-[75%]",d),children:c}),(0,a.jsx)("p",{className:(0,s.default)("text-foreground-light text-sm",m),children:u})]}),(0,a.jsx)("div",{className:"relative rounded h-1 overflow-hidden w-full border p-0 ".concat(i||"bg-surface-400"," ").concat(o||"border-none"),children:(0,a.jsx)("div",{className:"absolute rounded inset-x-0 bottom-0 h-1 ".concat(l," transition-all"),style:{width:"".concat(e,"%")}})})]})}{let e=Number(n/t*35);return e<2&&(e=2),(0,a.jsx)("div",{className:"relative rounded w-5 overflow-hidden border p-1 ".concat(i||"bg-gray-400"," ").concat(o||"border-none"),style:{height:35},children:(0,a.jsx)("div",{className:"absolute inset-x-0 bottom-0 w-5 ".concat(l),style:{height:e}})})}}},25321:function(e,t,n){"use strict";var a=n(52322),s=n(79534),l=n(34291),i=n.n(l),r=n(2784),o=n(83314),c=n(25346);t.Z=e=>{let{queryId:t,language:n="pgsql",defaultValue:l="",readOnly:d=!1,contextmenu:u=!0,onInputChange:m=i()}=e,h=(0,s.useMonaco)(),{project:x}=(0,o.d2)(),p=(0,r.useRef)();async function f(e){try{return await (0,c.x)({projectRef:null==x?void 0:x.ref,connectionString:null==x?void 0:x.connectionString,sql:e})}catch(t){return console.error("formatPgsql error:",t),e}}return(0,r.useEffect)(()=>{if(h){let e=h.languages.registerDocumentFormattingEditProvider("pgsql",{async provideDocumentFormattingEdits(e){let t=e.getValue(),n=await f(t);return[{range:e.getFullModelRange(),text:n}]}});return()=>{e.dispose()}}},[h]),(0,r.useEffect)(()=>{if(p.current){var e;null===(e=p.current)||void 0===e||e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})})}},[t]),(0,a.jsx)(s.default,{className:"monaco-editor",theme:"supabase",defaultLanguage:n,defaultValue:l,path:t,loading:(0,a.jsx)(()=>(0,a.jsx)("h4",{className:"text-lg",children:"Loading"}),{}),options:{readOnly:d,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0,contextmenu:u},onMount:(e,t)=>{p.current=e,e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})})},onChange:m})}},4084:function(e,t,n){"use strict";var a=n(52322),s=n(5632),l=n(37107);t.Z=e=>{let{message:t}=e,n=(0,s.useRouter)(),{ref:i}=n.query;return(0,a.jsx)(l.Z,{title:"No public tables found",ctaButtonLabel:"Create a new table",onClickCta:()=>{n.push("/project/".concat(i,"/editor"))},children:(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:t})})}},10586:function(e,t,n){"use strict";n.d(t,{q:function(){return l}});var a=n(52322),s=n(87831);let l=e=>{let{progress:t,message:n,description:l}=e;return(0,a.jsxs)("div",{className:"flex flex-col space-y-2",style:{minWidth:"220px"},children:[(0,a.jsx)(s.Z,{value:t,max:100,type:"horizontal",barClass:"bg-brand",labelBottom:n,labelTop:"".concat(t.toFixed(2),"%"),labelTopClass:"tabular-nums"}),void 0!==l&&(0,a.jsx)("p",{className:"text-xs text-foreground-light",children:l})]})}},56009:function(e,t,n){"use strict";var a=n(52322),s=n(6277);t.Z=e=>{let{options:t,width:n=50,activeOption:l,onClickOption:i,borderOverride:r="border-stronger"}=e,o=e=>"absolute top-0 z-1 text-xs inline-flex h-full items-center justify-center font-medium\n    ".concat(e?"hover:text-foreground-light hover:text-foreground":"hover:text-foreground"," hover:text-foreground focus:z-10 focus:outline-none focus:border-blue-300 focus:ring-blue\n    transition ease-in-out duration-150");return(0,a.jsxs)("div",{className:"relative border ".concat(r," rounded-md h-7"),style:{padding:1,width:(n+1)*2},children:[(0,a.jsx)("span",{style:{width:n,translate:l===t[1]?"0px":"".concat(n-2,"px")},"aria-hidden":"true",className:(0,s.default)("z-0 inline-block rounded h-full bg-overlay-hover shadow transform","transition-all ease-in-out border border-strong")}),t.map((e,t)=>(0,a.jsx)("span",{style:{width:n+1},className:"\n              ".concat(l===e?"text-foreground":"text-foreground-light","\n              ").concat(0===t?"right-0":"left-0","\n              ").concat(o(l===e),"\n              cursor-pointer\n            "),onClick:()=>i(e),children:(0,a.jsx)("span",{className:(0,s.default)("capitalize hover:text-foreground",l===e?"text-foreground":"text-foreground-light"),children:e})},"toggle_".concat(t)))]})}},48577:function(e,t,n){"use strict";var a=n(52322),s=n(24990),l=n(59491),i=n(39097),r=n.n(i),o=n(27792),c=n(13096),d=n(4646);t.Z=e=>{var t;let{icon:n,primaryText:i,projectRef:u,organizationSlug:m,secondaryText:h,addon:x,buttonText:p,disabled:f=!1}=e,{data:g}=(0,d.G)({orgSlug:m}),j=null==g?void 0:null===(t=g.plan)||void 0===t?void 0:t.id,v=(0,c.Xo)(l.KA.BILLING_WRITE,"stripe.subscriptions"),b=(0,c.P5)("disableProjectCreationAndUpdate");return(0,a.jsx)("div",{className:"block w-full rounded border border-opacity-20 py-4 px-6 border-overlay bg-surface-200",children:(0,a.jsxs)("div",{className:"flex space-x-3",children:[n&&(0,a.jsx)("div",{className:"mt-1",children:n}),(0,a.jsxs)("div",{className:"flex w-full items-center justify-between space-x-32",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-sm",children:i}),(0,a.jsx)("div",{children:(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:h})})]}),(0,a.jsxs)(s.fC,{delayDuration:0,children:[(0,a.jsx)(s.xz,{asChild:!0,children:(0,a.jsx)(o.z,{type:"primary",disabled:!v||b||f,asChild:!0,children:(0,a.jsx)(r(),{href:"free"===j?"/org/".concat(null!=m?m:"_","/billing?panel=subscriptionPlan"):"/project/".concat(null!=u?u:"_","/settings/addons?panel=").concat(x),children:p||("free"===j?"Upgrade to Pro":"Enable Addon")})})}),!v||b&&(0,a.jsx)(s.h_,{children:(0,a.jsxs)(s.VY,{side:"bottom",children:[(0,a.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,a.jsx)("div",{className:"border border-background text-center rounded bg-alternative py-1 px-2 leading-none shadow",children:(0,a.jsx)("span",{className:"text-xs text-foreground",children:b?(0,a.jsxs)(a.Fragment,{children:["Subscription changes are currently disabled.",(0,a.jsx)("br",{}),"Our engineers are working on a fix."]}):v?"":"You need additional permissions to amend subscriptions"})})]})})]})]})]})})}},54738:function(e,t,n){"use strict";n.d(t,{g:function(){return o}});var a=n(48228),s=n(62202),l=n(71436),i=n(76626);async function r(e){let{sql:t}=e,n=await (0,l.v_)(i.GW+"/api/ai/sql/title",{sql:t});if(!(0,l.d8)(n))throw n.error;return n}let o=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,a.D)(e=>r(e),{async onSuccess(t,n,a){await (null==e?void 0:e(t,n,a))},async onError(e,n,a){void 0===t?s.ZP.error("Failed to generate title: ".concat(e.message)):t(e,n,a)},...n})}},36322:function(e,t,n){"use strict";n.d(t,{$E:function(){return c},h8:function(){return o},kM:function(){return d}});var a=n(36492),s=n(85945),l=n(49422),i=n(2784),r=n(79916);async function o(e,t){let{projectRef:n}=e;if(!n)throw Error("projectRef is required");let{data:a,error:s}=await (0,l.U2)("/platform/auth/{ref}/config",{params:{path:{ref:n}},signal:t});if(s)throw(0,l.S3)(s);return a}let c=function(e){let{projectRef:t}=e,{enabled:n=!0,...s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.a)(r.o.authConfig(t),e=>{let{signal:n}=e;return o({projectRef:t},n)},{enabled:n&&void 0!==t,...s})},d=e=>{let{projectRef:t}=e,n=(0,s.NL)();return(0,i.useCallback)(()=>{t&&n.prefetchQuery(r.o.authConfig(t),e=>{let{signal:n}=e;return o({projectRef:t},n)})},[n,t])}},79916:function(e,t,n){"use strict";n.d(t,{o:function(){return a}});let a={users:(e,t)=>["auth",e,"users",...t?[t]:[]],authConfig:e=>["auth",e,"config"],accessToken:()=>["access-token"]}},81650:function(e,t,n){"use strict";n.d(t,{RT:function(){return i},xY:function(){return o}});var a=n(36492),s=n(49422),l=n(79916);let i=10;async function r(e,t){let{projectRef:n,page:a=1,keywords:l="",verified:r}=e;if(!n)throw Error("Project ref is required");let o={limit:i.toString(),offset:((a-1)*10).toString(),keywords:l};r&&(o.verified=r);let{data:c,error:d}=await (0,s.U2)("/platform/auth/{ref}/users",{params:{path:{ref:n},query:o},signal:t});if(d)throw(0,s.S3)(d);return c}let o=function(e){let{projectRef:t,page:n,keywords:s,verified:i}=e,{enabled:o=!0,...c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.a)(l.o.users(t,{page:n,keywords:s,verified:i}),e=>{let{signal:a}=e;return r({projectRef:t,page:n,keywords:s,verified:i},a)},{enabled:o&&void 0!==t,...c})}},49336:function(e,t,n){"use strict";n.d(t,{k:function(){return o}});var a=n(36492),s=n(71436),l=n(76626),i=n(71824);async function r(e,t){let{projectRef:n}=e;if(!n)throw Error("projectRef is required");let a=await (0,s.U2)("".concat(l.T5,"/projects/").concat(n,"/config/storage"),{signal:t});if(a.error)throw a.error;return a}let o=function(e){let{projectRef:t}=e,{enabled:n=!0,...s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.a)(i.U.storage(t),e=>{let{signal:n}=e;return r({projectRef:t},n)},{enabled:n&&void 0!==t,...s})}},16581:function(e,t,n){"use strict";n.d(t,{T:function(){return c}});var a=n(85945),s=n(48228),l=n(62202),i=n(49422),r=n(48973);async function o(e,t){let{projectRef:n,payload:a}=e,{data:s,error:l}=await (0,i.v_)("/platform/projects/{ref}/content",{params:{path:{ref:n}},body:{id:a.id,name:a.name,description:a.description,owner_id:a.owner_id,type:a.type,visibility:a.visibility,content:a.content},signal:t});if(l)throw l;return s}let c=function(){let{onError:e,onSuccess:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,a.NL)();return(0,s.D)(e=>o(e),{async onSuccess(e,n,a){let{projectRef:s}=n;await i.invalidateQueries(r.$.list(s)),await (null==t?void 0:t(e,n,a))},async onError(t,n,a){void 0===e?l.ZP.error("Failed to insert content: ".concat(t.message)):e(t,n,a)},...n})}},52718:function(e,t,n){"use strict";n.d(t,{I1:function(){return o}});var a=n(36492),s=n(71436),l=n(76626);n(2784);var i=n(48973);async function r(e,t){if(void 0===e)throw Error("projectRef is required for getContent");let n=await (0,s.U2)("".concat(l.T5,"/projects/").concat(e,"/content"),{signal:t});if(n.error)throw n.error;if(!n)throw Error("Content not found");return{content:n.data}}let o=function(e){let{enabled:t=!0,...n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.a)(i.$.list(e),t=>{let{signal:n}=t;return r(e,n)},{enabled:t&&void 0!==e,...n})}},44109:function(e,t,n){"use strict";n.d(t,{p:function(){return u},v:function(){return m}});var a=n(85945),s=n(48228),l=n(62202),i=n(49422),r=n(69786),o=n(66694),c=n(35618),d=n(5392);async function u(e){let{projectRef:t,connectionString:n,id:a,cascade:s=!1}=e,l=new Headers;n&&l.set("x-connection-encrypted",n);let{data:r,error:o}=await (0,i.IV)("/platform/pg-meta/{ref}/columns",{params:{header:{"x-connection-encrypted":n},path:{ref:t},query:{id:a,cascade:s.toString()}},headers:l});if(o)throw o;return r}let m=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,a.NL)();return(0,s.D)(e=>u(e),{async onSuccess(t,n,a){let{projectRef:s,table:l}=n;await Promise.all([i.invalidateQueries(r.M.query(s,["foreign-key-constraints"])),i.invalidateQueries(o.C.list(s)),...void 0!==l?[i.invalidateQueries(c.W.table(s,l.id)),i.invalidateQueries(r.M.query(s,[l.schema,l.name])),i.invalidateQueries(r.M.query(s,["table-definition",l.schema,l.name])),i.invalidateQueries(d.N.listBySchema(s,l.schema)),i.invalidateQueries(d.N.view(s,l.id))]:[]]),await (null==e?void 0:e(t,n,a))},async onError(e,n,a){void 0===t?l.Am.error("Failed to delete database column: ".concat(e.message)):t(e,n,a)},...n})}},22092:function(e,t,n){"use strict";n.d(t,{k:function(){return d}});var a=n(85945),s=n(48228),l=n(62202),i=n(49422),r=n(99172),o=n(58686);async function c(e){let{projectRef:t,connectionString:n,schema:a,name:s,version:l,cascade:r=!1,createSchema:c=!1}=e,d=new Headers;if(n&&d.set("x-connection-encrypted",n),c)try{await (0,o.Rj)({projectRef:t,connectionString:n,sql:"create schema if not exists ".concat(a)})}catch(e){throw e}let{data:u,error:m}=await (0,i.v_)("/platform/pg-meta/{ref}/extensions",{params:{header:{"x-connection-encrypted":n},path:{ref:t}},body:{schema:a,name:s,version:l,cascade:r},headers:d});if(m)throw m;return u}let d=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,a.NL)();return(0,s.D)(e=>c(e),{async onSuccess(t,n,a){let{projectRef:s}=n;await i.invalidateQueries(r.o.list(s)),await (null==e?void 0:e(t,n,a))},async onError(e,n,a){void 0===t?l.Am.error("Failed to enable database extension: ".concat(e.message)):t(e,n,a)},...n})}},73883:function(e,t,n){"use strict";n.d(t,{H:function(){return r}});var a=n(36492),s=n(49422),l=n(99172);async function i(e,t){let{projectRef:n,connectionString:a}=e;if(!n)throw Error("projectRef is required");let l=new Headers;a&&l.set("x-connection-encrypted",a);let{data:i,error:r}=await (0,s.U2)("/platform/pg-meta/{ref}/extensions",{params:{header:{"x-connection-encrypted":a},path:{ref:n}},headers:l,signal:t});if(r)throw r;return i}let r=function(e){let{projectRef:t,connectionString:n}=e,{enabled:s=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.a)(l.o.list(t),e=>{let{signal:a}=e;return i({projectRef:t,connectionString:n},a)},{enabled:s&&void 0!==t,...r})}},99172:function(e,t,n){"use strict";n.d(t,{o:function(){return a}});let a={list:e=>["projects",e,"database-extensions"]}},87555:function(e,t,n){"use strict";n.d(t,{R:function(){return r}});var a=n(36492),s=n(49422),l=n(93221);async function i(e,t){let{projectRef:n,connectionString:a}=e;if(!n)throw Error("projectRef is required");let l=new Headers;a&&l.set("x-connection-encrypted",a);let{data:i,error:r}=await (0,s.U2)("/platform/pg-meta/{ref}/functions",{params:{path:{ref:n}},headers:l,signal:t});if(r)throw r;return i}let r=function(e){let{projectRef:t,connectionString:n}=e,{enabled:s=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.a)(l.l.list(t),e=>{let{signal:a}=e;return i({projectRef:t,connectionString:n},a)},{enabled:s&&void 0!==t,...r})}},93221:function(e,t,n){"use strict";n.d(t,{l:function(){return a}});let a={list:e=>["projects",e,"database-functions"]}},43449:function(e,t,n){"use strict";n.d(t,{r:function(){return r}});var a=n(36492),s=n(49422),l=n(33747);async function i(e,t){let{projectRef:n,connectionString:a,schema:l}=e;if(!n)throw Error("projectRef is required");let i=new Headers;a&&i.set("x-connection-encrypted",a);let{data:r,error:o}=await (0,s.U2)("/platform/pg-meta/{ref}/policies",{params:{header:{"x-connection-encrypted":a},path:{ref:n},query:{included_schemas:l||"",excluded_schemas:""}},headers:i,signal:t});if(o)throw o;return r}let r=function(e){let{projectRef:t,connectionString:n,schema:s}=e,{enabled:r=!0,...o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.a)(l.R.list(t,s),e=>{let{signal:a}=e;return i({projectRef:t,connectionString:n,schema:s},a)},{enabled:r&&void 0!==t,...o})}},43518:function(e,t,n){"use strict";n.d(t,{l:function(){return c}});var a=n(85945),s=n(48228),l=n(62202),i=n(49422),r=n(33747);async function o(e){let{projectRef:t,connectionString:n,id:a}=e,s=new Headers;n&&s.set("x-connection-encrypted",n);let{data:l,error:r}=await (0,i.IV)("/platform/pg-meta/{ref}/policies",{params:{header:{"x-connection-encrypted":n},path:{ref:t},query:{id:a}},headers:s});if(r)throw r;return l}let c=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,a.NL)();return(0,s.D)(e=>o(e),{async onSuccess(t,n,a){let{projectRef:s}=n;await i.invalidateQueries(r.R.list(s)),await (null==e?void 0:e(t,n,a))},async onError(e,n,a){void 0===t?l.Am.error("Failed to delete database policy: ".concat(e.message)):t(e,n,a)},...n})}},9782:function(e,t,n){"use strict";n.d(t,{k:function(){return c}});var a=n(85945),s=n(48228),l=n(62202),i=n(49422),r=n(33747);async function o(e){let{projectRef:t,connectionString:n,id:a,payload:s}=e,l=new Headers;n&&l.set("x-connection-encrypted",n);let{data:r,error:o}=await (0,i.r$)("/platform/pg-meta/{ref}/policies",{params:{header:{"x-connection-encrypted":n},path:{ref:t},query:{id:a}},body:s,headers:l});if(o)throw o;return r}let c=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,a.NL)();return(0,s.D)(e=>o(e),{async onSuccess(t,n,a){let{projectRef:s}=n;await i.invalidateQueries(r.R.list(s)),await (null==e?void 0:e(t,n,a))},async onError(e,n,a){void 0===t?l.Am.error("Failed to update database policy: ".concat(e.message)):t(e,n,a)},...n})}},33747:function(e,t,n){"use strict";n.d(t,{R:function(){return a}});let a={list:(e,t)=>["projects",e,"database-policies",t]}},985:function(e,t,n){"use strict";n.d(t,{z:function(){return r}});var a=n(36492),s=n(49422),l=n(78464);async function i(e,t){let{projectRef:n,connectionString:a}=e;if(!n)throw Error("projectRef is required");let l=new Headers;a&&l.set("x-connection-encrypted",a);let{data:i,error:r}=await (0,s.U2)("/platform/pg-meta/{ref}/publications",{params:{header:{"x-connection-encrypted":a},path:{ref:n}},headers:l,signal:t});if(r)throw r;return i}let r=function(e){let{projectRef:t,connectionString:n}=e,{enabled:s=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.a)(l.z.list(t),e=>{let{signal:a}=e;return i({projectRef:t,connectionString:n},a)},{enabled:s&&void 0!==t,...r})}},25808:function(e,t,n){"use strict";n.d(t,{u:function(){return c}});var a=n(85945),s=n(48228),l=n(62202),i=n(49422),r=n(78464);async function o(e){let{projectRef:t,connectionString:n,id:a,tables:s,publish_insert:l,publish_update:r,publish_delete:o,publish_truncate:c}=e,d=new Headers;n&&d.set("x-connection-encrypted",n);let u={id:a};void 0!==s&&(u.tables=s),void 0!==l&&(u.publish_insert=l),void 0!==r&&(u.publish_update=r),void 0!==o&&(u.publish_delete=o),void 0!==c&&(u.publish_truncate=c);let{data:m,error:h}=await (0,i.r$)("/platform/pg-meta/{ref}/publications",{params:{header:{"x-connection-encrypted":n},path:{ref:t},query:{id:a}},body:u,headers:d});if(h)throw h;return m}let c=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,a.NL)();return(0,s.D)(e=>o(e),{async onSuccess(t,n,a){let{projectRef:s}=n;await i.invalidateQueries(r.z.list(s)),await (null==e?void 0:e(t,n,a))},async onError(e,n,a){void 0===t?l.Am.error("Failed to update database publication: ".concat(e.message)):t(e,n,a)},...n})}},78464:function(e,t,n){"use strict";n.d(t,{z:function(){return a}});let a={list:e=>["projects",e,"database-publications"]}},55895:function(e,t,n){"use strict";n.d(t,{x:function(){return r}});var a=n(36492),s=n(49422),l=n(7686);async function i(e,t){let{projectRef:n,connectionString:a}=e;if(!n)throw Error("projectRef is required");let l=new Headers;a&&l.set("x-connection-encrypted",a);let{data:i,error:r}=await (0,s.U2)("/platform/pg-meta/{ref}/roles",{params:{header:{"x-connection-encrypted":a},path:{ref:n}},headers:l,signal:t});if(r)throw r;return i}let r=function(e){let{projectRef:t,connectionString:n}=e,{enabled:s=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.a)(l.i.list(t),e=>{let{signal:a}=e;return i({projectRef:t,connectionString:n},a)},{enabled:s&&void 0!==t,...r})}},7686:function(e,t,n){"use strict";n.d(t,{i:function(){return a}});let a={list:e=>["projects",e,"database-roles"]}},63936:function(e,t,n){"use strict";n.d(t,{x:function(){return d}});var a=n(85945),s=n(48228),l=n(62202),i=n(71436),r=n(76626),o=n(71970);async function c(e){let{projectRef:t,connectionString:n,payload:a}=e,s=new Headers;n&&s.set("x-connection-encrypted",n);let l=await (0,i.v_)("".concat(r.T5,"/pg-meta/").concat(t,"/triggers"),a,{headers:Object.fromEntries(s)});if(l.error)throw l.error;return l}let d=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,a.NL)();return(0,s.D)(e=>c(e),{async onSuccess(t,n,a){let{projectRef:s}=n;await i.invalidateQueries(o.D.list(s)),await (null==e?void 0:e(t,n,a))},async onError(e,n,a){void 0===t?l.Am.error("Failed to create database trigger: ".concat(e.message)):t(e,n,a)},...n})}},77889:function(e,t,n){"use strict";n.d(t,{m:function(){return d}});var a=n(62202),s=n(85945),l=n(48228),i=n(71436),r=n(76626),o=n(71970);async function c(e){let{id:t,projectRef:n,connectionString:a}=e,s=new Headers;a&&s.set("x-connection-encrypted",a);let l=await (0,i.$v)("".concat(r.T5,"/pg-meta/").concat(n,"/triggers?id=").concat(t),void 0,{headers:Object.fromEntries(s)});if(null==l?void 0:l.error)throw l.error;return l}let d=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,s.NL)();return(0,l.D)(e=>c(e),{async onSuccess(t,n,a){let{projectRef:s}=n;await i.invalidateQueries(o.D.list(s)),await (null==e?void 0:e(t,n,a))},async onError(e,n,s){void 0===t?a.Am.error("Failed to delete database trigger: ".concat(e.message)):t(e,n,s)},...n})}},71970:function(e,t,n){"use strict";n.d(t,{D:function(){return a}});let a={list:e=>["projects",e,"database-triggers"],resource:(e,t)=>["projects",e,"resources",t]}},45105:function(e,t,n){"use strict";n.d(t,{T:function(){return r}});var a=n(36492),s=n(49422),l=n(96331);async function i(e,t){let{projectRef:n}=e;if(!n)throw Error("Project ref is required");let{data:a,error:l}=await (0,s.U2)("/platform/database/{ref}/backups",{params:{path:{ref:n}},signal:t});if(l)throw l;return a}let r=function(e){let{projectRef:t}=e,{enabled:n=!0,...s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.a)(l.A.backups(t),e=>{let{signal:n}=e;return i({projectRef:t},n)},{enabled:n&&void 0!==t,...s})}},33063:function(e,t,n){"use strict";n.d(t,{X:function(){return l}});var a=n(58686);let s=e=>{let{schema:t}=e;return"\nSELECT \n  con.oid as id, \n  con.conname as constraint_name, \n  con.confdeltype as deletion_action,\n  con.confupdtype as update_action,\n  rel.oid as source_id,\n  nsp.nspname as source_schema, \n  rel.relname as source_table, \n  (\n    SELECT \n      array_agg(\n        att.attname \n        ORDER BY \n          un.ord\n      ) \n    FROM \n      unnest(con.conkey) WITH ORDINALITY un (attnum, ord) \n      INNER JOIN pg_attribute att ON att.attnum = un.attnum \n    WHERE \n      att.attrelid = rel.oid\n  ) source_columns, \n  frel.oid as target_id,\n  fnsp.nspname as target_schema, \n  frel.relname as target_table, \n  (\n    SELECT \n      array_agg(\n        att.attname \n        ORDER BY \n          un.ord\n      ) \n    FROM \n      unnest(con.confkey) WITH ORDINALITY un (attnum, ord) \n      INNER JOIN pg_attribute att ON att.attnum = un.attnum \n    WHERE \n      att.attrelid = frel.oid\n  ) target_columns \nFROM \n  pg_constraint con \n  INNER JOIN pg_class rel ON rel.oid = con.conrelid \n  INNER JOIN pg_namespace nsp ON nsp.oid = rel.relnamespace \n  INNER JOIN pg_class frel ON frel.oid = con.confrelid \n  INNER JOIN pg_namespace fnsp ON fnsp.oid = frel.relnamespace \nWHERE \n  con.contype = 'f'\n  ".concat(void 0!==t?"AND nsp.nspname = '".concat(t,"'"):"",";\n").trim()},l=function(e){let{projectRef:t,connectionString:n,schema:l}=e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.cp)({projectRef:t,connectionString:n,sql:s({schema:l}),queryKey:["foreign-key-constraints"]},{select(e){var t;return(null!==(t=null==e?void 0:e.result)&&void 0!==t?t:[]).map(e=>({...e,source_columns:e.source_columns.replace("{","").replace("}","").split(","),target_columns:e.target_columns.replace("{","").replace("}","").split(",")}))},...i})}},38799:function(e,t,n){"use strict";n.d(t,{E:function(){return l}});var a=n(58686);let s=()=>"show max_connections",l=function(e){let{projectRef:t,connectionString:n}=e,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.cp)({projectRef:t,connectionString:n,sql:s(),queryKey:["max-connections"]},{select:e=>({maxConnections:parseInt(e.result[0].max_connections)}),...l})}},5341:function(e,t,n){"use strict";n.d(t,{X:function(){return x},Q:function(){return h}});var a=n(35538);let s=["information_schema","pg_catalog","pg_toast"],l="\n-- Adapted from information_schema.schemata\n\nselect\n  n.oid::int8 as id,\n  n.nspname as name,\n  u.rolname as owner\nfrom\n  pg_namespace n,\n  pg_roles u\nwhere\n  n.nspowner = u.oid\n  and (\n    pg_has_role(n.nspowner, 'USAGE')\n    or has_schema_privilege(n.oid, 'CREATE, USAGE')\n  )\n  and not pg_catalog.starts_with(n.nspname, 'pg_temp_')\n  and not pg_catalog.starts_with(n.nspname, 'pg_toast_temp_')\n";var i=n(30195);let r=i.z.object({id:i.z.number(),name:i.z.string(),owner:i.z.string()}),o=i.z.array(r),c=i.z.optional(r);var d=n(58686),u=n(96331);let m=({list:function(){let{includeSystemSchemas:e=!1,limit:t,offset:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=l;return e||(i="".concat(i," and not (n.nspname in (").concat(s.map(a.literal).join(","),"))")),t&&(i="".concat(i," limit ").concat(t)),n&&(i="".concat(i," offset ").concat(n)),{sql:i,zod:o}},retrieve:function(e){let{id:t,name:n}=e;return t?{sql:"".concat(l," and n.oid = ").concat((0,a.literal)(t),";"),zod:c}:{sql:"".concat(l," and n.nspname = ").concat((0,a.literal)(n),";"),zod:c}},create:function(e){let{name:t,owner:n}=e;return{sql:"create schema ".concat((0,a.ident)(t),"\n  ").concat(void 0===n?"":"authorization ".concat((0,a.ident)(n)),";\n")}},update:function(e,t){let{id:n,name:s}=e,{name:l,owner:i}=t;return{sql:"\ndo $$\ndeclare\n  id oid := ".concat(void 0===n?"".concat((0,a.literal)(s),"::regnamespace"):(0,a.literal)(n),";\n  old record;\n  new_name text := ").concat(void 0===l?null:(0,a.literal)(l),";\n  new_owner text := ").concat(void 0===i?null:(0,a.literal)(i),";\nbegin\n  select * into old from pg_namespace where oid = id;\n  if old is null then\n    raise exception 'Cannot find schema with id %', id;\n  end if;\n\n  if new_owner is not null then\n    execute(format('alter schema %I owner to %I;', old.nspname, new_owner));\n  end if;\n\n  -- Using the same name in the rename clause gives an error, so only do it if the new name is different.\n  if new_name is not null and new_name != old.nspname then\n    execute(format('alter schema %I rename to %I;', old.nspname, new_name));\n  end if;\nend\n$$;\n")}},remove:function(e){let{id:t,name:n}=e,{cascade:s=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{sql:"\ndo $$\ndeclare\n  id oid := ".concat(void 0===t?"".concat((0,a.literal)(n),"::regnamespace"):(0,a.literal)(t),";\n  old record;\n  cascade bool := ").concat((0,a.literal)(s),";\nbegin\n  select * into old from pg_namespace where oid = id;\n  if old is null then\n    raise exception 'Cannot find schema with id %', id;\n  end if;\n\n  execute(format('drop schema %I %s;', old.nspname, case when cascade then 'cascade' else 'restrict' end));\nend\n$$;\n")}},zod:r}).list(),h=function(e){let{projectRef:t,connectionString:n}=e,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,d.cp)({projectRef:t,connectionString:n,sql:m.sql,queryKey:["schemas","list"]},{select:e=>e.result,...a})};function x(e,t){return e.invalidateQueries(u.A.schemaList(t))}},88719:function(e,t,n){"use strict";var a,s;n.d(t,{l:function(){return a}}),(s=a||(a={})).TABLE="r",s.VIEW="v",s.MATERIALIZED_VIEW="m",s.FOREIGN_TABLE="f",s.PARTITIONED_TABLE="p"},38161:function(e,t,n){"use strict";n.d(t,{H:function(){return r}});var a=n(59403),s=n(58686),l=n(66694);async function i(e,t){let{projectRef:n,connectionString:a,schema:l="public",search:i,limit:r=100,page:o=0,sort:c="alphabetical"}=e,d="\n    with records as (\n      select\n        c.oid::int8 as \"id\",\n        nc.nspname as \"schema\",\n        c.relname as \"name\",\n        c.relkind as \"type\",\n        case c.relkind\n          when 'r' then 1\n          when 'v' then 2\n          when 'm' then 3\n          when 'f' then 4\n          when 'p' then 5\n        end as \"type_sort\",\n        obj_description(c.oid) as \"comment\",\n        count(*) over() as \"count\",\n        c.relrowsecurity as \"rls_enabled\"\n      from\n        pg_namespace nc\n        join pg_class c on nc.oid = c.relnamespace\n      where\n        c.relkind in ('r', 'v', 'm', 'f', 'p')\n        and not pg_is_other_temp_schema(nc.oid)\n        and (\n          pg_has_role(c.relowner, 'USAGE')\n          or has_table_privilege(\n            c.oid,\n            'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER'\n          )\n          or has_any_column_privilege(c.oid, 'SELECT, INSERT, UPDATE, REFERENCES')\n        )\n        and nc.nspname = '".concat(l,"'\n        ").concat(i?"and c.relname ilike '%".concat(i,"%'"):"","\n      order by ").concat("alphabetical"===c?"c.relname asc":'"type_sort" asc, c.relname asc',"\n      limit ").concat(r,"\n      offset ").concat(o*r,"\n    )\n    select\n      jsonb_build_object(\n        'entities', coalesce(jsonb_agg(\n          jsonb_build_object(\n            'id', r.id,\n            'schema', r.schema,\n            'name', r.name,\n            'type', r.type,\n            'comment', r.comment,\n            'rls_enabled', r.rls_enabled\n          )\n          order by ").concat("alphabetical"===c?"r.name asc":"r.type_sort asc, r.name asc","\n        ), '[]'::jsonb),\n        'count', coalesce(min(r.count), 0)\n      ) \"data\"\n    from records r;\n  "),{result:u}=await (0,s.Rj)({projectRef:n,connectionString:a,sql:d,queryKey:["public","entity-types"]},t);return u[0]}let r=function(e){let{projectRef:t,connectionString:n,schema:s="public",search:r,limit:o=100,sort:c}=e,{enabled:d=!0,...u}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.N)(l.C.list(t,{schema:s,search:r,sort:c,limit:o}),e=>{let{signal:a,pageParam:l}=e;return i({projectRef:t,connectionString:n,schema:s,search:r,limit:o,page:l,sort:c},a)},{enabled:d&&void 0!==t,staleTime:0,getNextPageParam(e,t){let n=t.length;if(!(n*o>=e.data.count))return n},...u})}},66694:function(e,t,n){"use strict";n.d(t,{C:function(){return a}});let a={list:(e,t)=>["projects",e,"entity-types",...t?[t]:[]]}},6931:function(e,t,n){"use strict";n.d(t,{k:function(){return r}});var a=n(36492),s=n(49422),l=n(7340);async function i(e,t){let{projectRef:n,connectionString:a}=e;if(!n)throw Error("projectRef is required");let l=new Headers;a&&l.set("x-connection-encrypted",a);let{data:i,error:r}=await (0,s.U2)("/platform/pg-meta/{ref}/types",{params:{header:{"x-connection-encrypted":a},path:{ref:n}},headers:Object.fromEntries(l),signal:t});return r&&(0,s.S3)(r),i.filter(e=>e.enums.length>0)}let r=function(e){let{projectRef:t,connectionString:n}=e,{enabled:s=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.a)(l.P.list(t),e=>{let{signal:a}=e;return i({projectRef:t,connectionString:n},a)},{enabled:s&&void 0!==t,staleTime:0,...r})}},7340:function(e,t,n){"use strict";n.d(t,{P:function(){return a}});let a={list:e=>["projects",e,"enumerated-types"]}},47220:function(e,t,n){"use strict";n.d(t,{y:function(){return l}});var a=n(58686);let s=()=>"\n    select\n      s.oid as \"id\",\n      w.fdwname as \"name\",\n      s.srvname as \"server_name\",\n      s.srvoptions as \"server_options\",\n      c.proname as \"handler\",\n      (\n        select jsonb_agg(\n          jsonb_build_object(\n            'id', c.oid::bigint,\n            'schema', relnamespace::regnamespace::text,\n            'name', c.relname,\n            'columns', (\n              select jsonb_agg(\n                jsonb_build_object(\n                  'name', a.attname,\n                  'type', pg_catalog.format_type(a.atttypid, a.atttypmod)\n                )\n              )\n              from pg_catalog.pg_attribute a\n              where a.attrelid = c.oid and a.attnum > 0 and not a.attisdropped\n            ),\n            'options', t.ftoptions\n          )\n        )\n        from pg_catalog.pg_class c\n        join pg_catalog.pg_foreign_table t on c.oid = t.ftrelid\n        where c.oid = any (select t.ftrelid from pg_catalog.pg_foreign_table t where t.ftserver = s.oid)\n      ) as \"tables\"\n    from pg_catalog.pg_foreign_server s\n    join pg_catalog.pg_foreign_data_wrapper w on s.srvfdw = w.oid\n    join pg_catalog.pg_proc c on w.fdwhandler = c.oid;\n  ",l=function(e){let{projectRef:t,connectionString:n}=e,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.cp)({projectRef:t,connectionString:n,sql:s(),queryKey:["fdws"]},l)}},20676:function(e,t,n){"use strict";n.d(t,{H:function(){return a}});let a={list:e=>["projects",e,"pg-sodium-keys"]}},25346:function(e,t,n){"use strict";n.d(t,{X:function(){return r},x:function(){return i}});var a=n(48228),s=n(71436),l=n(76626);async function i(e,t){let{projectRef:n,connectionString:a,sql:i}=e,r=new Headers;a&&r.set("x-connection-encrypted",a);let o=await (0,s.v_)("".concat(l.T5,"/pg-meta/").concat(n,"/query/format"),{query:i},{headers:Object.fromEntries(r),signal:t});if(o.error)throw o.error;return{result:o}}let r=function(){let{onSuccess:e,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,a.D)(e=>i(e),{async onSuccess(t,n,a){await (null==e?void 0:e(t,n,a))},...t})}},94077:function(e,t,n){"use strict";n.d(t,{H:function(){return c}});var a=n(25424),s=n(64308),l=n(50412),i=n(58686),r=n(28434);let o=e=>{var t;let{table:n,filters:s=[]}=e,l=new a.AE;if(!n)return"";let i=l.from(n.name,null!==(t=n.schema)&&void 0!==t?t:void 0).count();return s.filter(e=>e.value&&""!=e.value).forEach(e=>{let t=(0,r.q)(n,e);i=i.filter(e.column,e.operator,t)}),i.toSql()},c=function(e){let{projectRef:t,connectionString:n,queryKey:a,table:r,impersonatedRole:c,...d}=e,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},m=(0,l.Zp)();return(0,i.cp)({projectRef:t,connectionString:n,sql:(0,s.Jh)(o({table:r,...d}),{projectRef:null!=t?t:"ref",role:c}),queryKey:[...null!=a?a:[],{table:{name:null==r?void 0:r.name,schema:null==r?void 0:r.schema},impersonatedRole:c,...d}],isRoleImpersonationEnabled:m},{select:e=>({count:e.result[0].count}),enabled:void 0!==t&&void 0!==r,...u})}},43712:function(e,t,n){"use strict";n.d(t,{wF:function(){return c},KK:function(){return u}});var a=n(24459),s=n(25424),l=n(64308),i=n(50412),r=n(58686),o=n(28434);let c=async e=>{var t;let{projectRef:n,connectionString:i,table:c,filters:d=[],sorts:u=[],impersonatedRole:m}=e;if(a.Qy&&!i)return console.error("Connection string is required"),[];let h=[],x=new s.AE().from(c.name,null!==(t=c.schema)&&void 0!==t?t:void 0).select();d.filter(e=>e.value&&""!==e.value).forEach(e=>{let t=(0,o.q)(c,e);x=x.filter(e.column,e.operator,t)}),u.forEach(e=>{x=x.order(e.column,e.ascending,e.nullsFirst)});let p=-1,f=0,g=0,j=[];return await (async()=>{do{p+=1,f=500*p,g=(p+1)*500-1;let e=(0,l.Jh)(x.range(f,g).toSql(),{projectRef:n,role:m});try{let{result:t}=await (0,r.Rj)({projectRef:n,connectionString:i,sql:e});h.push(...t),j=t}catch(e){return{data:{rows:[]}}}}while(500===j.length)})(),h.filter(e=>1!==e[l.$y])},d=e=>{var t,n;let{table:a,filters:l=[],sorts:i=[],page:r,limit:c}=e,d=new s.AE;if(!a)return"";let u=a.columns.filter(e=>{var t;return(null!==(t=null==e?void 0:e.enum)&&void 0!==t?t:[]).length>0&&"array"===e.dataType.toLowerCase()}).map(e=>e.name),m=u.length>0?d.from(a.name,null!==(t=a.schema)&&void 0!==t?t:void 0).select("*,".concat(u.map(e=>'"'.concat(e,'"::text[]')).join(","))):d.from(a.name,null!==(n=a.schema)&&void 0!==n?n:void 0).select();l.filter(e=>e.value&&""!=e.value).forEach(e=>{let t=(0,o.q)(a,e);m=m.filter(e.column,e.operator,t)}),i.forEach(e=>{m=m.order(e.column,e.ascending,e.nullsFirst)});let{from:h,to:x}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=e?e*t:0;return{from:n,to:e?n+t-1:t-1}}((null!=r?r:1)-1,c);return m.range(h,x).toSql()},u=function(e){let{projectRef:t,connectionString:n,queryKey:a,table:s,impersonatedRole:o,...c}=e,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},m=(0,i.Zp)();return(0,r.cp)({projectRef:t,connectionString:n,sql:(0,l.Jh)(d({table:s,...c}),{projectRef:null!=t?t:"ref",role:o}),queryKey:[...null!=a?a:[],{table:{name:null==s?void 0:s.name,schema:null==s?void 0:s.schema},impersonatedRole:o,...c}],isRoleImpersonationEnabled:m},{select:e=>({rows:e.result.map((e,t)=>({idx:t,...e}))}),enabled:void 0!==t&&void 0!==s,...u})}},28434:function(e,t,n){"use strict";n.d(t,{h:function(){return i},q:function(){return l}});var a=n(27086),s=n(601);function l(e,t){let n=e.columns.find(e=>e.name==t.column);if(n&&(0,s.v3)(n.format)){let e=Number(t.value);if(!Number.isNaN(e)&&!(e>Number.MAX_SAFE_INTEGER))return Number(t.value)}return t.value}function i(e){let{table:t}=e,n=t.primary_keys;return n&&0!=n.length?{primaryKeys:n.map(e=>e.name)}:{error:{message:a.jg}}}},35618:function(e,t,n){"use strict";n.d(t,{W:function(){return a}});let a={list:(e,t,n)=>["projects",e,"tables",{schema:t,includeColumns:!!n}],table:(e,t)=>["projects",e,"tables",t]}},46198:function(e,t,n){"use strict";n.d(t,{H:function(){return u},W:function(){return d}});var a=n(85945),s=n(48228),l=n(62202),i=n(66694),r=n(49422),o=n(5392),c=n(35618);async function d(e){let{projectRef:t,connectionString:n,id:a,cascade:s=!1}=e,l=new Headers;n&&l.set("x-connection-encrypted",n);let{data:i,error:o}=await (0,r.IV)("/platform/pg-meta/{ref}/tables",{params:{header:{"x-connection-encrypted":n},path:{ref:t},query:{id:a,cascade:s}},headers:l});return o&&(0,r.S3)(o),i}let u=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(0,a.NL)();return(0,s.D)(e=>d(e),{async onSuccess(t,n,a){let{id:s,projectRef:l,schema:d}=n;await Promise.all([r.invalidateQueries(c.W.list(l,d)),r.invalidateQueries(c.W.table(l,s)),r.invalidateQueries(i.C.list(l)),r.invalidateQueries(o.N.listBySchema(l,d)),r.invalidateQueries(o.N.view(l,s))]),await (null==e?void 0:e(t,n,a))},async onError(e,n,a){void 0===t?l.Am.error("Failed to delete database table: ".concat(e.message)):t(e,n,a)},...n})}},44294:function(e,t,n){"use strict";n.d(t,{hC:function(){return i},yp:function(){return r}});var a=n(36492),s=n(35618);n(2784);var l=n(49422);async function i(e,t){let{id:n,projectRef:a,connectionString:s}=e;if(!a)throw Error("projectRef is required");if(!n)throw Error("id is required");let i=new Headers;s&&i.set("x-connection-encrypted",s);let{data:r,error:o}=await (0,l.U2)("/platform/pg-meta/{ref}/tables",{params:{header:{"x-connection-encrypted":s},path:{ref:a},query:{id:n.toString()}},headers:i,signal:t});return o&&(0,l.S3)(o),r}let r=function(e){let{projectRef:t,connectionString:n,id:l}=e,{enabled:r=!0,...o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.a)(s.W.table(t,l),e=>{let{signal:a}=e;return i({projectRef:t,connectionString:n,id:l},a)},{enabled:r&&void 0!==t&&void 0!==l,staleTime:0,...o})}},1877:function(e,t,n){"use strict";n.d(t,{T:function(){return o},V:function(){return c}});var a=n(85945),s=n(48228),l=n(62202),i=n(49422),r=n(35618);async function o(e){let{projectRef:t,connectionString:n,id:a,payload:s}=e,l=new Headers;n&&l.set("x-connection-encrypted",n);let{data:r,error:o}=await (0,i.r$)("/platform/pg-meta/{ref}/tables",{params:{header:{"x-connection-encrypted":n},path:{ref:t},query:{id:a}},body:s,headers:l});return o&&(0,i.S3)(o),r}let c=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,a.NL)();return(0,s.D)(e=>o(e),{async onSuccess(t,n,a){let{projectRef:s,schema:l,id:o}=n;await Promise.all([i.invalidateQueries(r.W.list(s,l)),i.invalidateQueries(r.W.table(s,o))]),await (null==e?void 0:e(t,n,a))},async onError(e,n,a){void 0===t?l.Am.error("Failed to update database table: ".concat(e.message)):t(e,n,a)},...n})}},36554:function(e,t,n){"use strict";n.d(t,{AF:function(){return m},Bj:function(){return u},Lk:function(){return d}});var a=n(36492),s=n(85945),l=n(829),i=n.n(l),r=n(2784),o=n(49422),c=n(35618);async function d(e,t){let{projectRef:n,connectionString:a,schema:s,includeColumns:l=!1,sortByProperty:r="name"}=e;if(!n)throw Error("projectRef is required");let c=new Headers;a&&c.set("x-connection-encrypted",a);let d={include_columns:"".concat(l)};s&&(d.included_schemas=s);let{data:u,error:m}=await (0,o.U2)("/platform/pg-meta/{ref}/tables",{params:{header:{"x-connection-encrypted":a},path:{ref:n},query:d},headers:c,signal:t});return(!Array.isArray(u)&&m&&(0,o.S3)(m),Array.isArray(u)&&r)?i()(u,e=>e[r]):u}let u=function(e){let{projectRef:t,connectionString:n,schema:s,includeColumns:l}=e,{enabled:i=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.a)(c.W.list(t,s,l),e=>{let{signal:a}=e;return d({projectRef:t,connectionString:n,schema:s,includeColumns:l},a)},{enabled:i&&void 0!==t,staleTime:0,...r})};function m(e){let{projectRef:t,connectionString:n}=e,a=(0,s.NL)();return(0,r.useCallback)((e,s)=>a.fetchQuery({queryKey:c.W.list(t,e,s),queryFn:a=>{let{signal:l}=a;return d({projectRef:t,connectionString:n,schema:e,includeColumns:s},l)}}),[n,t,a])}},9181:function(e,t,n){"use strict";function a(e){return!!e&&"object"==typeof e&&"message"in e&&"string"==typeof e.message}n.d(t,{V:function(){return a}})},86218:function(e,t,n){"use strict";n.d(t,{W:function(){return a}});let a={list:e=>["projects",e,"secrets"],getDecryptedValue:(e,t)=>["projects",e,"secrets",t]}},42341:function(e,t,n){"use strict";n.d(t,{mp:function(){return o},zQ:function(){return c}});var a=n(36492),s=n(99314),l=n(58686),i=n(86218);let r=e=>new s.A().from("decrypted_secrets","vault").select("decrypted_secret").match({id:e}).toSql(),o=async(e,t)=>{let{projectRef:n,connectionString:a,id:s}=e,o=r(s),{result:c}=await (0,l.Rj)({projectRef:n,connectionString:a,sql:o,queryKey:i.W.getDecryptedValue(n,s)},t);return c},c=function(e){let{projectRef:t,connectionString:n,id:s}=e,{enabled:l,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.a)(i.W.getDecryptedValue(t,s),e=>{let{signal:a}=e;return o({projectRef:t,connectionString:n,id:s},a)},{select:e=>e[0].decrypted_secret,enabled:l&&void 0!==t,...r})}},19627:function(e,t,n){"use strict";n.d(t,{f:function(){return r}});var a=n(99314),s=n(58686),l=n(86218);let i=()=>new a.A().from("secrets","vault").select("id,name,description,secret,key_id,created_at,updated_at").toSql(),r=function(e){let{projectRef:t,connectionString:n}=e,{enabled:a,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.cp)({projectRef:t,connectionString:n,sql:i(),queryKey:l.W.list(t)},{select:e=>e.result,enabled:a&&void 0!==t,...r})}},5392:function(e,t,n){"use strict";n.d(t,{N:function(){return a}});let a={list:e=>["projects",e,"views"],listBySchema:(e,t)=>[...a.list(e),t],view:(e,t)=>[...a.list(e),t]}},83179:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var a=n(85945),s=n(83314),l=n(58686);let i=e=>{let{id:t}=e;return"\n    select\n      c.oid::int8 as \"id\",\n      nc.nspname as \"schema\",\n      c.relname as \"name\",\n      c.relkind as \"type\",\n      obj_description(c.oid) as \"comment\",\n      count(*) over() as \"count\"\n    from\n      pg_namespace nc\n      join pg_class c on nc.oid = c.relnamespace\n    where\n      c.relkind in ('r', 'v', 'm', 'f', 'p')\n      and not pg_is_other_temp_schema(nc.oid)\n      and (\n        pg_has_role(c.relowner, 'USAGE')\n        or has_table_privilege(\n          c.oid,\n          'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER'\n        )\n        or has_any_column_privilege(c.oid, 'SELECT, INSERT, UPDATE, REFERENCES')\n      )\n      and c.oid = '".concat(t,"'\n    limit 1;\n  ")},r=function(e){let{projectRef:t,connectionString:n,id:a,...s}=e,{enabled:r,...o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,l.cp)({projectRef:t,connectionString:n,sql:i({id:a,...s}),queryKey:["entity-type",a]},{select(e){var t;return null!==(t=e.result[0])&&void 0!==t?t:null},enabled:r&&void 0!==t&&void 0!==a&&!isNaN(a),...o})};var o=n(66694),c=n(2784),d=function(e,t){let n=(0,a.NL)(),{project:l}=(0,s.d2)(),i=(0,c.useMemo)(()=>{var t,a,s,i;return null===(i=n.getQueryCache().find(o.C.list(null==l?void 0:l.ref)))||void 0===i?void 0:null===(s=i.state.data)||void 0===s?void 0:null===(a=s.pages)||void 0===a?void 0:null===(t=a.flatMap(e=>e.data.entities))||void 0===t?void 0:t.find(t=>t.id===e)},[null==l?void 0:l.ref,e]),{data:d}=r({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString,id:e},{enabled:!i,onSettled(n){n||void 0===e||null==t||t(e)}});return null!=i?i:d}},52111:function(e,t,n){"use strict";n.d(t,{Z:function(){return j}});var a=n(83314),s=n(88719),l=n(36492),i=n(71436),r=n(76626);async function o(e,t){let{id:n,projectRef:a,connectionString:s}=e;if(!a)throw Error("projectRef is required");if(!n)throw Error("id is required");let l=new Headers;s&&l.set("x-connection-encrypted",s);let o=await (0,i.U2)("".concat(r.T5,"/pg-meta/").concat(a,"/foreign-tables?id=").concat(n),{headers:Object.fromEntries(l),signal:t});if("error"in o)throw o.error;return o}let c=function(e){let{projectRef:t,connectionString:n,id:a}=e,{enabled:s=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,l.a)(["projects",t,"foreignTables",a],e=>{let{signal:s}=e;return o({projectRef:t,connectionString:n,id:a},s)},{enabled:s&&void 0!==t&&void 0!==a,staleTime:0,...i})};async function d(e,t){let{id:n,projectRef:a,connectionString:s}=e;if(!a)throw Error("projectRef is required");if(!n)throw Error("id is required");let l=new Headers;s&&l.set("x-connection-encrypted",s);let o=await (0,i.U2)("".concat(r.T5,"/pg-meta/").concat(a,"/materialized-views?id=").concat(n),{headers:Object.fromEntries(l),signal:t});if("error"in o)throw o.error;return o}let u=function(e){let{projectRef:t,connectionString:n,id:a}=e,{enabled:s=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,l.a)(["projects",t,"materializedViews",a],e=>{let{signal:s}=e;return d({projectRef:t,connectionString:n,id:a},s)},{enabled:s&&void 0!==t&&void 0!==a,staleTime:0,...i})};var m=n(44294),h=n(49422),x=n(5392);async function p(e,t){let{id:n,projectRef:a,connectionString:s}=e;if(!a)throw Error("projectRef is required");if(!n)throw Error("id is required");let l=new Headers;s&&l.set("x-connection-encrypted",s);let{data:i,error:r}=await (0,h.U2)("/platform/pg-meta/{ref}/views",{params:{header:{"x-connection-encrypted":s},path:{ref:a},query:{id:"".concat(n)}},headers:l,signal:t});return r&&(0,h.S3)(r),i}let f=function(e){let{projectRef:t,connectionString:n,id:a}=e,{enabled:s=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,l.a)(x.N.view(t,a),e=>{let{signal:s}=e;return p({projectRef:t,connectionString:n,id:a},s)},{enabled:s&&void 0!==t&&void 0!==a,staleTime:0,...i})};var g=n(83179),j=function(e){let{project:t}=(0,a.d2)(),n=(0,g.Z)(e),l=(0,m.yp)({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString,id:null==n?void 0:n.id},{enabled:(null==n?void 0:n.type)===s.l.TABLE}),i=f({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString,id:null==n?void 0:n.id},{enabled:(null==n?void 0:n.type)===s.l.VIEW}),r=u({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString,id:null==n?void 0:n.id},{enabled:(null==n?void 0:n.type)===s.l.MATERIALIZED_VIEW}),o=c({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString,id:null==n?void 0:n.id},{enabled:(null==n?void 0:n.type)===s.l.FOREIGN_TABLE});switch(null==n?void 0:n.type){case s.l.TABLE:return l;case s.l.VIEW:return i;case s.l.MATERIALIZED_VIEW:return r;case s.l.FOREIGN_TABLE:return o;default:return l}}},99962:function(e,t,n){"use strict";n.d(t,{F:function(){return a},U:function(){return s}});let a=["auth","cron","extensions","information_schema","net","pgsodium","pgsodium_masks","pgbouncer","pgtle","realtime","storage","supabase_functions","supabase_migrations","vault","graphql","graphql_public"],s=a.filter(e=>"extensions"!==e)},82978:function(e,t,n){"use strict";n.d(t,{H:function(){return I}});var a=n(87612),s=n(52322),l=n(20364),i=n(62419),r=n(93586),o=n.n(r),c=n(60417),d=n.n(c),u=n(55281),m=n.n(u),h=n(12982),x=n.n(h),p=n(93352),f=n.n(p),g=n(18149),j=n.n(g),v=n(51525),b=n.n(v),y=n(75652),N=n.n(y),w=n(84636),_=n.n(w),C=n(80075),S=n(62202),k=n(39480),E=n(72293),Z=n(10586),T=n(71436),R=n(76626),z=n(34406);let A=new URL(z.env.SUPABASE_PUBLIC_URL||"http://localhost:8000");z.env.LOGFLARE_URL,A.origin,A.host;let P=A.protocol.replace(":","");z.env.DEFAULT_PROJECT_NAME;let L=null;function I(){return null===L&&(L=new O(null)),L}let D=".emptyFolderPlaceholder",F="Please do not close the browser until it's completed";class O{initStore(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:P;this.projectRef=e,this.endpoint="".concat(R.T5,"/storage/").concat(e),void 0!==n&&this.initializeSupabaseClient(n,t,a)}get currentBucketName(){return this.selectedBucket.name}constructor(e){var t=this;(0,a._)(this,"projectRef",""),(0,a._)(this,"loaded",!1),(0,a._)(this,"view",E.De.COLUMNS),(0,a._)(this,"sortBy",E.Ye.NAME),(0,a._)(this,"sortByOrder","asc"),(0,a._)(this,"buckets",[]),(0,a._)(this,"selectedBucket",{}),(0,a._)(this,"columns",[]),(0,a._)(this,"openedFolders",[]),(0,a._)(this,"selectedItems",[]),(0,a._)(this,"selectedItemsToDelete",[]),(0,a._)(this,"selectedItemsToMove",[]),(0,a._)(this,"selectedFilePreview",{}),(0,a._)(this,"selectedFileCustomExpiry",void 0),(0,a._)(this,"DEFAULT_OPTIONS",{limit:200,offset:0,sortBy:{column:this.sortBy,order:this.sortByOrder}}),(0,a._)(this,"supabaseClient",null),(0,a._)(this,"endpoint",""),(0,a._)(this,"filePreviewCache",[]),(0,a._)(this,"uploadProgress",0),(0,a._)(this,"abortController",null),(0,a._)(this,"initializeSupabaseClient",(e,t,n)=>{this.supabaseClient=(0,l.eI)("".concat(R.Qy?"https":n,"://").concat(t),e,{auth:{persistSession:!1,autoRefreshToken:!1,multiTab:!1,detectSessionInUrl:!1,localStorage:{getItem:e=>{},setItem:(e,t)=>{},removeItem:e=>{}}}})}),(0,a._)(this,"updateFileInPreviewCache",e=>{let t=this.filePreviewCache.map(t=>t.id===e.id?e:t);this.filePreviewCache=t}),(0,a._)(this,"addFileToPreviewCache",e=>{let t=this.filePreviewCache.concat([e]);this.filePreviewCache=t}),(0,a._)(this,"clearFilePreviewCache",()=>{this.filePreviewCache=[]}),(0,a._)(this,"getLocalStorageKey",()=>"supabase-storage-".concat(this.projectRef)),(0,a._)(this,"getLatestColumnIndex",()=>this.columns.length-1),(0,a._)(this,"getCurrentlySelectedBucket",()=>this.columns.length>1?this.columns[1]:null),(0,a._)(this,"getPathAlongOpenedFolders",function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return e?t.openedFolders.length>0?"".concat(t.selectedBucket.name,"/").concat(t.openedFolders.map(e=>e.name).join("/")):t.selectedBucket.name:t.openedFolders.map(e=>e.name).join("/")}),(0,a._)(this,"abortApiCalls",()=>{this.abortController.abort(),this.abortController=new AbortController}),(0,a._)(this,"setLoaded",e=>{this.loaded=e}),(0,a._)(this,"setSelectedBucket",e=>{this.selectedBucket=e,this.clearOpenedFolders(),this.closeFilePreview(),this.clearSelectedItems()}),(0,a._)(this,"setView",e=>{this.view=e,this.closeFilePreview(),this.updateExplorerPreferences()}),(0,a._)(this,"setSortBy",async e=>{this.sortBy=e,this.closeFilePreview(),this.updateExplorerPreferences(),await this.refetchAllOpenedFolders()}),(0,a._)(this,"setSortByOrder",async e=>{this.sortByOrder=e,this.closeFilePreview(),this.updateExplorerPreferences(),await this.refetchAllOpenedFolders()}),(0,a._)(this,"clearColumns",()=>{this.columns=[]}),(0,a._)(this,"pushColumnAtIndex",(e,t)=>{this.columns=this.columns.slice(0,t+1).concat([e])}),(0,a._)(this,"popColumn",()=>{this.abortApiCalls(),this.columns=this.columns.slice(0,this.getLatestColumnIndex())}),(0,a._)(this,"popColumnAtIndex",e=>{this.columns=this.columns.slice(0,e+1)}),(0,a._)(this,"setColumnIsLoadingMore",function(e){let n=!(arguments.length>1)||void 0===arguments[1]||arguments[1];t.columns=t.columns.map((t,a)=>a===e?{...t,isLoadingMoreItems:n}:t)}),(0,a._)(this,"pushOpenedFolderAtIndex",(e,t)=>{this.openedFolders=this.openedFolders.slice(0,t).concat(e)}),(0,a._)(this,"popOpenedFolders",()=>{this.openedFolders=this.openedFolders.slice(0,this.openedFolders.length-1)}),(0,a._)(this,"popOpenedFoldersAtIndex",e=>{this.openedFolders=this.openedFolders.slice(0,e+1)}),(0,a._)(this,"clearOpenedFolders",()=>{this.openedFolders=[]}),(0,a._)(this,"setSelectedItems",e=>{this.selectedItems=e}),(0,a._)(this,"clearSelectedItems",e=>{void 0!==e?this.selectedItems=this.selectedItems.filter(t=>t.columnIndex!==e):this.selectedItems=[]}),(0,a._)(this,"setSelectedItemsToDelete",e=>{this.selectedItemsToDelete=e}),(0,a._)(this,"clearSelectedItemsToDelete",()=>{this.selectedItemsToDelete=[]}),(0,a._)(this,"setSelectedItemsToMove",e=>{this.selectedItemsToMove=e}),(0,a._)(this,"clearSelectedItemsToMove",()=>{this.selectedItemsToMove=[]}),(0,a._)(this,"setSelectedFileCustomExpiry",e=>{this.selectedFileCustomExpiry=e}),(0,a._)(this,"addNewFolderPlaceholder",e=>{let t=E.fh.FOLDER,n=-1===e?this.getLatestColumnIndex():e;this.addTempRow(t,"Untitled folder",E.R9.EDITING,n,{},!0)}),(0,a._)(this,"addNewFolder",async(e,t)=>{let n=this.sanitizeNameForDuplicateInColumn(e,!1,t);if(null===n)return;if(!/^[a-zA-Z0-9_-\s]*$/.test(n))return(0,k.Am)({variant:"destructive",description:"Folder name contains invalid special characters",duration:6e3});if(0===n.length)return this.removeTempRows(t);this.updateFolderAfterEdit(n,t);let a="".concat(n,"/").concat(D),s=this.openedFolders.slice(0,t).map(e=>e.name).join("/"),l=s.length>0?"".concat(s,"/").concat(a):a;await this.supabaseClient.storage.from(this.selectedBucket.name).upload(l,new File([],D)),s.length>0&&await (0,T.$v)("".concat(this.endpoint,"/buckets/").concat(this.selectedBucket.id,"/objects"),{paths:["".concat(s,"/").concat(D)]})}),(0,a._)(this,"setFilePreview",async e=>{var t,n,a,s;let l=null===(t=e.metadata)||void 0===t?void 0:t.size;if((null===(n=e.metadata)||void 0===n?void 0:n.mimetype)&&l){if(l>1e7){this.selectedFilePreview={...e,previewUrl:"skipped"};return}this.selectedFilePreview={...e,previewUrl:"loading"};let t=m()(this.filePreviewCache,{id:e.id}),n=null!==(a=null==t?void 0:t.fetchedAt)&&void 0!==a?a:null,i=null!==(s=null==t?void 0:t.expiresIn)&&void 0!==s?s:null,r=null!==n&&null!==i;if(!r||n+1e3*i<Date.now()){let t=await this.fetchFilePreview(e.name),n=this.selectedBucket.public?"".concat(t,"?t=").concat(new Date().toISOString()):t;this.selectedFilePreview={...e,previewUrl:n};let a={id:e.id,url:t,expiresIn:31536e4,fetchedAt:Date.now()};r?this.updateFileInPreviewCache(a):this.addFileToPreviewCache(a)}else this.selectedFilePreview={...e,previewUrl:t.url}}else this.selectedFilePreview={...e,previewUrl:null}}),(0,a._)(this,"closeFilePreview",()=>{this.selectedFilePreview={}}),(0,a._)(this,"getFileUrl",async function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=m()(t.filePreviewCache,{id:e.id});if(void 0!==a&&0===n)return a.url;{let a=await t.fetchFilePreview(e.name,n);try{let n=new URL(a);n.searchParams.set("t",new Date().toISOString());let s=n.toString(),l={id:e.id,url:s,expiresIn:31536e4,fetchedAt:Date.now()};return t.addFileToPreviewCache(l),s}catch(e){return console.error("Failed to get file URL",e),""}}}),(0,a._)(this,"openBucket",async e=>{let{id:t,name:n}=e;j()(this.selectedBucket,e)||(this.setSelectedBucket(e),await this.fetchFolderContents(t,n,-1))}),(0,a._)(this,"getFile",async e=>{try{return await new Promise((t,n)=>e.file(t,n))}catch(e){console.error("getFile error:",e);return}}),(0,a._)(this,"getFilesDataTransferItems",async e=>{let{dismiss:t}=(0,k.Am)({description:"Retrieving items to upload..."}),n=[],a=[];for(let t of e)a.push(t.webkitGetAsEntry());for(;a.length>0;){let e=a.shift()||{};if(e.isFile){let t=await this.getFile(e);void 0!==t&&(t.path=e.fullPath.slice(1),n.push(t))}else e.isDirectory&&a.push(...await this.readAllDirectoryEntries(e.createReader()))}return t(),n}),(0,a._)(this,"readAllDirectoryEntries",async e=>{let t=[],n=await this.readEntriesPromise(e);for(;n.length>0;)t.push(...n),n=await this.readEntriesPromise(e);return t}),(0,a._)(this,"readEntriesPromise",async e=>{try{return await new Promise((t,n)=>{e.readEntries(t,n)})}catch(e){console.error("readEntriesPromise error:",e)}}),(0,a._)(this,"uploadFiles",async function(e,n){var a,l,i;let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=new Date,d=r?(await t.getFilesDataTransferItems(e)).filter(e=>!e.path.includes("#/")):Array.from(e),u=-1===n?t.getLatestColumnIndex():n,m=(null!==(i=null===(l=t.columns)||void 0===l?void 0:null===(a=l[u])||void 0===a?void 0:a.items)&&void 0!==i?i:[]).filter(e=>!e.id).map(e=>e.name),h=d.map(e=>{if(!e.path)return e;let a=e.path.split("/"),s=a.length>1?a[0]:null;if(m.includes(s)){let l=t.sanitizeNameForDuplicateInColumn(s,!0,n);a[0]=l,e.path=a.join("/")}return e});t.uploadProgress=0;let x=[],p=h.length,g=0,j=0,v=t.openedFolders.slice(0,u).map(e=>e.name).join("/"),b=S.ZP.loading((0,s.jsx)(Z.q,{progress:0,message:"Uploading ".concat(h.length," file").concat(h.length>1?"s":"","..."),description:F})),y=h.map(e=>{var n;let a={cacheControl:"3600"},s={mimetype:e.type,size:e.size},l=(null!==(n=null==e?void 0:e.path)&&void 0!==n?n:"").split("/").length>1,i=l?e.name:t.sanitizeNameForDuplicateInColumn(e.name,!0),r=f()(e,["path"])&&l?e.path:i,o=v.length>0?"".concat(v,"/").concat(r):r;if(l){let n=e.path.split("/")[0];x.includes(n)||(t.addTempRow(E.fh.FOLDER,n,E.R9.LOADING,u,s),x.push(n))}else t.addTempRow(E.fh.FILE,i,E.R9.LOADING,u,s);return()=>new Promise(async n=>{let{error:s}=await t.supabaseClient.storage.from(t.selectedBucket.name).upload(o,e,a);t.uploadProgress=t.uploadProgress+1/h.length,s?(j+=1,S.ZP.error("Failed to upload ".concat(e.name,": ").concat(s.message))):g+=1,n()})}),N=o()(y,10);try{await N.reduce(async(e,n)=>{await e,await Promise.allSettled(n.map(e=>e())),S.ZP.loading((0,s.jsx)(Z.q,{progress:100*t.uploadProgress,message:"Uploading ".concat(h.length," file").concat(h.length>1?"s":"","..."),description:F}),{id:b})},Promise.resolve()),g>0&&await (0,T.$v)("".concat(t.endpoint,"/buckets/").concat(t.selectedBucket.id,"/objects"),{paths:["".concat(v,"/").concat(D)]}),await t.refetchAllOpenedFolders(),0===p?S.ZP.dismiss(b):j===p?S.ZP.error("Failed to upload ".concat(p," file").concat(p>1?"s":"","!"),{id:b}):g===p?S.ZP.success("Successfully uploaded ".concat(p," file").concat(p>1?"s":"","!"),{id:b}):S.ZP.success("Successfully uploaded ".concat(g," out of ").concat(p," file").concat(p>1?"s":"","!"),{id:b})}catch(e){S.ZP.error("Failed to upload files",{id:b})}let w=new Date;console.log("Total time taken for ".concat(h.length," files: ").concat((w-c)/1e3," seconds"))}),(0,a._)(this,"moveFiles",async e=>{let t=d()(e.split("/")).join("/"),n=0;this.clearSelectedItems();let{dismiss:a}=(0,k.Am)({description:"Please do not close the browser until the move is completed",duration:1/0});await Promise.all(this.selectedItemsToMove.map(async a=>{let s=this.openedFolders.slice(0,a.columnIndex).map(e=>e.name).join("/"),l=s.length>0?"".concat(s,"/").concat(a.name):a.name,i=e.length>0?"".concat(t,"/").concat(a.name):a.name,r=await (0,T.v_)("".concat(this.endpoint,"/buckets/").concat(this.selectedBucket.id,"/objects/move"),{from:l,to:i});r.error&&(n+=1,S.ZP.error(r.error.message))})),n===this.selectedItemsToMove.length?(0,k.Am)({variant:"destructive",description:"Failed to move files"}):(0,k.Am)({description:"Successfully moved ".concat(this.selectedItemsToMove.length-n," files to ").concat(t.length>0?t:"the root of your bucket")}),a();let s=this.selectedItemsToMove.map(e=>e.id),l=this.filePreviewCache.filter(e=>!s.includes(e.id));this.filePreviewCache=l,await this.refetchAllOpenedFolders(),this.clearSelectedItemsToMove()}),(0,a._)(this,"fetchFilePreview",async function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=t.getPathAlongOpenedFolders(!1),s=a.length>0?"".concat(a,"/").concat(e):e;if(t.selectedBucket.public){let e=await (0,T.v_)("".concat(t.endpoint,"/buckets/").concat(t.selectedBucket.id,"/objects/public-url"),{path:s});if(!e.error)return e.publicUrl;S.ZP.error("Failed to fetch public file preview: ".concat(e.error.message))}else{let e=await (0,T.v_)("".concat(t.endpoint,"/buckets/").concat(t.selectedBucket.id,"/objects/sign"),{path:s,expiresIn:n||31536e4});if(!e.error)return e.signedUrl;S.ZP.error("Failed to fetch signed url preview: ".concat(e.error.message))}return null}),(0,a._)(this,"deleteFiles",async function(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.closeFilePreview();let a=0,l=b()(e,"prefix")?e.map(e=>"".concat(e.prefix,"/").concat(e.name)):e.map(e=>{let{name:n,columnIndex:a}=e,s=t.openedFolders.slice(0,a).map(e=>e.name).join("/");return t.updateRowStatus(n,E.R9.LOADING,a),s.length>0?"".concat(s,"/").concat(n):n});t.clearSelectedItems();let i=S.ZP.loading((0,s.jsx)(Z.q,{progress:0,message:"Deleting ".concat(l.length," file(s)..."),description:F})),r=o()(l,2).map(e=>()=>(a+=e.length/l.length,(0,T.$v)("".concat(t.endpoint,"/buckets/").concat(t.selectedBucket.name,"/objects"),{paths:e})));await o()(r,2).reduce(async(e,t)=>{await e,await Promise.all(t.map(e=>e())),S.ZP.loading((0,s.jsx)(Z.q,{progress:100*a,message:"Deleting ".concat(l.length," file(s)..."),description:F}),{id:i})},Promise.resolve());let c=e.map(e=>e.id),d=t.filePreviewCache.filter(e=>!c.includes(e.id));if(t.filePreviewCache=d,n)S.ZP.dismiss(i);else{let e=N()(l.map(e=>{let t=e.split("/");return t.slice(0,t.length-1).join("/")}));await Promise.all(e.map(e=>t.validateParentFolderEmpty(e))),S.ZP.success("Successfully deleted ".concat(l.length," file(s)"),{id:i}),await t.refetchAllOpenedFolders(),t.clearSelectedItemsToDelete()}}),(0,a._)(this,"downloadFolder",async e=>{let t=0,n=S.ZP.loading("Retrieving files from folder..."),a=await this.getAllItemsAlongFolder(e);S.ZP.loading((0,s.jsx)(Z.q,{progress:0,message:"Downloading ".concat(a.length," file").concat(a.length>1?"s":"","..."),desription:F}),{id:n});let l=a.map(e=>{var n,s;let l=null!==(s=null===(n=e.metadata)||void 0===n?void 0:n.mimetype)&&void 0!==s?s:null;return()=>new Promise(async n=>{let s=await (0,T.v_)("".concat(this.endpoint,"/buckets/").concat(this.selectedBucket.id,"/objects/download"),{path:"".concat(e.prefix,"/").concat(e.name)});if(t+=1/a.length,s.error)console.error("Failed to download file","".concat(e.prefix,"/").concat(e.name)),n(!1);else{let t=await s.blob();n({name:e.name,prefix:e.prefix,blob:new Blob([t],{type:l})})}})}),r=o()(l,10),c=await r.reduce(async(e,l)=>{let i=await e,r=await Promise.allSettled(l.map(e=>e()));return S.ZP.loading((0,s.jsx)(Z.q,{progress:100*t,message:"Downloading ".concat(a.length," file").concat(a.length>1?"s":"","..."),desription:F}),{id:n}),(null!=i?i:[]).concat(r.map(e=>e.value).filter(Boolean))},Promise.resolve()),d=new i.U5("application/zip"),u=new i._Q(d,{bufferedWrite:!0});0===c.length&&S.ZP.error('Failed to download files from "'.concat(e.name,'"'),{id:n}),c.forEach(e=>{e.blob&&u.add("".concat(e.prefix,"/").concat(e.name),new i.Nt(e.blob))});let m=URL.createObjectURL(await u.close()),h=document.createElement("a");h.href=m,h.setAttribute("download","".concat(e.name,".zip")),document.body.appendChild(h),h.click(),h.parentNode.removeChild(h),S.ZP.success(c.length===a.length?'Successfully downloaded folder "'.concat(e.name,'"'):'Downloaded folder "'.concat(e.name,'". However, ').concat(a.length-c.length," files did not download successfully."),{id:n})}),(0,a._)(this,"downloadSelectedFiles",async e=>{let t=Math.min(...e.map(e=>e.columnIndex)),n=e.map(e=>{let{name:n,columnIndex:a}=e,s=this.openedFolders.slice(t,a).map(e=>e.name).join("/"),l=s.length>0?"".concat(s,"/").concat(n):n;return{...e,formattedPathToFile:l}}),a=0,l=S.ZP.loading("Downloading ".concat(e.length," file").concat(e.length>1?"s":"","...")),r=n.map(e=>()=>new Promise(async t=>{let s=await this.downloadFile(e,!1,!0);a+=1/n.length,t({...s,name:e.formattedPathToFile})})),c=o()(r,10),d=await c.reduce(async(t,n)=>{let i=await t,r=await Promise.allSettled(n.map(e=>e()));return S.ZP.loading((0,s.jsx)(Z.q,{progress:100*a,message:"Downloading ".concat(e.length," file").concat(e.length>1?"s":"","..."),description:F}),{id:l}),(null!=i?i:[]).concat(r.map(e=>e.value).filter(Boolean))},Promise.resolve()),u=new i.U5("application/zip"),m=new i._Q(u,{bufferedWrite:!0});d.forEach(e=>{m.add(e.name,new i.Nt(e.blob))});let h=URL.createObjectURL(await m.close()),x=document.createElement("a");x.href=h,x.setAttribute("download","supabase-files.zip"),document.body.appendChild(x),x.click(),x.parentNode.removeChild(x),S.ZP.success("Successfully downloaded ".concat(d.length," files"),{id:l})}),(0,a._)(this,"downloadFile",async function(e){var n,a;let s=!(arguments.length>1)||void 0===arguments[1]||arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e.name,r=null!==(a=null==e?void 0:null===(n=e.metadata)||void 0===n?void 0:n.mimetype)&&void 0!==a?a:null,o=s?S.ZP.loading("Retrieving ".concat(i,"...")):void 0,c=t.openedFolders.slice(0,e.columnIndex).map(e=>e.name).join("/"),d=c.length>0?"".concat(c,"/").concat(i):i,u=await (0,T.v_)("".concat(t.endpoint,"/buckets/").concat(t.selectedBucket.id,"/objects/download"),{path:d});if(u.error)return o&&S.ZP.error("Failed to download ".concat(i),{id:o}),!1;{let e=await u.blob(),t=new Blob([e],{type:r});if(l)return{name:i,blob:t};let n=window.URL.createObjectURL(t),a=document.createElement("a");return a.href=n,a.setAttribute("download","".concat(i)),document.body.appendChild(a),a.click(),a.parentNode.removeChild(a),window.URL.revokeObjectURL(e),o&&S.ZP.success("Downloading ".concat(i),{id:o}),!0}}),(0,a._)(this,"renameFile",async(e,t,n)=>{let a=e.name;if(a===t||0===t.length)this.updateRowStatus(a,E.R9.READY,n);else{this.updateRowStatus(a,E.R9.LOADING,n,t);let s=this.getPathAlongOpenedFolders(!1),l=s.length>0?"".concat(s,"/").concat(a):a,i=s.length>0?"".concat(s,"/").concat(t):t,r=await (0,T.v_)("".concat(this.endpoint,"/buckets/").concat(this.selectedBucket.id,"/objects/move"),{from:l,to:i});if(r.error)S.ZP.error("Failed to rename file: ".concat(r.error.message));else{S.ZP.success('Successfully renamed "'.concat(a,'" to "').concat(t,'"'));let n=this.filePreviewCache.filter(t=>t.id!==e.id);if(this.filePreviewCache=n,this.selectedFilePreview.name===a){let{previewUrl:n,...a}=e;this.setFilePreview({...a,name:t})}await this.refetchAllOpenedFolders()}}}),(0,a._)(this,"fetchFolderContents",async function(e,n,a){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(void 0===t.selectedBucket.id)return;t.abortApiCalls(),t.updateRowStatus(n,E.R9.LOADING,a),t.pushColumnAtIndex({id:e,name:n,status:E.R9.LOADING,items:[]},a);let l=t.openedFolders.slice(0,a+1).map(e=>e.name).join("/"),i={limit:200,offset:0,search:s,sortBy:{column:t.sortBy,order:t.sortByOrder}},r=await (0,T.v_)("".concat(t.endpoint,"/buckets/").concat(t.selectedBucket.id,"/objects/list"),{path:l,options:i},{abortSignal:t.abortController.signal});if(t.updateRowStatus(n,E.R9.READY,a),r.error)r.error.message.includes("aborted")||S.ZP.error('Failed to retrieve folder contents from "'.concat(n,'": ').concat(r.error.message));else{let s=t.formatFolderItems(r);t.pushColumnAtIndex({id:e||n,name:n,items:s,hasMoreItems:200===s.length,isLoadingMoreItems:!1},a)}}),(0,a._)(this,"fetchMoreFolderContents",async function(e,n){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";t.setColumnIsLoadingMore(e);let s=t.openedFolders.map(e=>e.name).join("/"),l={limit:200,offset:n.items.length,search:a,sortBy:{column:t.sortBy,order:t.sortByOrder}},i=await (0,T.v_)("".concat(t.endpoint,"/buckets/").concat(t.selectedBucket.id,"/objects/list"),{path:s,options:l},{abortSignal:t.abortController.signal});if(i.error)i.error.message.includes("aborted")||S.ZP.error('Failed to retrieve folder contents from "'.concat(folderName,'": ').concat(i.error.message));else{let n=t.formatFolderItems(i);t.columns=t.columns.map((t,a)=>a===e?{...t,items:t.items.concat(n),isLoadingMoreItems:!1,hasMoreItems:200===i.length}:t)}}),(0,a._)(this,"refetchAllOpenedFolders",async()=>{let e=this.openedFolders.map(e=>e.name);await this.fetchFoldersByPath(e)}),(0,a._)(this,"fetchFoldersByPath",async function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0===t.selectedBucket.id)return;let s=[""].concat(e);a&&(t.columns=[t.selectedBucket.name].concat(e).map(e=>({id:e,name:e,status:E.R9.LOADING,items:[]})));let l=(await Promise.all(s.map(async(a,s)=>{let l=e.slice(0,s).join("/"),i={limit:200,offset:0,search:n,sortBy:{column:t.sortBy,order:t.sortByOrder}},r=await (0,T.v_)("".concat(t.endpoint,"/buckets/").concat(t.selectedBucket.id,"/objects/list"),{path:l,options:i});return r.error?(S.ZP.error("Failed to fetch folders: ".concat(r.error.message)),[]):r}))).map((e,n)=>{let a=t.formatFolderItems(e);return{id:null,name:0===n?t.selectedBucket.name:s[n],items:a,hasMoreItems:200===a.length,isLoadingMoreItems:!1}});t.columns=l;let i=e.map((e,t)=>m()(l[t].items,{name:e})||{id:null,name:e,type:E.fh.FOLDER,status:E.R9.READY});t.openedFolders=i}),(0,a._)(this,"validateParentFolderEmpty",async e=>{let t=await (0,T.v_)("".concat(this.endpoint,"/buckets/").concat(this.selectedBucket.id,"/objects/list"),{path:e,options:this.DEFAULT_OPTIONS});if(!t.error&&0===t.length){let t="".concat(e,"/").concat(D);await this.supabaseClient.storage.from(this.selectedBucket.name).upload(t,new File([],D))}}),(0,a._)(this,"deleteFolder",async e=>{let t=await this.getAllItemsAlongFolder(e);if(await this.deleteFiles(t,!0),this.popColumnAtIndex(e.columnIndex),this.popOpenedFoldersAtIndex(e.columnIndex-1),e.columnIndex>0){let t=this.openedFolders.slice(0,e.columnIndex).map(e=>e.name).join("/");t.length>0&&await this.validateParentFolderEmpty(t)}await this.refetchAllOpenedFolders(),this.clearSelectedItemsToDelete(),S.ZP.success("Successfully deleted ".concat(e.name))}),(0,a._)(this,"renameFolder",async(e,t,n)=>{let a=e.name;if(a===t)return this.updateRowStatus(a,E.R9.READY,n);let l=S.ZP.loading((0,s.jsx)(Z.q,{progress:0,message:"Renaming folder to ".concat(t),description:F}));if(t.includes("/")||t.includes("\\"))return S.ZP.error("Folder name cannot contain forward or back slashes.");this.updateRowStatus(a,E.R9.LOADING,n,t);let i=await this.getAllItemsAlongFolder(e),r=0,c=!1,d=i.map(e=>{let a="".concat(e.prefix,"/").concat(e.name),s=a.split("/"),l=s.slice(0,n).concat(t).concat(s.slice(n+1)).join("/");return()=>new Promise(async e=>{r+=1/i.length,(await (0,T.v_)("".concat(this.endpoint,"/buckets/").concat(this.selectedBucket.name,"/objects/move"),{from:a,to:l})).error&&(c=!0,S.ZP.error("Failed to move ".concat(a," to the new folder"))),e()})}),u=o()(d,2);try{await u.reduce(async(e,n)=>{await e,await Promise.all(n.map(e=>e())),S.ZP.loader((0,s.jsx)(Z.q,{progress:100*r,message:"Renaming folder to ".concat(t),description:F}),{id:l})},Promise.resolve()),c?S.ZP.error("Renamed folder to ".concat(t," with some errors"),{id:l}):S.ZP.success("Successfully renamed folder to ".concat(t),{id:l}),await this.refetchAllOpenedFolders();let e=i.map(e=>e.id),n=this.filePreviewCache.filter(t=>!e.includes(t.id));this.filePreviewCache=n}catch(e){S.ZP.error("Failed to rename folder to ".concat(t),{id:l})}}),(0,a._)(this,"getAllItemsAlongFolder",async e=>{var t,n;let a=[],s="",{name:l,columnIndex:i,prefix:r}=e;if(void 0===r){let e=this.openedFolders.slice(0,i).map(e=>e.name).join("/");s=e.length>0?"".concat(e,"/").concat(l):l}else s="".concat(r,"/").concat(l);let o={limit:1e4,offset:0,sortBy:{column:this.sortBy,order:this.sortByOrder}},c=[];for(;;){let e=await (0,T.v_)("".concat(this.endpoint,"/buckets/").concat(this.selectedBucket.name,"/objects/list"),{path:s,options:o});if(c=c.concat(e),o.offset+=o.limit,(e||[]).length<o.limit)break}let d=null!==(t=null==c?void 0:c.filter(e=>null===e.id))&&void 0!==t?t:[];return(null!==(n=null==c?void 0:c.filter(e=>null!==e.id))&&void 0!==n?n:[]).forEach(e=>a.push({...e,prefix:s})),(await Promise.all(d.map(e=>this.getAllItemsAlongFolder({...e,prefix:s})))).map(e=>{e.map(e=>a.push(e))}),a}),(0,a._)(this,"sanitizeNameForDuplicateInColumn",function(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.getLatestColumnIndex(),s=t.columns[a].items.filter(e=>e.status!==E.R9.EDITING);if(s.filter(t=>t.name===e).length>0){if(!n)return S.ZP.error("The name ".concat(e," already exists in the current directory. Please use a different name.")),null;{let[t,n]=e.split("."),a=new RegExp("".concat(t," \\([-0-9]+\\)").concat(n?"."+n:"","$")),l=s.filter(e=>e.name.match(a)),i=t+" (".concat(l.length+1,")");return n?"".concat(i,".").concat(n):i}}return e}),(0,a._)(this,"formatFolderItems",function(){var e,t;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return null!==(t=null===(e=null!=n?n:[])||void 0===e?void 0:e.filter(e=>e.name!==D).map(e=>{let t=e.id?E.fh.FILE:E.fh.FOLDER,n=Number(new Date)-Number(new Date(e.created_at)),a=t===E.fh.FILE&&!e.metadata&&n>=9e5,s=t===E.fh.FILE&&!e.metadata&&n<=9e5?E.R9.LOADING:E.R9.READY;return{...e,type:t,status:s,isCorrupted:a}}))&&void 0!==t?t:[]}),(0,a._)(this,"addTempRow",function(e,n,a,s){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],r=t.columns.map((t,r)=>{if(r===s){let s={type:e,name:n,status:a,metadata:l},r=i?[s].concat(t.items):t.items.concat([s]);return{...t,items:r}}return t});t.columns=r}),(0,a._)(this,"removeTempRows",e=>{let t=this.columns.map((t,n)=>{if(n===e){let e=t.items.filter(e=>f()(e,"id"));return{...t,items:e}}return t});this.columns=t}),(0,a._)(this,"setSelectedItemToRename",e=>{this.updateRowStatus(e.name,E.R9.EDITING,e.columnIndex)}),(0,a._)(this,"updateRowStatus",function(e,n){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.getLatestColumnIndex(),s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=t.columns.map((t,l)=>{if(l===a){let a=t.items.map(t=>t.name===e?{...t,status:n,...s&&{name:s}}:t);return{...t,items:a}}return t});t.columns=l}),(0,a._)(this,"updateFolderAfterEdit",function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.getLatestColumnIndex(),a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:E.R9.READY,s=t.columns.map((t,s)=>{if(s===n){let n=t.items.map(t=>{if(t.status===E.R9.EDITING){let n=new Date().toISOString();return{...t,status:a,name:e,createdAt:n,lastAccessedAt:n,updatedAt:n,metadata:null,id:null}}return t});return{...t,items:n}}return t});t.columns=s}),(0,a._)(this,"updateExplorerPreferences",()=>{let e=this.getLocalStorageKey(),t={view:this.view,sortBy:this.sortBy,sortByOrder:this.sortByOrder};return localStorage.setItem(e,JSON.stringify(t)),t}),(0,a._)(this,"loadExplorerPreferences",()=>{var e,t;let n=this.getLocalStorageKey(),a=null!==(t=null===(e=localStorage)||void 0===e?void 0:e.getItem(n))&&void 0!==t?t:void 0;if(void 0!==a){let{view:e,sortBy:t,sortByOrder:n}=JSON.parse(a);this.view=e,this.sortBy=t,this.sortByOrder=n}else{let{view:e,sortBy:t,sortByOrder:n}=this.updateExplorerPreferences();this.view=e,this.sortBy=t,this.sortByOrder=n}}),(0,a._)(this,"selectRangeItems",(e,t)=>{let n=this.columns[e].items,a=n[t],s=this.selectedItems.map(e=>e.id),l=s[s.length-1],i=x()(n,{id:l}),r=n.slice(Math.min(t,i),Math.max(t,i)+1).map(t=>({...t,columnIndex:e}));if(t<i&&r.reverse(),s.includes(a.id)){let e=r.map(e=>e.id);this.setSelectedItems(this.selectedItems.filter(t=>t.id===a.id||!e.includes(t.id)))}else this.setSelectedItems(_()(this.selectedItems.concat(r),"id"))}),(0,C.ky)(this,{supabaseClient:!1}),this.projectRef=e,this.abortController=new AbortController}}},47242:function(e,t,n){"use strict";n.r(t);var a=n(52322),s=n(2784),l=n(53174),i=n(64343),r=n(86630),o=n(3593),c=n(63598),d=n(27398),u=n(73579);let m=()=>{let e=(0,u._2)(),[t,n]=(0,s.useState)();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c._S,{children:(0,a.jsx)(c.jX,{children:(0,a.jsxs)("div",{className:"col-span-12",children:[(0,a.jsx)(d.ph,{title:"Database Tables"}),(0,a.jsx)(l.bw,{onAddTable:e.onAddTable,onEditTable:t=>{n(t),e.onEditTable()},onDeleteTable:t=>{n(t),e.onDeleteTable()}})]})})}),(0,a.jsx)(r.Z,{selectedTable:t}),(0,a.jsx)(i.l5,{includeColumns:!0,selectedTable:t})]})};m.getLayout=e=>(0,a.jsx)(o._h,{title:"Database",children:e}),t.default=m},58905:function(e,t,n){"use strict";var a=n(52322),s=n(88883),l=n(2784),i=n(63955),r=n(18773),o=n(12467),c=n(55350),d=n(56860),u=n(97351),m=n(27792),h=n(30195);let x=(0,l.forwardRef)((e,t)=>{let{title:n,size:l="small",onConfirm:x,visible:p,onCancel:f,loading:g,cancelLabel:j="Cancel",confirmLabel:v="Submit",confirmPlaceholder:b,confirmString:y,alert:N,input:w,label:_,description:C,formMessage:S,text:k,children:E,blockDeleteButton:Z=!0,variant:T="default",...R}=e,z=h.z.object({confirmValue:h.z.literal(y,{required_error:"Value entered does not match."})}),A=(0,i.cI)({resolver:(0,s.F)(z),defaultValues:{confirmValue:""}});return(0,a.jsx)(r.Vq,{open:p,...R,onOpenChange:()=>{p&&f()},children:(0,a.jsxs)(r.cZ,{ref:t,className:"p-0 gap-0 pb-5 !block",size:l,children:[(0,a.jsx)(r.fK,{className:(0,o.cn)("border-b"),padding:"small",children:(0,a.jsx)(r.$N,{className:"",children:n})}),N&&(0,a.jsx)(c.J,{type:T,label:N.title,description:N.description,className:"border-r-0 border-l-0 rounded-none -mt-px [&_svg]:ml-0.5 mb-0",...null==N?void 0:N.base}),E&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.VO,{padding:"small",children:E}),(0,a.jsx)(r.P3,{})]}),void 0!==k&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.VO,{className:"p-5",padding:"small",children:(0,a.jsx)("p",{className:"text-foreground-light text-sm",children:k})}),(0,a.jsx)(r.P3,{})]}),(0,a.jsx)(d.l0,{...A,children:(0,a.jsxs)("form",{onSubmit:A.handleSubmit(function(e){x()}),className:"px-5 flex flex-col gap-2 pt-3",children:[(0,a.jsx)(d.Wi,{control:A.control,name:"confirmValue",render:e=>{let{field:t}=e;return(0,a.jsxs)(d.xJ,{children:[(0,a.jsxs)(d.lX,{..._,children:["Type ",(0,a.jsx)("span",{className:"text-foreground break-all",children:y})," to confirm."]}),(0,a.jsx)(d.NI,{children:(0,a.jsx)(u.I,{placeholder:b,...w,...t})}),(0,a.jsx)(d.pf,{...C}),(0,a.jsx)(d.zG,{...S})]})}}),(0,a.jsxs)("div",{className:"flex gap-2",children:[!Z&&(0,a.jsx)(m.z,{size:"medium",block:!0,type:"default",disabled:g,children:j}),(0,a.jsx)(m.z,{block:!0,size:"medium",type:"destructive"===T?"danger":"warning"===T?"warning":"primary",htmlType:"submit",loading:g,disabled:g,className:"truncate",children:v})]})]})})]})})});x.displayName="TextConfirmModal",t.Z=x},33755:function(e,t,n){"use strict";n.d(t,{H:function(){return l},a:function(){return i}});var a=n(52322),s=n(9019);let l=e=>{let{name:t}=e;return(0,a.jsx)("div",{className:"text-typography-body-light [[data-theme*=dark]_&]:text-typography-body-dark flex cursor-not-allowed items-center space-x-2 rounded bg-gray-600 py-0.5 px-2 text-sm",children:(0,a.jsx)("span",{className:"opacity-50",children:t})})},i=e=>{let{name:t,handleRemove:n}=e;return(0,a.jsxs)("div",{className:"text-typography-body-light [[data-theme*=dark]_&]:text-typography-body-dark flex items-center space-x-2 rounded bg-surface-300 py-0.5 px-2 text-sm",onClick:e=>e.preventDefault(),children:[(0,a.jsx)("span",{children:t}),(0,a.jsx)(s.Z,{size:12,className:"cursor-pointer opacity-50 transition hover:opacity-100",onClick:e=>{e.preventDefault(),e.stopPropagation(),n()}})]})}},15698:function(e,t,n){"use strict";n.d(t,{Z:function(){return y}});var a=n(52322),s=n(6277),l=n(90882),i=n.n(l),r=n(34498),o=n.n(r),c=n(67304),d=n.n(c),u=n(2784),m=n(26120),h=n(56599),x=n(31840),p=n(34124),f=n(80203),g=n(16166),j=n(14279),v=n(98938),b=n(33755);function y(e){let{options:t,value:n,label:l,error:r,descriptionText:c,placeholder:y,searchPlaceholder:N="Search for option",emptyMessage:w,disabled:_,allowDuplicateSelection:C=!1,onChange:S=()=>{}}=e,k=(0,u.useRef)(null),[E,Z]=(0,u.useState)(!1),[T,R]=(0,u.useState)(n||[]),[z,A]=(0,u.useState)(""),[P,L]=(0,u.useState)(128),I=n||T;(0,u.useEffect)(()=>{L(k.current?k.current.offsetWidth:P)},[k.current]),(0,u.useEffect)(()=>{E||A("")},[E]);let D="".concat(P,"px"),F=o()(t,["disabled"],["desc"]),O=z.length>0?i()(F,e=>!e.disabled&&e.name.includes(z)):i()(F,{disabled:!1}),q=e=>void 0!==(I||[]).find(t=>t===e.value),W=e=>{let t=T.filter((t,n)=>n!==e);R(t),S(t)},U=e=>{let n=q(e),a=C?[...I.concat([e.value])]:n?[...d()(I,e.value)]:[...I.concat([e.value])],s=t.filter(e=>e.disabled).map(e=>e.name),l=C?a.concat(s):[...new Set(a.concat(s))];R(l),S(l)};return(0,a.jsxs)("div",{className:"form-group ".concat(_?"pointer-events-none opacity-50":""),children:[l&&(0,a.jsx)("label",{className:"!w-full",children:l}),(0,a.jsx)("div",{className:["form-control form-control--multi-select","border border-strong bg-control","multi-select relative block w-full space-x-1 overflow-auto rounded","".concat(void 0!==r?"border-red-800 bg-red-100":"")].join(" "),ref:k,children:(0,a.jsxs)(m.J2,{open:E,onOpenChange:Z,modal:!1,children:[(0,a.jsx)(m.xo,{asChild:!0,children:(0,a.jsxs)("div",{className:["flex w-full flex-wrap items-start gap-1.5 p-1.5 cursor-pointer","".concat(0===I.length?"h-9":"")].join(" "),onClick:()=>Z(!0),children:[0===I.length&&y&&(0,a.jsx)("div",{className:"px-2 text-sm text-foreground-light h-full flex items-center",children:y}),I.map((e,t)=>{var n;let s="".concat(e,"-").concat(t),l=F.find(t=>t.value===e),i=null!==(n=null==l?void 0:l.disabled)&&void 0!==n&&n;return l?i?(0,a.jsx)(b.H,{name:e},s):(0,a.jsx)(b.a,{name:e,handleRemove:()=>C?W(t):U(l)},s):(0,a.jsx)(a.Fragment,{})}),(0,a.jsx)("div",{className:"absolute inset-y-0 right-0 pl-3 pr-2 flex space-x-1 items-center cursor-pointer ",children:(0,a.jsx)(h.Z,{size:16,strokeWidth:2,className:"text-foreground-lighter"})})]})}),(0,a.jsxs)(m.yk,{className:"p-0",side:"bottom",align:"start",style:{width:D,marginLeft:"-5px"},children:[(0,a.jsx)(x.Z,{className:"[&>div>div>div>input]:!rounded-b-none [&>div>div>div>input]:!pl-9",icon:(0,a.jsx)(p.Z,{size:16}),placeholder:N,value:z,onChange:e=>A(e.target.value)}),(0,a.jsx)(f.x,{className:(0,s.default)("p-1",O.length>5?"h-[225px]":""),children:O.length>=1?O.map(e=>{let t=!!(!C&&I&&I.find(t=>t===e.value));return(0,a.jsxs)("div",{onClick:()=>U(e),className:["text-typography-body-light [[data-theme*=dark]_&]:text-typography-body-dark","group flex cursor-pointer items-center justify-between transition","space-x-1 rounded bg-transparent p-2 px-4 text-sm hover:bg-overlay-hover","".concat(t?" [[data-theme*=dark]_&]:bg-green-600 [[data-theme*=dark]_&]:bg-opacity-25":"")].join(" "),children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("p",{children:e.name}),void 0!==e.description&&(0,a.jsx)("p",{className:"opacity-50",children:e.description})]}),t&&(0,a.jsx)(g.Z,{size:16,strokeWidth:3,className:"cursor-pointer transition ".concat(t?"text-brand":"")}),C&&(0,a.jsxs)("div",{className:"flex items-center opacity-0 group-hover:opacity-100 transition space-x-1",children:[(0,a.jsx)(j.Z,{size:14}),(0,a.jsx)("p",{className:"text-sm",children:"Add value"})]})]},"multiselect-option-".concat(e.id))}):0===t.length?(0,a.jsx)("div",{className:"flex h-full w-full flex-col border-default items-center justify-center border border-dashed p-3",children:w||(0,a.jsxs)("div",{className:"flex w-full items-center space-x-2",children:[(0,a.jsx)(v.Z,{strokeWidth:1.5,size:18,className:"text-foreground-light"}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"No options available"})]})}):(0,a.jsx)("div",{className:"flex h-full w-full flex-col border-default items-center justify-center border border-dashed p-3",children:w||(0,a.jsx)("div",{className:"flex w-full items-center space-x-2",children:(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"No options found"})})})})]})]})}),c&&(0,a.jsx)("span",{className:"form-text text-muted mt-2 text-sm",children:c}),r&&(0,a.jsx)("span",{className:"text-red-900 text-sm mt-2",children:r})]})}},62767:function(e,t,n){"use strict";n.d(t,{A:function(){return i}});var a=n(52322),s=n(12467);let l=e=>{let{className:t,delayIndex:n=0,animationDelay:l=150}=e;return(0,a.jsx)("div",{className:(0,s.cn)("shimmering-loader rounded py-3",t),style:{animationFillMode:"backwards",animationDelay:"".concat(n*l,"ms")}})},i=()=>(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(l,{}),(0,a.jsx)(l,{className:"w-3/4"}),(0,a.jsx)(l,{className:"w-1/2"})]});t.Z=l},48378:function(e,t,n){"use strict";n.d(t,{E:function(){return b}});var a=n(52322),s=n(2784),l=n(56860),i=n(10929),r=n(12467),o=n(88130),c=n(19323);let d=(0,i.j)("grid gap-2",{variants:{size:{tiny:"text-xs",small:"text-sm leading-4",medium:"text-sm",large:"text-base",xlarge:"text-base"},align:{left:"",right:""},responsive:{true:"",false:""},layout:{horizontal:"grid grid-cols-12",vertical:"flex flex-col gap-3",flex:"flex flex-row gap-3"},flex:{true:"",false:""}},compoundVariants:[{layout:"flex",align:"right",className:"justify-between"}],defaultVariants:{}}),u=(0,i.j)("",{variants:{flex:{true:"",false:""},align:{left:"",right:""},layout:{horizontal:"flex flex-col gap-2 col-span-4",vertical:"flex flex-row gap-2 justify-between",flex:"flex flex-col gap-0"},labelLayout:{horizontal:"",vertical:"","":""}},compoundVariants:[{flex:!0,align:"left",className:"order-2"},{flex:!0,align:"right",className:"order-1"},{layout:"vertical",labelLayout:void 0,flex:!1,className:"flex flex-row gap-2 justify-between"},{layout:"horizontal",className:"flex flex-col gap-2"}],defaultVariants:{}}),m=(0,i.j)("",{variants:{flex:{true:"",false:""},align:{left:"order-1",right:"order-2"},layout:{horizontal:"",vertical:"",flex:""}},compoundVariants:[{flex:!0,align:"left",className:"order-1"},{flex:!0,align:"right",className:"order-2"},{layout:"vertical",className:"col-span-12"},{layout:"horizontal",align:"left",className:"col-span-8"},{layout:"horizontal",align:"right",className:"text-right"}],defaultVariants:{}}),h=(0,i.j)("text-foreground-lighter leading-normal",{variants:{size:{...c.NO.text},layout:{vertical:"mt-2",horizontal:"mt-2",flex:""}},defaultVariants:{}}),x=(0,i.j)("text-foreground-muted",{variants:{size:{...c.NO.text}},defaultVariants:{}}),p=(0,i.j)("text-foreground-muted",{variants:{size:{...c.NO.text}},defaultVariants:{}}),f=(0,i.j)("text-foreground-muted",{variants:{size:{...c.NO.text}},defaultVariants:{}}),g=(0,i.j)("",{variants:{flex:{true:"",false:""},align:{left:"",right:""}},compoundVariants:[{flex:!0,align:"left",className:""},{flex:!0,align:"right",className:"order-last"}]}),j=(0,i.j)("",{variants:{nonBoxInput:{true:"",false:""},label:{true:"",false:""},layout:{vertical:"",horizontal:""}},compoundVariants:[{nonBoxInput:!0,label:!0,layout:"vertical",className:"my-3"},{nonBoxInput:!0,label:!0,layout:"horizontal",className:"my-3 md:mt-0 mb-3"}],defaultVariants:{}}),v=s.forwardRef((e,t)=>{let{align:n="left",className:s,description:i,id:c,label:v,labelOptional:b,layout:y="vertical",style:N,labelLayout:w,size:_="medium",beforeLabel:C,afterLabel:S,nonBoxInput:k=!v,hideMessage:E=!1,isReactForm:Z,...T}=e,R="flex"===y,z=!!(v||C||S),A=Z&&!E&&(0,a.jsx)(l.zG,{className:"mt-2","data-formlayout-id":"message"}),P=i&&Z?(0,a.jsx)(l.pf,{className:(0,r.cn)(h({size:_,layout:y})),"data-formlayout-id":"description",id:c+"-description",children:i}):(0,a.jsx)("p",{className:(0,r.cn)(h({size:_,layout:y}),"text-sm text-foreground-light"),"data-formlayout-id":"description",children:i}),L=()=>(0,a.jsxs)(a.Fragment,{children:[C&&(0,a.jsx)("span",{className:(0,r.cn)(x({size:_})),id:c+"-before","data-formlayout-id":"beforeLabel",children:C}),v,S&&(0,a.jsx)("span",{className:(0,r.cn)(p({size:_})),id:c+"-after","data-formlayout-id":"afterLabel",children:S})]});return(0,a.jsxs)("div",{ref:t,...T,className:(0,r.cn)(d({size:_,flex:R,align:n,layout:y}),s),children:[R&&(0,a.jsx)("div",{className:(0,r.cn)(g({flex:R,align:n})),children:T.children}),z||b||"horizontal"===y?(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:(0,r.cn)(u({align:n,labelLayout:w,flex:R,layout:y})),"data-formlayout-id":"labelContainer",children:[z&&Z?(0,a.jsx)(l.lX,{className:"flex gap-2 items-center","data-formlayout-id":"formLabel",children:(0,a.jsx)(L,{})}):(0,a.jsx)(o._,{htmlFor:T.name,"data-formlayout-id":"label",className:"flex gap-2 items-center",children:(0,a.jsx)(L,{})}),b&&(0,a.jsx)("span",{className:(0,r.cn)(f({size:_})),id:c+"-optional","data-formlayout-id":"labelOptional",children:b}),R&&(0,a.jsxs)(a.Fragment,{children:[P,A]})]})}):null,!R&&(0,a.jsx)("div",{className:(0,r.cn)(m({align:n,layout:y})),style:N,"data-formlayout-id":"dataContainer",children:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:(0,r.cn)(j({nonBoxInput:k,label:v,layout:y})),"data-formlayout-id":"nonBoxInputContainer",children:T.children}),A,P]})})]})}),b=(0,s.forwardRef)((e,t)=>{let{...n}=e;return(0,a.jsx)(l.xJ,{children:(0,a.jsx)(v,{ref:t,isReactForm:!0,...n,children:n.children})})});b.displayName="FormItemLayout"},72978:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var a=n(52322),s=n(2784),l=n(24920),i=n(91952),r=n(87759);let o=(0,s.createContext)({parentCallback:e=>{},parentSize:""});function c(e){let{className:t,id:n="",name:s="",label:l,afterLabel:c,beforeLabel:d,description:u,checked:m,value:h,onChange:x,onBlur:p,size:f="medium",disabled:g=!1,...j}=e,{formContextOnChange:v,values:b,handleBlur:y}=(0,r.G)(),N=(0,i.Z)("checkbox");return(0,a.jsx)(o.Consumer,{children:e=>{let{parentCallback:i,parentSize:r}=e,o=n||s||(l?l.toLowerCase().replace(/^[^A-Z0-9]+/gi,"").replace(/ /g,"-"):void 0);f=r||f;let w=s||o,_=null!=m?m:void 0,C=[N.container];return t&&C.push(t),b&&void 0===m&&(_=b[n||s]),(0,a.jsxs)("div",{className:C.join(" "),children:[(0,a.jsx)("input",{id:o,name:w,type:"checkbox",className:[N.base,N.size[f]].join(" "),onChange:function(e){i&&i(e),x&&x(e),v&&v(e)},onBlur:function(e){y&&setTimeout(()=>{y(e)},100),p&&p(e)},checked:_,value:h||o,disabled:g,...j}),(0,a.jsxs)("label",{className:[N.label.base,N.label[f]].join(" "),htmlFor:o,children:[(0,a.jsxs)("span",{children:[d&&(0,a.jsx)("span",{className:[N.label_before.base,N.label_before[f]].join(" "),children:d}),l,c&&(0,a.jsx)("span",{className:[N.label_after.base,N.label_after[f]].join(" "),children:c})]}),u&&(0,a.jsx)("p",{className:[N.description.base,N.description[f]].join(" "),children:u})]})]})}})}c.Group=function(e){let{id:t,layout:n="vertical",error:s,descriptionText:r,label:d,afterLabel:u,beforeLabel:m,labelOptional:h,children:x,className:p,options:f,onChange:g,size:j="medium"}=e,v=(0,i.Z)("checkbox");return(0,a.jsx)(l.l,{label:d,afterLabel:u,beforeLabel:m,labelOptional:h,layout:n,id:t,error:s,descriptionText:r,className:p,size:j,children:(0,a.jsx)(o.Provider,{value:{parentCallback:e=>{g&&g(e)},parentSize:j},children:(0,a.jsx)("div",{className:v.group,children:f?f.map(e=>(0,a.jsx)(c,{id:e.id,value:e.value,label:e.label,beforeLabel:e.beforeLabel,afterLabel:e.afterLabel,checked:e.checked,name:e.name,description:e.description,defaultChecked:e.defaultChecked})):x})})})};var d=c},37268:function(e,t,n){"use strict";n.d(t,{d:function(){return N}});var a=n(52322),s=n(2784),l=n(72282),i=n(90028);let r=e=>({hljs:{display:"block",overflowX:"auto",color:e?"#ddd":"#888"},"hljs-tag":{color:"#569cd6"},"hljs-keyword":{color:"#569cd6",fontWeight:"normal"},"hljs-selector-tag":{color:"#569cd6",fontWeight:"normal"},"hljs-literal":{color:"#569cd6",fontWeight:"normal"},"hljs-strong":{color:"#569cd6"},"hljs-name":{color:"#569cd6"},"hljs-code":{color:"#66d9ef"},"hljs-class .hljs-title":{color:"gray"},"hljs-attribute":{color:"#bf79db"},"hljs-symbol":{color:"#bf79db"},"hljs-regexp":{color:"#bf79db"},"hljs-link":{color:"#bf79db"},"hljs-string":{color:"#3ECF8E"},"hljs-bullet":{color:"#3ECF8E"},"hljs-subst":{color:"#3ECF8E"},"hljs-title":{color:"#3ECF8E",fontWeight:"normal"},"hljs-section":{color:"#3ECF8E",fontWeight:"normal"},"hljs-emphasis":{color:"#3ECF8E"},"hljs-type":{color:"#3ECF8E",fontWeight:"normal"},"hljs-built_in":{color:"#3ECF8E"},"hljs-builtin-name":{color:"#3ECF8E"},"hljs-selector-attr":{color:"#3ECF8E"},"hljs-selector-pseudo":{color:"#3ECF8E"},"hljs-addition":{color:"#3ECF8E"},"hljs-variable":{color:"#3ECF8E"},"hljs-template-tag":{color:"#3ECF8E"},"hljs-template-variable":{color:"#3ECF8E"},"hljs-comment":{color:e?"#999":"#888"},"hljs-quote":{color:"#75715e"},"hljs-deletion":{color:"#75715e"},"hljs-meta":{color:"#75715e"},"hljs-doctag":{fontWeight:"normal"},"hljs-selector-id":{fontWeight:"normal"}});var o=n(12467),c=n(27792),d=n(16166),u=n(38282),m=n(86497),h=n(12463),x=n(31806),p=n(54299),f=n(14969),g=n(27666),j=n(88109),v=n(81303),b=n(83667),y=n(6659);let N=e=>{var t,n,N;let{title:w,language:_,linesToHighlight:C=[],className:S,value:k,children:E,hideCopy:Z=!1,hideLineNumbers:T=!1}=e,{resolvedTheme:R}=(0,y.F)(),z=null==R?void 0:R.includes("dark"),A=r(z),[P,L]=(0,s.useState)(!1),I=()=>{L(!0),setTimeout(()=>{L(!1)},1e3)},D=s.Children.toArray(E),[F]=1===D.length?D:[],O=null!==(n=null!=k?k:"string"==typeof F?F:void 0)&&void 0!==n?n:E,q="string"==typeof(O=null!==(N=null==O?void 0:null===(t=O.trimEnd)||void 0===t?void 0:t.call(O))&&void 0!==N?N:O)&&O.length<70?"short-inline-codeblock":"",W=_||(S?S.replace("language-",""):"js");"jsx"===W&&(W="js"),i.Z.registerLanguage("js",m.Z),i.Z.registerLanguage("ts",h.Z),i.Z.registerLanguage("py",p.Z),i.Z.registerLanguage("sql",f.Z),i.Z.registerLanguage("bash",g.Z),i.Z.registerLanguage("dart",j.Z),i.Z.registerLanguage("csharp",x.Z),i.Z.registerLanguage("json",v.Z),i.Z.registerLanguage("kotlin",b.Z),("bash"===W||"sh"===W)&&(T=!0);let U=!T;return(0,a.jsxs)(a.Fragment,{children:[w&&(0,a.jsx)("div",{className:"rounded-t-md bg-surface-100 py-2 px-4 border-b border-default text-blue-1100 font-sans",children:w.replace(/%20/g," ")}),S?(0,a.jsxs)("div",{className:"relative max-w-[90vw] md:max-w-none overflow-auto",children:[(0,a.jsx)(i.Z,{language:W,wrapLines:!0,style:A,className:(0,o.cn)("code-block border border-surface p-4 w-full !my-0 !bg-surface-100","".concat(w?"!rounded-t-none !rounded-b-md":"!rounded-md"),"".concat(U?"":"pl-6"),S),customStyle:{fontSize:13,lineHeight:1.4},showLineNumbers:U,lineProps:e=>C.includes(e)?{style:{display:"block",backgroundColor:"hsl(var(--background-selection))"}}:{},lineNumberContainerStyle:{paddingTop:"128px"},lineNumberStyle:{minWidth:"44px",paddingLeft:"4px",paddingRight:"4px",marginRight:"12px",color:"#828282",textAlign:"center",fontSize:12,paddingTop:"4px",paddingBottom:"4px"},children:O}),!Z&&(k||E)&&S?(0,a.jsx)("div",{className:["absolute right-2","".concat(z?"dark":""),"".concat(w?"top-[3.25rem]":"top-2")].join(" "),children:(0,a.jsx)(l,{text:k||E,children:(0,a.jsx)(c.z,{type:"default",icon:P?(0,a.jsx)(d.Z,{}):(0,a.jsx)(u.Z,{}),onClick:()=>I(),children:P?"Copied":""})})}):null]}):(0,a.jsx)("code",{className:q,children:k||E})]})}},15998:function(e,t,n){"use strict";var a=n(52322),s=n(69557);n(2784);var l=n(91952);let i=e=>{let{open:t,children:n,className:l,...i}=e;return(0,a.jsx)(s.fC,{asChild:i.asChild,defaultOpen:i.defaultOpen,open:t,onOpenChange:i.onOpenChange,disabled:i.disabled,className:l,children:n})};i.Trigger=function(e){let{children:t,asChild:n}=e;return(0,a.jsx)(s.xz,{asChild:n,children:t})},i.Content=function(e){let{asChild:t,children:n,className:i}=e,r=(0,l.Z)("collapsible");return(0,a.jsx)(s.VY,{asChild:t,className:[r.content,i].join(" "),children:n})},t.ZP=i},64606:function(e,t,n){"use strict";var a=n(52322);n(2784);var s=n(50468),l=n(83036);t.Z=function(e){return(0,a.jsx)(l.Z,{icon:s.Z,...e})}},17318:function(e,t,n){"use strict";var a=n(52322);n(2784);var s=n(27320),l=n(83036);t.Z=function(e){return(0,a.jsx)(l.Z,{icon:s.Z,...e})}},78174:function(e,t,n){"use strict";var a=n(52322);n(2784);var s=n(21079),l=n(83036);t.Z=function(e){return(0,a.jsx)(l.Z,{icon:s.Z,...e})}},3490:function(e,t,n){"use strict";var a=n(52322);n(2784);var s=n(78046),l=n(83036);t.Z=function(e){return(0,a.jsx)(l.Z,{icon:s.Z,...e})}},65028:function(e,t,n){"use strict";var a=n(52322);n(2784);var s=n(58951),l=n(83036);t.Z=function(e){return(0,a.jsx)(l.Z,{icon:s.Z,...e})}},50416:function(e,t,n){"use strict";var a=n(52322);n(2784);var s=n(29),l=n(83036);t.Z=function(e){return(0,a.jsx)(l.Z,{icon:s.Z,...e})}},52712:function(e,t,n){"use strict";var a=n(52322);n(2784);var s=n(83371),l=n(83036);t.Z=function(e){return(0,a.jsx)(l.Z,{icon:s.Z,...e})}},65283:function(e,t,n){"use strict";var a=n(52322);n(2784);var s=n(48869),l=n(83036);t.Z=function(e){return(0,a.jsx)(l.Z,{icon:s.Z,...e})}},82631:function(e,t,n){"use strict";var a=n(52322);n(2784);var s=n(70177),l=n(83036);t.Z=function(e){return(0,a.jsx)(l.Z,{icon:s.Z,...e})}},29078:function(e,t,n){"use strict";var a=n(52322);n(2784);var s=n(83178),l=n(83036);t.Z=function(e){return(0,a.jsx)(l.Z,{icon:s.Z,...e})}},79728:function(e,t,n){"use strict";var a=n(52322);n(2784);var s=n(97497),l=n(83036);t.Z=function(e){return(0,a.jsx)(l.Z,{icon:s.Z,...e})}},45236:function(e,t,n){"use strict";var a=n(52322);n(2784);var s=n(72681),l=n(83036);t.Z=function(e){return(0,a.jsx)(l.Z,{icon:s.Z,...e})}},69168:function(e,t,n){"use strict";var a=n(52322);n(2784);var s=n(72227),l=n(83036);t.Z=function(e){return(0,a.jsx)(l.Z,{icon:s.Z,...e})}},12203:function(e,t,n){"use strict";var a=n(52322);n(2784);var s=n(5152),l=n(83036);t.Z=function(e){return(0,a.jsx)(l.Z,{icon:s.Z,...e})}},63952:function(e,t,n){"use strict";var a=n(52322);n(2784);var s=n(94570),l=n(83036);t.Z=function(e){return(0,a.jsx)(l.Z,{icon:s.Z,...e})}},28024:function(e,t,n){"use strict";var a=n(52322);n(2784);var s=n(88951),l=n(83036);t.Z=function(e){return(0,a.jsx)(l.Z,{icon:s.Z,...e})}},34124:function(e,t,n){"use strict";var a=n(52322);n(2784);var s=n(32465),l=n(83036);t.Z=function(e){return(0,a.jsx)(l.Z,{icon:s.Z,...e})}},35723:function(e,t,n){"use strict";var a=n(52322);n(2784);var s=n(67270),l=n(83036);t.Z=function(e){return(0,a.jsx)(l.Z,{icon:s.Z,...e})}},97110:function(e,t,n){"use strict";var a=n(52322),s=n(2784),l=n(24920),i=n(74743),r=n(7231),o=n(91952),c=n(87759);t.Z=function(e){let{defaultValue:t,descriptionText:n,error:d,icon:u,inputRef:m,label:h,afterLabel:x,beforeLabel:p,labelOptional:f,layout:g,value:j,actions:v,size:b="medium",validation:y,id:N="",name:w="",..._}=e,C=(0,o.Z)("inputNumber"),{formContextOnChange:S,values:k,errors:E,handleBlur:Z,touched:T,fieldLevelValidation:R}=(0,c.G)();k&&!j&&(j=k[N||w]),d||(E&&!d&&(d=E[N||w]),d=T&&T[N||w]?d:void 0),(0,s.useEffect)(()=>{y&&R(N,y(j))},[]);let z=[C.base];return d&&z.push(C.variants.error),d||z.push(C.variants.standard),u&&z.push(C.with_icon),b&&z.push(C.size[b]),_.disabled&&z.push(C.disabled),(0,a.jsx)("div",{className:_.className,children:(0,a.jsx)(l.l,{label:h,afterLabel:x,beforeLabel:p,labelOptional:f,layout:g,id:N,error:d,descriptionText:n,style:_.style,size:b,children:(0,a.jsxs)("div",{className:C.container,children:[(0,a.jsx)("input",{"data-size":b,id:N,name:w,onChange:function(e){_.onChange&&_.onChange(e),S&&S(e),y&&R(N,y(e.target.value))},onBlur:function(e){Z&&Z(e),_.onBlur&&_.onBlur(e)},type:"number",ref:m,value:j,className:z.join(" "),..._}),u&&(0,a.jsx)(r.Z,{size:b,icon:u}),d||v?(0,a.jsxs)("div",{className:C.actions_container,children:[d&&(0,a.jsx)(i.Z,{size:b}),v&&v]}):null]})})})}},55380:function(e,t,n){"use strict";n.d(t,{Z:function(){return g}});var a=n(52322),s=n(46653),l=n(35676),i=n.n(l),r=n(2784),o=n(24920),c=n(74743),d=n(7231),u=n(91952),m=n(12467),h=n(87759),x=n(16166);let p=(0,r.createContext)({onChange:e=>{},selected:void 0});function f(e){let{children:t,className:n,buttonClassName:l,descriptionText:x,error:f,icon:g,id:j="",name:v="",label:b,labelOptional:y,layout:N,value:w,onChange:_,onFocus:C,onBlur:S,style:k,size:E="medium",defaultValue:Z,validation:T,disabled:R,optionsWidth:z}=e,[A,P]=(0,r.useState)(void 0),[L,I]=(0,r.useState)({}),D=(0,u.Z)("listbox"),F=(0,r.useRef)(null),{formContextOnChange:O,values:q,errors:W,handleBlur:U,touched:V,fieldLevelValidation:M}=(0,h.G)();q&&!w&&(w=q[j||v],Z=q[j||v]),f||(W&&!f&&(f=W[j||v]),f=V&&V[j||v]?f:void 0),(0,r.useEffect)(()=>{void 0!==w&&P(w)},[w]),(0,r.useEffect)(()=>{function e(){var e;document.documentElement.style.setProperty("--width-listbox","".concat(z||(null===(e=F.current)||void 0===e?void 0:e.offsetWidth),"px"))}return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),(0,r.useEffect)(()=>{var e;let n=i()(t);function a(e){return n.find(t=>t.props.value===e)}if(w){P(w);let e=a(w);I((null==e?void 0:e.props)?e.props:void 0);return}if(A){let e=a(A);I((null==e?void 0:e.props)?e.props:void 0);return}if(Z){P(Z);let e=a(A);I((null==e?void 0:e.props)?e.props:void 0);return}I(null===(e=n[0])||void 0===e?void 0:e.props)},[A]);let B=[D.container,D.base,l],K=[D.addOnBefore];return f&&B.push(D.variants.error),f||B.push(D.variants.standard),g&&K.push(D.with_icon),E&&B.push(D.size[E]),R&&B.push(D.disabled),(0,a.jsx)(o.l,{label:b,labelOptional:y,layout:N,id:j,error:f,descriptionText:x,className:n,style:k,size:E,children:(0,a.jsxs)(s.fC,{children:[(0,a.jsx)(s.xz,{asChild:!0,disabled:R,children:(0,a.jsxs)("button",{"data-size":E,ref:F,className:(0,m.cn)(B),onBlur:function(e){U&&U(e),S&&S(e)},onFocus:C,name:v,id:j,children:[(0,a.jsxs)("span",{className:(0,m.cn)(K),children:[g&&(0,a.jsx)(d.Z,{size:E,icon:g}),(null==L?void 0:L.addOnBefore)&&(0,a.jsx)(L.addOnBefore,{}),(0,a.jsx)("span",{className:D.label,children:null==L?void 0:L.label})]}),(0,a.jsx)("span",{className:D.chevron_container,children:(0,a.jsx)("svg",{className:D.chevron,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L10 5.414 7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3zm-3.707 9.293a1 1 0 011.414 0L10 14.586l2.293-2.293a1 1 0 011.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})})}),f&&(0,a.jsx)("div",{className:D.actions_container,children:f&&(0,a.jsx)(c.Z,{size:E})})]})}),(0,a.jsx)(s.VY,{sideOffset:6,loop:!0,side:"bottom",align:"center",className:D.options_container,children:(0,a.jsx)("div",{children:(0,a.jsx)(p.Provider,{value:{onChange:function(e){_&&_(e),P(e);let t={};t.target={type:"select",name:v,id:j,value:e,checked:void 0},O&&O(t),T&&M(j,T(e))},selected:A},children:t})})})]})})}f.Option=function(e){let{id:t,value:n,label:l,disabled:i=!1,children:r,className:o="",addOnBefore:c}=e,d=(0,u.Z)("listbox");return(0,a.jsx)(p.Consumer,{children:e=>{let{onChange:l,selected:u}=e,h=u===n;return(0,a.jsxs)(s.ck,{className:(0,m.cn)(d.option,h?d.option_active:" ",i?d.option_disabled:" ",o),onSelect:()=>i?{}:l(n),children:[(0,a.jsxs)("div",{className:d.option_inner,children:[c&&c({active:h,selected:u}),(0,a.jsx)("span",{children:"function"==typeof r?r({active:h,selected:u}):r})]}),h?(0,a.jsx)("span",{className:(0,m.cn)(d.option_check,h?d.option_check_active:""),children:(0,a.jsx)(x.Z,{className:d.option_check_icon,"aria-hidden":"true"})}):null]},t)}})};var g=f},72762:function(e,t,n){"use strict";n.d(t,{ZP:function(){return m}});var a=n(52322),s=n(2784),l=n(91952),i=n(12467);function r(e){let{children:t,className:n,tag:s="div",style:l}=e;return(0,a.jsx)("".concat(s),{style:l,children:t})}r.Title=function(e){let{className:t,level:n=1,children:s,style:l}=e;return(0,a.jsx)("h".concat(n),{style:l,children:s})},r.Text=function(e){let{className:t,children:n,style:s,type:l,disabled:i,mark:r,code:o,keyboard:c,underline:d,strikethrough:u,strong:m,small:h}=e;return o?(0,a.jsx)("code",{style:s,children:n}):r?(0,a.jsx)("mark",{style:s,children:n}):c?(0,a.jsx)("kbd",{style:s,children:n}):m?(0,a.jsx)("strong",{style:s,children:n}):(0,a.jsx)("span",{style:s,children:n})},r.Link=function(e){let{children:t,target:n="_blank",href:s,className:l,onClick:i,style:r}=e;return(0,a.jsx)("a",{onClick:i,href:s,target:n,rel:"noopener noreferrer",style:r,children:t})};let o=(0,s.createContext)({type:"text"}),c=e=>{let{type:t}=e;return(0,a.jsx)(o.Provider,{value:{type:t},children:e.children})},d=()=>{let e=(0,s.useContext)(o);if(void 0===e)throw Error("MenuContext must be used within a MenuContextProvider.");return e};function u(e){let{children:t,className:n,ulClassName:s,style:l,type:i="text"}=e;return(0,a.jsx)("nav",{role:"menu","aria-label":"Sidebar","aria-orientation":"vertical","aria-labelledby":"options-menu",className:n,style:l,children:(0,a.jsx)(c,{type:i,children:(0,a.jsx)("ul",{className:s,children:t})})})}u.Item=function(e){let{children:t,icon:n,active:s,rounded:r,onClick:o,doNotCloseOverlay:c=!1,showActiveBar:u=!1,style:m}=e,h=(0,l.Z)("menu"),{type:x}=d(),p=[h.item.base];p.push(h.item.variants[x].base),s?p.push(h.item.variants[x].active):p.push(h.item.variants[x].normal);let f=[h.item.content.base];s?f.push(h.item.content.active):f.push(h.item.content.normal);let g=[h.item.icon.base];return s?g.push(h.item.icon.active):g.push(h.item.icon.normal),(0,a.jsxs)("li",{role:"menuitem",className:(0,i.cn)("outline-none",p),style:m,onClick:o,"aria-current":s?"page":void 0,children:[n&&(0,a.jsx)("div",{className:"".concat(g.join(" ")," min-w-fit"),children:n}),(0,a.jsx)("span",{className:f.join(" "),children:t})]})},u.Group=function(e){let{children:t,icon:n,title:s}=e,i=(0,l.Z)("menu"),{type:r}=d();return(0,a.jsxs)("div",{className:[i.group.base,i.group.variants[r]].join(" "),children:[n&&(0,a.jsx)("span",{className:i.group.icon,children:n}),(0,a.jsx)("span",{className:i.group.content,children:s}),t]})},u.Misc=function(e){let{children:t}=e;return(0,a.jsx)("div",{children:(0,a.jsx)(r.Text,{children:(0,a.jsx)("span",{children:t})})})};var m=u},29947:function(e,t,n){"use strict";n.d(t,{M:function(){return i},_:function(){return r}});var a=n(52322),s=n(2784),l=n(12467);let i=(0,s.forwardRef)((e,t)=>(0,a.jsx)("nav",{ref:t,dir:"ltr",...e,className:(0,l.cn)("border-b",e.className),children:(0,a.jsx)("ul",{role:"menu",children:e.children})})),r=e=>{let{children:t,className:n,active:s,...i}=e;return(0,a.jsx)("li",{"aria-selected":s?"true":"false","data-state":s?"active":"inactive",className:(0,l.cn)("inline-flex items-center justify-center whitespace-nowrap text-sm ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground text-foreground-lighter hover:text-foreground data-[state=active]:border-foreground border-b-2 border-transparent *:px-3 *:py-1.5",n),...i,children:t})}},11158:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var a=n(52322),s=n(2784),l=n(24920),i=n(91952),r=n(87759);let o=(0,s.createContext)({parentCallback:e=>{},type:"",name:"",activeId:"",parentSize:""});function c(e){let{id:t=("00000"+(46656*Math.random()|0).toString(36)).slice(-3)+("00000"+(46656*Math.random()|0).toString(36)).slice(-3),disabled:n,value:s,label:l,afterLabel:c,beforeLabel:d,description:u,name:m,checked:h,className:x,onChange:p,onBlur:f,hidden:g=!1,size:j="medium",align:v="vertical",optionalLabel:b,addOnBefore:y,children:N}=e,w=(0,i.Z)("radio"),{handleBlur:_}=(0,r.G)();function C(e){_&&_(e),f&&f(e)}return(0,a.jsx)(o.Consumer,{children:e=>{let{parentCallback:i,type:r,name:o,activeId:f,parentSize:_}=e;j=_||j;let S=f===t||!!h||!1!==h&&void 0,k=[x,w.variants[r].container.base,"list"===r&&!g&&w.variants[r].container.size[j]];return k.push(w.variants[r].base),k.push(w.variants[r].size[j]),S?k.push(w.variants[r].active):k.push(w.variants[r].inactive),n&&k.push(w.disabled),"list"!==r&&(g=!0),(0,a.jsxs)("label",{htmlFor:t,className:k.join(" "),children:[(0,a.jsx)("input",{id:t,name:o||m,type:"radio",className:[w.base,w.size[j],g&&w.hidden,w.variants[r].radio_offset,""].join(" "),checked:S,disabled:n,value:s||t,onChange:e=>{i&&i(e),p&&p(e)},onBlur:C}),y,N||(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:[w.label.base,w.label[j],w.variants[r].container.align[v]].join(" "),children:[d&&(0,a.jsx)("div",{className:[w.label_before.base,w.label_before[j]].join(" "),children:d}),(0,a.jsx)("div",{children:l}),c&&(0,a.jsx)("div",{className:[w.label_after.base,w.label_after[j]].join(" "),children:c}),u&&(0,a.jsx)("div",{className:[w.description.base,w.description[j]].join(" "),children:u})]}),b&&(0,a.jsx)("div",{className:[w.optionalLabel.base,w.optionalLabel[j]].join(" "),children:b})]})]})}})}c.Group=function(e){let{id:t,layout:n,error:d,descriptionText:u,label:m,afterLabel:h,beforeLabel:x,labelOptional:p,children:f,className:g,type:j="list",options:v,value:b,name:y,onChange:N,size:w="medium",validation:_,groupClassName:C,labelsLayout:S="vertical"}=e,[k,E]=(0,s.useState)(""),Z=(0,i.Z)("radio"),{formContextOnChange:T,values:R,errors:z,touched:A,fieldLevelValidation:P}=(0,r.G)();return R&&!b&&(b=R[t||y]),d||(z&&!d&&(d=z[t||y]),d=A&&A[t||y]?d:void 0),(0,s.useEffect)(()=>{_&&P(t,_(b))},[]),(0,s.useEffect)(()=>{E(b)},[b]),(0,a.jsx)("fieldset",{name:y,className:g,children:(0,a.jsx)(l.l,{nonBoxInput:!0,label:m,afterLabel:h,beforeLabel:x,labelOptional:p,layout:n,id:t,error:d,descriptionText:u,size:w,labelLayout:S,children:(0,a.jsx)("div",{className:C||Z.variants[j].group,children:(0,a.jsx)(o.Provider,{value:{parentCallback:function(e){N&&N(e),T&&T(e),_&&P(t,_(e.target.value)),E(e.target.id)},type:j,name:y,activeId:k,parentSize:w},children:v?v.map(e=>(0,a.jsx)(c,{id:e.id,label:e.label,beforeLabel:e.beforeLabel,afterLabel:e.afterLabel,value:e.value,description:e.description})):f})})})})};var d=c},14774:function(e,t,n){"use strict";var a=n(52322),s=n(2784),l=n(24920),i=n(74743),r=n(7231),o=n(91952),c=n(87759);function d(e){let{autoComplete:t,autofocus:n,children:d,className:u,descriptionText:m,disabled:h,error:x,icon:p,id:f="",inputRef:g,label:j,afterLabel:v,beforeLabel:b,labelOptional:y,layout:N,name:w="",onChange:_,onBlur:C,placeholder:S,required:k,value:E,defaultValue:Z,style:T,size:R="medium",borderless:z=!1,validation:A,...P}=e,{formContextOnChange:L,values:I,errors:D,handleBlur:F,touched:O,fieldLevelValidation:q}=(0,c.G)();I&&!E&&(E=I[f]),x||(D&&!x&&(x=D[f||w]),x=O&&O[f||w]?x:void 0),(0,s.useEffect)(()=>{A&&q(f,A(E))},[]);let W=(0,o.Z)("select"),U=[W.container];u&&U.push(u);let V=[W.base];return x&&V.push(W.variants.error),x||V.push(W.variants.standard),p&&V.push(W.with_icon),R&&V.push(W.size[R]),h&&V.push(W.disabled),(0,a.jsx)(l.l,{label:j,afterLabel:v,beforeLabel:b,labelOptional:y,layout:N,id:f,error:x,descriptionText:m,className:u,style:T,size:R,children:(0,a.jsxs)("div",{className:W.container,children:[(0,a.jsx)("select",{id:f,name:w,"data-size":R,defaultValue:Z,autoComplete:t,autoFocus:n,className:V.join(" "),onChange:function(e){_&&_(e),L&&L(e),A&&q(f,A(e.target.value))},onBlur:function(e){F&&F(e),C&&C(e)},ref:g,value:E,disabled:h,required:k,placeholder:S,...P,children:d}),p&&(0,a.jsx)(r.Z,{size:R,icon:p}),x&&(0,a.jsx)("div",{className:W.actions_container,children:x&&(0,a.jsx)(i.Z,{size:R})}),(0,a.jsx)("span",{className:W.chevron_container,children:(0,a.jsx)("svg",{className:W.chevron,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L10 5.414 7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3zm-3.707 9.293a1 1 0 011.414 0L10 14.586l2.293-2.293a1 1 0 011.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})})}d.Option=function(e){let{value:t,children:n,selected:s}=e;return(0,a.jsx)("option",{value:t,selected:s,children:n})},d.OptGroup=function(e){let{label:t,children:n}=e;return(0,a.jsx)("optgroup",{label:t,children:n})},t.ZP=d},832:function(e,t,n){"use strict";n.d(t,{Yi:function(){return o},bZ:function(){return c},zs:function(){return r}});var a=n(52322),s=n(83997),l=n(2784),i=n(12467);let r=s.fC,o=s.xz,c=l.forwardRef((e,t)=>{let{className:n,align:l="center",animate:r="zoom-in",sideOffset:o=4,...c}=e;return(0,a.jsx)(s.VY,{ref:t,align:l,sideOffset:o,className:(0,i.cn)("z-50 w-64 rounded-md border bg-overlay p-4 text-popover-foreground shadow-md outline-none","zoom-in"===r?"animate-in zoom-in-[99%]":"animate-in fade-in-50 data-[side=bottom]:slide-in-from-top-1 data-[side=left]:slide-in-from-right-1 data-[side=right]:slide-in-from-left-1 data-[side=top]:slide-in-from-bottom-1",n),...c})});c.displayName=s.VY.displayName},4260:function(e,t,n){"use strict";n.d(t,{Bw:function(){return f},DI:function(){return m},Ph:function(){return u},Ql:function(){return g},U$:function(){return j},i4:function(){return p},ki:function(){return h}});var a=n(52322),s=n(38947),l=n(81395),i=n(83030),r=n(2784),o=n(12467),c=n(10929),d=n(19323);let u=s.fC,m=s.ZA,h=s.B4,x=(0,c.j)("",{variants:{size:{...d.Ld}},defaultVariants:{size:d.Rc}}),p=r.forwardRef((e,t)=>{let{className:n,children:i,size:r,...c}=e;return(0,a.jsxs)(s.xz,{ref:t,className:(0,o.cn)("flex w-full items-center justify-between rounded-md border border-button bg-button text-xs ring-offset-background-control placeholder:text-foreground-muted focus:outline-none ring-border-control focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",x({size:r}),n),...c,children:[i,(0,a.jsx)(s.JO,{asChild:!0,children:(0,a.jsx)(l.Z,{className:"h-4 w-4 text-foreground-muted"})})]})});p.displayName=s.xz.displayName;let f=r.forwardRef((e,t)=>{let{className:n,children:l,position:i="popper",...r}=e;return(0,a.jsx)(s.h_,{children:(0,a.jsx)(s.VY,{ref:t,className:(0,o.cn)("relative z-50 min-w-[8rem] overflow-hidden rounded-md border bg-overlay text-popover-foreground shadow-md animate-in fade-in-80","popper"===i&&"translate-y-1",n),position:i,...r,children:(0,a.jsx)(s.l_,{className:(0,o.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:l})})})});f.displayName=s.VY.displayName,r.forwardRef((e,t)=>{let{className:n,...l}=e;return(0,a.jsx)(s.__,{ref:t,className:(0,o.cn)("py-1.5 pl-8 pr-2 text-xs text-foreground-lighter",n),...l})}).displayName=s.__.displayName;let g=r.forwardRef((e,t)=>{let{className:n,children:l,...r}=e;return(0,a.jsxs)(s.ck,{ref:t,className:(0,o.cn)("group","relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-xs outline-none focus:bg-overlay-hover text-foreground-lighter focus:text-foreground data-[state=checked]:text-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...r,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(s.wU,{className:"h-3.5 w-3.5 bg-foreground rounded-full flex justify-center items-center",children:(0,a.jsx)(i.Z,{className:"h-2 w-2 text-background-overlay",strokeWidth:6})})}),(0,a.jsx)(s.eT,{children:l})]})});g.displayName=s.ck.displayName;let j=r.forwardRef((e,t)=>{let{className:n,...l}=e;return(0,a.jsx)(s.Z0,{ref:t,className:(0,o.cn)("-mx-1 my-1 h-px bg-border-overlay",n),...l})});j.displayName=s.Z0.displayName},66243:function(e,t,n){"use strict";n.d(t,{DN:function(){return g},FF:function(){return j},Tu:function(){return f},bC:function(){return v},sw:function(){return d},ue:function(){return p},yo:function(){return c}});var a=n(52322),s=n(70241),l=n(10929),i=n(2784),r=n(88724),o=n(12467);let c=s.fC;s.xz;let d=s.x8,u=(0,l.j)("fixed inset-0 z-40 flex",{variants:{side:{top:"items-start",bottom:"items-end",left:"justify-start",right:"justify-end"}},defaultVariants:{side:"right"}}),m=e=>{let{side:t,children:n,...l}=e;return(0,a.jsx)(s.h_,{...l,children:(0,a.jsx)("div",{className:u({side:t}),children:n})})};m.displayName=s.h_.displayName;let h=i.forwardRef((e,t)=>{let{className:n,children:l,...i}=e;return(0,a.jsx)(s.aV,{className:(0,o.cn)("fixed inset-0 z-40 bg-alternative/90 backdrop-blur-sm transition-all duration-100 data-[state=closed]:animate-out data-[state=closed]:fade-out data-[state=open]:fade-in",n),...i,ref:t})});h.displayName=s.aV.displayName;let x=(0,l.j)("fixed z-40 scale-100 gap-4 bg-studio opacity-100 shadow-lg",{variants:{side:{top:"animate-in slide-in-from-top w-full duration-300 border-b",bottom:"animate-in slide-in-from-bottom w-full duration-300 border-t",left:"animate-in slide-in-from-left h-full duration-300 border-r",right:"animate-in slide-in-from-right h-full duration-300 border-l"},size:{content:"",default:"",sm:"",lg:"",xl:"",xxl:"",full:""}},compoundVariants:[{side:["top","bottom"],size:"content",class:"max-h-screen"},{side:["top","bottom"],size:"default",class:"h-1/3"},{side:["top","bottom"],size:"sm",class:"h-1/4"},{side:["top","bottom"],size:"lg",class:"h-1/2"},{side:["top","bottom"],size:"xl",class:"h-5/6"},{side:["top","bottom"],size:"full",class:"h-screen"},{side:["right","left"],size:"content",class:"max-w-screen"},{side:["right","left"],size:"default",class:"w-1/3"},{side:["right","left"],size:"sm",class:"w-1/4"},{side:["right","left"],size:"lg",class:"w-1/2"},{side:["right","left"],size:"xl",class:"w-4/6"},{side:["right","left"],size:"xxl",class:"w-5/6"},{side:["right","left"],size:"full",class:"w-screen"}],defaultVariants:{side:"right",size:"default"}}),p=i.forwardRef((e,t)=>{let{side:n,size:l,className:i,children:c,showClose:d=!0,...u}=e;return(0,a.jsxs)(m,{side:n,children:[(0,a.jsx)(h,{}),(0,a.jsxs)(s.VY,{ref:t,className:(0,o.cn)(x({side:n,size:l}),i),...u,children:[c,d?(0,a.jsxs)(s.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,a.jsx)(r.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]}):null]})]})});p.displayName=s.VY.displayName;let f=e=>{let{className:t,...n}=e;return(0,a.jsx)("div",{className:(0,o.cn)("px-5 py-4 text-center sm:text-left border-b",t),...n})};f.displayName="SheetHeader";let g=e=>{let{className:t,...n}=e;return(0,a.jsx)("div",{className:(0,o.cn)("px-content py-content",t),...n})};g.displayName="SheetSection";let j=e=>{let{className:t,...n}=e;return(0,a.jsx)("div",{className:(0,o.cn)("px-5 py-3 border-t w-full","flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...n})};j.displayName="SheetFooter";let v=i.forwardRef((e,t)=>{let{className:n,...l}=e;return(0,a.jsx)(s.Dx,{ref:t,className:(0,o.cn)("text-base text-foreground",n),...l})});v.displayName=s.Dx.displayName,i.forwardRef((e,t)=>{let{className:n,...l}=e;return(0,a.jsx)(s.dk,{ref:t,className:(0,o.cn)("text-sm text-foreground-muted",n),...l})}).displayName=s.dk.displayName},79268:function(e,t,n){"use strict";n.d(t,{r:function(){return d}});var a=n(52322),s=n(16530),l=n(10929),i=n(2784),r=n(12467);let o=(0,l.j)("peer inline-flex shrink-0 cursor-pointer items-center rounded-full border transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-brand data-[state=checked]:hover:bg-brand-600/90 data-[state=unchecked]:bg-control data-[state=unchecked]:hover:bg-border",{variants:{size:{small:"h-[16px] w-[28px]",medium:"h-[20px] w-[34px]",large:"h-[24px] w-[44px]"}},defaultVariants:{size:"medium"}}),c=(0,l.j)("pointer-events-none block rounded-full bg-foreground-lighter data-[state=checked]:bg-white shadow-lg ring-0 transition-transform",{variants:{size:{small:"h-[12px] w-[12px] data-[state=checked]:translate-x-[13px] data-[state=unchecked]:translate-x-[1px]",medium:"h-[16px] w-[16px] data-[state=checked]:translate-x-[15px] data-[state=unchecked]:translate-x-[1px]",large:"h-[18px] w-[18px] data-[state=checked]:translate-x-[22px] data-[state=unchecked]:translate-x-[3px]"}},defaultVariants:{size:"medium"}}),d=i.forwardRef((e,t)=>{let{className:n,size:l,...i}=e;return(0,a.jsx)(s.fC,{className:(0,r.cn)(o({size:l}),n),...i,ref:t,children:(0,a.jsx)(s.bU,{className:(0,r.cn)(c({size:l}))})})});d.displayName=s.fC.displayName},38147:function(e,t,n){"use strict";n.d(t,{c:function(){return o}});var a=n(52322),s=n(2784),l=n(37005),i=n.n(l),r=n(12467);let o=e=>{let{loading:t=!1,className:n,allowHoverEffect:l=!1}=e,[o,c]=(0,s.useState)(1),[d,u]=(0,s.useState)(1),[m,h]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{let e=setInterval(()=>{t&&(h(!0),c(e=>e%5+1),u(e=>e%5+1))},500);return()=>clearInterval(e)},[t]),(0,s.useEffect)(()=>{!1===t&&(setTimeout(()=>{h(!1)},500),c(1))},[t]),(0,a.jsx)("div",{className:(0,r.cn)(i()["ai-icon__container"],l&&i()["ai-icon__container--allow-hover-effect"],t&&m&&i()["spin-ai-icon-container"],n),children:(0,a.jsxs)("div",{className:(0,r.cn)(i()["ai-icon__grid"]),children:[(0,a.jsx)("div",{className:(0,r.cn)(i()["ai-icon__grid__square"],t?i()["ai-icon__grid__square--step-".concat(o)]:m?i()["ai-icon__grid__square--exiting--step-".concat(d)]:i()["ai-icon__grid__square--static"])}),(0,a.jsx)("div",{className:(0,r.cn)(i()["ai-icon__grid__square"],t?i()["ai-icon__grid__square--step-".concat(o)]:m?i()["ai-icon__grid__square--exiting--step-".concat(d)]:i()["ai-icon__grid__square--static"])}),(0,a.jsx)("div",{className:(0,r.cn)(i()["ai-icon__grid__square"],t?i()["ai-icon__grid__square--step-".concat(o)]:m?i()["ai-icon__grid__square--exiting--step-".concat(d)]:i()["ai-icon__grid__square--static"])}),(0,a.jsx)("div",{className:(0,r.cn)(i()["ai-icon__grid__square"],t?i()["ai-icon__grid__square--step-".concat(o)]:m?i()["ai-icon__grid__square--exiting--step-".concat(d)]:i()["ai-icon__grid__square--static"])})]})})}},37005:function(e){e.exports={"spin-ai-icon-container":"ai-icon-animation-style_spin-ai-icon-container__7sgAA",spinAiIconContainer:"ai-icon-animation-style_spinAiIconContainer__rBP6P","ai-icon__container":"ai-icon-animation-style_ai-icon__container__2aXBS","ai-icon__grid":"ai-icon-animation-style_ai-icon__grid__Qrwxf","ai-icon__grid__square":"ai-icon-animation-style_ai-icon__grid__square__YU8EZ","ai-icon__grid__square--static":"ai-icon-animation-style_ai-icon__grid__square--static__1tOM_","ai-icon__container--allow-hover-effect":"ai-icon-animation-style_ai-icon__container--allow-hover-effect__HrB86","ai-icon__grid__square--step-1":"ai-icon-animation-style_ai-icon__grid__square--step-1__KATlI",step1_square1:"ai-icon-animation-style_step1_square1__BIjL3",step1_square2:"ai-icon-animation-style_step1_square2__QzsE7",step1_square3:"ai-icon-animation-style_step1_square3__ls1SO",step1_square4:"ai-icon-animation-style_step1_square4__Kk8zi","ai-icon__grid__square--step-2":"ai-icon-animation-style_ai-icon__grid__square--step-2__9OoIG",step2_square1:"ai-icon-animation-style_step2_square1__o_hcu",step2_square2:"ai-icon-animation-style_step2_square2__HBZt7",step2_square3:"ai-icon-animation-style_step2_square3__K6E2K",step2_square4:"ai-icon-animation-style_step2_square4__oDGDL","ai-icon__grid__square--step-3":"ai-icon-animation-style_ai-icon__grid__square--step-3__RldL4",step3_square1:"ai-icon-animation-style_step3_square1__Oo6vT",step3_square2:"ai-icon-animation-style_step3_square2__36Os9",step3_square3:"ai-icon-animation-style_step3_square3__Nj5rc",step3_square4:"ai-icon-animation-style_step3_square4__OFVFh","ai-icon__grid__square--step-4":"ai-icon-animation-style_ai-icon__grid__square--step-4__7o69c",step4_square1:"ai-icon-animation-style_step4_square1__G_8pn",step4_square2:"ai-icon-animation-style_step4_square2__KHYf3",step4_square3:"ai-icon-animation-style_step4_square3__XON12",step4_square4:"ai-icon-animation-style_step4_square4__Aq8dV","ai-icon__grid__square--step-5":"ai-icon-animation-style_ai-icon__grid__square--step-5__cF2Rx",step5_square1:"ai-icon-animation-style_step5_square1__me9Ru",step5_square2:"ai-icon-animation-style_step5_square2__0Ydfw",step5_square3:"ai-icon-animation-style_step5_square3__bOHqW",step5_square4:"ai-icon-animation-style_step5_square4__m2l32","ai-icon__grid__square--exiting--step-1":"ai-icon-animation-style_ai-icon__grid__square--exiting--step-1__JYREY",exit_step1_square1:"ai-icon-animation-style_exit_step1_square1__C_GBC",exit_step1_square2:"ai-icon-animation-style_exit_step1_square2__TID0l",exit_step1_square3:"ai-icon-animation-style_exit_step1_square3__ADmUT",exit_step1_square4:"ai-icon-animation-style_exit_step1_square4__kilu_","ai-icon__grid__square--exiting--step-2":"ai-icon-animation-style_ai-icon__grid__square--exiting--step-2__kDUVt",exit_step2_square1:"ai-icon-animation-style_exit_step2_square1__vmYa5",exit_step2_square2:"ai-icon-animation-style_exit_step2_square2__zxv0q",exit_step2_square3:"ai-icon-animation-style_exit_step2_square3__Dhey5",exit_step2_square4:"ai-icon-animation-style_exit_step2_square4__P1UKx","ai-icon__grid__square--exiting--step-3":"ai-icon-animation-style_ai-icon__grid__square--exiting--step-3__h48Ts",exit_step3_square1:"ai-icon-animation-style_exit_step3_square1__l1FKu",exit_step3_square2:"ai-icon-animation-style_exit_step3_square2__4RPQL",exit_step3_square3:"ai-icon-animation-style_exit_step3_square3__s2vMz",exit_step3_square4:"ai-icon-animation-style_exit_step3_square4__Zros9","ai-icon__grid__square--exiting--step-4":"ai-icon-animation-style_ai-icon__grid__square--exiting--step-4__VEmk_",exit_step4_square1:"ai-icon-animation-style_exit_step4_square1__bG99O",exit_step4_square2:"ai-icon-animation-style_exit_step4_square2__1Fxvf",exit_step4_square3:"ai-icon-animation-style_exit_step4_square3__EWeB7",exit_step4_square4:"ai-icon-animation-style_exit_step4_square4__HC5ov","ai-icon__grid__square--exiting--step-5":"ai-icon-animation-style_ai-icon__grid__square--exiting--step-5___9jFB",exit_step5_square1:"ai-icon-animation-style_exit_step5_square1__w4ctB",exit_step5_square2:"ai-icon-animation-style_exit_step5_square2__UZdas",exit_step5_square3:"ai-icon-animation-style_exit_step5_square3__O_mvc",exit_step5_square4:"ai-icon-animation-style_exit_step5_square4__SKL7Z"}}},function(e){e.O(0,[667,6139,9678,8183,8421,3844,3145,8286,3517,5022,6751,1421,5573,1761,5232,2550,8947,4713,297,6206,2784,5766,4056,3501,7689,6647,6909,9774,2888,179],function(){return e(e.s=7079)}),_N_E=e.O()}]);